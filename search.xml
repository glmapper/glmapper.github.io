<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[20181111-ä¹¦æ³•ç»ƒä¹ ]]></title>
    <url>%2F2018%2F11%2F10%2Fshufa-20181111%2F</url>
    <content type="text"><![CDATA[é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶ä¹‹å¹¿é™µ -æç™½æ•…äººè¥¿è¾é»„é¹¤æ¥¼ï¼ŒçƒŸèŠ±ä¸‰æœˆä¸‹æ‰¬å·å­¤å¸†è¿œå½±ç¢§ç©ºå°½ï¼Œå”¯è§é•¿æ±Ÿå¤©é™…æµ å°†è¿›é…’ -æç™½å›ä¸è§ï¼Œé»„æ²³ä¹‹æ°´å¤©ä¸Šæ¥ï¼Œå¥”æµåˆ°æµ·ä¸å¤å›ã€‚å›ä¸è§ï¼Œé«˜å ‚æ˜é•œæ‚²ç™½å‘ï¼Œæœå¦‚é’ä¸æš®æˆé›ªã€‚äººç”Ÿå¾—æ„é¡»å°½æ¬¢ï¼Œè«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆã€‚å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£å°½è¿˜å¤æ¥ã€‚çƒ¹ç¾Šå®°ç‰›ä¸”ä¸ºä¹ï¼Œä¼šé¡»ä¸€é¥®ä¸‰ç™¾æ¯ã€‚å²‘å¤«å­ï¼Œä¸¹ä¸˜ç”Ÿï¼Œå°†è¿›é…’ï¼Œæ¯è«åœã€‚ä¸å›æ­Œä¸€æ›²ï¼Œè¯·å›ä¸ºæˆ‘å€¾è€³å¬ã€‚(å€¾è€³å¬ ä¸€ä½œï¼šä¾§è€³å¬)é’Ÿé¼“é¦”ç‰ä¸è¶³è´µï¼Œä½†æ„¿é•¿é†‰ä¸å¤é†’ã€‚(ä¸è¶³è´µ ä¸€ä½œï¼šä½•è¶³è´µï¼›ä¸å¤é†’ ä¸€ä½œï¼šä¸æ„¿é†’/ä¸ç”¨é†’)å¤æ¥åœ£è´¤çš†å¯‚å¯ï¼ŒæƒŸæœ‰é¥®è€…ç•™å…¶åã€‚(å¤æ¥ ä¸€ä½œï¼šè‡ªå¤ï¼›æƒŸ é€šï¼šå”¯)é™ˆç‹æ˜”æ—¶å®´å¹³ä¹ï¼Œæ–—é…’ååƒæ£æ¬¢è°‘ã€‚ä¸»äººä½•ä¸ºè¨€å°‘é’±ï¼Œå¾„é¡»æ²½å–å¯¹å›é…Œã€‚äº”èŠ±é©¬ï¼Œåƒé‡‘è£˜ï¼Œå‘¼å„¿å°†å‡ºæ¢ç¾é…’ï¼Œä¸å°”åŒé”€ä¸‡å¤æ„ã€‚ é’ç‰æ¡ˆÂ·å…ƒå¤• -è¾›å¼ƒç–¾ä¸œé£å¤œæ”¾èŠ±åƒæ ‘ã€‚æ›´å¹è½ã€æ˜Ÿå¦‚é›¨ã€‚å®é©¬é›•è½¦é¦™æ»¡è·¯ã€‚å‡¤ç®«å£°åŠ¨ï¼Œç‰å£¶å…‰è½¬ï¼Œä¸€å¤œé±¼é¾™èˆã€‚è›¾å„¿é›ªæŸ³é»„é‡‘ç¼•ã€‚ç¬‘è¯­ç›ˆç›ˆæš—é¦™å»ã€‚ä¼—é‡Œå¯»ä»–åƒç™¾åº¦ã€‚è“¦ç„¶å›é¦–ï¼Œé‚£äººå´åœ¨ï¼Œç¯ç«é˜‘çŠå¤„ã€‚]]></content>
      <categories>
        <category>ä¹¦æ³•</category>
      </categories>
      <tags>
        <tag>ä¹¦æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-design-model-strategy%2F</url>
    <content type="text"><![CDATA[ä¸Šæ¬¡åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­æœ‰æåŠåˆ°ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼é€šå¸¸ä¸ä¼šå•ç‹¬æ¥è¯•ç”¨ï¼Œåœ¨ä¸€äº›å®é™…çš„åº”ç”¨ä¸­ä¼šæ­é…å…¶ä»–çš„æ¨¡å¼æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¯´ä»Šå¤©è¦å­¦ä¹ çš„ç­–ç•¥æ¨¡å¼ã€‚ ä¸€ç›´æˆ‘éƒ½å¾ˆå–œæ¬¢ç­–ç•¥è¿™ä¸ªè¯ï¼Œæœ‰ç§è«åçš„é«˜å¤§ä¸Šï¼Œå¯¹ä¸‰å›½æœ‰äº†è§£çš„å°ä¼™ä¼´è‚¯å®šä¼šçŸ¥é“ï¼Œæœ‰çš„è°‹å£«æ˜¯æ¯”è¾ƒç›´æ¥çš„ï¼ŒçŒ®è®¡å°±æ˜¯çŒ®è®¡ï¼Œæœ‰è¯å½“é¢è¯´ï¼›ä½†æ˜¯ä¹Ÿæœ‰çš„è°‹å£«å°±æ˜¯æ¯”è¾ƒå–œæ¬¢æä¸€ç§ç¥ç§˜æ„Ÿï¼Œå¼„ä¸ªå°å¸ƒè¢‹å­é‡Œé¢å¡ä¸ªå°å¸ƒæ¡ï¼ˆç®€ç§°ï¼šé”¦å›Šï¼‰ï¼›å¯¹äºä¸€ä»¶å¾ˆæ£˜æ‰‹çš„äº‹æƒ…ï¼Œåœ¨äº¤ä»£ä¸‹å»çš„æ—¶å€™å°±ä¼šæœ‰è¿™æ ·çš„å˜±å’ï¼šâ€œæ­¤äº‹å…³ç³»é‡å¤§ï¼Œè¿˜æœ›XXXï¼ˆæ˜µç§°ï¼‰åŠ¡å¿…å¤„ç†å¦¥å¸–ï¼›è¿™é‡Œæœ‰ä¸‰ä¸ªé”¦å›Šï¼Œå¦‚æœXXXXï¼Œä½ å°±æ‹†å¼€ç¬¬Xä¸ªé”¦å›Šï¼Œç„¶åXXXXâ€ï¼›æœ‰æ—¶å€™æˆ‘å°±å¾ˆä¸è§£ï¼Œå‡å¦‚çœŸåœ¨é‡åˆ°äº‹æƒ…çš„æ—¶å€™æ¥çœ‹ï¼Œé‚£è·¯ä¸Šä¸¢äº†æ€ä¹ˆåŠï¼Ÿä¸€æ‘¸å£è¢‹å°±æ‡µé€¼äº†æœ‰æœ¨æœ‰ï¼Ÿ æ‰¯è¿œäº†ï¼Œä¸è¿‡æ„æ€å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œä¸€ä¸ªé”¦å›Šå…¶å®å°±æ˜¯ä¸€ç§ç­–ç•¥ï¼›ç„¶åå®ƒæœ‰ä¸€ä¸ªæ€»çš„èƒŒæ™¯ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼‰ï¼Œè¿™ä¸ªå¤§èƒŒæ™¯ä¸‹ï¼Œæ¯ä¸ªä¸åŒçš„åœºæ™¯éƒ½ä¼šæœ‰ä¸€ä¸­ç­–ç•¥æ¥å¯¹åº”å¤„ç†ï¼› æˆ‘ä»¬å…ˆä»¥ä¸Šé¢çš„åˆ—å­ä¸ºèƒŒæ™¯æ¥æ’¸ä¸€ä¸ªå°çš„ä¾‹å­ï¼Œç„¶åå†å»çœ‹ä¸€ä¸ªspringä¸­æ¯”è¾ƒå…¸å‹çš„ç­–ç•¥æ¨¡å¼ä½¿ç”¨ï¼Œæœ€åå†æ¥æ¢è®¨ä¸‹ç­–ç•¥æ¨¡å¼çš„ç±»å›¾ï¼Œå¹¶ä»¥æ­¤æ¥è¯´æ˜ç­–ç•¥æ¨¡å¼ä¸­çš„ä¸€äº›åŸºæœ¬è§’è‰²åŠå…¶èŒè´£ã€‚ é”¦å›Šå¦™è®¡ å…µé©¬æœªåŠ¨ï¼Œç²®è‰å…ˆè¡Œï¼›ä½†æ˜¯è¿™ä¸ªè¿è¾“ç²®è‰åˆ°åº•æ˜¯èµ°æ°´è·¯è¿˜æ˜¯èµ°é™†åœ°å‘¢ï¼Ÿé‚£è¿™å¾—çœ‹å¾€å“ªè¿â€¦ 12345678910111213141516171819202122232425package com.glmapper.designmode.policy;/** * @description: å¤§èƒŒæ™¯ï¼Œè¿è¾“ç²®è‰ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/5/5 */public class TransportFood &#123; //æŒæœ‰ä¸€ä¸ªè¿è¾“ç­–ç•¥çš„å¯¹è±¡ private TransportFoodStrategy strategy; /** * æ„é€ å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå…·ä½“ç­–ç•¥å¯¹è±¡ * @param strategy å…·ä½“ç­–ç•¥å¯¹è±¡ */ public TransportFood(TransportFoodStrategy strategy)&#123; this.strategy = strategy; &#125; /** * ç­–ç•¥æ–¹æ³• */ public void trasportFood()&#123; strategy.trasport(); &#125;&#125; è¿™ä¸ªæ˜¯æˆ‘ä»¬çš„æ€»ä½“èƒŒæ™¯ï¼Œå°±æ˜¯è¿è¾“ç²®è‰ï¼›ä½†æ˜¯è¿™ä¸ªåªæ˜¯è¯´è¦è¿è¾“ç²®è‰ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¯´æ˜¯æ€ä¹ˆè¿ï¼Ÿè¿™å°±å¾—TransportFoodStrategyè¿™ä¸ªè¿è¾“ç­–ç•¥æœ‰å…·ä½“çš„è¿è¾“æ–¹æ¡ˆã€‚ è¿è¾“æ–¹æ¡ˆ1ï¼šå¦‚æœç²®è‰æ˜¯ä»æ­¦æ±‰åˆ°å—äº¬ï¼ŒOKï¼Œé‚£å°±èµ°æ°´è¿å§ã€‚ 123456789101112/** * @description: è¿è¾“ç²®è‰çš„ç­–ç•¥ä¹‹æ°´è¿è¿è¾“ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/5/5 */public class WaterTransportStrategy implements TransportFoodStrategy &#123; @Override public void trasport() &#123; System.out.println("ç”¨èˆ¹ï¼Œèµ°æ°´è¿"); &#125;&#125; è¿è¾“æ–¹æ¡ˆ2ï¼šå¦‚æœä»å†…è’™åˆ°åŒ—äº¬ï¼›é‚£å°±èµ°é™†è¿å§ã€‚ 123456789101112/** * @description: è¿è¾“ç²®è‰çš„ç­–ç•¥ä¹‹é™†åœ°è¿è¾“ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/5/5 */public class LandTransportStrategy implements TransportFoodStrategy &#123; @Override public void trasport() &#123; System.out.println("ç”¨é©¬è½¦ï¼Œèµ°é™†è¿"); &#125;&#125; å¥½äº†ï¼Œæ¥çœ‹ä¸‹å¦™è®¡ä½¿ç”¨ï¼š 1234567891011121314151617181920212223242526272829303132333435/** * @description: å†³ç­–åˆ¶å®š-å®¢æˆ·ç«¯ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/5/5 */public class Client &#123; public static void main(String[] args) &#123; TransportFoodStrategy strategy = getTransportFoodStrategy("å†…è’™åˆ°åŒ—äº¬"); TransportFood transportFood = new TransportFood(strategy); transportFood.trasportFood(); &#125; /** * è·å–è¿è¾“æ–¹æ¡ˆ * @param lineType è¿è¾“è·¯çº¿ * @return */ private static TransportFoodStrategy getTransportFoodStrategy( String lineType)&#123; if (lineType.equals("å†…è’™åˆ°åŒ—äº¬"))&#123; return new LandTransportStrategy(); &#125; if (lineType.equals("æ­¦æ±‰åˆ°å—äº¬"))&#123; return new WaterTransportStrategy(); &#125; return null; &#125;&#125;-&gt; ç”¨é©¬è½¦ï¼Œèµ°é™†è¿ ç²®è‰è¿å®Œäº†ï¼ŒçœŸæ­£çš„è¡¨æ¼”å¼€å§‹äº†â€¦ Springä¸­å…¸å‹çš„ç­–ç•¥æ¨¡å¼ä½¿ç”¨æˆ‘ä»¬çŸ¥é“springåŠ è½½èµ„æºæ–‡ä»¶æ˜¯é€šè¿‡ResourceLoaderæ¥æå®šçš„ã€‚åœ¨ResourceLoaderä¸­æä¾›äº†ä¸€ä¸ªï¼š 1Resource getResource(String location); è¿™ä¸ªæ–¹æ³•çš„æ³¨è§£ä¸­è¯´é“ 12//å…è®¸å¤šä¸ªèµ„æºè°ƒç”¨ã€‚allowing for multiple &#123;@link Resource#getInputStream()&#125; calls. è¿™é‡Œå°±å¾ˆèµ¤è£¸è£¸äº†ï¼Œä»–å‘Šè¯‰äº†ä½ è¦è·å–èµ„æºï¼Œä½†æ˜¯å¦‚æœè·å–èµ„æºå‘¢ï¼Ÿè¿™å°±å¾—çœ‹æœ‰å“ªäº›å…·ä½“çš„è·å–ç­–ç•¥äº†ã€‚ ä¸Šå›¾å°±æ˜¯Resourceçš„å…·ä½“å­ç±»å®ç°ï¼Œä¹Ÿå°±æ˜¯ä¸€äº›å…·ä½“çš„ç­–ç•¥ã€‚æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„åº”è¯¥ç®—æ˜¯UrlResourceï¼ˆåŠ è½½URLæŒ‡å®šçš„èµ„æºï¼‰å’ŒClasspathResourceï¼ˆåŠ è½½ç±»è·¯å¾„ä¸­çš„èµ„æºï¼‰è¿™ä¸¤ä¸ªã€‚å†æ¥çœ‹ä¸‹è¿™ä¸ªgetResourceè¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š getResourceæ–¹æ³•æ˜¯åœ¨DefaultResourceLoaderä¸­å…·ä½“å®ç°çš„ï¼›DefaultResourceLoaderæ˜¯ResourceLoaderçš„é»˜è®¤å®ç°ã€‚ 12345678910111213141516171819202122232425262728293031323334@Overridepublic Resource getResource(String location) &#123; Assert.notNull(location, "Location must not be null"); //é¦–å…ˆä½¿ç”¨ProtocolResolveræ¥é€šè¿‡locationå‚æ•°åˆ›å»ºResourceå¯¹è±¡ // spring4.3.xå¼€å§‹æ‰æœ‰çš„ for (ProtocolResolver protocolResolver : this.protocolResolvers) &#123; Resource resource = protocolResolver.resolve(location,this); if (resource != null) &#123; return resource; &#125; &#125; //æŒ‡å®šè·¯å¾„çš„ if (location.startsWith("/")) &#123; return getResourceByPath(location); &#125; //ä»¥classpathå¼€å¤´çš„ else if (location.startsWith(CLASSPATH_URL_PREFIX)) &#123; return new ClassPathResource(location.substring( CLASSPATH_URL_PREFIX.length()), getClassLoader()); &#125; //è¿™é‡Œæ˜¯å…ˆå°è¯•è§£ææ˜¯å¦æ˜¯å¸¦æœ‰ç½‘ç»œåè®®çš„èµ„æºï¼Œ //å¦‚æœè§£æå¼‚å¸¸ï¼Œåˆ™æ˜¯åœ¨å¼‚å¸¸å¤„ç†ä¸­ä½¿ç”¨äº†ä¸€ç§é»˜è®¤çš„æœºåˆ¶ã€‚ else &#123; try &#123; // Try to parse the location as a URL... URL url = new URL(location); return new UrlResource(url); &#125; catch (MalformedURLException ex) &#123; // No URL -&gt; resolve as resource path. return getResourceByPath(location); &#125; &#125;&#125; å…³äºProtocolResolver å…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™é‡Œçš„locationå…¶å®å’Œæˆ‘ä»¬ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­çš„lineTypeçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œæ ¹æ®è¿™ä¸ªæ¥ç¡®å®šå…·ä½“ä½¿ç”¨å“ªä¸ªç­–ç•¥æ–¹æ³•ã€‚ ç­–ç•¥1ï¼šä½¿ç”¨ProtocolResolveræ¥é€šè¿‡locationå‚æ•°åˆ›å»ºResourceå¯¹è±¡ï¼Œåœ¨ProtocolResolverä¸­å…³äºProtocolResolverçš„è§£é‡Šæ˜¯ï¼šA resolution strategy for protocol-specific resource handles-åè®®ä¸“ç”¨èµ„æºå¥æŸ„çš„è§£æç­–ç•¥ã€‚ ç­–ç•¥2ï¼šè¿”å›ç»™å®šè·¯å¾„ä¸Šèµ„æºçš„èµ„æºå¥æŸ„ã€‚ ç­–ç•¥3ï¼šä»¥classpath:ä¸ºå‰ç¼€çš„ï¼Œè¿™ç§locationå‚æ•°ç›´æ¥è¿”å›ä¸€ä¸ªClassPathResourceå¯¹è±¡ï¼Œè¡¨ç¤ºåŠ è½½classesè·¯å¾„ä¸‹çš„èµ„æºï¼› ç­–ç•¥4ï¼šä½¿ç”¨ç½‘ç»œåè®®ä½œä¸ºå‰ç¼€çš„ï¼Œæ¯”å¦‚httpã€ftpç­‰ï¼Œè¿™ç§ç›´æ¥è¿”å›ä¸€ä¸ªUrlResourceå¯¹è±¡ï¼› ç­–ç•¥5ï¼šæ— å‰ç¼€çš„ï¼Œåœ¨é»˜è®¤å®ç°ä¸­å’Œç¬¬ä¸‰ç§ä¸€æ ·æ˜¯åŠ è½½classesè·¯å¾„ä¸‹çš„èµ„æºï¼Œä¸åŒçš„æ˜¯æ­¤å¤„å½“ä½œæ˜¯ClassPathContextResourceæ¥å¤„ç†çš„ã€‚ Springä¸­Resourceçš„ç­–(tao)ç•¥(lu)è¯´å®Œäº†ï¼Œå†å›è¿‡å¤´æ¥çœ‹ä¸‹ç­–ç•¥æ¨¡å¼çš„ä¸€äº›å…·ä½“ç†è®ºçŸ¥è¯†ã€‚ ç­–ç•¥æ¨¡å¼ å®šä¹‰ï¼šç­–ç•¥æ¨¡å¼å±äºå¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚å…¶ç”¨æ„æ˜¯é’ˆå¯¹ä¸€ç»„ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…åˆ°å…·æœ‰å…±åŒæ¥å£çš„ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä»è€Œä½¿å¾—å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥åœ¨ä¸å½±å“åˆ°å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹å‘ç”Ÿå˜åŒ–ã€‚ ç»“åˆå‰é¢çš„ä¾‹å­åˆ†æå’Œè¿™æ®µå®šä¹‰ï¼Œå¯ä»¥çŸ¥é“ï¼Œå…¶å®ç­–ç•¥æ¨¡å¼çœŸçš„æ„å›¾ä¸æ˜¯å¦‚ä½•å®ç°ç­–ç•¥ç®—æ³•ï¼Œå®ƒæ›´åœ¨æ„çš„æ˜¯å¦‚ä½•ç»„ç»‡è¿™äº›ç®—æ³•ã€‚ è¿™ä¹Ÿæ˜¯ç­–ç•¥æ¨¡å¼çš„ä½¿ç”¨å¯ä»¥è®©ç¨‹åºç»“æ„æ›´çµæ´»ï¼Œå…·æœ‰æ›´å¥½çš„ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§çš„é‡è¦å› ç´ ã€‚ ç±»å›¾ï¼šè¿™ä¸ªç±»å›¾ç”»çš„ç¡®å®æ˜¯æœ‰ç‚¹ä¸‘ï¼Œä½†æ˜¯ä¸ºäº†äº²æ‰‹ç»˜åˆ¶ä¸€ä¸‹ï¼Œæ‰€ä»¥è¿˜è¯·å¤šå¤šè§è°…ï¼ ç±»å›¾ä¸­çš„ä¸€äº›è§’è‰²ï¼š contextï¼šç­–ç•¥èƒŒæ™¯ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨ç­–ç•¥çš„ä¸»ä½“ï¼›å®ƒæŒæœ‰ä¸€ä¸ªstrategyç±»çš„å¼•ç”¨ strategyï¼šæŠ½è±¡ç­–ç•¥ï¼Œè¿™ä¸ªè§’è‰²ç»™å‡ºäº†æ‰€æœ‰å…·ä½“ç­–ç•¥ç±»æ‰€éœ€çš„æ¥å£ã€‚æ‰€ä»¥é€šå¸¸æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…æ¥å£ã€‚ strategyPolicyï¼šå…·ä½“ç­–ç•¥ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åŒ…è£…å…·ä½“çš„ç®—æ³•æˆ–è€…è¡Œä¸º é‚£ä¹ˆåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œç­–ç•¥æ¨¡å¼åˆ°åº•ç»™æˆ‘ä»¬å¸¦æ¥çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜å‘¢ï¼Ÿè¿™ä¸ªéœ€è¦ä»æ¨¡å¼æœ¬èº«çš„ä¼˜ç¼ºç‚¹æ¥çœ‹ï¼š ä¼˜ç‚¹ ç­–ç•¥æ¨¡å¼æä¾›äº†ç®¡ç†ç›¸å…³çš„ç®—æ³•æ—çš„åŠæ³•ã€‚ç­–ç•¥ç±»çš„ç­‰çº§ç»“æ„å®šä¹‰äº†ä¸€ä¸ªç®—æ³•æˆ–è¡Œä¸ºæ—ã€‚æ°å½“ä½¿ç”¨ç»§æ‰¿å¯ä»¥æŠŠå…¬å…±çš„ä»£ç ç§»åˆ°çˆ¶ç±»é‡Œé¢ï¼Œä»è€Œé¿å…ä»£ç é‡å¤ã€‚ ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶(if-else)è¯­å¥ã€‚é€šå¸¸å¯¹äºä¸€ä¸ªèƒŒæ™¯ä¸»ä½“ï¼Œä¸€èˆ¬åªä¼šæœ‰ä¸€ç§ç­–ç•¥ç®—æ³•å¯ä¾›ä½¿ç”¨ï¼Œä½¿ç”¨å¤šé‡æ¡ä»¶å¥çš„è¯ä¸æ˜“ç»´æŠ¤ï¼›å› ä¸ºå®ƒæŠŠé‡‡å–å“ªä¸€ç§ç®—æ³•æˆ–é‡‡å–å“ªä¸€ç§è¡Œä¸ºçš„é€»è¾‘ä¸ç®—æ³•æˆ–è¡Œä¸ºçš„é€»è¾‘æ··åˆåœ¨ä¸€èµ·äº†ã€‚ ç¼ºç‚¹ å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚è¿™å°±æ„å‘³ç€å®¢æˆ·ç«¯å¿…é¡»ç†è§£è¿™äº›ç®—æ³•çš„åŒºåˆ«ï¼Œä»¥ä¾¿é€‚æ—¶é€‰æ‹©æ°å½“çš„ç®—æ³•ç±»ã€‚æ¢è¨€ä¹‹ï¼Œç­–ç•¥æ¨¡å¼åªé€‚ç”¨äºå®¢æˆ·ç«¯çŸ¥é“ç®—æ³•æˆ–è¡Œä¸ºçš„æƒ…å†µã€‚ ç”±äºç­–ç•¥æ¨¡å¼æŠŠæ¯ä¸ªå…·ä½“çš„ç­–ç•¥å®ç°éƒ½å•ç‹¬å°è£…æˆä¸ºç±»ï¼Œå¦‚æœå¤‡é€‰çš„ç­–ç•¥å¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆå¯¹è±¡çš„æ•°ç›®å°±ä¼šå¾ˆå¯è§‚ã€‚â€“å¦‚æœç­–ç•¥å¾ˆå¤šï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä¸€äº›æ··åˆç­–ç•¥æ¥é¿å…ç­–ç•¥ç±»çš„ä¸æ–­è†¨èƒ€ã€‚ åœ¨äº†è§£å…¶ä¼˜ç¼ºç‚¹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆç†çš„å°†å…¶æ”¾åœ¨ä¸€äº›é€‚å½“çš„åœºæ™¯ä¸­æ¥ï¼›å¦‚ä»¥ä¸‹åœºæ™¯ï¼š å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚ ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œå¦‚æœä¸ç”¨æ°å½“çš„æ¨¡å¼ï¼Œè¿™äº›è¡Œä¸ºå°±åªå¥½ä½¿ç”¨å¤šé‡çš„æ¡ä»¶é€‰æ‹©è¯­å¥æ¥å®ç°ã€‚ å‚è€ƒ ã€ŠJAVAä¸æ¨¡å¼ã€‹ ã€ŠJAVAä¸æ¨¡å¼ã€‹ä¹‹ç­–ç•¥æ¨¡å¼ ç­–ç•¥æ¨¡å¼]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-æ¨¡æ¿æ–¹æ³•æ¨¡å¼]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-design-model-modulemethod%2F</url>
    <content type="text"><![CDATA[æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨sringä¸­æœ‰å¤§é‡çš„åº”ç”¨ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¥å°†å½“å‰çš„å®ç°å§”æ‰˜ç»™å­ç±»æ¥å®ç°ï¼Œå¢å¼ºä»£ç çš„å¯æ‰©å±•æ€§å’Œå¤ç”¨æ€§ã€‚å› ä¸ºæ¶‰åŠåˆ°çˆ¶å­ç±»å…³ç³»ï¼Œæ‰€ä»¥æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯åŸºäºâ€œç»§æ‰¿â€æ¥å®ç°çš„ï¼›æ¨¡æ¿æ–¹æ³•æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚ ç®€å•åœ°è¯´å°±æ˜¯ï¼Œé€šè¿‡çˆ¶ç±»æ¥å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•éª¨æ¶ï¼Œå¹¶ä¸”çº¦å®šè¿™äº›æ–¹æ³•åŠå…¶è°ƒç”¨é¡ºåºï¼Œè€Œå…·ä½“çš„æŸäº›ç‰¹å®šæ–¹æ³•ç”±å­ç±»å®ç°ã€‚ å…ˆæ¥çœ‹ä¸€ä¸ªå°demoï¼›æˆ‘ä»¬ä»¥å†™åšå®¢æ¥ä¸¾ä¾‹å­ï¼Œä¸€èˆ¬æˆ‘ä»¬å†™åšå®¢çš„æ­¥éª¤å¦‚ä¸‹ï¼š æ‰“å¼€ç›®æ ‡ç½‘ç«™ æ‰“å¼€ç¼–è¾‘å™¨ å†™æ–‡ç«  å‘å¸ƒæ–‡ç«  å®ä¾‹ä»£ç é¦–å…ˆæ˜¯å®šä¹‰ä¸€ä¸ªçˆ¶ç±»ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142package com.glmapper.designmode.mudolmethod;/** * @description: æŠ½è±¡æ¨¡æ¿çˆ¶ç±» * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/30 */public abstract class AbstractTemplateMethod &#123; /** * æµç¨‹æ–¹æ³•1ï¼šæŠ½è±¡æ–¹æ³•ï¼Œä¾›å­ç±»å®ç° */ public abstract void openTargetWebSite(); /** * æµç¨‹æ–¹æ³•2ï¼šå­ç±»å¯é€‰æ‹©é‡å†™ */ public void openMarkDown()&#123; System.out.println("æ‰“å¼€ç¼–è¾‘å™¨"); &#125; /** * æµç¨‹æ–¹æ³•3ï¼šæŠ½è±¡æ–¹æ³•ï¼Œä¾›å­ç±»å®ç° */ public abstract void writeBlog(); /** * æµç¨‹æ–¹æ³•4ï¼šå­ç±»å¯é€‰æ‹©é‡å†™ */ protected void publisher()&#123; System.out.println("å‘å¸ƒæ–‡ç« "); &#125; /** * æ¨¡æ¿æ–¹æ³•ï¼Œæ­¤å¤„ç”³æ˜ä¸ºfinalï¼Œæ˜¯ä¸å¸Œæœ›å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œé˜²æ­¢æ›´æ”¹æµç¨‹çš„æ‰§è¡Œé¡ºåº */ public final void templateWriteBlog()&#123; openTargetWebSite(); openMarkDown(); writeBlog(); publisher(); &#125;&#125; ä¸Šé¢ä»£ç ä¸­æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªtemplateWriteBlogæ–¹æ³•ï¼Œè¿™é‡Œæ–¹æ³•ä¸­åŒ…æ‹¬äº†å†™åšå®¢çš„ä¸€äº›æµç¨‹ã€‚åœ¨è¿™äº›æµç¨‹æ–¹æ³•ä¸­æœ‰äº›æ–¹æ³•çˆ¶ç±»æä¾›äº†é»˜è®¤å®ç°ï¼Œè€Œä¸€äº›å…·æœ‰å·®å¼‚æ€§çš„æ–¹æ³•åˆ™è®©å­ç±»æ¥å®ç°ã€‚ 123456789101112131415161718package com.glmapper.designmode.mudolmethod;/** * @description: å­ç±» * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/30 */public class JueJinTemplateMethodPolicy extends AbstractTemplateMethod &#123; @Override public void openTargetWebSite() &#123; System.out.println("æ‰“å¼€æ˜é‡‘ç½‘ç«™"); &#125; @Override public void writeBlog() &#123; System.out.println("å†™ä¸€ç¯‡Springç›¸å…³çš„æ–‡ç« "); &#125;&#125; å­ç±»1ï¼šJueJinTemplateMethodPolicyï¼Œè¿™ä¸ªå­ç±»ä¸­å®ç°äº†çˆ¶ç±»ä¸­çš„éƒ¨åˆ†æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼šopenTargetWebSiteå’ŒwriteBlogã€‚ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå»é‡å†™çˆ¶ç±»é»˜è®¤å·²ç»å®ç°çš„æ–¹æ³•ï¼Œä»…å®ç°çˆ¶ç±»ä¸­é¢„ç•™çš„æŠ½è±¡æ–¹æ³•æ¥å®ç°ï¼‰ã€‚ 1234567891011121314151617181920package com.glmapper.designmode.mudolmethod;/** * @description: å­ç±» * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/30 */public class CSDNTemplateMethodPolicy extends AbstractTemplateMethod&#123; @Override public void openTargetWebSite() &#123; System.out.println("æ‰“å¼€CSDNç½‘ç«™"); &#125; @Override public void writeBlog() &#123; System.out.println("å†™ä¸€ç¯‡è®¾è®¡æ¨¡å¼æ–‡ç« "); &#125;&#125; å­ç±»2ï¼šCSDNTemplateMethodPolicy,è¿™ä¸ªå­ç±»çš„ä½œç”¨å…¶å®å’Œå­ç±»1æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯æä¾›äº†å¦å¤–çš„ä¸€ç§å®ç°ç­–ç•¥ï¼›ï¼ˆå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼éƒ½æ˜¯å’Œç­–ç•¥æ¨¡å¼æ¥è”åˆä½¿ç”¨çš„ï¼Œé€šè¿‡ä¸€å¥—æ¨¡æ¿æœºåˆ¶ï¼Œå¯¹äºæ¨¡æ¿ä¸­çš„éƒ¨åˆ†æµç¨‹é€šè¿‡ä¸åŒçš„ç­–ç•¥æ¥å®ç°ä¸åŒçš„åŠŸèƒ½ï¼‰ 1234567891011121314151617181920212223242526package com.glmapper.designmode.mudolmethod;/** * @description: å­ç±» * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/30 */public class MainTest &#123; public static void main(String[] args) &#123; AbstractTemplateMethod csdnTemplate = new CSDNTemplateMethodPolicy(); csdnTemplate.templateWriteBlog(); AbstractTemplateMethod juejinTemplate = new JueJinTemplateMethodPolicy(); juejinTemplate.templateWriteBlog(); &#125;&#125;æ‰“å¼€CSDNç½‘ç«™æ‰“å¼€ç¼–è¾‘å™¨å†™ä¸€ç¯‡è®¾è®¡æ¨¡å¼æ–‡ç« å‘å¸ƒæ–‡ç« æ‰“å¼€æ˜é‡‘ç½‘ç«™æ‰“å¼€ç¼–è¾‘å™¨å†™ä¸€ç¯‡Springç›¸å…³çš„æ–‡ç« å‘å¸ƒæ–‡ç«  ä¸Šé¢æ˜¯å®¢æˆ·ç«¯ä»£ç åŠè¾“å‡ºç»“æœã€‚é€šè¿‡è¾“å‡ºæˆ‘ä»¬å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºï¼Œæ¨¡æ¿ä¸­çš„ä¸€äº›æ–¹æ³•å°†å»¶è¿Ÿåˆ°å­ç±»ä¸­å»å®ç°ï¼Œæ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚å› æ­¤å¯¹äºæ¨¡æ¿æ–¹æ³•è¿™ä¸ªæ¨¡å¼æ¥è¯´ï¼Œçˆ¶ç±»æ˜¯å§‹ç»ˆæ§åˆ¶ç€æ•´ä¸ªæµç¨‹ä¸»åŠ¨æƒçš„ï¼Œè€Œå­ç±»åªæ˜¯è¾…åŠ©çˆ¶ç±»å®ç°æŸäº›å¯å®šåˆ¶çš„æ­¥éª¤ã€‚ æ¨¡å¼è§£æå…ˆçœ‹ä¸‹æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç±»å›¾ï¼š ä»ç±»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­çš„è§’è‰²ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªè§’è‰²ï¼š æŠ½è±¡æ¨¡æ¿ï¼ˆAbstractTemplateï¼‰ï¼š å®šä¹‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŠ½è±¡æ“ä½œï¼Œä»¥ä¾¿äºè®©å­ç±»å®ç°ã€‚è¿™äº›æŠ½è±¡æ“ä½œå°±æ˜¯æµç¨‹ä¸­çš„åŸºæœ¬æ“ä½œï¼ˆå¯¹åº”çš„æ˜¯æ¨¡æ¿æ–¹æ³•ä¸­çš„æŸä¸ªå…·ä½“çš„æ“ä½œæ–¹æ³•ï¼‰ï¼›è¿™äº›åŸºæœ¬æ“ä½œæ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ å®šä¹‰å¹¶ä¸”å®ç°äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚è¿™ä¸ªæ¨¡æ¿æ–¹æ³•ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„éª¨æ¶ï¼Œè€Œé€»è¾‘çš„ç»„æˆæ­¥éª¤åœ¨ç›¸åº”çš„æŠ½è±¡æ“ä½œä¸­ï¼Œæ¨è¿Ÿåˆ°å­ç±»ä¸­å–å®ç°ï¼Œå½“ç„¶ï¼Œåœ¨è¿™ä¸ªé¡¶çº§é€»è¾‘ä¸­ï¼Œéƒ¨åˆ†æ–¹æ³•ä¹Ÿå¯ä»¥ç”±çˆ¶ç±»æ¥æä¾›é»˜è®¤å®ç°çš„ã€‚ å…·ä½“ç±»ï¼ˆSubTemplateImpl)ï¼š å®ç°çˆ¶ç±»æ‰€å®šä¹‰çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŠ½è±¡æ–¹æ³• æ¯ä¸€ä¸ªæŠ½è±¡æ¨¡æ¿è§’è‰²éƒ½å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå…·ä½“æ¨¡æ¿è§’è‰²ä¸ä¹‹å¯¹åº”ï¼Œè€Œæ¯ä¸€ä¸ªå…·ä½“æ¨¡æ¿è§’è‰²éƒ½å¯ä»¥ç»™å‡ºè¿™äº›æŠ½è±¡æ–¹æ³•çš„ä¸åŒå®ç°ã€‚ æ¨¡æ¿æ–¹æ³•ä¸­çš„è¿™ä¸ªæ–¹æ³•çš„æ¦‚å¿µæ‹†å¼€æ¥è¯´åŒ…æ‹¬ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯æ¨¡æ¿æ–¹æ³•é‡Œé¢çš„åŸºæœ¬æ–¹æ³•ã€‚æ¨¡æ¿æ–¹æ³•å®šä¹‰æ¸¸æˆè§„åˆ™ï¼ŒåŸºæœ¬æ–¹æ³•å®ç°è§„åˆ™ä¸­çš„æ¯ä¸ªéƒ¨åˆ†ã€‚ æ¨¡æ¿æ–¹æ³•å¸¦æ¥çš„ä¼˜åŠ¿æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆçš„å¸®åŠ©æˆ‘ä»¬æå®šä¸‹é¢çš„è¿™äº›åœºæ™¯é—®é¢˜ï¼š å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚ æå–å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚ è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚ ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºå¯¹äºæ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§ã€‚ å…¸å‹çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„åº”ç”¨æœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯servletï¼Œservletçš„ç”Ÿå‘½å‘¨æœŸ(ä»¥å‰ç»å¸¸é‡åˆ°çš„é¢è¯•ç‚¹ï¼Œç°åœ¨å·²ç»æ²¡äººé—®äº†å§) åˆå§‹åŒ– init å¤„ç† service é”€æ¯ destroy å…¶å®è¿™é‡Œæˆ‘è§‰å¾—ä¹Ÿæ˜¯æ¨¡æ¿æ–¹æ³•çš„ä¸€ç§ä½“ç°ï¼Œè™½ç„¶åœ¨servletä¸­æ²¡æœ‰å®šä¹‰é¡¶å±‚çš„æ¨¡æ¿æ–¹æ³•æ¥æ§åˆ¶è¿™ä¸ªæµç¨‹(æˆ‘çš„æƒ³æ³•æ˜¯è¿™ä¸ªæµç¨‹æ˜¯ç”±å®¹å™¨æ¥æ§åˆ¶çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ç§é»˜è®¤çš„çº¦å®š)ã€‚ åœ¨å…¶å­ç±»GenericServletä¸­å¯¹initå’Œdestroyæœ‰äº†é»˜è®¤çš„å®ç°ï¼Œè€Œserviceæ–¹æ³•åˆ™æ˜¯äº¤ç”±å­ç±»æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•servletç±»å‡å¿…é¡»å®ç°serviceæ–¹æ³•ã€‚ è¿™é‡Œçš„serviceæ–¹æ³•å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚serviceæ–¹æ³•ä¸­è°ƒç”¨äº†7ä¸ªdoæ–¹æ³•ä¸­çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªï¼Œå®Œæˆå¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼Œè¿™äº›doæ–¹æ³•éœ€è¦ç”±HttpServletçš„å…·ä½“å­ç±»æä¾›ã€‚ HttpServletä¸­çš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041protected void service(HttpServletRequest req, HttpServletResponseresp) throws ServletException, IOException &#123; String method = req.getMethod(); long lastModified; if (method.equals("GET")) &#123; lastModified = this.getLastModified(req); if (lastModified == -1L) &#123; this.doGet(req, resp); &#125; else &#123; long ifModifiedSince = req.getDateHeader("If-Modified-Since"); if (ifModifiedSince &lt; lastModified) &#123; this.maybeSetLastModified(resp, lastModified); this.doGet(req, resp); &#125; else &#123; resp.setStatus(304); &#125; &#125; &#125; else if (method.equals("HEAD")) &#123; lastModified = this.getLastModified(req); this.maybeSetLastModified(resp, lastModified); this.doHead(req, resp); &#125; else if (method.equals("POST")) &#123; this.doPost(req, resp); &#125; else if (method.equals("PUT")) &#123; this.doPut(req, resp); &#125; else if (method.equals("DELETE")) &#123; this.doDelete(req, resp); &#125; else if (method.equals("OPTIONS")) &#123; this.doOptions(req, resp); &#125; else if (method.equals("TRACE")) &#123; this.doTrace(req, resp); &#125; else &#123; String errMsg = lStrings.getString("http.method_not_implemented"); Object[] errArgs = new Object[]&#123;method&#125;; errMsg = MessageFormat.format(errMsg, errArgs); resp.sendError(501, errMsg); &#125; &#125; FrameworkServletä¸­çš„å®ç°(FrameworkServletæ˜¯SpringMVCæ ¸å¿ƒæ§åˆ¶å™¨DispatchServletçš„çˆ¶ç±»)ï¼š 1234567891011121314151617/** * Override the parent class implementation in order to intercept PATCH requests. */@Overrideprotected void service(HttpServletRequest request,HttpServletResponse response) throws ServletException, IOException &#123; HttpMethod httpMethod = HttpMethod.resolve(request.getMethod()); if (HttpMethod.PATCH == httpMethod || httpMethod == null) &#123; processRequest(request, response); &#125; else &#123; super.service(request, response); &#125;&#125; å…³äºæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„å­¦ä¹ å°±åˆ°è¿™é‡Œäº†ã€‚]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-è§‚å¯Ÿè€…æ¨¡å¼]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-design-model-obs%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘æƒ³æ·±å…¥ç ”ç©¶ä¸‹å“åº”å¼ç¼–ç¨‹ï¼Œä½œä¸ºåŸºç¡€å¾ˆæœ‰å¿…è¦æ¥æŠŠè§‚å¯Ÿè€…æ¨¡å¼æ’¸ä¸€éï¼›ä¸€å¼€å§‹æˆ‘æ˜¯è§‰å¾—å¾ˆeasy,ç„¶åå°±ç›´æ¥å¼€æ’¸äº†ï¼Œæ’¸ç€æ’¸ç€å‘ç°æ’¸ä¸åŠ¨äº†ã€‚å› ä¸ºæˆ‘çªç„¶ä¸å¤ªæ˜ç™½è¿™ä¸ªæ¨¡å¼äº†ï¼Œè¯´å¥½çš„è§‚å¯Ÿè€…ï¼Œåˆ°åº•å‘å¸ƒ-è®¢é˜…çš„ä¸¤è€…æ‰§è¡Œè€…è°æ‰æ˜¯è§‚å¯Ÿè€…ï¼Ÿåˆæˆ–è€…è¯´è¿˜æœ‰å…¶ä»–è§’è‰²ï¼Ÿä½†æ˜¯æ ¹æ®ã€ŠJAVAä¸æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­çš„ç»“æ„ï¼Œå¹¶æ²¡æœ‰é¢å¤–çš„è§’è‰²å‡ºç°ã€‚ æ€è€ƒä¸­â€¦.ï¼Œå¥½å§æƒ³ä¸å‡ºæ¥â€¦.ï¼Œè·‘æ­¥å»â€¦ è·‘æ­¥æ—¶æˆ‘ç»™è‡ªå·±ç½—åˆ—äº†å‡ ä¸ªé—®é¢˜ï¼š è¿™é‡Œå…ˆæŠ›å‡ºå®šä¹‰ï¼šGOFç»™è§‚å¯Ÿè€…æ¨¡å¼å¦‚ä¸‹å®šä¹‰ï¼šå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚ æ—¢ç„¶æ˜¯å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜æ›´ï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯è°çš„çŠ¶æ€å‘ç”Ÿäº†å˜æ›´ï¼Œåˆå¯¼è‡´äº†è°è¢«é€šçŸ¥ã€‚ è§‚å¯Ÿè€…æ¨¡å¼æ—¢ç„¶åˆå¯ä»¥ç§°ä¹‹ä¸ºâ€œå‘å¸ƒ-è®¢é˜…æ¨¡å¼â€ï¼Œé‚£ä¹ˆå¯¹åº”èµ·æ¥ï¼Œè§‚å¯Ÿè€…åˆ°åº•æ‰¿å½“äº†â€œå‘å¸ƒâ€çš„è§’è‰²è¿˜æ˜¯â€œè®¢é˜…â€çš„è§’è‰²ã€‚å°±æ˜¯è¯´è§‚å¯Ÿè€…åˆ°åº•æ˜¯ä¸»åŠ¨çš„è¿˜æ˜¯è¢«åŠ¨çš„ï¼Ÿ è¢«è§‚å¯Ÿè€…åˆå¹²äº†ä»€ä¹ˆäº‹ï¼Ÿå®ƒæ˜¯ä¸»åŠ¨çš„è¿˜æ˜¯è¢«åŠ¨çš„è§’è‰²ï¼Ÿ è¿™é‡Œç”±äºä¸€äº›å®šå¼æ€ç»´ï¼Œæ€»ä¼šè§‰å¾—æ—¢ç„¶æ˜¯â€œè¢«è§‚å¯Ÿè€…â€ï¼Œé‚£ä¹ˆè¿™ä¸ªâ€œè¢«â€å­—å°±æ˜¯ä¸æ˜¯å°±è¡¨æ˜â€œè¢«è§‚å¯Ÿè€…â€æ˜¯è¢«åŠ¨æ¥å—å˜æ›´çš„ä¸€æ–¹ï¼Œä¹Ÿå°±æ˜¯æ¥å—é€šçŸ¥çš„ä¸€æ–¹å‘¢ï¼Ÿ ä¹‹å‰æˆ‘ä¹Ÿæ˜¯èµ°åˆ°è¿™ä¸ªèƒ¡åŒé‡Œäº†ï¼Œç¨‹åºå†™å®Œæ€»è§‰å¾—å“ªé‡Œä¸å¯¹ï¼›å›è¿‡å¤´çœ‹ï¼Œè¿˜æ˜¯è‡ªå·±å¤ªå¹´è½»ï¼Œæ²¡æœ‰getåˆ°å“ªäº›å¤§ä½¬ä»¬çš„ç‚¹ã€‚ å…ˆæ¥çœ‹ç¨‹åºï¼›è¿™é‡Œç”¨æ˜é‡‘æ¥æ‰“ä¸ªæ¯”æ–¹ï¼Œæˆ‘çš„åšå®¢glmmaperä½œä¸ºè¢«è§‚å¯Ÿè€…ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒè€…ã€‚æ˜é‡‘å°ä¼™ä¼´ä»¬ä½œä¸ºè§‚å¯Ÿè€…ï¼Œä¹Ÿå°±æ˜¯è®¢é˜…è€…ã€‚ å…·ä½“é€»è¾‘ï¼šå°ä¼™ä¼´ä»¬ï¼ˆè®¢é˜…è€…ï¼‰å…³æ³¨ï¼ˆè®¢é˜…ï¼‰äº†æˆ‘çš„åšå®¢ï¼ˆå‘å¸ƒè€…ï¼‰ï¼Œå¦‚æœæˆ‘å‘å¸ƒäº†ä¸€ç¯‡æ–‡ç« ï¼ˆçŠ¶æ€å˜æ›´ï¼‰ï¼Œå°±ä¼šé€šçŸ¥ï¼ˆæ¨é€æ¶ˆæ¯ï¼‰æ‰€æœ‰å…³æ³¨æˆ‘çš„å°ä¼™ä¼´ã€‚ 123456789101112131415161718192021222324252627package com.glmapper.designmode.observor;/** * @description: æŠ½è±¡ä¸»é¢˜æ¥å£ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/22 */public interface Subject &#123; /** * æ–°å¢å…³æ³¨è€… * @param observer å…³æ³¨çš„å°ä¼™ä¼´ */ void addFocusObserver(Observer observer); /** * å–æ¶ˆå…³æ³¨ * @param observer å–æ¶ˆå…³æ³¨çš„å°ä¼™ä¼´ */ void removeFocusObserver(Observer observer); /** * é€šçŸ¥æœºåˆ¶ï¼Œé€šçŸ¥æœºåˆ¶ç”±ç›¸å…³äº‹ä»¶æ¥è§¦å‘ï¼Œæ¯”å¦‚è¯´å‘å¸ƒæ–‡ç«  * @param blogName åšå®¢å * @param articleName æ–‡ç« å */ void notifyObservers(String blogName,String articleName);&#125; ä¸‰ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯åšå®¢ä¸»é¡µå¢åŠ äº†ä¸€ä¸ªå…³æ³¨è€…ï¼›ä¸€ä¸ªæ˜¯åšå®¢ä¸»é¡µæœ‰å°ä¼™ä¼´å–æ¶ˆçš„å…³æ³¨ï¼ˆå¯¹äºåšå®¢æ¥è¯´å°±æ˜¯ç§»é™¤ä¸€ä¸ªå…³æ³¨è€…ï¼Œè¿™é‡Œä¸çŸ¥é“æ˜¯å¦ä¹Ÿä¼šè§‰å¾—åˆ«æ‰­ï¼Ÿæ˜æ˜ä½ å–æ¶ˆçš„å…³æ³¨ï¼Œä¸ºå•¥è¯´æˆæ˜¯æˆ‘ç§»é™¤ä½ ï¼Œä¹Ÿå°±æ˜¯ä¸è®©ä½ å…³æ³¨äº†ï¼Œè¿˜èƒ½è¿™ä¹ˆç©?è¿™é‡Œè‚¯å®šæ˜¯éœ€è¦åœ¨å¼•å…¥å…¶ä»–çš„ä¸€äº›è¾…åŠ©æœºåˆ¶ï¼Œæ¯”å¦‚è¯´ä½ åœ¨å®¢æˆ·ç«¯å‘èµ·äº†ä¸€ä¸ªå–æ¶ˆå…³æ³¨çš„è¯·æ±‚ï¼Œåç«¯å¤„ç†çš„æ—¶å€™æ˜é‡‘çš„å·¥ç¨‹å¸ˆä»¬å°±æ˜¯åœ¨æˆ‘çš„å…³æ³¨åˆ—è¡¨ä¸­å°†ä½ ç§»é™¤çš„ï¼Œå—¯ï¼Œè¿™ä¹ˆä¸€æƒ³ç¡®å®æ˜¯æˆ‘ä¸è®©ä½ å…³æ³¨äº†ã€‚ğŸ˜„â€¦.ï¼‰ï¼›æœ€åä¸€ä¸ªæ–¹æ³•æ˜¯å‘èµ·ä¸€ä¸ªé€šçŸ¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„åšå®¢ï¼Œæ¯”å¦‚è¯´æ˜¯glmapperï¼› 1234567891011121314151617181920212223242526272829303132333435363738394041package com.glmapper.designmode.observor;import java.util.ArrayList;import java.util.List;/** * @description: è¿™ä¸ªæ˜¯å…·ä½“å‘å¸ƒè€…ï¼Œè¿™é‡Œæ¯”å–»æˆæˆ‘çš„åšå®¢glmapper * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/22 */public class ConcreteSubject implements Subject &#123; /** æˆ‘çš„å½“å‰å…³æ³¨åˆ—è¡¨ */ List&lt;Observer&gt; Observers = new ArrayList&lt;&gt;(); /** æˆ‘çš„åšå®¢å ï¼šæ±‚å…³æ³¨ */ private static final String blogName = "glmapper"; @Override public void addFocusObserver(Observer observer) &#123; Observers.add(observer); &#125; @Override public void removeFocusObserver(Observer observer) &#123; Observers.remove(observer); &#125; @Override public void notifyObservers(String blogName,String articleName) &#123; for (Observer observer:Observers) &#123; observer.update(blogName,articleName); &#125; &#125; /** * è¿™é‡Œæ˜¯å‘å¸ƒæ–‡ç« ï¼Œè§¦å‘é€šçŸ¥äº‹ä»¶ */ public void publishArticle(String articleName)&#123; notifyObservers(blogName,articleName); &#125;&#125; å‰é¢æåˆ°ï¼Œé€šçŸ¥äº‹ä»¶è‚¯å®šæ˜¯ç”±äºæŸäº›çŠ¶æ€å‘ç”Ÿå˜æ›´äº†ï¼Œæ‰ä¼šè¿›è¡Œé€šçŸ¥ï¼Œè¿™é‡Œå°±å¯ä»¥æ¯”æ–¹ä¸ºæˆ‘å‘å¸ƒäº†ä¸€ç¯‡åšå®¢ï¼Œç„¶åé€šçŸ¥ä½ ï¼ˆè¿™é‡Œåªèƒ½å‡å¦‚ä½ å…³æ³¨äº†ï¼‰ã€‚å†æ¥çœ‹è§‚å¯Ÿè€…ï¼š 12345678910111213141516package com.glmapper.designmode.observor;/** * @description: è®¢é˜…è€…æŠ½è±¡æ¥å£ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/22 */public interface Observer &#123; /** * è°ƒç”¨æ­¤æ–¹æ³•ä¼šæ›´æ–°çŠ¶æ€ï¼Œåšå‡ºç›¸åº”çš„åŠ¨ä½œ * @param blogName * @param articleName */ void update(String blogName,String articleName);&#125; æŠ½è±¡è®¢é˜…è€…ï¼Œæœ‰ä¸€ä¸ªupdateæ–¹æ³•ï¼Œé€šçŸ¥ä½ å»åšå‡ºç›¸åº”çš„åŠ¨ä½œï¼Œå…·ä½“åŠ¨ä½œæ¯ä¸ªè§‚å¯Ÿè€…éƒ½å¯èƒ½ä¸åŒã€‚ 123456789101112131415161718192021package com.glmapper.designmode.observor;/** * @description: è¿™ä¸ªæ˜¯å…·ä½“è®¢é˜…è€…,è¿™é‡Œå¯ä»¥æ¯”å–»æˆåšå®¢å…³æ³¨è€…ï¼Œ * æ”¶åˆ°å˜æ›´ä¿¡æ¯ä¹‹åéœ€è¦åšå‡ºç›¸åº”çš„åŠ¨ä½œ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/22 */public class ConcreteObserver implements Observer &#123; @Override public void update(String blogName,String articleName) &#123; System.out.println(blogName+"å‘å¸ƒäº†æ–°çš„æ–‡ç« ï¼Œæ–‡ç« åä¸ºï¼š"+articleName); read(articleName); &#125; private void read(String articleName)&#123; System.out.println("å³å°†é˜…è¯» "+articleName+" è¿™ç¯‡æ–‡ç« "); &#125;&#125; ä¸Šé¢æ˜¯ä¸€ä¸ªå…·ä½“çš„å…³æ³¨è€…ï¼ŒåŠ å…¥è¯´å°±æ˜¯ä½ ã€‚åšå®¢æ›´æ–°ä¹‹åå‘äº†ä¸€ä¸ªé€šçŸ¥ç»™ä½ (æ˜é‡‘appæ¨é€çš„æ¶ˆæ¯)ï¼Œç„¶åä½ ç‚¹äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸€ç§åŠ¨ä½œã€‚ä¾‹å­ä¸­ä¸¾çš„æ˜¯read,å°±æ˜¯å…³æ³¨è€…åšå‡ºé˜…è¯»çš„åŠ¨ä½œã€‚ çœ‹ä¸‹æœ€åçš„è¿è¡Œç»“æœï¼š 1234567891011121314151617181920212223242526package com.glmapper.designmode.observor;/** * @description: [æè¿°æ–‡æœ¬] * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: ç£Šå” * @date: 18/4/22 */public class MyMainIndex&#123; public static void main(String[] args) &#123; //åšå®¢ä¸»ä½“ ConcreteSubject subject = new ConcreteSubject(); //å…³æ³¨è€…ï¼šhandSomeæ˜¯å¸…æ°”çš„æ„æ€ Observer handSome = new ConcreteObserver(); //å¢åŠ ä¸€ä¸ªå…³æ³¨è€… subject.addFocusObserver(handSome); //å‘ä¸€ç¯‡æ–‡ç«  subject.publishArticle("è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼"); &#125;&#125;glmapperå‘å¸ƒäº†æ–°çš„æ–‡ç« ï¼Œæ–‡ç« åä¸ºï¼šè®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼å³å°†é˜…è¯» è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼ è¿™ç¯‡æ–‡ç«  é…’æ¡¶è¯´ï¼šå•Šï¼Œæ¬¢ä¹æ—¶å…‰æ€»æ˜¯çŸ­æš‚çš„ æ‰€ä»¥ä½œä¸ºç§¯ç´¯ï¼Œè¿˜æ˜¯éœ€è¦å°†ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µæ¥ç½—åˆ—ä¸€ä¸‹çš„ã€‚ ä¸»è¦è§’è‰²ï¼š æŠ½è±¡ä¸»é¢˜è§’è‰²ï¼ˆSubjectï¼šä¸»é¢˜è§’è‰²å°†æ‰€æœ‰å¯¹è§‚å¯Ÿè€…å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æœ‰ä»»æ„å¤šä¸ªè§‚å¯Ÿè€…ã€‚æŠ½è±¡ä¸»é¢˜æä¾›äº†å¢åŠ å’Œåˆ é™¤ç­‰è§‚å¯Ÿè€…å¯¹è±¡çš„æ¥å£ã€‚ æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²ï¼ˆObserverï¼‰ï¼šä¸ºæ‰€æœ‰çš„å…·ä½“è§‚å¯Ÿè€…å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œåœ¨è§‚å¯Ÿçš„ä¸»é¢˜å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°è‡ªå·±ã€‚ å…·ä½“ä¸»é¢˜è§’è‰²ï¼ˆConcreteSubjectï¼‰(1ä¸ª)ï¼šå­˜å‚¨ç›¸å…³çŠ¶æ€åˆ°å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå½“å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰ç™»è®°è¿‡çš„è§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ã€‚å…·ä½“ä¸»é¢˜è§’è‰²é€šå¸¸ç”¨ä¸€ä¸ªå…·ä½“å­ç±»å®ç°ã€‚ å…·ä½“è§‚å¯Ÿè€…è§’è‰²ï¼ˆConcretedObserverï¼‰(å¤šä¸ª)ï¼šå­˜å‚¨ä¸€ä¸ªå…·ä½“ä¸»é¢˜å¯¹è±¡ï¼Œå­˜å‚¨ç›¸å…³çŠ¶æ€ï¼Œå®ç°æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²æ‰€è¦æ±‚çš„æ›´æ–°æ¥å£ï¼Œä»¥ä½¿å¾—å…¶è‡ªèº«çŠ¶æ€å’Œä¸»é¢˜çš„çŠ¶æ€ä¿æŒä¸€è‡´ã€‚ å…·ä½“å…³ç³»ï¼š æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰(æ¥å£)â€“&gt;è¢«å…·ä½“ä¸»é¢˜ï¼ˆConcreteSubjectï¼‰è§’è‰²(1ä¸ª)å®ç° æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰(æ¥å£)â€“&gt;è¢«å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcretedObserverï¼‰è§’è‰²(Nä¸ª)å®ç° è§‚å¯Ÿè€…å¯¹è±¡è½½å…¥ä¸»é¢˜æ–¹æ³•,å¹¶åœ¨ä¸»é¢˜æ–¹æ³•ä¸­è°ƒç”¨è§‚å¯Ÿè€…å¯¹è±¡å®ç°çš„æ¥å£æ–¹æ³•updateæ¥è®©è‡ªå·±å‘ç”Ÿå˜æ›´å“åº”ã€‚ ä¸€äº›åœºæ™¯ï¼š å½“å¯¹ä¸€ä¸ªå¯¹è±¡çš„çš„æ”¹åŠ¨ä¼šå¼•å‘å…¶ä»–å¯¹è±¡çš„å˜åŠ¨æ—¶ï¼Œè€Œä¸”ä½ æ— æ³•é¢„æµ‹æœ‰å¤šå°‘ä¸ªå¯¹è±¡éœ€è¦è¢«æ”¹åŠ¨ã€‚ å½“ä¸€ä¸ªå¯¹è±¡éœ€è¦æœ‰èƒ½åŠ›é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œä¸”ä¸éœ€è¦äº†è§£è¿™äº›å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹æ—¶ã€‚ åŸºäºå‘å¸ƒè®¢é˜…çš„å…·ä½“å®ç°ä¾‹å­è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ¯”è¾ƒå…¸å‹çš„å°±æ˜¯è¿™ç§è®¢é˜…ä¸€ä¸ªåšå®¢ï¼Œç„¶ååšå®¢æ›´æ–°æ¨é€ï¼›è¿˜æœ‰å¾®ä¿¡å…¬ä¼—å·ï¼ŒæœåŠ¡å·è¿™äº›ã€‚ åˆ°è¿™é‡Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ä¸€å¼€å§‹ç•™ä¸‹çš„å‡ ä¸ªé—®é¢˜ï¼š è¢«è§‚å¯Ÿè€…çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ï¼Œç„¶åâ€œä¸»åŠ¨é€šçŸ¥â€è§‚å¯Ÿè€…ï¼Œå¹¶ä¸æ˜¯è¯´ï¼Œè§‚å¯Ÿè€…ä¸»åŠ¨å»è·å–é€šçŸ¥ã€‚ è¢«è§‚å¯Ÿè€…æ˜¯æ¶ˆæ¯å‘å¸ƒè€…ï¼Œè§‚å¯Ÿè€…æ˜¯æ¶ˆæ¯è®¢é˜…è€…ï¼›è§‚å¯Ÿè€…æ˜¯è¢«åŠ¨æ¥å—è€…ã€‚ è¢«è§‚å¯Ÿè€…çš„ä½œç”¨å°±æ˜¯å­˜å‚¨å½“å‰çš„è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œç„¶åæä¾›ä¸€äº›é€šçŸ¥æœºåˆ¶æ¥å‘Šè¯‰è§‚å¯Ÿè€…è‡ªå·±å‘ç”Ÿäº†çŠ¶æ€å˜æ›´ï¼Œæ˜¯ä¸»åŠ¨è€…ã€‚ OKï¼Œè§‚å¯Ÿè€…æ¨¡å¼å°±æ’¸åˆ°è¿™é‡Œï¼Œä¹Ÿæ¬¢è¿å°ä¼™ä¼´ä»¬æå‡ºè‡ªå·±çè´µçš„æ„è§ï¼›æœ‰å†™çš„ä¸å½“ä¹‹å¤„çƒ¦è¯·åŠæ—¶æå‡ºã€‚]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringMVCæºç ç³»åˆ—ï¼šä¹å¤§ç»„ä»¶å°è®°]]></title>
    <url>%2F2018%2F11%2F10%2Fspring-base-webmvc5%2F</url>
    <content type="text"><![CDATA[å‰é¢å‡ ç¯‡æ–‡ç« éƒ½æ˜¯é’ˆå¯¹äºSpringMVCä¸­çš„å…·ä½“ç»„ä»¶è¿›è¡Œæºç åˆ†æçš„ï¼›æœ¬æ–‡ä¸»è¦ç”¨äºè¡¥å……è®°å½•ä¸€ä¸‹å…³äºSpringMVCä¸­ä¹å¤§ç»„ä»¶çš„å­¦ä¹ ã€‚è¿™ä¸ªä¼šç‰µæ‰¯å‡ºé™¤ä¹‹å‰çš„å‡ ç¯‡HandlerMappingä¹‹å¤–çš„å…¶ä»–ä¸€äº›åŸºç¡€ç»„ä»¶ã€‚ ä¹‹å‰ç®€å•çš„æœ‰ä»‹ç»è¿‡DispatcherServletè¿™ä¸ªç±»çš„ä½“ç³»ç»“æ„ï¼Œæ­¤å¤„å°±ä¸å†èµ˜è¿°äº†ã€‚åœ¨DispatcherServletç±»ä¸­ï¼Œå…¶åœ¨mvcå­å®¹å™¨è¿›è¡Œåˆå§‹åŒ–æ—¶å°±ä¼šå®Œæˆå¯¹ä¹å¤§ç»„ä»¶çš„åˆå§‹åŒ–å·¥ä½œï¼Œå…·ä½“å“ªä¹å¤§ç»„ä»¶åé¢ä¼šæ…¢æ…¢è¯´åˆ°ã€‚å…ˆæ¥çœ‹ä¸‹åœ¨DispatcherServletä¸­æ˜¯é€šè¿‡å“ªäº›æ–¹æ³•æ¥å®Œæˆåˆå§‹åŒ–å·¥ä½œçš„,å…ˆè´´ä¸€æ®µä»£ç ï¼š 123456789101112131415protected void onRefresh(ApplicationContext context) &#123; this.initStrategies(context);&#125;protected void initStrategies(ApplicationContext context) &#123; this.initMultipartResolver(context); this.initLocaleResolver(context); this.initThemeResolver(context); this.initHandlerMappings(context); this.initHandlerAdapters(context); this.initHandlerExceptionResolvers(context); this.initRequestToViewNameTranslator(context); this.initViewResolvers(context); this.initFlashMapManager(context);&#125; ä¸Šé¢ä»£ç ä¸­çš„onRefreshæ–¹æ³•å°±æ˜¯DispatcherServletçš„å…¥å£æ–¹æ³•ã€‚åœ¨onRefreshä¸­åˆé€šè¿‡è°ƒç”¨initStrategiesæ–¹æ³•æ¥å°†å„ä¸ªç»„ä»¶çš„åˆå§‹åŒ–é€»è¾‘è¿›è¡Œæ•´åˆï¼Œä¸ªäººç†è§£å…¶å®å°±æ˜¯ç­–ç•¥å¥—ç­–ç•¥ï¼Œåœ¨ä¸€ä¸ªå°±æ˜¯èŒè´£ä¹Ÿæ˜ç¡®ã€‚ åœ¨initStrategiesæ–¹æ³•ä¸­åˆé€šè¿‡è°ƒç”¨ç»„ä»¶å„è‡ªçš„åˆå§‹åŒ–æ–¹æ³•æ¥å®Œæˆå…·ä½“çš„åˆå§‹åŒ–å·¥ä½œã€‚ä»è¿™ä¸ªåœ°æ–¹å…¶å®å°±å¯ä»¥æ¸…æ¥šçš„çœ‹å‡ºSpringMVCä¸­çš„9ä¸ªç»„ä»¶åç§°äº†ã€‚ä¸‹é¢å°±æ¥æ‹ä¸€æ‹è¿™ä¹å¤§ç»„ä»¶çš„åŸºæœ¬èŒè´£ã€‚ HandlerMappingå…³äºhandlermappingåœ¨ä¸‹é¢å‡ ç¯‡æ–‡ç« ä¸­åšè¿‡ä¸€äº›åŸºæœ¬ä»‹ç»ï¼Œä½†æ˜¯è¿˜ä¸æ˜¯å¾ˆå…¨ï¼Œå¯¹äºhandlermappingçš„å­ç±»è¿˜æ²¡æœ‰åˆ†æå®Œï¼Œè¿™ä¸ªä¼šåæœŸæ›´æ–°çš„ã€‚ SpringMVCæºç ç³»åˆ—ï¼šHandlerMapping SpringMVCæºç ç³»åˆ—ï¼šAbstractHandlerMapping SpringMVCæºç ç³»åˆ—ï¼šAbstractUrlHandlerMapping å¯¹äºHandlerMappingæ¥è¯´ï¼Œå…¶ä½œç”¨å°±æ˜¯æ ¹æ®requestæ‰¾åˆ°ç›¸åº”çš„å¤„ç†å™¨Handlerå’ŒIntecepteræ‹¦æˆªå™¨ã€‚å…·ä½“ç»†èŠ‚å‚æ•°ä¸Šé¢ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚ HandlerAdapterå¦‚æœè¯´HandlerMappingæ˜¯ä¸€æ”¯ç¬”ï¼Œé‚£ä¹ˆHandlerAdapterå°±æ˜¯ç”¨ç¬”çš„äººã€‚ä¹Ÿå°±æ˜¯è¯´HandlerAdapterå°±æ˜¯ä½¿ç”¨å¤„ç†å™¨å¹²æ´»çš„äººã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¥çœ‹ä¸‹ä»£ç ï¼š 12345public interface HandlerAdapter &#123; boolean supports(Object var1); ModelAndView handle(HttpServletRequest var1, HttpServletResponse var2, Object var3) throws Exception; long getLastModified(HttpServletRequest var1, Object var2);&#125; æ˜¯ä¸æ˜¯ä¸€ç›®äº†ç„¶äº†ï¼Œåœ¨HandlerAdapteræ¥å£ä¸­æä¾›äº†handleè¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œå‚æ•°ä¸­Object handlerç¬¬ä¸‰ä¸ªå‚æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªå¤„ç†å™¨ï¼Œé‚£æˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œhandleæ–¹æ³•å°±æ˜¯ä½¿ç”¨handleræ¥å¤„ç†é€»è¾‘çš„ã€‚å¤„ç†ä¹‹åè¿”å›ä¸€ä¸ªModelAndViewã€‚ HandlerExceptionResolverè¿™ä¸ªæ˜¯SpringMVCä¸­çš„å¼‚å¸¸å¤„ç†ç»„ä»¶ï¼ŒHandlerExceptionResolverè¿™ä¸ªç»„ä»¶çš„ä½œç”¨å°±æ˜¯æ ¹æ®å¼‚å¸¸è®¾ç½®ModelAndViewï¼Œç„¶åå†å°†å¤„ç†ç»“æœäº¤ç»™renderæ–¹æ³•è¿›è¡Œæ¸²æŸ“ã€‚å½“ç„¶renderä¹Ÿä»…ä»…åªæ˜¯è´Ÿè´£å°†ModelAndViewæ¸²æŸ“æˆé¡µé¢ï¼ŒModelAndViewçš„å…·ä½“æ¥æºå®ƒä¸å…³å¿ƒã€‚ è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼ŒåŠ å…¥åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ€ä¹ˆåŠï¼Ÿä»ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çŸ¥é“ï¼ŒHandlerExceptionResolverè¿™ä¸ªç»„ä»¶å¯¹å¼‚å¸¸çš„å¤„ç†ç»“æœæ˜¯ModelAndViewï¼Œç„¶åå†ç”±renderæ–¹æ³•è¿›è¡Œæ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯è¯´HandlerExceptionResolveræ˜¯åœ¨æ¸²æŸ“ä¹‹å‰å·¥ä½œçš„ï¼Œå› æ­¤æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼ŒHandlerExceptionResolveræ˜¯ä¸ä¼šå¤„ç†çš„ã€‚ 123public interface HandlerExceptionResolver &#123; ModelAndView resolveException(HttpServletRequest var1, HttpServletResponse var2, Object var3, Exception var4);&#125; åœ¨HandlerExceptionResolverä¸­ä¹Ÿåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ä»å¼‚å¸¸ä¸­è§£æå‡ºModelAndViewã€‚ ViewResolverViewResolverçš„ä½œç”¨æ˜¯å°†Stringç±»å‹çš„é€»è¾‘è§†å›¾æ ¹æ®localè§£æä¸ºViewè§†å›¾çš„ã€‚ä¸‹é¢æ˜¯ViewResolverçš„æºç æ¥å£å®šä¹‰ï¼š 123public interface ViewResolver &#123; View resolveViewName(String viewName, Locale local) throws Exception;&#125; ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ViewResolverä¸­ä¹Ÿæ˜¯åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä»resolveViewNameæ–¹æ³•çš„å‚æ•°å’Œè¿”å›ç»“æœå°±å¾ˆå¥½çš„è§£é‡Šäº†å…¶ä½œç”¨ã€‚ viewName Stringç±»å‹çš„è§†å›¾å local åŒºåŸŸï¼Œå¯ä»¥ç”¨æ¥åšå›½é™…åŒ–ã€‚ Viewå®é™…ä¸Šæ˜¯ç”¨æ¥æ¸²æŸ“é¡µé¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å°†ç¨‹åºè¿”å›çš„ç»“æœå¡«å…¥åˆ°å…·ä½“çš„æ¨¡æ¿é‡Œé¢ï¼Œç”Ÿæˆå…·ä½“çš„è§†å›¾æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šjspï¼Œftlï¼Œhtmlç­‰ã€‚ ä½†æ˜¯è¿™é‡Œåˆä¼šç‰µæ‰¯å‡ºä¸¤ä¸ªé—®é¢˜ï¼š ç”¨ä»€ä¹ˆæ¨¡æ¿ï¼Ÿ å‚æ•°æ€ä¹ˆå¡«å…¥ï¼Ÿ å½“ç„¶ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜ä¹Ÿå°±æ˜¯æœ¬å°èŠ‚è¯´çš„ViewResolveréœ€è¦è§£å†³çš„é—®é¢˜ã€‚å¤§ä½“åˆ†ä¸ºä¸¤ç§ï¼š é’ˆå¯¹å•ä¸€è§†å›¾ç±»å‹çš„è§£æå™¨ InternalResourceViewResolver FreeMarkerViewResolver ä¸Šé¢ä¸¤ç§æ˜¯ç”¨çš„æœ€å¤šçš„ä¸¤ç§ï¼ŒInternalResourceViewResolverç”¨æ¥è§£æjspï¼Œè€ŒFreeMarkerViewResolveråˆ™æ˜¯é’ˆå¯¹FreeMarkerã€‚ é’ˆå¯¹åŒæ—¶è§£æå¤šç§ç±»å‹è§†å›¾çš„è§£æå™¨ BeanNameViewResolver éœ€è¦åŒæ—¶ä½¿ç”¨è§†å›¾åå’Œå¯¹åº”çš„localæ¥è§£æè§†å›¾ã€‚å®ƒéœ€è¦å°†æ¯ä¸€ä¸ªè§†å›¾åå’Œå¯¹åº”çš„è§†å›¾ç±»å‹é…ç½®åˆ°ç›¸åº”çš„propertiesæ–‡ä»¶ä¸­ã€‚ï¼ˆåé¢è®²ç»„ä»¶å®ç°ç»†èŠ‚æ—¶ç»™å‡ºåˆ—å­ï¼‰ XmlViewResolver XmlViewResolverå’ŒBeanNameViewResolveræœ‰ç‚¹å·®ä¸å¤šï¼ŒBeanNameViewResolverä½¿ç”¨çš„æ˜¯xmlæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚ ResourceBundleViewResolver è¿™ä¸ªå…¶å®å°±æ˜¯æ ¹æ®viewNameä»Springå®¹å™¨ä¸­æŸ¥æ‰¾beanï¼Œå†æ ¹æ®è¿™ä¸ªbeanæ¥æ‰¾åˆ°å¯¹åº”çš„è§†å›¾ã€‚ LocalResolveråœ¨ä¸Šé¢çš„ViewResolverä¸­æåˆ°ï¼Œè§£æè§†å›¾éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯Stringç±»å‹çš„é€»è¾‘è§†å›¾åï¼Œå¦å¤–ä¸€ä¸ªæ˜¯localã€‚LocalResolverçš„ä½œç”¨å°±æ˜¯ä»requestä¸­è§£æå‡ºlocalçš„ã€‚ 12345public interface LocaleResolver &#123; Locale resolveLocale(HttpServletRequest request); void setLocale(HttpServletRequest request, HttpServletResponse response, Locale local);&#125; ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ä»requestä¸­è§£æå‡ºlocalï¼Œç¬¬äºŒä¸ªæ–¹æ³•æ˜¯å°†localè®¾ç½®åˆ°requestä¸­ã€‚ å…³äºlocalå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ç”¨æ¥åšå›½é™…åŒ–å¤„ç†çš„ã€‚ ThemeResolverè§£æä¸»é¢˜çš„ã€‚è¿™ä¸ªæˆ‘å¹³æ—¶é™¤äº†SpringMVCè‡ªå·±æä¾›çš„åŠŸèƒ½å¤–ï¼Œå¾ˆå°‘è‡ªå·±å»æ‰©å±•ä½¿ç”¨ï¼Œå³ä½¿æ˜¯æ¢ä¸»é¢˜ä¹Ÿæ²¡æœ‰åšè¿‡ã€‚ä¸è¿‡æ—¢ç„¶å­˜åœ¨è‚¯å®šæ˜¯æœ‰å­˜åœ¨çš„åŸå› çš„ã€‚å¯¹äºæˆ‘ä»¬å¸¸è§çš„ç½‘é¡µç•Œé¢æ´»ç€æ‰‹æœºç•Œé¢æ¥è¯´ï¼Œä¸€å¥—ä¸»é¢˜æ— éå°±æ˜¯æ¢ä¸€å¥—å›¾ç‰‡ï¼Œæ´»ç€cssæ ·å¼æ–‡ä»¶ç­‰ç­‰ã€‚æˆ‘ä»¬é€šè¿‡ThemeResolverè¿™ä¸ªå°±å¯ä»¥å®ç°è¿™æ ·çš„åŠŸèƒ½ã€‚å…·ä½“ä½¿ç”¨å…¶å®ä¹Ÿå°±æ˜¯é…ä¸€å¥—propertiesæ–‡ä»¶ä¾›ç³»ç»Ÿåœ¨ä¸åŒçš„æ—¶å€™è¯»å–åˆ‡æ¢ï¼›å½“ç„¶ä½¿ç”¨è¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥å®ç°å›½é™…åŒ–çš„ã€‚ 12345public interface ThemeResolver &#123; String resolveThemeName(HttpServletRequest request); void setThemeName(HttpServletRequest request, HttpServletResponse response, String themeName);&#125; RequestToViewNameTranslatorè¿™ä¸ªå…¶å®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå°±æ˜¯å°†requestè¯·æ±‚è½¬æ¢ä¸ºè§†å›¾åç§°ã€‚ 123public interface RequestToViewNameTranslator &#123; String getViewName(HttpServletRequest request) throws Exception;&#125; RequestToViewNameTranslatoråªæœ‰ä¸€ä¸ªé»˜è®¤çš„å®ç°ç±»DefaultRequestToViewNameTranslatorã€‚ åœ¨DefaultRequestToViewNameTranslatorå…·ä½“å®ç°äº†getViewName(HttpServletRequest request)æ–¹æ³•ï¼š 1234public String getViewName(HttpServletRequest request) &#123; String lookupPath = this.urlPathHelper.getLookupPathForRequest(request); return this.prefix + this.transformPath(lookupPath) + this.suffix;&#125; ä¸»è¦æ˜¯å§”æ´¾ç»™urlPathHelperå¸®åŠ©ç±»å¾—åˆ°è¯·æ±‚çš„åç¼€åç§°ï¼Œæ¯”å¦‚é€šè¿‡ è¯·æ±‚è·¯å¾„æ¯”å¦‚/glmapper/login.doè½¬æ¢å¾—åˆ°/login.do ï¼›å…·ä½“æ€ä¹ˆè½¬æ¢æˆè§†å›¾ä¹Ÿä¼šåœ¨åé¢çš„ç»„ä»¶ä»‹ç»ä¸­ç»™å‡ºå…·ä½“çš„ä¾‹å­ã€‚ MultipartResolverè¿™ä¸ªç›¸åº”å°ä¼™ä¼´ä»¬ä¹Ÿä¸é™Œç”Ÿï¼Œåšç½‘ç«™å¤šå¤šå°‘å°‘ä¼šæ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ ã€‚MultipartResolverå°±æ˜¯ç”¨æ¥å¤„ç†ä¸Šä¼ è¯·æ±‚çš„ã€‚å…¶å¤„ç†æ–¹å¼å°±æ˜¯å°†requeståŒ…è£…æˆMultipartHttpServletRequestã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨MultipartHttpServletRequestè¿™ä¸ªç›´æ¥è°ƒç”¨getFileè·å–çš„æ–‡ä»¶äº†ã€‚ FlashMapManagerè¿™ä¸ªåœ¨redirectæ˜¯è¿›è¡Œå‚æ•°ä¼ é€’éœ€è¦ç”¨åˆ°ã€‚ 12345public interface FlashMapManager &#123; FlashMap retrieveAndUpdate(HttpServletRequest request, HttpServletResponse response); void saveOutputFlashMap(FlashMap flashMap, HttpServletRequest request, HttpServletResponse response);&#125; retrieveAndUpdateè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ¢å¤å‚æ•°çš„ï¼Œå¯¹äºæ¢å¤è¿‡çš„å’Œè¶…æ—¶çš„å‚æ•°å°†éƒ½ä¼šè¢«åˆ é™¤æ‰ã€‚ saveOutputFlashMapè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥ä¿å­˜å‚æ•°çš„ã€‚ FlashMapManagerçš„é»˜è®¤å®ç°æœºåˆ¶ä¸­å‚æ•°çš„å­˜å‚¨æ˜¯æ”¾åœ¨sessionä¸­çš„ã€‚æˆ‘ä¹‹å‰åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å°±æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œå¯¹äºä¸€äº›æˆ‘ä»¬ä¸æƒ³æš´éœ²åœ¨urlä¸­çš„å‚æ•°ï¼Œåœ¨è¿›è¡Œè¯·æ±‚è½¬å‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨@RedirectAttributeså°†å‚æ•°ä¿å­˜ï¼Œç„¶ååœ¨ä¸‹ä¸€ä¸ªå¤„ç†å™¨ä¸­è·å–åˆ°ã€‚ å°ç»“æœ¬ç¯‡ä¸»è¦æ˜¯æ¥å¯¹ä¹å¤§ç»„ä»¶åšä¸€ä¸ªç¬¼ç»Ÿçš„ä»‹ç»ï¼Œç»†èŠ‚å®ç°åŠæ¡ˆä¾‹å‡ä¸æ¶‰åŠï¼›åœ¨åç»­çš„SpringMVCæºç ç³»åˆ—ä¸­å¯¹å„ä¸ªç»„ä»¶çš„å®ç°ç»†èŠ‚åˆ†ææ—¶å†ä¸€æ¢ç©¶ç«Ÿå§ã€‚]]></content>
      <categories>
        <category>spring mvc</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>web</tag>
        <tag>mvc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringMVCæºç ç³»åˆ—ï¼šAbstractUrlHandlerMapping]]></title>
    <url>%2F2018%2F11%2F10%2Fspring-base-webmvc4%2F</url>
    <content type="text"><![CDATA[AbstractUrlHandlerMappingæ˜¯é€šè¿‡urlæ¥è¿›è¡ŒåŒ¹é…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡urlä¸å¯¹åº”çš„HandleråŒ…å­˜åˆ°ä¸€ä¸ªMapä¸­ï¼Œç„¶ååœ¨getHandlerInternalæ–¹æ³•ä¸­ä½¿ç”¨urlä½œä¸ºkeyä»Mapä¸­è·å–æˆ‘ä»¬çš„handlerã€‚ AbstractUrlHandlerMappingå®ç°äº†ä»urlè·å–handlerçš„è¿‡ç¨‹ï¼Œå…·ä½“çš„æ˜ å°„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯handlerMapåˆ™æ˜¯äº¤ç»™å…·ä½“å­ç±»æ¥å»å®Œæˆçš„ã€‚AbstractUrlHandlerMappingä¸­å®šä¹‰äº†handlerMapç”¨æ¥ç»´æŠ¤æ˜ å°„å…³ç³»ï¼Œå¦‚ä¸‹ï¼š12private final Map&lt;String, Object&gt; handlerMap = new LinkedHashMap&lt;String, Object&gt;(); é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªrootHandler,è¿™ä¸ªç”¨äºå¤„ç†â€œ/â€è¯·æ±‚ã€‚ åœ¨å‰é¢ä¸‰ç¯‡æ–‡ç« ä¸­æåˆ°è¿‡ï¼Œhandlerçš„è·å–æ˜¯é€šè¿‡getHandlerInternalæ–¹æ³•å®Œæˆçš„ï¼Œä¸‹é¢çœ‹ä¸‹å…·ä½“çš„æºç ï¼Œåˆ†æä¸‹handlerçš„è·å–å’ŒhandlerMapçš„æ„å»ºã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243//æŸ¥æ‰¾ç»™å®šè¯·æ±‚çš„URLè·¯å¾„çš„Handlerã€‚protected Object getHandlerInternal(HttpServletRequest request) throwsException &#123; String lookupPath = getUrlPathHelper().getLookupPathForRequest(request); //ä½¿ç”¨lookupPathä»Mapä¸­æŸ¥æ‰¾handler Object handler = lookupHandler(lookupPath, request); if (handler == null) &#123; //ä¸´æ—¶å˜é‡ï¼Œä¿å­˜åŸå§‹çš„handler Object rawHandler = null; //æ˜¯å¦æ˜¯â€˜/â€™æ ¹è·¯å¾„ if ("/".equals(lookupPath)) &#123; //è·å–rootHandler rawHandler = getRootHandler(); &#125; //å¦‚æœrawHandleræ˜¯null if (rawHandler == null) &#123; //è·å–é»˜è®¤çš„handler rawHandler = getDefaultHandler(); &#125; //å¦‚æœrawHandlerä¸æ˜¯null if (rawHandler != null) &#123; // å¦‚æœæ˜¯stringç±»å‹ï¼Œåˆ™åˆ°å®¹å™¨ä¸­æŸ¥æ‰¾å…·ä½“çš„bean if (rawHandler instanceof String) &#123; String handlerName = (String) rawHandler; //å®¹å™¨ä¸­è·å– rawHandler = getApplicationContext().getBean(handlerName); &#125; //æ ¡éªŒhandlerå’Œrequestæ˜¯å¦åŒ¹é… validateHandler(rawHandler, request); //æ³¨å†Œæ‹¦æˆªå™¨ handler = buildPathExposingHandler(rawHandler, lookupPath, lookupPath, null); &#125; &#125; //æ—¥å¿—debug if (handler != null &amp;&amp; logger.isDebugEnabled()) &#123; logger.debug("Mapping [" + lookupPath + "] to " + handler); &#125; else if (handler == null &amp;&amp; logger.isTraceEnabled()) &#123; logger.trace("No handler mapping found for [" + lookupPath + "]"); &#125; //è¿”å›handler return handler;&#125; åœ¨getHandlerInternalæ–¹æ³•ä¸­æœ‰å‡ ä¸ªæ–¹æ³•è°ƒç”¨ï¼ŒåƒgetLookupPathForRequestã€getRootHandlerã€getDefaultHandlerã€lookupHandlerã€buildPathExposingHandlerç­‰ã€‚å…¶ä¸­getLookupPathForRequestã€getRootHandlerã€getDefaultHandlerè¿™å‡ ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼›æ¯”è¾ƒæ ¸å¿ƒçš„å°±æ˜¯lookupHandlerã€buildPathExposingHandlerè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ lookupHandler lookupHandlerä½¿ç”¨getUrlPathHelper().getLookupPathForRequest(request)è·å–åˆ°çš„lookupPathä»Mapä¸­æŸ¥æ‰¾éœ€è¦çš„Handler,é€šå¸¸æƒ…å†µä¸‹æ˜¯ç›´æ¥getä¸åˆ°çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› åœ¨äºå¾ˆå¤šçš„handleréƒ½æ˜¯ä½¿ç”¨äº†Patternçš„åŒ¹é…æ¨¡å¼ï¼Œæ¯”å¦‚è¯´â€œ/user/*â€,æ˜Ÿå·è¡¨ç¤ºåŒ¹é…ä»»æ„å†…å®¹ï¼Œå¹¶éæ˜¯æŒ‡å®šurlä¸²ä¸­çš„å­—ç¬¦ã€‚å¦‚æœPatternä¸­åŒ…å«äº†PathVariable,ä¹Ÿä¸èƒ½ç›´æ¥ä»Mapä¸­è·å–åˆ°ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œä¸€ä¸ªurlè¿˜å¯èƒ½å’Œå¤šä¸ªPatternç›¸åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å’±ä»¬è‚¯å®šå°±éœ€è¦é€‰æ‹©æœ€ä¼˜çš„ï¼Œæ‰€ä»¥è¯´æŸ¥æ‰¾è¿‡ç¨‹å…¶å®å¹¶ä¸æ˜¯ç›´æ¥ä»mapä¸­è·å–é‚£ä¹ˆç®€å•ã€‚é‚£ä¹ˆå°±æ¥çœ‹ä¸‹åœ¨lookupHandlerä¸­éƒ½å¹²äº†å“ªäº›äº‹æƒ…ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374protected Object lookupHandler(String urlPath, HttpServletRequest request) throws Exception &#123; // ç›´æ¥åŒ¹é…ï¼Œç›´æ¥ä»Mapä¸­è·å– Object handler = this.handlerMap.get(urlPath); //å–åˆ°äº† if (handler != null) &#123; // å¦‚æœæ˜¯stringç±»å‹ï¼Œåˆ™ä»å®¹å™¨ä¸­è·å–Bean if (handler instanceof String) &#123; String handlerName = (String) handler; handler = getApplicationContext().getBean(handlerName); &#125; //éªŒè¯æ˜¯å¦åŒ¹é… validateHandler(handler, request); //æ³¨å†Œæ‹¦æˆªå™¨ return buildPathExposingHandler(handler, urlPath, urlPath, null); &#125; // Pattern åŒ¹é…ï¼Œå¸¦*å·çš„æ¨¡å¼ä¸urlè¿›è¡ŒåŒ¹é… List&lt;String&gt; matchingPatterns = new ArrayList&lt;String&gt;(); for (String registeredPattern : this.handlerMap.keySet()) &#123; if (getPathMatcher().match(registeredPattern, urlPath)) &#123; matchingPatterns.add(registeredPattern); &#125; else if (useTrailingSlashMatch()) &#123; if (!registeredPattern.endsWith("/") &amp;&amp; getPathMatcher().match(registeredPattern + "/", urlPath)) &#123; matchingPatterns.add(registeredPattern +"/"); &#125; &#125; &#125; //è·å–æœ€ä½³åŒ¹é… String bestPatternMatch = null; Comparator&lt;String&gt; patternComparator = getPathMatcher().getPatternComparator(urlPath); if (!matchingPatterns.isEmpty()) &#123; Collections.sort(matchingPatterns, patternComparator); if (logger.isDebugEnabled()) &#123; logger.debug("Matching patterns for request [" + urlPath + "] are " + matchingPatterns); &#125; bestPatternMatch = matchingPatterns.get(0); &#125; //æœ€ä½³åŒ¹é…ä¸ä¸ºnull if (bestPatternMatch != null) &#123; //ä»Mapä¸­çœ‹çœ‹æ˜¯å¦æœ‰å¯¹åº”çš„Handler handler = this.handlerMap.get(bestPatternMatch); //å¦‚æœMapä¸­æ²¡æœ‰ if (handler == null) &#123; //æ˜¯å¦ä»¥/ç»“å°¾ Assert.isTrue(bestPatternMatch.endsWith("/")); //å»é™¤/ä¹‹åå†è·å–ä¸€æ¬¡ handler = this.handlerMap.get(bestPatternMatch.substring(0, bestPatternMatch.length() - 1)); &#125; // å¦‚æœæ˜¯Stringç±»å‹ï¼Œåˆ™ä»å®¹å™¨ä¸­è·å–Bean? if (handler instanceof String) &#123; String handlerName = (String) handler; handler = getApplicationContext().getBean(handlerName); &#125; //éªŒè¯æ˜¯å¦åŒ¹é… validateHandler(handler, request); String pathWithinMapping = getPathMatcher().extractPathWithinPattern(bestPatternMatch, urlPath); // å¯èƒ½æœ‰å¤šç§æœ€ä½³æ¨¡å¼ï¼Œè®©æˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬æœ‰æ­£ç¡®çš„URIæ¨¡æ¿å˜é‡ï¼ˆè¯‘ï¼‰ Map&lt;String, String&gt; uriTemplateVariables = new LinkedHashMap&lt;String, String&gt;(); for (String matchingPattern : matchingPatterns) &#123; if (patternComparator.compare(bestPatternMatch, matchingPattern) == 0) &#123; Map&lt;String, String&gt; vars = getPathMatcher().extractUriTemplateVariables(matchingPattern, urlPath); Map&lt;String, String&gt; decodedVars = getUrlPathHelper().decodePathVariables(request, vars); uriTemplateVariables.putAll(decodedVars); &#125; &#125; if (logger.isDebugEnabled()) &#123; logger.debug("URI Template variables for request [" + urlPath + "] are " + uriTemplateVariables); &#125; return buildPathExposingHandler(handler, bestPatternMatch, pathWithinMapping, uriTemplateVariables); &#125; // No handler found... return null;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå…³äºè¯‘æ³¨çš„éƒ¨åˆ†éœ€è¦è¯´ä¸€ä¸‹ï¼›ä»£ç å¦‚ä¸‹ï¼š 123456789Map&lt;String, String&gt; uriTemplateVariables = new LinkedHashMap&lt;String, String&gt;();for (String matchingPattern : matchingPatterns) &#123; if (patternComparator.compare(bestPatternMatch, matchingPattern) == 0) &#123; Map&lt;String, String&gt; vars = getPathMatcher().extractUriTemplateVariables(matchingPattern, urlPath); Map&lt;String, String&gt; decodedVars = getUrlPathHelper().decodePathVariables(request, vars); uriTemplateVariables.putAll(decodedVars); &#125;&#125; ä¹‹å‰æ˜¯é€šè¿‡sortæ–¹æ³•è¿›è¡Œæ’åºçš„ï¼Œç„¶åå°†ç¬¬ä¸€ä¸ªä½œä¸ºbestPatternMatchï¼Œä½†æ˜¯å¦‚æœå¤šä¸ªpatternçš„é¡ºåºç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´sortè¿”å›çš„æ˜¯0,å­˜åœ¨å¤šç§æœ€ä½³åŒ¹é…ï¼Œé‚£å°±éœ€è¦ç¡®ä¿æˆ‘ä»¬æœ‰æ­£ç¡®çš„URIæ¨¡æ¿å˜é‡ã€‚ä¸Šé¢ä»£ç å°±æ˜¯å¤„ç†è¿™ç§æƒ…å†µçš„ã€‚ buildPathExposingHandler è¿™ä¸ªæ–¹æ³•åœ¨ä¸Šé¢çš„ä¸¤æ®µä»£ç ä¸­éƒ½é¢‘ç¹å‡ºç°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åˆ°åº•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿä»£ç ä¸­æˆ‘æ³¨é‡Šçš„æ˜¯æ³¨å†Œæ‹¦æˆªå™¨ï¼Œé‚£ä¹ˆæ³¨å†Œçš„åˆæ˜¯ä»€ä¹ˆæ‹¦æˆªå™¨ï¼Ÿå¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä»£ç ã€‚ 123456789101112131415161718//buildPathExposingHandlerä¸ºç»™å®šçš„rawHandleræ„å»ºä¸€ä¸ªHandlerå¯¹è±¡ï¼Œå¹¶åœ¨æ‰§//è¡Œå¤„ç†ç¨‹åºä¹‹å‰æš´éœ²å®é™…çš„å¤„ç†ç¨‹åºPATH_WITHIN_HANDLER_MAPPING_ATTRIBUT//Eä»¥åŠURI_TEMPLATE_VARIABLES_ATTRIBUTEã€‚//é»˜è®¤å®ç°ç”¨ä¸€ä¸ªç‰¹æ®Šçš„æ‹¦æˆªå™¨æ„å»ºä¸€ä¸ªHandlerExecutionChainï¼Œè¯¥æ‹¦æˆªå™¨æš´éœ²//pathå±æ€§å’Œuriæ¨¡æ¿å˜é‡ã€‚protected Object buildPathExposingHandler(Object rawHandler, String bestMatchingPattern, String pathWithinMapping, Map&lt;String, String&gt; uriTemplateVariables) &#123; HandlerExecutionChain chain = new HandlerExecutionChain(rawHandler); chain.addInterceptor(new PathExposingHandlerInterceptor(bestMatchingPattern, pathWithinMapping)); if (!CollectionUtils.isEmpty(uriTemplateVariables)) &#123; chain.addInterceptor(new UriTemplateVariablesHandlerInterceptor(uriTemplateVariables)); &#125; return chain;&#125; å››ä¸ªå‚æ•°ï¼š rawHandler åŸå§‹å¤„ç†ç¨‹åº bestMatchingPattern æœ€ä½³åŒ¹é…æ¨¡å¼ pathWithinMapping åœ¨æ‰§è¡ŒHandlerä¹‹å‰å…¬å¼€çš„è·¯å¾„ uriTemplateVariables å¦‚æœæ²¡æœ‰æ‰¾åˆ°å˜é‡ï¼ŒURIæ¨¡æ¿å˜é‡å¯ä»¥æ˜¯{null} ä»ä»£ç æ³¨é‡Šç¿»è¯‘åŠä»£ç å†…å®¹å¯ä»¥äº†è§£åˆ°ï¼ŒbuildPathExposingHandlerçš„ä½œç”¨å°±æ˜¯ç»™å·²ç»æŸ¥æ‰¾åˆ°çš„handleræ³¨å†Œä¸¤ä¸ªæ‹¦æˆªå™¨ ExposingHandlerInterceptor UriTemplateVariablesHandlerInterceptor è¿™ä¸¤ä¸ªç±»å‡æ˜¯AbstractUrlHandlerMappingçš„å†…éƒ¨ç±»ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå†…éƒ¨æ‹¦æˆªå™¨ã€‚è¿™ä¸¤ä¸ªæ‹¦æˆªå™¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†ä¸å½“å‰urlå®é™…åŒ¹é…çš„patternã€åŒ¹é…æ¡ä»¶ä»¥åŠurlæ¨¡æ¿å‚æ•°ç­‰è®¾ç½®åˆ°requestçš„å±æ€§é‡Œé¢å»ï¼Œè¿™æ ·åœ¨åé¢çš„å¤„ç†è¿‡ç¨‹ä¸­å°±å¯ä»¥ç›´æ¥ä»requestå±æ€§ä¸­è·å–ã€‚çœ‹ä¸‹ä¸¤ä¸ªå†…éƒ¨ç±»çš„å®šä¹‰ï¼š 123456789101112131415161718192021222324252627282930313233private class PathExposingHandlerInterceptor extends HandlerInterceptorAdapter &#123; private final String bestMatchingPattern; private final String pathWithinMapping; public PathExposingHandlerInterceptor(String bestMatchingPattern, String pathWithinMapping) &#123; this.bestMatchingPattern = bestMatchingPattern; this.pathWithinMapping = pathWithinMapping; &#125; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) &#123; exposePathWithinMapping(this.bestMatchingPattern, this.pathWithinMapping, request); //è®¾ç½®requestå±æ€§ request.setAttribute(HandlerMapping.INTROSPECT_TYPE_LEVEL_MAPPING, supportsTypeLevelMappings()); return true; &#125;&#125;private class UriTemplateVariablesHandlerInterceptor extends HandlerInterceptorAdapter &#123; private final Map&lt;String, String&gt; uriTemplateVariables; public UriTemplateVariablesHandlerInterceptor(Map&lt;String, String&gt; uriTemplateVariables) &#123; this.uriTemplateVariables = uriTemplateVariables; &#125; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) &#123; //è¿™exposeUriTemplateVariablesç§è®¾ç½®requestå±æ€§ exposeUriTemplateVariables(this.uriTemplateVariables, request); return true; &#125;&#125; ä»å†…éƒ¨ç±»çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªå†…éƒ¨ç±»æ˜¯é€šè¿‡åœ¨preHandleæ–¹æ³•ä¸­è°ƒç”¨exposePathWithinMappingå’ŒexposeUriTemplateVariableså®Œæˆå±æ€§è®¾ç½®åˆ°requestä¸­çš„ã€‚ å¯¹äºæŸ¥æ‰¾handlerçš„å…³é”®å…¶å®å°±æ˜¯ç»´æŠ¤urlå’Œhandlerçš„æ˜ å°„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯handlerMapçš„æ„å»ºã€‚åœ¨AbstractUrlHandlerMappingä¸­æ˜¯é€šè¿‡registerHandlerè¿™ä¸ªæ–¹æ³•æ¥æ„å»ºhandlerMapçš„ã€‚AbstractUrlHandlerMappingæä¾›äº†ä¸¤ä¸ªregisterHandleræ–¹æ³•ï¼Œä¸‹é¢å°±é€šè¿‡ä»£ç æ¥çœ‹ä¸‹å…·ä½“çš„å®ç°ã€‚ 1234567protected void registerHandler(String[] urlPaths, String beanName) throws BeansException, IllegalStateException &#123; Assert.notNull(urlPaths, "URL path array must not be null"); for (String urlPath : urlPaths) &#123; registerHandler(urlPath, beanName); &#125;&#125; ç¬¬ä¸€ä¸ªregisterHandleræ˜¯å°†å¤šä¸ªurlæ³¨å†Œåˆ°ä¸€ä¸ªå¤„ç†å™¨ã€‚beanNameå…¶å®å°±æ˜¯å’±ä»¬å¤„ç†å™¨çš„åç§°ï¼Œå¯ä»¥é€šè¿‡beanNameåˆ°å®¹å™¨ä¸­å»æ‰¾åˆ°çœŸæ­£çš„å¤„ç†å™¨Beanã€‚å…·ä½“å¤„ç†å°±æ˜¯é€šè¿‡éå†æ‰€æœ‰çš„urlï¼Œç„¶åå†é€šè¿‡è°ƒç”¨ç¬¬äºŒä¸ªregisterHandlerå°†handleræ³¨å†Œåˆ°handlerMapä¸­ã€‚æ¥çœ‹ç¬¬äºŒä¸ªï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748protected void registerHandler(String urlPath, Object handler) throwsBeansException, IllegalStateException &#123; Assert.notNull(urlPath, "URL path must not be null"); Assert.notNull(handler, "Handler object must not be null"); Object resolvedHandler = handler; // å¦‚æœçš„handleræ˜¯stringç±»å‹ï¼Œå¹¶ä¸”ä¸æ˜¯lazyInitHandlersï¼Œåˆ™ä»SpringMV //Cå®¹å™¨ä¸­è·å–handler if (!this.lazyInitHandlers &amp;&amp; handler instanceof String) &#123; String handlerName = (String) handler; if (getApplicationContext().isSingleton(handlerName)) &#123; resolvedHandler = getApplicationContext().getBean(handlerName); &#125; &#125; Object mappedHandler = this.handlerMap.get(urlPath); if (mappedHandler != null) &#123; if (mappedHandler != resolvedHandler) &#123; //å¼‚å¸¸å¤„ç† &#125; &#125; else &#123; //æ˜¯å¦æ˜¯è·Ÿè·¯å¾„ if (urlPath.equals("/")) &#123; if (logger.isInfoEnabled()) &#123; logger.info("Root mapping to " + getHandlerDescription(handler)); &#125; setRootHandler(resolvedHandler); &#125; //æ˜¯å¦æ˜¯*æ¨¡å¼ else if (urlPath.equals("/*")) &#123; if (logger.isInfoEnabled()) &#123; logger.info("Default mapping to " + getHandlerDescription(handler)); &#125; setDefaultHandler(resolvedHandler); &#125; //åŠ å…¥åˆ°handlerMapä¸­ else &#123; this.handlerMap.put(urlPath, resolvedHandler); if (logger.isInfoEnabled()) &#123; logger.info("Mapped URL path [" + urlPath + "] onto " + getHandlerDescription(handler)); &#125; &#125; &#125;&#125; è¿™ä¸ªé‡Œé¢é¦–å…ˆæ˜¯çœ‹Mapä¸­æ˜¯å¦æœ‰åŸæ¥ä¼ å…¥çš„urlï¼Œå¦‚æœæ²¡æœ‰å°±åŠ å…¥ï¼Œå¦‚æœæœ‰å°±çœ‹ä¸‹åŸæ¥ä¿å­˜çš„å’Œå½“å‰æ³¨å†Œçš„handleræ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ªå°±æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆåŒä¸€ä¸ªurlä¸å¯èƒ½å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„handlerï¼‰ã€‚ åœ¨putä¹‹å‰ï¼Œä¹Ÿåšäº†ä¸€äº›â€œ/â€å’Œâ€œ/*â€çš„éªŒè¯å¤„ç†ï¼Œå¦‚æœæ˜¯è¿™ä¸¤ç§è·¯å¾„çš„è¯å°±ä¸ä¿å­˜åˆ°handlerMapä¸­äº†ã€‚ â€œ/â€ï¼šsetRootHandler(resolvedHandler); â€œ/*â€ï¼šsetDefaultHandler(resolvedHandler); OKï¼Œåˆ°è¿™AbstractUrlHandlerMappingè¿™ä¸ªç±»å°±åˆ†æå®Œäº†ï¼Œå…¶å®AbstractUrlHandlerMappingåšçš„äº‹æƒ…å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªæ¡†å­ï¼Œå­ç±»åªè¦å®Œæˆå¯¹Mapçš„åˆå§‹åŒ–å°±å¯ä»¥äº†ã€‚å…³äºAbstractUrlHandlerMappingçš„å­ç±»åç»­å†è°ˆã€‚]]></content>
      <categories>
        <category>spring mvc</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>web</tag>
        <tag>mvc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šæ³¨è§£è¯´æ˜]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase13%2F</url>
    <content type="text"><![CDATA[å› ä¸ºè¦çœ‹Springä¸­æ³¨è§£çš„å…·ä½“å®šä¹‰ï¼Œæ‰€ä»¥åœ¨è¯´ä¹‹å‰ï¼Œå…ˆæ¥ç®€å•è¯´ä¸‹JAVAä¸­æ³¨è§£çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚ å…ƒæ³¨è§£ä»€ä¹ˆæ˜¯å…ƒæ³¨è§£å‘¢ï¼Œå°±æ˜¯æ³¨è§£çš„æ³¨è§£ã€‚javaä¸­æä¾›äº†ä»¥ä¸‹å‡ ç§ï¼š @Target æ³¨è§£çš„ä½œç”¨åŸŸæè¿° 123456789101112131415161718public enum ElementType &#123; /** ç±», æ¥å£ æˆ–è€…æšä¸¾ */ TYPE, /** å­—æ®µ */ FIELD, /** æ–¹æ³• */ METHOD, /** å‚æ•° */ PARAMETER, /** æ„é€ æ–¹æ³• */ CONSTRUCTOR, /** å±€éƒ¨å˜é‡ */ LOCAL_VARIABLE, /** æ³¨è§£ç±»å‹ */ ANNOTATION_TYPE, /** åŒ… */ PACKAGE&#125; @Retention ç”Ÿå‘½å‘¨æœŸæè¿° 1234567891011121314public enum RetentionPolicy &#123; /** * åœ¨åŸæ–‡ä»¶ä¸­æœ‰æ•ˆï¼Œè¢«ç¼–è¯‘å™¨ä¸¢å¼ƒã€‚ */ SOURCE, /** * åœ¨classæ–‡ä»¶æœ‰æ•ˆï¼Œå¯èƒ½ä¼šè¢«è™šæ‹Ÿæœºå¿½ç•¥ã€‚ */ CLASS, /** * åœ¨è¿è¡Œæ—¶æœ‰æ•ˆã€‚ */ RUNTIME&#125; @Inherited æ ‡è¯†æ€§çš„å…ƒæ³¨è§£ï¼Œå®ƒå…è®¸å­æ³¨è§£ç»§æ‰¿å®ƒã€‚ @Documented ç”¨äºæ ‡å‡†ç”Ÿæˆjavadocæ—¶ä¼šåŒ…å«çš„æ³¨è§£ã€‚ JAVAä¸­æ³¨è§£çš„å®šä¹‰æ–¹å¼1public @interface æ³¨è§£å &#123;å®šä¹‰ä½“&#125; ä¸Šé¢è¯•ä¸€äº›åŸºæœ¬æ¦‚å¿µç‚¹ï¼Œå…³æ³¨æ³¨è§£å…¶ä»–çš„ä¸€äº›ç‰¹æ€§å’Œç”¨æ³•å°±ä¸ç»†è¯´äº†ã€‚ç›´æ¥çœ‹Springä¸­çš„æ³¨è§£å§ã€‚ 1ã€@Component12345678910111213@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface Component &#123; /** * The value may indicate a suggestion for a logical component name, * to be turned into a Spring bean in case of an autodetected component. * @return the suggested component name, if any */ String value() default "";&#125; æŒ‡ç¤ºæ³¨é‡Šç±»æ˜¯â€œç»„ä»¶â€ã€‚ å½“ä½¿ç”¨åŸºäºæ³¨é‡Šçš„é…ç½®å’Œç±»è·¯å¾„æ‰«ææ—¶ï¼Œè¿™äº›ç±»è¢«è®¤ä¸ºæ˜¯è‡ªåŠ¨æ£€æµ‹çš„å€™é€‰å¯¹è±¡ã€‚ 2ã€@Controller1234567@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Componentpublic @interface Controller &#123; String value() default "";&#125; ä½¿ç”¨è¿‡Spring mvcçš„å°ä¼™ä¼´å¯¹äºè¿™ä¸ªæ³¨è§£è‚¯å®šä¸é™Œç”Ÿã€‚@Controllerè¡¨ç¤ºæ³¨é‡Šçš„ç±»æ˜¯â€œæ§åˆ¶å™¨â€ï¼ˆä¾‹å¦‚Webæ§åˆ¶å™¨ï¼‰ã€‚è¿™ä¸ªæ³¨è§£ä½œä¸º@Componentçš„ä¸€ä¸ªç‰¹å®šæ–¹å¼å­˜åœ¨ï¼Œå…è®¸é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨æ£€æµ‹å®ç°ç±»ã€‚é€šå¸¸æƒ…å†µä¸‹ä¼šç»“åˆRequestMappingæ³¨è§£ä½¿ç”¨ã€‚ä»å®ƒçš„å®šä¹‰å±‚é¢æ¥çœ‹ï¼Œè¿™ä¸ªæ³¨è§£åªèƒ½ç”¨äºæ¥å£æˆ–è€…ç±»ä¸Šé¢ï¼Œä¸èƒ½ç”¨äºæ–¹æ³•æˆ–è€…å±æ€§å­—æ®µä¸Šé¢ã€‚ 3ã€@Service1234567@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Componentpublic @interface Service &#123; String value() default "";&#125; è¡¨ç¤ºæ³¨é‡Šç±»æ˜¯ä¸€ä¸ªâ€œæœåŠ¡â€ï¼Œæœ€åˆç”±Domain-Driven Design ï¼ˆEvansï¼Œ2003ï¼‰å®šä¹‰ä¸ºâ€œä½œä¸ºæ¨¡å‹ä¸­ç‹¬ç«‹çš„æ¥å£æä¾›çš„æ“ä½œï¼Œæ²¡æœ‰å°è£…çŠ¶æ€â€ã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŠŠä»–ç”¨åœ¨æ ‡å‡†æˆ‘ä»¬çš„serviceæœåŠ¡æ¥å£çš„å®ç°ç±»ä¸Šé¢ï¼Œå®é™…ä¸Šè¿™ç›¸å½“äºç¼©å°å®ƒä»¬çš„è¯­ä¹‰å’Œé€‚å½“çš„ä½¿ç”¨ã€‚ @Serviceè¿™ä¸ªæ³¨é‡Šä½œä¸º @Componentçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå…è®¸é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨æ£€æµ‹å®ç°ç±»ã€‚ 4ã€@Repository123456789101112@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Componentpublic @interface Repository &#123; /** * The value may indicate a suggestion for a logical component name, * to be turned into a Spring bean in case of an autodetected component. * @return the suggested component name, if any */ String value() default "";&#125; ç”¨äºæ ‡æ³¨æ•°æ®è®¿é—®ç»„ä»¶ï¼Œå³DAOç»„ä»¶ 5ã€@RequestMapping123456789101112131415161718192021222324@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Mappingpublic @interface RequestMapping &#123; String name() default ""; @AliasFor("path") String[] value() default &#123;&#125;; @AliasFor("value") String[] path() default &#123;&#125;; RequestMethod[] method() default &#123;&#125;; String[] params() default &#123;&#125;; String[] headers() default &#123;&#125;; String[] consumes() default &#123;&#125;; String[] produces() default &#123;&#125;;&#125; @RequestMappingæ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†åœ°å€æ˜ å°„è¯·æ±‚çš„æ³¨è§£ï¼Œä»å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œå¯ä½œç”¨äºæ–¹æ³•æˆ–è€…ç±»ä¸Šã€‚ ç”¨äºç±»ä¸Šï¼Œå¤§å¤šæ•°æ˜¯ä¸ºäº†è¿›è¡ŒåŒºåˆ†controller ç”¨äºæ–¹æ³•ä¸Šåˆ™æ˜¯å¯¹æ–¹æ³•è¿›è¡Œæ³¨è§£ä»¥äº§ç”Ÿè®¿é—®çš„è·¯å¾„ã€‚ å®ƒåŒ…æ‹¬äº†å‡ ä¸ªå±æ€§ï¼š value ç”¨äºè®¾ç½®æ–¹æ³•æˆ–è€…ç±»çš„æ˜ å°„è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥å†™è·¯å¾„ã€‚æˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ç›´æ¥å†™ï¼Œä¾‹å¦‚ï¼š@RequestMapping(â€œ/XXXâ€); method ç”¨äºæŒ‡å®šè¯·æ±‚çš„æ–¹æ³•ï¼Œå¯ä»¥è®¾ç½®å•ä¸ªæˆ–å¤šä¸ªï¼Œå¦‚æœè¯·æ±‚æ–¹æ³•ä¸æ»¡è¶³æ¡ä»¶åˆ™ä¼šè¯·æ±‚å¤±è´¥ã€‚ params æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›å‚æ•°å€¼æ˜¯ï¼Œæ‰è®©è¯¥æ–¹æ³•å¤„ç†ã€‚ name æ­¤æ˜ å°„æŒ‡å®šä¸€ä¸ªåç§° path ä»…åœ¨Servletç¯å¢ƒä¸­ï¼šè·¯å¾„æ˜ å°„URIï¼ˆä¾‹å¦‚â€œ/myPath.doâ€ï¼‰ã€‚ä¹Ÿæ”¯æŒAnté£æ ¼çš„è·¯å¾„æ¨¡å¼ï¼ˆä¾‹å¦‚â€œ/myPath/*.doâ€ï¼‰ã€‚åœ¨æ–¹æ³•çº§åˆ«ï¼Œåœ¨ç±»å‹çº§åˆ«è¡¨ç¤ºçš„ä¸»æ˜ å°„å†…æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆä¾‹å¦‚â€œedit.doâ€ï¼‰ã€‚ è·¯å¾„æ˜ å°„URIå¯èƒ½åŒ…å«å ä½ç¬¦ï¼ˆä¾‹å¦‚â€œ/ $ {connect}â€ï¼‰ consumes æŒ‡å®šå¤„ç†è¯·æ±‚çš„æäº¤å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰ï¼Œä¾‹å¦‚application/json, text/html; produces æŒ‡å®šè¿”å›çš„å†…å®¹ç±»å‹ï¼Œä»…å½“requestè¯·æ±‚å¤´ä¸­çš„(Accept)ç±»å‹ä¸­åŒ…å«è¯¥æŒ‡å®šç±»å‹æ‰è¿”å›ï¼› headers æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›æŒ‡å®šçš„headerå€¼ï¼Œæ‰èƒ½è®©è¯¥æ–¹æ³•å¤„ç†è¯·æ±‚ã€‚ å…¶ä»–çš„å‡ ä¸ªæ²¡æ€ä¹ˆç”¨è¿‡ï¼Œç¡®å®ä¸äº†è§£ï¼Œæœ‰çŸ¥é“çš„å°ä¼™ä¼´ï¼Œæ¬¢è¿ç•™è¨€ã€‚ 6ã€@ResponseBody@ResponseBodyè¿™ä¸ªæˆ‘ä¸€èˆ¬æ˜¯ç”¨åœ¨åšå¼‚æ­¥è¯·æ±‚è°ƒç”¨çš„æ–¹æ³•ä¸Šæ¥ä½¿ç”¨çš„ã€‚å› ä¸ºåœ¨ä½¿ç”¨@RequestMappingåï¼Œè¿”å›å€¼é€šå¸¸è§£æä¸ºè·³è½¬è·¯å¾„ã€‚åŠ ä¸Š@responsebodyåï¼Œè¿”å›ç»“æœç›´æ¥å†™å…¥HTTP response bodyä¸­ï¼Œä¸ä¼šè¢«è§£æä¸ºè·³è½¬è·¯å¾„ã€‚ å¯¹äºå¼‚æ­¥è¯·æ±‚ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¿”å›è§£æè§†å›¾ï¼ŒäºŒæ˜¯å¸Œæœ›å“åº”çš„ç»“æœæ˜¯jsonæ•°æ®ï¼Œé‚£ä¹ˆåŠ ä¸Š@responsebodyåï¼Œå°±ä¼šç›´æ¥è¿”å›jsonæ•°æ®ã€‚ 7ã€@AutowiredAutowiredå°±æ˜¯è‡ªåŠ¨è£…é…çš„æ„æ€ï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†æ¶ˆé™¤ä»£ç Javaä»£ç é‡Œé¢çš„getter/setterä¸beanå±æ€§ä¸­çš„propertyã€‚å½“ç„¶ï¼Œgetterçœ‹ä¸ªäººéœ€æ±‚ï¼Œå¦‚æœç§æœ‰å±æ€§éœ€è¦å¯¹å¤–æä¾›çš„è¯ï¼Œå°±åº”è¯¥ä¿ç•™ã€‚ @Autowiredé»˜è®¤æŒ‰ç±»å‹åŒ¹é…çš„æ–¹å¼ï¼Œåœ¨å®¹å™¨æŸ¥æ‰¾åŒ¹é…çš„Beanï¼Œå½“æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªåŒ¹é…çš„Beanæ—¶ï¼ŒSpringå°†å…¶æ³¨å…¥@Autowiredæ ‡æ³¨çš„å˜é‡ä¸­ã€‚ ä½†æ˜¯å½“æ¥å£å­˜åœ¨ä¸¤ä¸ªå®ç°ç±»çš„æ—¶å€™å¿…é¡»ä½¿ç”¨@QualifieræŒ‡å®šæ³¨å…¥å“ªä¸ªå®ç°ç±»ï¼Œå¦åˆ™å¯ä»¥çœç•¥ï¼Œåªå†™@Autowiredã€‚ 8ã€@Qualifier@Qualifierç”¨äºæŒ‡å®šæ³¨å…¥Beançš„åç§°ï¼Œå°±æ˜¯ä¸Šé¢è¯´åˆ°çš„ï¼Œå¦‚æœå®¹å™¨ä¸­æœ‰ä¸€ä¸ªä»¥ä¸ŠåŒ¹é…çš„Beanï¼Œåˆ™å¯ä»¥é€šè¿‡@Qualifieræ³¨è§£é™å®šBeançš„åç§°ã€‚ 9ã€@Resourceè¿™ä¸ªæ³¨è§£ä¸æ˜¯Springçš„ï¼Œæ”¾åœ¨è¿™é‡Œæ˜¯ä¸ºäº†å’Œ@Autowiredåšä¸€ä¸ªåŒºåˆ«ã€‚@Resourceé»˜è®¤æŒ‰åç§°è£…é…ï¼Œå½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„beanæ‰ä¼šæŒ‰ç±»å‹è£…é…ã€‚ 10ã€@PathVariableå½“ä½¿ç”¨@RequestMapping URI template æ ·å¼æ˜ å°„æ—¶ï¼Œ å³ someUrl/{paramId}, è¿™æ—¶çš„paramIdå¯é€šè¿‡ @Pathvariableæ³¨è§£ç»‘å®šå®ƒä¼ è¿‡æ¥çš„å€¼åˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚ 123456@RequestMapping("/user/&#123;userId&#125;")public ModelAndView userCenter(HttpServletRequest request, HttpServletResponse response, @PathVariable String userId)&#123; //do something &#125; å¦‚æœæ–¹æ³•å‚æ•°åç§°å’Œéœ€è¦ç»‘å®šçš„uri templateä¸­å˜é‡åç§°ä¸ä¸€è‡´ï¼Œéœ€è¦åœ¨@PathVariable(â€œnameâ€)æŒ‡å®šuri templateä¸­çš„åç§°ã€‚ 11ã€@RequestParam@RequestParamæ³¨è§£æœ‰ä¸¤ä¸ªå±æ€§ï¼š valueã€requiredï¼› valueç”¨æ¥æŒ‡å®šè¦ä¼ å…¥å€¼çš„idåç§° requiredç”¨æ¥æŒ‡ç¤ºå‚æ•°æ˜¯å¦å¿…é¡»ç»‘å®šï¼› ä¸¾ä¸ªä¾‹å­ï¼š 123456789@RequestMapping("/t_rparam1") public String t_rparam1(@RequestParam Long userId) &#123; //do something &#125; @RequestMapping("/t_rparam2") public String t_rparam2(Long userId) &#123; //do something &#125; t_rparam1 å¿…é¡»å¸¦æœ‰å‚æ•°,ä¹Ÿå°±æ˜¯è¯´ä½ ç›´æ¥è¾“å…¥localhost:8080/t_rparam1 ä¼šæŠ¥é”™åªèƒ½è¾“å…¥localhost:8080/t_rparam1?userId=? æ‰èƒ½æ‰§è¡Œç›¸åº”çš„æ–¹æ³• t_rparam2 å¯å¸¦å‚æ•°ä¹Ÿå¯ä¸å¸¦å‚æ•°;ä¹Ÿå°±æ˜¯è¯´è¾“å…¥localhost:8080/t_rparam2å’Œè¾“å…¥ localhost:8080/t_rparam2?userId=?éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½® @RequestParam é‡Œé¢çš„requiredä¸ºfalse(é»˜è®¤ä¸ºtrue ä»£è¡¨å¿…é¡»å¸¦å‚æ•°) è¿™æ ·t_rparam1å°±è·Ÿt_rparam2æ˜¯ä¸€æ ·çš„äº†ã€‚ 12ã€@RequestHeaderåˆ©ç”¨@RequestHeader æ³¨è§£å¯ä»¥æŠŠRequestè¯·æ±‚headeréƒ¨åˆ†çš„å€¼ç»‘å®šåˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚ 1234567@RequestMapping("/t_heander") public void getRequestHeaderTest(HttpServletRequest request, HttpServletResponse response, @RequestHeader("Accept-Encoding")String encoding) &#123; //do something &#125; 13ã€@CookieValue@CookieValueå°±æ˜¯æŠŠRequest headerä¸­cookieçš„å€¼ç»‘å®šåˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚æ¯”å¦‚è¯´æˆ‘ä»¬çš„cookieå¦‚ä¸‹ï¼š 1Cookie:JSESSIONID=ka8A5L5t7WTUPXbaLupBieqOdmc0ZpD5MyKvea6oQr7JJSIZzM;userId=001;sysFlag=glmapper è·å–å¦‚ä¸‹ï¼š1234@RequestMapping("/t_cookie") public void getCookieValueTest(@CookieValue("JSESSIONID") String cookie) &#123; //do something &#125; 14ã€@RequestBody@RequestBodyè¿™ä¸ªæ³¨è§£å¸¸ç”¨æ¥å¤„ç†Content-Typeä¸æ˜¯application/x-www-form-urlencodedç¼–ç çš„å†…å®¹ï¼Œæ¯”å¦‚è¯´ï¼šapplication/json, application/xmlç­‰ç­‰ï¼›è¿™ä¸ªå’ŒResonseBodyå¯ä»¥åè¿‡æ¥ç†è§£ã€‚ 15ã€@ModelAttribute æ–¹æ³•ä¸Š é€šå¸¸ç”¨æ¥åœ¨å¤„ç†@RequestMappingä¹‹å‰ï¼Œä¸ºè¯·æ±‚ç»‘å®šéœ€è¦ä»åå°æŸ¥è¯¢çš„modelï¼› å‚æ•°ä¸Š ç”¨æ¥é€šè¿‡åç§°å¯¹åº”ï¼ŒæŠŠç›¸åº”åç§°çš„å€¼ç»‘å®šåˆ°æ³¨è§£çš„å‚æ•°beanä¸Šï¼› å‚è€ƒ ã€ŠSpringæŠ€æœ¯å†…å¹•ã€‹ https://www.cnblogs.com/FrankLei/p/6579843.html]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JUCÂ·ThreadPoolExecutor çº¿ç¨‹æ± ]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-up-juc2%2F</url>
    <content type="text"><![CDATA[ThreadPoolExecutorç®—æ˜¯JUCä¸­æœ€å¸¸ç”¨çš„ç±»ä¹‹ä¸€äº†ã€‚ThreadPoolExecutorï¼Œé¡¾åæ€ä¹‰ï¼Œthread-pool-executor,ç¡¬ç¿»è¯‘å°±æ˜¯â€œçº¿ç¨‹-æ± -æ‰§è¡Œè€…â€ï¼›javaä¸­ï¼Œé€šè¿‡ThreadPoolExecutorå¯ä»¥å¾ˆå®¹æ˜“çš„åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿå‘¢ï¼Ÿå®ƒèƒ½å¤Ÿå¸¦æ¥ä»€ä¹ˆæ ·çš„ä¼˜åŠ¿å‘¢ï¼Ÿå®ƒåˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼ŸOKï¼Œå¸¦ç€è¿™å‡ ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹JAVAä¸­çš„çº¿ç¨‹æ± æŠ€æœ¯ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿå…³äºè¿™ä¸ªé—®é¢˜å…¶å®æœ‰ç‚¹é¸¡è‚‹ï¼Œæˆ‘è§‰å¾—å†é—®è¿™ä¸ªé—®é¢˜ä¹‹å‰æ›´åº”è¯¥é—®ä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹æ± ã€‚é‚£ä¸ºä»€ä¹ˆå‘¢? this is a ä¾‹å­ï¼š å¿«é€’è¡Œä¸šæœ€è¿‘ä¸¤å¹´å‘å±•çš„ç°å¸¸ç«çƒ­ï¼Œå¬è¯´å·¥èµ„ä¹Ÿéå¸¸çš„é«˜ï¼Œæå¾—æˆ‘ä¸€å¤©å¤©çš„éƒ½æ²¡æœ‰å¿ƒæ€å»å¥½å¥½å†™ä»£ç äº†... ä¹‹å‰çš„å°å¿«é€’å…¬å¸éƒ½æ˜¯æ²¡æœ‰å›ºå®šçš„å¿«é€’å‘˜çš„ï¼Œå°±æ˜¯è¯´ï¼Œæ¯æ¬¡å»é€ä¸€ä»¶å¿«é€’ï¼Œç«™ç‚¹è´Ÿè´£äººå°±éœ€è¦å»æ‰¾ä¸€ä¸ªäººæ¥å¸®å¿™é€ï¼Œé€å®Œä¹‹åå°±æ²¡æœ‰ç„¶åäº†(å½“ç„¶ï¼Œé’±è¿˜æ˜¯è¦ç»™çš„)ã€‚ ä½†æ˜¯åæ¥éšç€è´§è¶Šæ¥è¶Šå¤šï¼Œæ‰¾äººç»™é’±æˆæœ¬å¤ªå¤§ï¼Œè€Œä¸”å†œå¿™æ—¶è¿˜éœ€è¦èŠ±å¾ˆé•¿æ—¶é—´å»æ‰¾äººï¼Œæ‰€ä»¥å°±é›‡ç”¨äº†5ä¸ªäººï¼Œç­¾äº†åˆåŒï¼Œé•¿æœŸä¸ºç«™ç‚¹é…é€ã€‚ ä»¥å‰éƒ½æ˜¯éšæ—¶ç”¨éšæ—¶æ‰¾ï¼Œç°åœ¨ä¸æ˜¯ï¼Œç°åœ¨æ˜¯æˆç«‹äº†ä¸€ä¸ªç‰©æµå…¬å¸ï¼Œå¼€äº†ä¸€ä¸ªé…é€éƒ¨ï¼Œé…é€éƒ¨é—¨è§„å®šæ­£å¼é…é€å‘˜æœ€å¤šåªèƒ½æœ‰äº”ä¸ªäººã€‚ ä¹‹å‰é…é€çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼š æ¯æ¬¡æœ‰è´§ï¼Œæˆ‘éƒ½ä¼šå»ä¸´æ—¶æ‰¾ä¸€ä¸ªäººï¼Œç„¶åç­¾è®¢ä¸´æ—¶åˆåŒï¼Œé€å®Œä¹‹åè§£é™¤åˆåŒã€‚å¾ˆéº»çƒ¦ã€‚è¿™ä¹Ÿæ˜¯ä¸ç”¨çº¿ç¨‹æ± çš„ç¼ºç‚¹ï¼Œå°±æ˜¯ä»»åŠ¡æ¥äº†ï¼Œæˆ‘ä»¬éœ€è¦é¢‘ç¹çš„å»åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œç”¨å®Œä¹‹åè¿˜éœ€è¦é‡Šæ”¾çº¿ç¨‹èµ„æºï¼Œå¯¹äºç³»ç»Ÿçš„æ¶ˆè€—æ˜¯å¾ˆå¤§çš„ã€‚ å› ä¸ºé…é€çš„è´§è½¦åªæœ‰é‚£ä¹ˆå‡ ä¸ªï¼Œå¦‚æœä¸´æ—¶ç­¾è®¢çš„äººå¤šäº†ï¼Œè½¦å­ä¸å¤Ÿç”¨ï¼Œå…¶ä»–äººåªèƒ½ç­‰ç€è½¦å­é€å®Œä¹‹åæ‰èƒ½ç”¨ã€‚ æˆç«‹é…é€éƒ¨ä¹‹åè§£å†³çš„é—®é¢˜ æˆç«‹é…é€éƒ¨ä¹‹åå‘¢ï¼Œå› ä¸ºç­¾è®¢çš„æ˜¯åŠ³åŠ¡åˆåŒï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤çš„è®©é…é€å‘˜é…é€ä¸åŒçš„è´§ç‰©ã€‚è¾¾åˆ°çº¿ç¨‹èµ„æºçš„å¤ç”¨ã€‚ å› ä¸ºé™å®šäº†æœ€å¤šæ‹›è˜çš„äººæ•°ï¼Œå¯ä»¥å¾ˆå¥½çš„é¿å…æ‹›è¿‡å¤šæ— ç”¨çš„äººã€‚ OKï¼Œæˆ‘ä»¬ä»¥ä¸Šè¿°ä¾‹å­æ¥å¯¹åº”ç†è§£çº¿ç¨‹æ± çš„åŸºæœ¬åŸç† å…ˆæ¥çœ‹ä¸‹ï¼ŒJAVAå¯¹ThreadPoolExecutorçš„ç±»ç”³æ˜ï¼š 1public class ThreadPoolExecutor extends AbstractExecutorService åœ¨ã€åˆè¯†ã€‘-JUCÂ·Executoræ¡†æ¶ä¸­ç»™å‡ºäº†Executorçš„ç»§æ‰¿ä½“ç³»ã€‚ThreadPoolExecutorå°±æ˜¯å…·å¤‡çº¿ç¨‹æ± åŠŸèƒ½çš„é›†æˆè€…ã€‚ æ„é€ æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//æ„é€ æ–¹æ³•ä¸€public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue) &#123; this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, Executors.defaultThreadFactory(), defaultHandler); &#125; //æ„é€ æ–¹æ³•äºŒ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory) &#123; this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, defaultHandler);&#125;//æ„é€ æ–¹æ³•ä¸‰public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler) &#123; this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, Executors.defaultThreadFactory(), handler);&#125;//æ„é€ æ–¹æ³•å››public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler;&#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ„é€ æ–¹æ³•ï¼ˆä¸€ã€äºŒã€ä¸‰ï¼‰éƒ½æ˜¯é€šè¿‡è°ƒç”¨ï¼ˆå››ï¼‰æ¥åšå…·ä½“å±æ€§åˆå§‹åŒ–çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æ¥çœ‹æ„é€ æ–¹æ³•å››ï¼›åœ¨æ„é€ æ–¹æ³•å››ä¸­æ€»å…±éœ€è¦7ä¸ªå‚æ•°ï¼Œå…ˆæ¥çœ‹ä¸‹æ¯ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰ï¼š corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯æ ¸å¿ƒçº¿ç¨‹æ•°å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ç±»æ¯”äºä¸Šé¢ä¾‹å­ä¸­çš„é…é€éƒ¨ä¸­ç­¾è®¢åŠ³åŠ¨åˆåŒçš„äººçš„ä¸ªæ•°ã€‚ maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ã€‚åŠ å…¥è¯´ç°åœ¨æ˜¯åŒåä¸€æœŸé—´ï¼Œå¿«é€’å¼‚å¸¸çš„å¤šï¼Œé…é€éƒ¨çš„5ä¸ªäººå®Œå…¨å¿™ä¸è¿‡æ¥ï¼Œè€Œä¸”ä»“åº“ä¹Ÿæ»¡äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦å†æ‹›è˜ä¸€äº›ä¸´æ—¶é…é€å‘˜ï¼Œå‡è®¾maximumPoolSizeä¸º10ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸´æ—¶æ‹›è˜å¯ä»¥æ‹›5ä¸ªäººï¼Œé…é€éƒ¨ç­¾è®¢æ­£å¼åŠ³åŠ¨åˆåŒçš„äººå’Œç­¾è®¢ä¸´æ—¶åˆåŒçš„äººåŠ ä¸€å—ä¸èƒ½è¶…è¿‡é…é€éƒ¨è§„å®šçš„æœ€å¤§äººæ•°ï¼ˆ10äººï¼‰ã€‚æ‰€ä»¥è¯´ï¼ŒmaximumPoolSizeå°±æ˜¯çº¿ç¨‹æ± èƒ½å¤Ÿå…è®¸çš„å­˜åœ¨çš„æœ€å¤§çº¿ç¨‹çš„æ•°é‡ã€‚ keepAliveTime å­˜æ´»æ—¶é—´ã€‚ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªå‘¢ï¼Ÿæƒ³ä¸€ä¸‹ï¼ŒåŒåä¸€è¿‡å»äº†ï¼Œè´§ç‰©å·²ç»é…é€çš„å·®ä¸å¤šäº†ã€‚ä¸´æ—¶åˆåŒå†™çš„æ˜¯å¦‚æœä¸´æ—¶é…é€å‘˜2å¤©æ²¡æœ‰é…é€äº†ï¼Œé‚£é…é€éƒ¨å°±æœ‰æƒåˆ©ç»ˆæ­¢ä¸´æ—¶åˆåŒï¼Œç°åœ¨å·²ç»è¾¾åˆ°2å¤©è¿™ä¸ªç‚¹äº†ï¼Œéœ€è¦å¼€é™¤è¿™äº›ä¸´æ—¶é…é€ä¸“å‘˜äº†ã€‚å¯¹äºçº¿ç¨‹æ± æ¥è¯´ï¼ŒkeepAliveTimeå°±æ˜¯ç”¨æ¥è¡¨ç¤ºï¼Œå½“é™¤æ ¸å¿ƒçº¿ç¨‹æ± ä¹‹å¤–çš„çº¿ç¨‹è¶…è¿‡keepAliveTimeæ—¶é—´ä¹‹åï¼Œå°±éœ€è¦è¢«ç³»ç»Ÿå›æ”¶äº†ã€‚ unit keepAliveTimeçš„æ—¶é—´å•ä½ã€‚ workQueue å·¥ä½œé˜Ÿåˆ—ã€‚è¿™ä¸ªå°±ç›¸å½“äºä¸€ä¸ªä»“åº“ï¼Œç°åœ¨é…é€éƒ¨5ä¸ªäººéƒ½åœ¨é…é€ï¼Œä½†æ˜¯è¿˜ä¸æ–­çš„æœ‰æ–°çš„å¿«é€’è¾¾åˆ°ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªä»“åº“æ¥å­˜æ”¾è¿™äº›å¿«é€’ã€‚å¯¹äºçº¿ç¨‹æ± æ¥è¯´ï¼Œå½“æ ¸å¿ƒçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä»»åŠ¡å¤„ç†ï¼Œå¹¶ä¸”è¿˜æœ‰ä»»åŠ¡è¿›æ¥çš„æ—¶å€™ï¼Œå°±ä¼šå°†ä»»åŠ¡æ·»åŠ åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­å»ã€‚ threadFactory çº¿ç¨‹å·¥å‚ã€‚å°±æ˜¯ç”¨æ¥åˆ›å»ºçº¿ç¨‹çš„ã€‚å¯ä»¥ç±»æ¯”æˆæ‹›è˜ç»„ï¼Œä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…åå­—æˆ–è€…ç¼–å·è¿™æ ·ã€‚ handler RejectedExecutionHandler ç”¨æ¥æè¿°æ‹’ç»ç­–ç•¥çš„ã€‚å‡è®¾ç°åœ¨æˆ‘çš„ä»“åº“ä¹Ÿæ»¡è¶³ï¼Œå¹¶ä¸”é…é€éƒ¨å·²ç»è¾¾åˆ°10ä¸ªäººäº†ã€‚æ€ä¹ˆåŠå‘¢ï¼Œé‚£ä¹ˆåªèƒ½é‡‡ç”¨ä¸€äº›ç­–ç•¥æ¥æ‹’ç»ä»»åŠ¡äº†ã€‚ çº¿ç¨‹æ± çš„çŠ¶æ€ 1234567891011// runState is stored in the high-order bits//RUNNINGï¼›è¯¥çŠ¶æ€çš„çº¿ç¨‹æ± æ¥æ”¶æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡private static final int RUNNING = -1 &lt;&lt; COUNT_BITS;//SHUTDOWNï¼›è¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS;//STOPï¼›ä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼›private static final int STOP = 1 &lt;&lt; COUNT_BITS;//æ‰€æœ‰çš„ä»»åŠ¡å·²ç»ˆæ­¢ï¼Œctlè®°å½•çš„â€ä»»åŠ¡æ•°é‡â€ä¸º0ï¼Œçº¿ç¨‹æ± ä¼šå˜ä¸ºTIDYINGçŠ¶æ€private static final int TIDYING = 2 &lt;&lt; COUNT_BITS;//çº¿ç¨‹æ± å½»åº•ç»ˆæ­¢ï¼Œå°±å˜æˆTERMINATEDçŠ¶æ€ã€‚ private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; ä¸‹é¢æ˜¯åœ¨ç½‘ä¸Šå‘ç°çš„ä¸€ä½å¤§ç‰›çš„å›¾ï¼›æ„Ÿè§‰å¯ä»¥è¾ƒä¸ºç›´è§‚çš„æè¿°çŠ¶æ€çš„å˜æ›´ å·¥ä½œåŸç† æœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ã€‚ 1ã€å¦‚ä½•æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ï¼Ÿ12345678910111213141516171819202122public void execute(Runnable command) &#123; //ä»»åŠ¡ä¸ºnull,ç›´æ¥æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ if (command == null) throw new NullPointerException(); int c = ctl.get(); //å¦‚æœçº¿ç¨‹æ•°å¤§äºç­‰äºåŸºæœ¬çº¿ç¨‹æ•°ï¼Œå°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ— if (workerCountOf(c) &lt; corePoolSize) &#123; if (addWorker(command, true)) return; c = ctl.get(); &#125; if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; int recheck = ctl.get(); if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0) addWorker(null, false); &#125; else if (!addWorker(command, false)) reject(command);&#125; å¦‚æœå°‘äºcorePoolSizeçº¿ç¨‹æ­£åœ¨è¿è¡Œï¼Œè¯·å°è¯•ä½¿ç”¨ç»™å®šå‘½ä»¤å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚ å¯¹addWorkerçš„è°ƒç”¨ä¼šè‡ªåŠ¨æ£€æŸ¥runStateå’ŒworkerCountï¼Œä»è€Œé˜²æ­¢é”™è¯¯æŠ¥è­¦ï¼Œåœ¨ä¸åº”è¯¥çš„æ—¶å€™é€šè¿‡è¿”å›falseæ¥æ·»åŠ çº¿ç¨‹ã€‚ å¦‚æœä¸€ä¸ªä»»åŠ¡èƒ½å¤ŸæˆåŠŸæ’é˜Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»ç„¶éœ€è¦å†æ¬¡æ£€æŸ¥æ˜¯å¦åº”è¯¥æ·»åŠ ä¸€ä¸ªçº¿ç¨‹ï¼ˆå› ä¸ºç°æœ‰çš„çº¿ç¨‹è‡ªä¸Šæ¬¡æ£€æŸ¥ä»¥æ¥å·²ç»æ­»æ‰ï¼‰æˆ–è€…è‡ªä»è¿›å…¥è¿™ä¸ªæ–¹æ³•ä»¥æ¥ï¼Œæ± å…³é—­äº†ã€‚æ‰€ä»¥æˆ‘ä»¬é‡æ–°æ£€æŸ¥çŠ¶æ€ï¼Œå¦‚æœå½“å‰commandå·²ç»stopäº†ï¼Œé‚£ä¹ˆå°±é€€å‡ºå·¥ä½œé˜Ÿåˆ—ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±å¼€å§‹ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚ å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¼šæƒ³å°è¯•å»åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å»æ‰§è¡Œï¼Œå¦‚æœåˆ›å»ºä¸äº†ï¼Œé‚£å°±æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ 2ã€å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼Ÿé€šè¿‡å®ç°è¿™ä¸ªæ¥å£å»åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ 123public interface ThreadFactory &#123; Thread newThread(Runnable r);&#125; 3ã€å¦‚ä½•å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Ÿé€šè¿‡addWorkeræ–¹æ³•æ¥æ·»åŠ ï¼Œå…¶å®åœ¨excuteä¸­åªæ˜¯ä½œä¸ºä¸€ä¸ªæäº¤ä»»åŠ¡çš„å…¥å£ï¼Œå®é™…çš„å¤„ç†é€»è¾‘éƒ½æ˜¯åœ¨addWorkerè¿™ä¸ªæ–¹æ³•é‡Œæ¥å®Œæˆçš„ã€‚addWorkeræœ‰ä¸¤ä¸ªå‚æ•°ï¼š firstTask å½“å‰ä»»åŠ¡ core ç”¨æ¥æ ‡æ³¨å½“å‰éœ€è¦åˆ›å»ºçš„çº¿ç¨‹æ˜¯å¦æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œå¦‚æœcoreä¸ºtrueï¼Œåˆ™è¡¨æ˜åˆ›å»ºçš„æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰è¿˜æ²¡æœ‰è¾¾åˆ°æœ€å¤§æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚ å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„å‰åŠéƒ¨åˆ†ï¼š1234567891011121314151617181920212223242526272829private boolean addWorker(Runnable firstTask, boolean core) &#123; retry: //è‡ªæ—‹æ–¹å¼ for (;;) &#123; //è·å–å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ int c = ctl.get(); int rs = runStateOf(c); //å¦‚æœçŠ¶æ€æ˜¯STOPï¼ŒTIDYING,TERMINATEDçŠ¶æ€çš„è¯ï¼Œåˆ™ä¼šè¿”å›false //å¦‚æœçŠ¶æ€æ˜¯SHUTDOWNï¼Œä½†æ˜¯firstTaskä¸ä¸ºç©ºæˆ–è€…workQueueä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›falseã€‚ if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; //é€šè¿‡è‡ªæ—‹çš„æ–¹å¼ï¼Œåˆ¤æ–­è¦æ·»åŠ çš„workeræ˜¯å¦ä¸ºcorePoolèŒƒç•´ä¹‹å†…çš„ for (;;) &#123; int wc = workerCountOf(c); if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; if (compareAndIncrementWorkerCount(c)) break retry; c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; //å¦‚æœè¶…è¿‡CAPACITYé™åˆ¶äº†åˆ™ç›´æ¥è¿”å›false1wc &gt;= CAPACITY //åˆ¤æ–­å½“å‰çš„workerCountæ˜¯å¦å¤§äºcorePoolsizeï¼Œå¦åˆ™åˆ™åˆ¤æ–­æ˜¯å¦å¤§äºmaximumPoolSize//å…·ä½“çš„æ¯”è¾ƒå–å†³äºå…¥å‚coreæ˜¯trueè¿˜æ˜¯falseã€‚1wc &gt;= (core ? corePoolSize : maximumPoolSize) å¦‚æœä¸Šé¢ä¸¤ä¸ªæœ‰ä¸€ä¸ªæ»¡è¶³äº†ï¼Œåˆ™ç›´æ¥è¿”å›falseã€‚ ä¸‹é¢æ˜¯åˆ¤æ–­WorkerCounté€šè¿‡CASæ“ä½œå¢åŠ 1æ˜¯å¦æˆåŠŸï¼ŒæˆåŠŸçš„è¯å°±åˆ°æ­¤ç»“æŸ12if (compareAndIncrementWorkerCount(c)) break retry; å¦‚æœä¸æˆåŠŸï¼Œåˆ™å†æ¬¡åˆ¤æ–­å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¦‚æœç°åœ¨è·å–åˆ°çš„çŠ¶æ€ä¸è¿›å…¥è‡ªæ—‹çš„çŠ¶æ€ä¸ä¸€è‡´çš„è¯ï¼Œé‚£ä¹ˆåˆ™é€šè¿‡continue retryé‡æ–°è¿›è¡ŒçŠ¶æ€çš„åˆ¤æ–­ã€‚123c = ctl.get(); // Re-read ctlif (runStateOf(c) != rs) continue retry; å†æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„åé¢åŠä¸ªéƒ¨åˆ†ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849boolean workerStarted = false;boolean workerAdded = false;Worker w = null;try &#123; final ReentrantLock mainLock = this.mainLock; //åˆ›å»ºä¸€ä¸ªæ–°çš„Workerå¯¹è±¡ w = new Worker(firstTask); final Thread t = w.thread; // if (t != null) &#123; //åŠ é” mainLock.lock(); try &#123; // åœ¨é”å®šçš„æƒ…å†µä¸‹é‡æ–°æ£€æŸ¥ã€‚ // åœ¨ä¸€ä¸‹æƒ…å†µé€€å‡ºï¼šThreadFactory åˆ›å»ºå¤±è´¥æˆ–è€…åœ¨è·å–é”ä¹‹å‰shut downäº† int c = ctl.get(); int rs = runStateOf(c); //çŠ¶æ€æ ¡éªŒ if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; if (t.isAlive()) // é¢„å…ˆæ£€æŸ¥tæ˜¯å¯ä»¥å¯åŠ¨çš„ throw new IllegalThreadStateException(); //æ·»åŠ è‡³workersä¸­ workers.add(w); int s = workers.size(); //å¦‚æœè¶…è¿‡äº†å†å²æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™å°†å½“å‰æ± æ•°é‡è®¾ç½®ä¸ºå†å²æœ€å¤§çº¿ç¨‹è®°å½•æ•° if (s &gt; largestPoolSize) largestPoolSize = s; //æ ‡è¯†æ·»åŠ å·¥ä½œçº¿ç¨‹æˆåŠŸ workerAdded = true; &#125; &#125; finally &#123; //è§£é” mainLock.unlock(); &#125; //å¦‚æœæ·»åŠ æˆåŠŸåˆ™å¯åŠ¨å½“å‰å·¥ä½œçº¿ç¨‹ if (workerAdded) &#123; t.start(); //å¹¶å°†å½“å‰çº¿ç¨‹çŠ¶æ€è®¾ç½®ä¸ºå·²å¯åŠ¨ workerStarted = true; &#125; &#125;&#125; finally &#123;//æ·»åŠ å¤±è´¥ if (! workerStarted) addWorkerFailed(w);&#125;return workerStarted;&#125; æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ 1ã€AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼› 2ã€CallerRunsPolicyï¼šä½¿ç”¨è°ƒç”¨è€…è‡ªå·±çš„å½“å‰çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼› 3ã€DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼› 4ã€DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼› å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ã€‚ å¸¸ç”¨å·¥ä½œé˜Ÿåˆ—ç±»å‹1ã€ArrayBlockingQueue åŸºäºæ•°ç»„çš„é˜»å¡é˜Ÿåˆ—ï¼Œé•¿åº¦æœ‰é™ 2ã€LinkedBlockingQuene åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œé•¿åº¦æ— é™ï¼Œä½¿ç”¨è¿™ä¸ªå¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬çš„æ‹’ç»ç­–ç•¥å¤±æ•ˆã€‚å› ä¸ºå¯ä»¥æ— é™çš„åˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ã€‚ 3ã€PriorityBlockingQueue å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼› 3ã€SynchronousQuene SynchronousQueneæ˜¯ä¸€ä¸ªæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„BlockingQueueï¼›æ¯ä¸€ä¸ªputæ“ä½œå¿…é¡»è¦ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚æ‰€ä»¥è¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒä¸å­˜æˆ‘ä»¬çš„ä»»åŠ¡ï¼Œä¹Ÿå°±è¯´è¯´å®ƒçš„æ¯ä¸ªputæ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨takeæ“ä½œï¼Œå¦åˆ™putæ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚ Workerè¿™ä¸ªæ˜¯ThreadPoolExecutorçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚é‡è¦çš„æ˜¯è¿™ä¸ªå†…éƒ¨ç±»å®ç°äº†AbstractQueuedSynchronizerï¼ˆAQS:æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰æŠ½è±¡ç±»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475private final class Worker extends AbstractQueuedSynchronizer implements Runnable&#123; /** * This class will never be serialized, but we provide a * serialVersionUID to suppress a javac warning. */ private static final long serialVersionUID = 6138294804551838833L; /** å½“å‰workæŒæœ‰çš„çº¿ç¨‹ */ final Thread thread; /** è¿è¡Œçš„åˆå§‹ä»»åŠ¡ã€‚ å¯èƒ½ä¸ºç©ºã€‚*/ Runnable firstTask; /** æ¯ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡çš„è®¡æ•°å™¨ */ volatile long completedTasks; /** * æ„é€ å‡½æ•° */ Worker(Runnable firstTask) &#123; // ç¦æ­¢ä¸­æ–­ï¼Œç›´åˆ°runWorker setState(-1); //æƒ³æäº¤çš„ä»»åŠ¡äº¤ç»™å½“å‰å·¥ä½œçº¿ç¨‹ this.firstTask = firstTask; //é€šè¿‡çº¿ç¨‹å·¥å‚åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ this.thread = getThreadFactory().newThread(this); &#125; /** å°†runæ–¹æ³•çš„æ‰§è¡Œå§”æ‰˜ç»™å¤–éƒ¨runWorker */ public void run() &#123; runWorker(this); &#125; // æ˜¯å¦é”å®š // // 0ä»£è¡¨è§£é”çŠ¶æ€ã€‚ // 1ä»£è¡¨é”å®šçŠ¶æ€ã€‚ protected boolean isHeldExclusively() &#123; return getState() != 0; &#125; //å°è¯•è·å–é”ï¼ˆé‡å†™AQSçš„æ–¹æ³•ï¼‰ protected boolean tryAcquire(int unused) &#123; if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; return false; &#125; //å°è¯•é‡Šæ”¾é”ï¼ˆé‡å†™AQSçš„æ–¹æ³•ï¼‰ protected boolean tryRelease(int unused) &#123; setExclusiveOwnerThread(null); setState(0); return true; &#125; //åŠ é” public void lock() &#123; acquire(1); &#125; //å°è¯•åŠ é” public boolean tryLock() &#123; return tryAcquire(1); &#125; //è§£é” public void unlock() &#123; release(1); &#125; //æ˜¯å¦é”å®š public boolean isLocked() &#123; return isHeldExclusively(); &#125; //å¦‚æœå¯åŠ¨åˆ™ä¸­æ–­ void interruptIfStarted() &#123; Thread t; if (getState() &gt;= 0 &amp;&amp; (t = thread) != null &amp;&amp; !t.isInterrupted()) &#123; try &#123; t.interrupt(); &#125; catch (SecurityException ignore) &#123; &#125; &#125; &#125;&#125; runWorkeræœ€åæ¥çœ‹ä¸‹runWorkerè¿™ä¸ªæ–¹æ³•ï¼ˆThreadPoolExecutorä¸­çš„æ–¹æ³•ï¼‰ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); Runnable task = w.firstTask; w.firstTask = null; w.unlock(); // allow interrupts boolean completedAbruptly = true; try &#123; while (task != null || (task = getTask()) != null) &#123; w.lock(); // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; beforeExecute(wt, task); Throwable thrown = null; try &#123; task.run(); &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; w.completedTasks++; w.unlock(); &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); &#125;&#125; ä¸‹é¢æ˜¯å¯¹æ³¨é‡Šçš„è¹©è„šç¿»è¯‘ï¼Œæ¬¢è¿åæ§½ï¼Œä½†æ³¨æ„å°ºåº¦ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ ä¸»è¦å·¥ä½œå¾ªç¯è¿è¡Œã€‚é‡å¤åœ°ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œå®ƒä»¬ï¼ŒåŒæ—¶å¤„ç†ä¸€äº›é—®é¢˜: æˆ‘ä»¬å¯èƒ½ä¼šä»æœ€åˆçš„ä»»åŠ¡å¼€å§‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¾—åˆ°ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚å¦åˆ™ï¼Œåªè¦æ± æ­£åœ¨è¿è¡Œï¼Œæˆ‘ä»¬å°±ä»getTaskè·å¾—ä»»åŠ¡ã€‚ å¦‚æœå®ƒè¿”å›nullï¼Œåˆ™ç”±äºæ›´æ”¹æ± çŠ¶æ€æˆ–é…ç½®å‚æ•°è€Œå¯¼è‡´workeré€€å‡ºã€‚å…¶ä»–é€€å‡ºçš„ç»“æœæ˜¯åœ¨å¤–éƒ¨ä»£ç ä¸­æŠ›å‡ºçš„å¼‚å¸¸ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹completeAbruptlyæˆç«‹ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´processWorkerExitæ¥å–ä»£è¿™ä¸ªçº¿ç¨‹ã€‚ åœ¨è¿è¡Œä»»ä½•ä»»åŠ¡ä¹‹å‰ï¼Œè·å–é”ä»¥é˜²æ­¢ä»»åŠ¡æ­£åœ¨æ‰§è¡Œæ—¶å‘ç”Ÿå…¶ä»–æ± ä¸­æ–­ï¼Œè°ƒç”¨clearInterruptsForTaskRunç¡®ä¿é™¤éæ± æ­£åœ¨åœæ­¢ï¼Œåˆ™æ­¤çº¿ç¨‹æ²¡æœ‰è®¾ç½®å…¶ä¸­æ–­ã€‚ æ¯ä¸ªä»»åŠ¡è¿è¡Œä¹‹å‰éƒ½ä¼šè°ƒç”¨beforeExecuteï¼Œè¿™å¯èƒ½ä¼šå¼•å‘ä¸€ä¸ªå¼‚å¸¸ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå¯¼è‡´çº¿ç¨‹æ­»äº¡ï¼ˆæ–­å¼€å¾ªç¯completeAbruptlyä¸ºtrueï¼‰ï¼Œè€Œä¸å¤„ç†ä»»åŠ¡ã€‚ å‡è®¾beforeExecuteæ­£å¸¸å®Œæˆï¼Œæˆ‘ä»¬è¿è¡Œä»»åŠ¡ï¼Œæ”¶é›†ä»»ä½•æŠ›å‡ºçš„å¼‚å¸¸å‘é€åˆ°afterExecuteã€‚ æˆ‘ä»¬åˆ†åˆ«å¤„ç†RuntimeExceptionï¼ŒErrorï¼ˆè¿™ä¸¤ä¸ªè§„èŒƒä¿è¯æˆ‘ä»¬é™·é˜±ï¼‰å’Œä»»æ„çš„Throwablesã€‚ å› ä¸ºæˆ‘ä»¬ä¸èƒ½åœ¨Runnable.runä¸­é‡æ–°æŠ›å‡ºThrowableï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒä»¬å°è£…åœ¨Errorsä¸­ï¼ˆåˆ°çº¿ç¨‹çš„UncaughtExceptionHandlerï¼‰ã€‚ ä»»ä½•æŠ›å‡ºçš„å¼‚å¸¸ä¹Ÿä¿å®ˆåœ°å¯¼è‡´çº¿ç¨‹æ­»äº¡ã€‚ task.runå®Œæˆåï¼Œæˆ‘ä»¬è°ƒç”¨afterExecuteï¼Œè¿™ä¹Ÿå¯èƒ½ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´çº¿ç¨‹æ­»äº¡ã€‚ æ ¹æ®JLS Sec 14.20ï¼Œå³ä½¿task.runæŠ›å‡ºï¼Œè¿™ä¸ªå¼‚å¸¸ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚ å¼‚å¸¸æœºåˆ¶çš„æœ€ç»ˆæ•ˆæœæ˜¯afterExecuteå’Œçº¿ç¨‹çš„UncaughtExceptionHandleræ‹¥æœ‰å…³äºç”¨æˆ·ä»£ç é‡åˆ°çš„ä»»ä½•é—®é¢˜çš„å‡†ç¡®ä¿¡æ¯ã€‚ æ€»ç»“æœ¬æ–‡æ˜¯JUCçš„ç¬¬äºŒç¯‡ï¼Œæ„åœ¨é€šè¿‡æŸ¥çœ‹æºç æ¥äº†è§£çº¿ç¨‹æ± çš„å…·ä½“å·¥ä½œåŸç†ã€‚æ–‡ä¸­å¦‚æœå­˜åœ¨ä¸å½“çš„æè¿°ï¼Œå¸Œæœ›å°ä¼™ä¼´ä»¬èƒ½å¤ŸåŠæ—¶æå‡ºã€‚ç°å¸¸æ„Ÿè°¢ï¼ æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼Œå¹²è´§æ»¡æ»¡å“¦~]]></content>
      <categories>
        <category>JUC</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>çº¿ç¨‹</tag>
        <tag>thread</tag>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JUCÂ·Executor æ¡†æ¶]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-up-juc1%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¤šçº¿ç¨‹å’Œå¹¶å‘è¿™ä¸¤ä¸ªä¸œè¥¿çœŸçš„æ˜¯å‘å¾€å·²ä¹…ï¼Œæ€»æ˜¯æœ‰ä¸€ç§ç¥ç§˜çš„æ„Ÿè§‰ï¼Œæƒ³å»æ¢ç´¢ä¸€æ³¢ï¼Œåˆæ‹…å¿ƒæ°´å¹³ä¸å¤Ÿæ— æ³•é©¾é©­ã€‚æƒ³ä»¥è¯»ä¹¦ç¬”è®°çš„æ–¹å¼æ¥å†™ï¼Œä½†æ˜¯åˆè§‰å¾—ç¼ºå°‘è‡ªå·±çš„ä¸€äº›æ€è€ƒï¼›ä½†æ˜¯åœ¨æ²¡æœ‰è¶³å¤Ÿå¹¶å‘ç¼–ç¨‹ç»éªŒçš„æƒ…å†µä¸‹åˆæ²¡æ³•å»å†™å‡ºå¾ˆæ·±åˆ»çš„ä¸œè¥¿ï¼Œæ¯•ç«Ÿæ²¡æœ‰è¸©è¿‡å‘ã€‚æ‰€ä»¥åœ¨é˜…è¯»springæºç çš„åŒæ—¶ï¼Œä¹Ÿæƒ³æŠ½ç‚¹æ—¶é—´æ¥çœ‹ä¸€çœ‹JUCçš„ä¸œè¥¿ï¼Œå…³äºè¿™å—åªèƒ½è¯´æ˜¯è®°å½•è‡ªå·±å­¦ä¹ JUCçš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå°è¯•ç”¨ä¸€äº›å…·ä½“çš„ä»£ç demoæ¥åŠ æ·±ç†è§£ã€‚æ‰€ä»¥å°±æŠŠæœ¬ç³»åˆ—å†™æˆã€Šã€ åˆè¯†ã€‘-JUCÂ·XXXXã€‹ï¼Œç”¨æ¥è®©è‡ªå·±æ‰“å¼€å¹¶å‘ç¼–ç¨‹çš„å¤§é—¨ã€‚ JUCJUCå³java.util.concurrentï¼›ä¹Ÿå°±æ˜¯javaæä¾›çš„å¹¶å‘åŒ…ã€‚JUCä¸­ä»åŒ…ç»“æ„ä¸Šæ¥çœ‹ä¸»è¦æ˜¯ï¼š java.util.concurrent åœ¨è¿™ä¸ªåŒ…ä¸‹é¢ä¸»è¦æ˜¯çº¿ç¨‹æ± ã€å¹¶å‘é›†åˆä»¥åŠä¸€äº›å¹¶å‘å·¥å…·ç±»ã€‚çº¿ç¨‹æ± ç›¸å…³æ˜¯å›´ç»•Excetoræ¡†æ¶æ¥æ„å»ºï¼›è¿™ä¹Ÿæ˜¯æœ¬æ–‡ä¸‹é¢éƒ¨åˆ†çš„é‡ç‚¹ã€‚ java.util.concurrent.atomic è¿™ä¸ªåŒ…ä¸‹é¢æ˜¯ä¸€äº›åŸå­æ“ä½œç±»ï¼Œç®—æ˜¯å¹¶å‘è¾…åŠ©å·¥å…·ç±»ï¼ŒåŸºæœ¬å®ç°ä¾èµ–äºCASï¼› java.util.concurrent.locks è¿™ä¸ªä»åå­—å°±å¯ä»¥çŸ¥é“å®ƒçš„ä½œç”¨ï¼Œå°±æ˜¯æä¾›é”ã€‚ JUCå„ä¸ªæ¨¡å—çš„ç±» æ•´ä½“æ¡†æ¶ atomic locks å¹¶å‘é›†åˆ å¹¶å‘å·¥å…· forkJoin fork-joinåœ¨JUCä¸­æœ‰ä¸‹é¢ä¸‰ä¸ªç±»ï¼š 1public class ForkJoinPool extends AbstractExecutorService 1public abstract class ForkJoinTask&lt;V&gt; implements Future&lt;V&gt;, Serializable 1public class ForkJoinWorkerThread extends Thread FutureFutureæä¾›äº†å¯ä»¥è·å–å¼‚æ­¥æ‰§è¡Œç»“æœçš„æ–¹æ³•ï¼ŒåŒºåˆ«äºRunnableçš„runæ–¹æ³•ï¼Œrunæ˜¯ä¸æä¾›è¿”å›ç»“æœçš„ã€‚1234567891011121314public interface Future&lt;V&gt; &#123; //å–æ¶ˆ boolean cancel(boolean mayInterruptIfRunning); //å¦‚æœä»»åŠ¡å®Œæˆå‰è¢«å–æ¶ˆï¼Œåˆ™è¿”å›trueã€‚ boolean isCancelled(); //å¦‚æœä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œæ— è®ºæ˜¯æ­£å¸¸ç»“æŸæˆ–æ˜¯ä¸­é€”å–æ¶ˆè¿˜æ˜¯å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½è¿”å›trueã€‚ boolean isDone(); //è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœï¼Œå¦‚æœæ²¡æœ‰ç»“æœå¯ç”¨ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ç›´åˆ°å¼‚æ­¥è®¡ç®—å®Œæˆã€‚ V get() throws InterruptedException, ExecutionException; //è·å–å¼‚æ­¥æ‰§è¡Œç»“æœï¼Œå¦‚æœæ²¡æœ‰ç»“æœå¯ç”¨ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ï¼Œä½†æ˜¯ä¼šæœ‰æ—¶é—´é™åˆ¶ï¼Œ //å¦‚æœé˜»å¡æ—¶é—´è¶…è¿‡è®¾å®šçš„timeoutæ—¶é—´ï¼Œè¯¥æ–¹æ³•å°†æŠ›å‡ºå¼‚å¸¸ã€‚ V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; Callableå£°æ˜äº†ä¸€ä¸ªåç§°ä¸ºcall()çš„æ–¹æ³•ï¼ŒåŒæ—¶è¿™ä¸ªæ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼Vï¼Œä¹Ÿå¯ä»¥æŠ›å‡ºå¼‚å¸¸123public interface Callable&lt;V&gt; &#123; V call() throws Exception; &#125; å…³äºCallableå’ŒFutureçš„ä½¿ç”¨ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ç»“åˆæˆ‘ä»¬çš„çº¿ç¨‹æ± æ¥ä½¿ç”¨çš„ã€‚ ExecutorExecutoræ¥å£æ˜¯çº¿ç¨‹æ± å®ç°çš„é¡¶çº§æ¥å£ï¼Œå…¶å’Œspringä¸­çš„BeanFactoryæ‰€æ‰¿æ‹…çš„è§’è‰²å·®ä¸å¤šï¼Œå°±æ˜¯æä¾›é¡¶çº§çš„åŠŸèƒ½çº¦æŸï¼Œå…·ä½“å®ç°äº¤äºä¸åŒå­ç±»æ¥å®Œæˆã€‚12345678910111213public interface Executor &#123; /** * Executes the given command at some time in the future. The command * may execute in a new thread, in a pooled thread, or in the calling * thread, at the discretion of the &lt;tt&gt;Executor&lt;/tt&gt; implementation. * * @param command the runnable task * @throws RejectedExecutionException if this task cannot be * accepted for execution. * @throws NullPointerException if command is null */ void execute(Runnable command);&#125; ä¸‹é¢æ˜¯JUCä¸­Executoræ¡†æ¶çš„æ•´ä½“ç»“æ„ï¼š ExecutorService12345678910111213141516171819202122232425262728293031323334353637383940414243public interface ExecutorService extends Executor &#123; //å…³é—­çº¿ç¨‹æ±  void shutdown(); List&lt;Runnable&gt; shutdownNow(); //æ˜¯å¦ä¸ºShutdownçŠ¶æ€ boolean isShutdown(); //æ˜¯å¦ä¸ºTerminatedçŠ¶æ€ boolean isTerminated(); //è¶…è¿‡è¶…æ—¶æ—¶é—´æ—¶ï¼Œä¼šç›‘æµ‹ExecutorServiceæ˜¯å¦å·²ç»å…³é—­ //è‹¥å…³é—­åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ //ä¸€èˆ¬æƒ…å†µä¸‹ä¼šå’Œshutdownæ–¹æ³•ç»„åˆä½¿ç”¨ã€‚ boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; //è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œå‚æ•°æ¥æ”¶çš„æ˜¯ä¸€ä¸ªCallableçš„å®ç° //Callableæ¥å£ä¸­çš„call()æ–¹æ³•æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œå¯ä»¥è¿”å›ä»»åŠ¡çš„æ‰§è¡Œç»“æœ //åŒºåˆ«äºRunnableæ¥å£ä¸­çš„run()æ–¹æ³•ï¼ˆvoidä¿®é¥°ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼‰ã€‚ &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task); &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result); //è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œé€šè¿‡è¿”å›çš„Futureå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æäº¤çš„ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆäº†ã€‚ Future&lt;?&gt; submit(Runnable task); //è¿”å›ä¸€ä¸ªFutureçš„Listï¼Œå…¶ä¸­å¯¹åº”ç€æ¯ä¸ªCallableä»»åŠ¡æ‰§è¡Œåçš„Futureå¯¹è±¡ã€‚ &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException; //å¢åŠ äº†è¶…æ—¶æ§åˆ¶ &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException; //æ¥æ”¶å‚æ•°æ˜¯ä¸€ä¸ªCallableçš„é›†åˆï¼Œ //è¿”å›çš„æ˜¯æ‰€æœ‰Callableé›†åˆä»»åŠ¡ä¸­æŸä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœ &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException; //å¢åŠ äº†è¶…æ—¶æ§åˆ¶ &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; ExecutorService å†Executoræ¥å£çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¯¹çº¿ç¨‹æ± çŠ¶æ€çš„æ§åˆ¶ä»¥åŠæäº¤ä»»åŠ¡æ‰§è¡Œçš„è¶…æ—¶æ§åˆ¶ã€‚çº¿ç¨‹æ± çš„åŸºæœ¬åŠŸèƒ½è¿˜ä¸å¤Ÿå®Œå–„ï¼Œä¸èƒ½çœŸæ­£çš„å…·å¤‡å¤„ç†å…·ä½“ä¸šåŠ¡çš„èƒ½åŠ›ï¼ˆæ¯•ç«Ÿæ˜¯ä¸ªæ¥å£ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ï¼‰ã€‚ å¼€ä¸ªç¯‡ï¼Œæ…¢æ…¢å­¦~]]></content>
      <categories>
        <category>JUC</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>çº¿ç¨‹</tag>
        <tag>thread</tag>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šBeanWrapper]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase12%2F</url>
    <content type="text"><![CDATA[BeanWrapper æ˜¯Springæä¾›çš„ä¸€ä¸ªç”¨æ¥æ“ä½œjavaBeanå±æ€§çš„å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥ç›´æ¥ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ã€‚ å¯¹äºbeanå±æ€§çš„æ“ä½œï¼Œå¤§å®¶ç†ŸçŸ¥çš„ä¸»è¦æœ‰ä¸‹é¢è¿™äº›å·¥å…·ç±»ï¼š 1.Apacheçš„BeanUtilså’ŒPropertyUtils 2.cglibçš„BeanMapå’ŒBeanCopier 3.springçš„BeanUtils Springä¸­BeanWrapper çš„ä¸»è¦åŠŸèƒ½åœ¨äºï¼š 1.æ”¯æŒè®¾ç½®åµŒå¥—å±æ€§ 2.æ”¯æŒå±æ€§å€¼çš„ç±»å‹è½¬æ¢ï¼ˆè®¾ç½®ConversionServiceï¼‰ 3.æä¾›åˆ†æå’Œæ“ä½œæ ‡å‡†JavaBeançš„æ“ä½œï¼šè·å–å’Œè®¾ç½®å±æ€§å€¼ï¼ˆå•ç‹¬æˆ–æ‰¹é‡ï¼‰ï¼Œè·å–å±æ€§æè¿°ç¬¦ä»¥åŠæŸ¥è¯¢å±æ€§çš„å¯è¯»æ€§/å¯å†™æ€§çš„èƒ½åŠ›ã€‚ BeanWrapperæœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº†ä¸€æ•´å¥—å¤„ç†Beançš„æ–¹æ³•ã€‚æºç å¦‚ä¸‹ï¼š 1234567891011121314public interface BeanWrapper extends ConfigurablePropertyAccessor &#123; //ä¸ºæ•°ç»„å’Œé›†åˆè‡ªåŠ¨å¢é•¿æŒ‡å®šä¸€ä¸ªé™åˆ¶ã€‚åœ¨æ™®é€šçš„BeanWrapperä¸Šé»˜è®¤æ˜¯æ— é™çš„ã€‚ void setAutoGrowCollectionLimit(int autoGrowCollectionLimit); //è¿”å›æ•°ç»„å’Œé›†åˆè‡ªåŠ¨å¢é•¿çš„é™åˆ¶ã€‚ int getAutoGrowCollectionLimit(); //å¦‚æœæœ‰çš„è¯,è¿”å›ç”±æ­¤å¯¹è±¡åŒ…è£…çš„beanå®ä¾‹ Object getWrappedInstance(); //è¿”å›è¢«åŒ…è£…çš„JavaBeanå¯¹è±¡çš„ç±»å‹ã€‚ Class&lt;?&gt; getWrappedClass(); //è·å–åŒ…è£…å¯¹è±¡çš„PropertyDescriptorsï¼ˆç”±æ ‡å‡†JavaBeansè‡ªçœç¡®å®šï¼‰ã€‚ PropertyDescriptor[] getPropertyDescriptors(); //è·å–åŒ…è£…å¯¹è±¡çš„ç‰¹å®šå±æ€§çš„å±æ€§æè¿°ç¬¦ã€‚ PropertyDescriptor getPropertyDescriptor(String propertyName) throws InvalidPropertyException;&#125; ä¸Šé¢çš„BeanWrapperæ˜¯åŸºäº4.3.6ç‰ˆæœ¬çš„ï¼Œè¿™ä¸ªæ¥å£åœ¨4.1ç‰ˆæœ¬ä¹‹åç•¥æœ‰æ”¹åŠ¨ã€‚BeanWrapperImplæ˜¯BeanWrapperçš„å®ç°ç±»ï¼ŒBeanWrapperImplçš„çˆ¶ç±»æ˜¯AbstractNestablePropertyAccessorï¼Œé€šè¿‡è¿™ä¸ªä½¿å¾—BeanWrapperå…·æœ‰å¤„ç†å±æ€§çš„èƒ½åŠ›ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨BeanWrapper åŒ…è£…å¯¹è±¡çš„ä¾‹å­ï¼š 1234567891011121314151617181920212223242526272829303132package com.glmapper.spring.test;import org.springframework.beans.BeanWrapper;import org.springframework.beans.PropertyAccessorFactory;import org.springframework.beans.PropertyValue;/** * BeanWrapper æµ‹è¯•ç±» */public class BeanWrapperTest &#123; public static void main(String[] args) &#123; User user=new User(); //é€šè¿‡PropertyAccessorFactoryå°†userå¯¹è±¡å°è£…æˆBeanWrapper BeanWrapper bw=PropertyAccessorFactory.forBeanPropertyAccess(user); //æ–¹å¼ä¸€ï¼šç›´æ¥å¯¹å±æ€§å€¼è¿›è¡Œè®¾ç½® bw.setPropertyValue("userName", "å¼ ä¸‰"); //æ–¹å¼äºŒï¼šé€šè¿‡PropertyValueè¿›è¡Œè®¾ç½® PropertyValue pv=new PropertyValue("userName","æå››"); bw.setPropertyValue(pv); System.out.println(user.getUserName()); &#125;&#125;//ä¸€ä¸ªUserç±»class User&#123; private String userName; public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125;&#125; åœ¨Springä¸­ï¼Œæœ‰å¾ˆå¤šBeanå±æ€§çš„æ“ä½œéƒ½æ˜¯é€šè¿‡BeanWrapperæ¥å®Œæˆçš„ï¼Œæ¯”å¦‚å¸¸è§çš„HttpServletBeançš„å±æ€§è®¾ç½®å°±æ˜¯ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆå››ï¼‰-æ€»ç»“]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase11%2F</url>
    <content type="text"><![CDATA[Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆä¸€ï¼‰getBean Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆäºŒï¼‰createBean Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆä¸‰ï¼‰-å±æ€§æ³¨å…¥ åœ¨ä¸Šé¢ä¸‰ç¯‡æ–‡ç« ä¸­å¯¹ä¾èµ–æ³¨å…¥åšäº†ä¸€ä¸ªå¤§è‡´çš„æ¢³ç†ï¼›é‡Œé¢éƒ½æ˜¯å¤§é‡ä»£ç çš„åˆ†æï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¸€ä¸ªæ€»ç»“å½’çº³ã€‚ ä¾èµ–æ³¨å…¥è°ƒç”¨è¿‡ç¨‹ å¦‚å‰å‡ ç¯‡æ–‡ç« æ‰€è¿°ï¼Œä¾èµ–æ³¨å…¥æ˜¯ç”±getBeanæ¥è§¦å‘çš„ï¼›ç„¶åæ¶‰åŠåˆ°beanå®ä¾‹çš„åˆ›å»ºã€ä¾èµ–å…³ç³»çš„å»ºç«‹ã€å±æ€§æ³¨å…¥ç­‰å­è¿‡ç¨‹ã€‚ getBean æ–¹æ³•è§¦å‘ä¾èµ–æ³¨å…¥ doGetBean ä»å®¹å™¨ä¸­æŸ¥æ‰¾Beanï¼ˆBeanFactoryé“¾ï¼Œå½“å‰å®¹å™¨-&gt;åŒäº²å®¹å™¨-åŒäº²å®¹å™¨â€¦ï¼‰ å½“ç„¶ï¼Œåœ¨è·å–åˆ°æŸä¸ªBeançš„æ—¶å€™ä¹Ÿä¼šé€šè¿‡é€’å½’çš„æ–¹å¼æ¥ä¾èµ–æ³¨å…¥ä¾èµ–çš„bean createBeanInstance ç”Ÿæˆäº†Beanæ‰€åŒ…å«çš„Javaå¯¹è±¡ï¼ŒSpringä¸­ç”¨SimpleInstantiationStrategyç±»æ¥ç”ŸæˆBeanå¯¹è±¡çš„å®ä¾‹ï¼Œå®ä¾‹åŒ–Javaå¯¹è±¡çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼ˆCGlibæ˜¯é»˜è®¤æ–¹å¼ï¼‰ï¼š é€šè¿‡BeanUtilsï¼Œå®ƒä½¿ç”¨äº†JVMçš„åå°„åŠŸèƒ½æ¥ç”ŸæˆJavaå¯¹è±¡å®ä¾‹ ç”¨CGLIBæ¥ç”Ÿæˆï¼ŒCGLIBæ˜¯ä¸€ç§å¸¸ç”¨çš„å­—èŠ‚ç ç”Ÿæˆå™¨çš„ç±»åº“ populateBean è®¾ç½®Beanå¯¹è±¡çš„ä¾èµ–å…³ç³» resolveValueIfNecessary æ³¨å…¥ç±»å‹çš„å¤„ç†ï¼›è§£æä¸åŒç±»å‹çš„å±æ€§ setPropertyValues å±æ€§æ³¨å…¥ å…³äºlazy-initIocå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯å¯¹BeanDefinitionçš„å®šä½ã€è½½å…¥ã€è§£æå’Œæ³¨å†Œï¼›ä½†æ˜¯å°±åƒä¹‹å‰è¯´è¿‡çš„ï¼Œæ­¤æ—¶ä¾èµ–æ³¨å…¥è¿˜æ²¡æœ‰å‘ç”Ÿã€‚åœ¨Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆä¸€ï¼‰getBeanæ–‡ä¸­æåˆ°ï¼Œä¾èµ–æ³¨å…¥å‘ç”Ÿåœ¨åº”ç”¨ç¬¬ä¸€æ¬¡å‘å®¹å™¨è·å–Beançš„æ—¶å€™ï¼›ä¹Ÿå°±æ˜¯ä¸Šé¢è¯´åˆ°çš„é€šè¿‡getBeanæ¥è§¦å‘ã€‚ å½“ç„¶ï¼Œä¾èµ–æ³¨å…¥ä¹Ÿå¯ä»¥åœ¨å®¹å™¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­å°±å®Œæˆã€‚è¿™ä¸ªå°±æ˜¯lazy-initå±æ€§çš„å­˜åœ¨æ„ä¹‰äº†ã€‚å°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®Beançš„lazy-initå±æ€§æ¥æ§åˆ¶é¢„å®ä¾‹åŒ–çš„è¿‡ç¨‹ã€‚ é¢„å®ä¾‹åŒ–ï¼šåœ¨åˆå§‹åŒ–å®¹å™¨æ—¶å®ŒæˆBeançš„ä¾èµ–æ³¨å…¥ è¿™ç§åšæ³•çš„å¥½å¤„åœ¨äºæé«˜äº†æˆ‘ä»¬ç¬¬ä¸€æ¬¡è·å–Beançš„çš„æ•ˆç‡ï¼Œä½†æ˜¯å®ƒä¹Ÿé™ä½äº†å®¹å™¨åˆå§‹åŒ–çš„é€Ÿåº¦ã€‚ï¼ˆè¿™ä¸ªå…¶å®å¾ˆå¥½ç†è§£çš„ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡è·å–Beançš„æ—¶å€™ï¼Œä¾èµ–æ³¨å…¥å·²ç»å®Œæˆäº†ï¼Œç›´æ¥æ‹¿è¿‡æ¥ç”¨å°±è¡Œï¼‰ å…³äºlazy-initå±æ€§çš„å¤„ç†ä¹Ÿæ˜¯åœ¨wac.refreshè¿™ä¸ªæ–¹æ³•ä¸­å®Œæˆçš„ï¼Œå…·ä½“æ˜¯åœ¨finishBeanFactoryInitializationæ–¹æ³•ä¸­ã€‚å¦‚æœç»§ç»­è¿½æº¯çš„è¯ï¼Œæœ€ç»ˆæ˜¯äº¤ç»™DefaultListableBeanFactoryå®¹å™¨ä¸­çš„preInstantiateSingletonsæ–¹æ³•ä¸­å®Œæˆã€‚ lazy-initè¿™ç§å®ä¾‹åŒ–æ–¹å¼å°±æ˜¯é€šè¿‡å°†ä¾èµ–æ³¨å…¥å§”æ‰˜ç»™å®¹å™¨æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ç¬¬ä¸€å‘å®¹å™¨ç”³è¯·çš„Beançš„æ—¶å€™å®Œæˆä¾èµ–æ³¨å…¥ï¼Œä¸åŒçš„é˜¶æ®µï¼Œä¹Ÿæœ‰ä¸åŒçš„ä¼˜åŠ£ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆä¸‰ï¼‰-å±æ€§æ³¨å…¥]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase10%2F</url>
    <content type="text"><![CDATA[å‰é¢æ–‡ç« ä¸­å¯¹ä¾èµ–æ³¨å…¥çš„è§¦å‘å’Œbeançš„åˆ›å»ºåšäº†å­¦ä¹ è®°å½•ï¼Œæœ¬æ–‡å°†æ¥è®°å½•ä¸€ä¸‹beançš„å±æ€§æ³¨å…¥è¿‡ç¨‹ã€‚Beançš„å±æ€§æ³¨å…¥å‘ç”Ÿåœ¨BeanDefinitionValueResolverè¿™ä¸ªç±»ä¸­ï¼ŒBeanDefinitionValueResolverè¿™ç±»æ˜¯ç”¨äºbeanå·¥å‚å®ç°çš„Helperç±»ï¼ŒèŒè´£å°±æ˜¯å°†beanå®šä¹‰å¯¹è±¡ä¸­åŒ…å«çš„å€¼è§£æä¸ºåº”ç”¨äºç›®æ ‡beanå®ä¾‹çš„å®é™…å€¼ã€‚ BeanDefinitionValueResolverç±»ä¸­çš„resolveValueIfNecessary()æ–¹æ³•åŒ…å«äº†å¯¹æ‰€æœ‰æ³¨å…¥ç±»å‹çš„å¤„ç†ã€‚æ‰€ä»¥æœ¬æ–‡ä¸»è¦å›´ç»•è¿™ä¸ªæ–¹æ³•å±•å¼€æ¥è¯´ã€‚ resolveValueIfNecessaryæ–¹æ³•resolveValueIfNecessary():ç»™å®šä¸€ä¸ªPropertyValueï¼Œè¿”å›ä¸€ä¸ªvalueï¼Œè§£æå¯¹å·¥å‚ä¸­å…¶ä»–beançš„å¼•ç”¨ã€‚ valueå¯èƒ½æ˜¯ï¼š RuntimeBeanReference : åœ¨è§£æåˆ°ä¾èµ–çš„Beançš„æ—¶ä¾¯ï¼Œè§£æå™¨ä¼šä¾æ®ä¾èµ–beançš„nameåˆ›å»ºä¸€ä¸ªRuntimeBeanReferenceå¯¹åƒï¼Œå°†è¿™ä¸ªå¯¹åƒæ”¾å…¥BeanDefinitionçš„MutablePropertyValuesä¸­ã€‚ ManagedListï¼šç”¨æ¥ä¿å­˜å®ƒæ‰€ç®¡ç†çš„Listå…ƒç´ ï¼Œå®ƒå¯ä»¥åŒ…å«è¿è¡Œæ—¶æœŸçš„beanå¼•ç”¨(å°†è¢«è§£æä¸ºbeanå¯¹è±¡). ManagedSet ï¼šç”¨æ¥ä¿å­˜å®ƒæ‰€ç®¡ç†çš„setå€¼ï¼Œå®ƒå¯ä»¥åŒ…å«è¿è¡Œæ—¶æœŸçš„beanå¼•ç”¨(å°†è¢«è§£æä¸ºbeanå¯¹è±¡) ManagedMap ï¼šç”¨æ¥ä¿å­˜å®ƒæ‰€ç®¡ç†çš„mapå€¼ï¼Œå®ƒå¯ä»¥åŒ…å«è¿è¡Œæ—¶æœŸçš„beanå¼•ç”¨(å°†è¢«è§£æä¸ºbeanå¯¹è±¡) 1ã€æ–¹æ³•ç”³æ˜ argName ï¼šä¸ºå…¶å®šä¹‰çš„å‚æ•°çš„åç§° value ï¼šè¦è§£æçš„å€¼å¯¹è±¡1public Object resolveValueIfNecessary(Object argName, Object value) 2ã€RuntimeBeanReference å½“åœ¨beanfactoryä¸­ä½œä¸ºå¦å¤–ä¸€ä¸ªbeançš„å¼•ç”¨æ—¶ï¼Œä½œä¸ºå±æ€§å€¼å¯¹è±¡ï¼Œå°†åœ¨è¿è¡Œæ—¶è¿›è¡Œè§£æã€‚ RuntimeBeanReferenceæ˜¯åœ¨å¯¹BeanDefinitionè¿›è¡Œè§£ææ—¶ç”Ÿæˆçš„æ•°æ®å¯¹è±¡ã€‚1234if (value instanceof RuntimeBeanReference) &#123; RuntimeBeanReference ref = (RuntimeBeanReference) value; return resolveReference(argName, ref);&#125; 3ã€RuntimeBeanNameReference å½“åœ¨beanfactoryä¸­ä½œä¸ºå¦å¤–ä¸€ä¸ªbeanåç§°çš„å¼•ç”¨æ—¶ï¼Œä½œä¸ºå±æ€§å€¼å¯¹è±¡ï¼Œå°†åœ¨è¿è¡Œæ—¶è¿›è¡Œè§£æã€‚12345678else if (value instanceof RuntimeBeanNameReference) &#123; String refName = ((RuntimeBeanNameReference) value).getBeanName(); refName = String.valueOf(doEvaluate(refName)); if (!this.beanFactory.containsBean(refName)) &#123; //å¼‚å¸¸ï¼šInvalid bean name '" + refName + "' in bean reference for " + argName &#125; return refName;&#125; 4ã€BeanDefinitionHolder è§£æBeanDefinitionHolderï¼šåŒ…å«å…·æœ‰åç§°å’Œåˆ«åçš„BeanDefinitionã€‚BeanDefinitionHolderå°±æ˜¯ä½¿ç”¨åç§°æˆ–è€…åˆ«åæ¥ä¿å­˜BeanDefinitionçš„ã€‚1234else if (value instanceof BeanDefinitionHolder) &#123; BeanDefinitionHolder bdHolder = (BeanDefinitionHolder) value; return resolveInnerBean(argName, bdHolder.getBeanName(), bdHolder.getBeanDefinition());&#125; 5ã€BeanDefinition è§£æçº¯ç²¹çš„BeanDefinition1234567else if (value instanceof BeanDefinition) &#123; // Resolve plain BeanDefinition, without contained name: use dummy name. BeanDefinition bd = (BeanDefinition) value; String innerBeanName = "(inner bean)" + BeanFactoryUtils.GENERATED_BEAN_NAME_SEPARATOR + ObjectUtils.getIdentityHexString(bd); return resolveInnerBean(argName, innerBeanName, bd); &#125; 6ã€ManagedArray åŒ…å«è¿è¡Œæ—¶æœŸçš„beanå¼•ç”¨(å°†è¢«è§£æä¸ºbeanå¯¹è±¡)1234567891011121314151617181920212223else if (value instanceof ManagedArray) &#123; // May need to resolve contained runtime references. ManagedArray array = (ManagedArray) value; Class&lt;?&gt; elementType = array.resolvedElementType; if (elementType == null) &#123; String elementTypeName = array.getElementTypeName(); if (StringUtils.hasText(elementTypeName)) &#123; try &#123; elementType = ClassUtils.forName(elementTypeName, this.beanFactory.getBeanClassLoader()); array.resolvedElementType = elementType; &#125; catch (Throwable ex) &#123; // Improve the message by showing the context. //å¼‚å¸¸ï¼šError resolving array type for " + argName &#125; &#125; else &#123; elementType = Object.class; &#125; &#125; return resolveManagedArray(argName, (List&lt;?&gt;) value, elementType);&#125; 7ã€ManagedListï¼ŒManagedSetï¼ŒManagedMap åŒ…å«è¿è¡Œæ—¶æœŸçš„beanå¼•ç”¨(å°†è¢«è§£æä¸ºbeanå¯¹è±¡)123456789101112//å¯¹ManagedListè¿›è¡Œè§£æelse if (value instanceof ManagedList) &#123; return resolveManagedList(argName, (List&lt;?&gt;) value);&#125;//å¯¹ManagedSetè¿›è¡Œè§£æelse if (value instanceof ManagedSet) &#123; return resolveManagedSet(argName, (Set&lt;?&gt;) value);&#125;//å¯¹ManagedMapè¿›è¡Œè§£æelse if (value instanceof ManagedMap) &#123; return resolveManagedMap(argName, (Map&lt;?, ?&gt;) value);&#125; 8ã€ManagedProperties ManagedPropertiesè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªspringç®¡ç†çš„å±æ€§å®ä¾‹ï¼Œå®ƒæ”¯æŒçˆ¶/å­ definitionçš„åˆå¹¶ã€‚1234567891011121314151617//å¯¹ManagedPropertiesè¿›è¡Œè§£æelse if (value instanceof ManagedProperties) &#123; Properties original = (Properties) value; Properties copy = new Properties(); for (Map.Entry&lt;Object, Object&gt; propEntry : original.entrySet()) &#123; Object propKey = propEntry.getKey(); Object propValue = propEntry.getValue(); if (propKey instanceof TypedStringValue) &#123; propKey = evaluate((TypedStringValue) propKey); &#125; if (propValue instanceof TypedStringValue) &#123; propValue = evaluate((TypedStringValue) propValue); &#125; copy.put(propKey, propValue); &#125; return copy;&#125; 9ã€TypedStringValue TypedStringValueä¿å­˜çš„æ˜¯ä¸€ä¸ªç±»å‹çš„å±æ€§å€¼ã€‚1234567891011121314151617181920//å¯¹TypedStringValueè¿›è¡Œè§£æelse if (value instanceof TypedStringValue) &#123; // Convert value to target type here. TypedStringValue typedStringValue = (TypedStringValue) value; Object valueObject = evaluate(typedStringValue); try &#123; Class&lt;?&gt; resolvedTargetType = resolveTargetType(typedStringValue); if (resolvedTargetType != null) &#123; return this.typeConverter.convertIfNecessary(valueObject, resolvedTargetType); &#125; else &#123; return valueObject; &#125; &#125; catch (Throwable ex) &#123; // Improve the message by showing the context. throw new BeanCreationException( //å¼‚å¸¸ï¼šError converting typed String value for " + argName &#125;&#125; 10ã€ä½œä¸ºè¡¨è¾¾å¼è¿›è¡Œè¯„ä¼° å°†ç»™å®šçš„å€¼ä½œä¸ºè¡¨è¾¾å¼è¿›è¡Œè¯„ä¼°ã€‚123else &#123; return evaluate(value);&#125; åœ¨å®Œæˆä¸Šè¿°è§£æä¹‹åï¼Œå·²ç»ä¸ºæˆ‘ä»¬çš„ä¾èµ–æ³¨å…¥åšå¥½äº†å‡†å¤‡ã€‚è¿™æ˜¯çœŸæ­£æŠŠBeanå¯¹è±¡è®¾ç½®åˆ°å®ƒæ‰€ä¾èµ–çš„å¦ä¸€ä¸ªBeançš„å±æ€§ä¸­å»çš„åœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¤„ç†çš„å±æ€§ä¹Ÿæ˜¯å„å¼å„æ ·çš„ã€‚å…·ä½“å±æ€§çš„æ³¨å…¥æ˜¯åœ¨ä¹‹å‰æåˆ°çš„BeanWrapperæ¥å£çš„å®ç°ç±»BeanWrapperImplçš„setPropertyValueæ–¹æ³•æ¥å®Œæˆã€‚ setPropertyValueæ–¹æ³•aã€æ–¹æ³•å£°æ˜è¿™ä¸ªæ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œæ˜¯BeanWrapperImplå®é™…å¤„ç†çš„æ–¹æ³•ï¼Œå…¶å¯¹å¤–ä¹Ÿæä¾›äº†setPropertyValueçš„å…¶å®ƒé‡è½½æ–¹æ³•æ¥æä¾›æœåŠ¡ã€‚ 12private void setPropertyValue(PropertyTokenHolder tokens, PropertyValue pv) throws BeansException bã€PropertyTokenHolderæ˜¯BeanWrapperImplçš„å†…éƒ¨ç±»12345private static class PropertyTokenHolder &#123; public String canonicalName; public String actualName; public String[] keys;&#125; åœ¨setPropertyValueæ–¹æ³•ä¸­ä¼šæ ¹æ®tokenså˜é‡æ˜¯å¦ä¸ºnull,æœ‰ä¸¤ä¸ªä¸åŒçš„åˆ†æ”¯ã€‚å…¶ä¸­å½“tokensä¸ºnullæ—¶ï¼Œåˆ™ä¼šå¯¹å±æ€§åè¿›è¡Œé€’å½’è°ƒç”¨åˆ†æå¤„ç†ï¼Œè¿”å›åˆ†æå¤„ç†åçš„BeanWrapImplå¯¹è±¡nestedBwã€‚å¦‚æœnestedBw==this,åˆ™ä¼šè®¾ç½®pvçš„resolvedTokenså±æ€§å€¼ï¼Œæœ€åå°†è°ƒç”¨nestedBwå¯¹è±¡çš„è®¾ç½®å±æ€§å€¼æ–¹æ³•è®¾ç½®å±æ€§ã€‚æ¥å…·ä½“çœ‹çœ‹ï¼š cã€å…¶ä¸­å½“tokensä¸ºnullæ—¶ï¼Œå³å¯¹é›†åˆç±»çš„åŸŸè¿›è¡Œæ³¨å…¥1234567891011121314// è®¾ç½®tokensçš„ç´¢å¼•å’ŒkeysPropertyTokenHolder getterTokens = new PropertyTokenHolder();getterTokens.canonicalName = tokens.canonicalName;getterTokens.actualName = tokens.actualName;getterTokens.keys = new String[tokens.keys.length - 1];System.arraycopy(tokens.keys, 0, getterTokens.keys, 0, tokens.keys.length - 1);Object propValue;//getPropertyValueç”¨æ¥è·å–Beanä¸­å¯¹å¯¹è±¡æ³¨å…¥çš„å¼•ç”¨ï¼›try &#123; propValue = getPropertyValue(getterTokens);&#125;catch (NotReadablePropertyException ex) &#123;//å¼‚å¸¸ï¼šCannot access indexed value in property referenced &#125; 1ã€propValueä¸ºnull propValueä¸ºnull12345678910111213if (propValue == null) &#123; // ç©ºå€¼æ˜ å°„çš„æƒ…å†µ if (this.autoGrowNestedPaths) &#123; // TODO: cleanup, this is pretty hacky int lastKeyIndex = tokens.canonicalName.lastIndexOf('['); getterTokens.canonicalName = tokens.canonicalName.substring(0, lastKeyIndex); propValue = setDefaultValue(getterTokens); &#125; else &#123; //å¼‚å¸¸ï¼šCannot access indexed value in property referenced " + "in indexed property path '" + propertyName + "': returned null" &#125;&#125; 2ã€å¯¹arrayè¿›è¡Œæ³¨å…¥ å¯¹arrayè¿›è¡Œæ³¨å…¥1234567891011121314151617if (propValue.getClass().isArray()) &#123; PropertyDescriptor pd = getCachedIntrospectionResults().getPropertyDescriptor(actualName); Class requiredType = propValue.getClass().getComponentType(); int arrayIndex = Integer.parseInt(key); Object oldValue = null; try &#123; if (isExtractOldValueForEditor() &amp;&amp; arrayIndex &lt; Array.getLength(propValue)) &#123; oldValue = Array.get(propValue, arrayIndex); &#125; Object convertedValue = convertIfNecessary(propertyName, oldValue, pv.getValue(), requiredType, TypeDescriptor.nested(property(pd), tokens.keys.length)); Array.set(propValue, arrayIndex, convertedValue); &#125; catch (IndexOutOfBoundsException ex) &#123; //å¼‚å¸¸ï¼šInvalid array index in property path '" + propertyName &#125;&#125; 2ã€å¯¹listè¿›è¡Œæ³¨å…¥ å¯¹listè¿›è¡Œæ³¨å…¥123456789101112131415161718192021222324252627282930313233else if (propValue instanceof List) &#123; PropertyDescriptor pd = getCachedIntrospectionResults().getPropertyDescriptor(actualName); Class requiredType = GenericCollectionTypeResolver.getCollectionReturnType( pd.getReadMethod(), tokens.keys.length); List list = (List) propValue; int index = Integer.parseInt(key); Object oldValue = null; if (isExtractOldValueForEditor() &amp;&amp; index &lt; list.size()) &#123; oldValue = list.get(index); &#125; Object convertedValue = convertIfNecessary(propertyName, oldValue, pv.getValue(), requiredType, TypeDescriptor.nested(property(pd), tokens.keys.length)); int size = list.size(); if (index &gt;= size &amp;&amp; index &lt; this.autoGrowCollectionLimit) &#123; for (int i = size; i &lt; index; i++) &#123; try &#123; list.add(null); &#125; catch (NullPointerException ex) &#123; //å¼‚å¸¸ï¼šInvalidPropertyException &#125; &#125; list.add(convertedValue); &#125; else &#123; try &#123; list.set(index, convertedValue); &#125; catch (IndexOutOfBoundsException ex) &#123; //å¼‚å¸¸ï¼šInvalid list index in property path '" + propertyName + "'" &#125; &#125;&#125; 2ã€å¯¹mapè¿›è¡Œæ³¨å…¥ å¯¹mapè¿›è¡Œæ³¨å…¥1234567891011121314151617181920else if (propValue instanceof Map) &#123; PropertyDescriptor pd = getCachedIntrospectionResults().getPropertyDescriptor(actualName); Class mapKeyType = GenericCollectionTypeResolver.getMapKeyReturnType( pd.getReadMethod(), tokens.keys.length); Class mapValueType = GenericCollectionTypeResolver.getMapValueReturnType( pd.getReadMethod(), tokens.keys.length); Map map = (Map) propValue; //é‡è¦æç¤ºï¼šä¸è¦åœ¨è¿™é‡Œä¼ é€’å®Œæ•´çš„å±æ€§åç§° TypeDescriptor typeDescriptor = (mapKeyType != null ? TypeDescriptor.valueOf(mapKeyType) : TypeDescriptor.valueOf(Object.class)); Object convertedMapKey = convertIfNecessary(null, null, key, mapKeyType, typeDescriptor); Object oldValue = null; if (isExtractOldValueForEditor()) &#123; oldValue = map.get(convertedMapKey); &#125; // åœ¨è¿™é‡Œä¼ é€’å®Œæ•´çš„å±æ€§åç§°å’Œæ—§å€¼ï¼Œå› ä¸ºå¸Œæœ›å¯¹mapå€¼æœ‰å®Œæ•´çš„è½¬æ¢èƒ½åŠ›ã€‚ Object convertedMapValue = convertIfNecessary(propertyName, oldValue, pv.getValue(), mapValueType, TypeDescriptor.nested(property(pd), tokens.keys.length)); map.put(convertedMapKey, convertedMapValue);&#125; å…¶ä¸­å½“tokensä¸ä¸ºnullæ—¶ï¼Œå³å¯¹éé›†åˆç±»çš„åŸŸè¿›è¡Œæ³¨å…¥è¿™é‡Œæ˜¯æ ¸å¿ƒçš„åœ°æ–¹ï¼Œå–å¾—æ³¨å…¥å±æ€§çš„setæ–¹æ³•ï¼Œé€šè¿‡åå°„æœºåˆ¶ï¼ŒæŠŠå¯¹è±¡æ³¨å…¥è¿›å»ã€‚123final Method writeMethod = (pd instanceof GenericTypeAwarePropertyDescriptor ? ((GenericTypeAwarePropertyDescriptor) pd).getWriteMethodForActualAccess() : pd.getWriteMethod()); æ€»ç»“é€šè¿‡ä¸Šé¢çš„å‡ ç¯‡åˆ†ææˆ‘ä»¬å¤§æ¦‚çš„ç†Ÿæ‚‰äº†Beanåˆ›å»ºå’Œå¯¹è±¡ä¾èµ–æ³¨å…¥çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œspringéœ€è¦æ ¹æ®Beandefinitionä¸­çš„ä¿¡æ¯æ¥é€’å½’å®Œæˆä¾èµ–æ³¨å…¥ã€‚å¹¶ä¸”è¿™äº›é€’å½’çš„å…¥å£éƒ½æ˜¯getBeanè¿™ä¸ªæ–¹æ³•ã€‚ ä¸€ä¸ªé€’å½’æ˜¯åœ¨ä¸Šä¸‹æ–‡ä½“ç³»ä¸­æŸ¥æ‰¾éœ€è¦çš„Beanå’Œåˆ›å»ºBeançš„é€’å½’è°ƒç”¨ï¼› å¦ä¸€ä¸ªé€’å½’æ˜¯åœ¨ä¾èµ–æ³¨å…¥æ—¶é€šè¿‡é€’å½’è°ƒç”¨å®¹å™¨çš„getBeanæ–¹æ³•ï¼Œå¾—åˆ°å½“å‰Beançš„ä¾èµ–Beanï¼ŒåŒæ—¶ä¹Ÿè§¦å‘å¯¹ä¾èµ–Beançš„åˆ›å»ºå’Œæ³¨å…¥ã€‚ åœ¨å¯¹Beançš„å±æ€§è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶è§£æçš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚è¿™æ ·å°±å¯ä»¥æ ¹æ®ä¾èµ–å…³ç³»ï¼Œä¸€å±‚ä¸€å±‚çš„å®ŒæˆBeançš„åˆ›å»ºå’Œæ³¨å…¥ï¼Œç›´åˆ°æœ€åå®Œæˆå½“å‰Beançš„åˆ›å»ºã€‚ å‚è€ƒ ã€ŠSpringæŠ€æœ¯å†…å¹•ã€‹ https://www.cnblogs.com/davidwang456/p/4213652.html]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆäºŒï¼‰createBean]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase9%2F</url>
    <content type="text"><![CDATA[åœ¨Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆä¸€ï¼‰ï¼ˆAbstractBeanFactory-getBeanï¼‰æœ€åè¯´é“getBeanæ˜¯ä¾èµ–æ³¨å…¥çš„èµ·ç‚¹ï¼Œbeançš„åˆ›å»ºéƒ½æ˜¯é€šè¿‡createBeanæ¥å®Œæˆå…·ä½“çš„åˆ›å»ºçš„ã€‚createBeançš„å…·ä½“å®ç°æ˜¯åœ¨AbstractAutowireCapableBeanFactoryä¸­çš„ã€‚æœ¬ç¯‡å°±æ‹ä¸€æ‹è¿™ä¸ªæ–¹æ³•çœ‹ä¸‹beançš„åˆ›å»ºè¿‡ç¨‹ã€‚ è¿™ä¸ªæ–¹æ³•æ˜¯AbstractAutowireCapableBeanFactoryè¿™ä¸ªç±»çš„ä¸­å¿ƒæ–¹æ³•ï¼Œå…¶ä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ï¼Œå¡«å……beanå®ä¾‹ï¼Œåç½®å¤„ç†ç­‰ã€‚ åœ¨createBeanä¸­ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š åˆ¤æ–­éœ€è¦åˆ›å»ºçš„Beanæ˜¯å¦å¯ä»¥å®ä¾‹åŒ–ï¼Œè¿™ä¸ªç±»æ˜¯å¦å¯ä»¥é€šè¿‡ç±»è£…è½½å™¨æ¥è½½å…¥ æ˜¯å¦é…ç½®äº†åç½®å¤„ç†å™¨ç›¸å…³å¤„ç†ï¼ˆå¦‚æœé…ç½®äº†åˆ™è¿”å›ä¸€ä¸ªä»£ç†ï¼‰ åˆ›å»ºBean å…·ä½“æ¥çœ‹æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142protected Object createBean(String beanName, RootBeanDefinition mbd, Object[] args) throws BeanCreationException &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Creating instance of bean '" + beanName + "'"); &#125; RootBeanDefinition mbdToUse = mbd; // Make sure bean class is actually resolved at this point, and // clone the bean definition in case of a dynamically resolved Class // which cannot be stored in the shared merged bean definition. //åˆ¤æ–­éœ€è¦åˆ›å»ºçš„Beanæ˜¯å¦å¯ä»¥å®ä¾‹åŒ–ï¼Œè¿™ä¸ªç±»æ˜¯å¦å¯ä»¥é€šè¿‡ç±»è£…è½½å™¨æ¥è½½å…¥ Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName); if (resolvedClass != null &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != null) &#123; mbdToUse = new RootBeanDefinition(mbd); mbdToUse.setBeanClass(resolvedClass); &#125; // Prepare method overrides. try &#123; mbdToUse.prepareMethodOverrides(); &#125; catch (BeanDefinitionValidationException ex) &#123; //å¼‚å¸¸ï¼šValidation of method overrides failed &#125; try &#123; // Give BeanPostProcessors a chance to return a proxy instead of the target //bean instance. //æ˜¯å¦é…ç½®äº†åç½®å¤„ç†å™¨ç›¸å…³å¤„ç†ï¼ˆå¦‚æœé…ç½®äº†åˆ™è¿”å›ä¸€ä¸ªä»£ç†ï¼‰ Object bean = resolveBeforeInstantiation(beanName, mbdToUse); if (bean != null) &#123; return bean; &#125; &#125; catch (Throwable ex) &#123; //å¼‚å¸¸:BeanPostProcessor before instantiation of bean failed &#125; //åˆ›å»ºBean Object beanInstance = doCreateBean(beanName, mbdToUse, args); if (logger.isDebugEnabled()) &#123; logger.debug("Finished creating instance of bean '" + beanName + "'"); &#125; return beanInstance;&#125; ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºbeanæ˜¯äº¤ç»™doCreateBeanæ–¹æ³•æ¥åˆ›å»ºçš„ã€‚ç»§ç»­çœ‹doCreateBeanè¿™ä¸ªæ–¹æ³•ï¼šï¼ˆè¿™é‡Œé¢æ¶‰åŠåˆ°ä¸€ä¸ªBeanWrapperè¿™ä¸ªæ¥å£ï¼Œå°ä¼™ä¼´å¯ä»¥ç§»æ­¥äº†è§£ä¸€ä¸‹ã€ŠSpringæºç ç³»åˆ—ï¼šBeanWrapperã€‹ï¼‰ ä»£ç  1ï¼š123456789101112131415// ç”¨BeanWrapperæ¥æŒæœ‰åˆ›å»ºå‡ºæ¥çš„Beanå¯¹è±¡BeanWrapper instanceWrapper = null;//å¦‚æœæ˜¯å•ä¾‹çš„è¯ï¼Œåˆ™å…ˆæŠŠç¼“å­˜ä¸­çš„åŒåbeanæ¸…é™¤if (mbd.isSingleton()) &#123; instanceWrapper = this.factoryBeanInstanceCache.remove(beanName);&#125;//å®é™…åˆ›å»ºçš„äº¤ç»™createBeanInstanceæ¥å®Œæˆï¼Œ//beançš„ç”Ÿæˆï¼Œè¿™é‡Œä¼šä½¿ç”¨é»˜è®¤çš„ç±»ç”Ÿæˆå™¨ï¼ŒåŒ…è£…æˆBeanWrapperImplç±»ï¼Œ//ä¸ºäº†ä¸‹é¢çš„populateBeanæ–¹æ³•çš„å±æ€§æ³¨å…¥åšå‡†å¤‡ if (instanceWrapper == null) &#123; instanceWrapper = createBeanInstance(beanName, mbd, args);&#125;final Object bean = (instanceWrapper != null ? instanceWrapper.getWrappedInstance() : null);Class&lt;?&gt; beanType = (instanceWrapper != null ? instanceWrapper.getWrappedClass() : null);mbd.resolvedTargetType = beanType; ä»£ç  2ï¼š å…è®¸åå¤„ç†å™¨ä¿®æ”¹åˆå¹¶çš„beanå®šä¹‰ã€‚1234567891011synchronized (mbd.postProcessingLock) &#123; if (!mbd.postProcessed) &#123; try &#123; applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName); &#125; catch (Throwable ex) &#123; //å¼‚å¸¸ï¼šPost-processing of merged bean definition failed &#125; mbd.postProcessed = true; &#125; &#125; ä»£ç  3 ï¼š å³ä½¿è¢«BeanFactoryAwareç­‰ç”Ÿå‘½å‘¨æœŸæ¥å£è§¦å‘ï¼Œä¹Ÿè¦å°½å¿«åœ°ç¼“å­˜singletons ä»¥ä¾¿èƒ½å¤Ÿè§£æå¾ªç¯å¼•ç”¨ã€‚1234567891011121314boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName));if (earlySingletonExposure) &#123; if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Eagerly caching bean &apos;&quot; + beanName + &quot;&apos; to allow for resolving potential circular references&quot;); &#125; addSingletonFactory(beanName, new ObjectFactory&lt;Object&gt;() &#123; @Override public Object getObject() throws BeansException &#123; return getEarlyBeanReference(beanName, mbd, bean); &#125; &#125;);&#125; ä»£ç  4: è¿™é‡Œæ˜¯å¯¹beançš„åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¾èµ–æ³¨å…¥å°±åœ¨è¿™é‡Œå‘ç”Ÿï¼›è¿™ä¸ªexposedObjectå˜é‡ä¿å­˜çš„æ˜¯åœ¨åˆå§‹åŒ–å¤„ç†å®Œä»¥åè¿”å›çš„ä½œä¸ºä¾èµ–æ³¨å…¥å®Œæˆä¹‹åçš„beanã€‚123456789101112131415161718// Initialize the bean instance.Object exposedObject = bean;try &#123; populateBean(beanName, mbd, instanceWrapper); if (exposedObject != null) &#123; exposedObject = initializeBean(beanName, exposedObject, mbd); &#125;&#125;catch (Throwable ex) &#123; //æŠ›å‡º if (ex instanceof BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123; throw (BeanCreationException) ex; &#125; else &#123; //å¼‚å¸¸:Initialization of bean failed &#125;&#125; ä»£ç  5: è¿™é‡Œæ˜¯æ³¨å†Œbean12345678try &#123; registerDisposableBeanIfNecessary(beanName, bean, mbd);&#125;catch (BeanDefinitionValidationException ex) &#123; //å¼‚å¸¸å¤„ç†&#125;//è¿”å›ç»“æœreturn exposedObject; ä¸Šé¢çš„5ä¸ªä»£ç æ®µå‡æ˜¯doCreateBeanä¸­çš„å¤„ç†é€»è¾‘ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡ŒæŸ¥é˜…æºç ã€‚ä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬ä¾ç„¶æ²¡æœ‰å¾—åˆ°å…·ä½“åˆ›å»ºçš„è¿‡ç¨‹ï¼Œå› ä¸ºåœ¨doCreateBeanä¸­åˆä¾èµ–ï¼šcreateBeanInstanceå’ŒpopulateBeanä¸¤ä¸ªæ–¹æ³•ã€‚ åœ¨createBeanInstanceä¸­ç”Ÿæˆäº†Beanæ‰€åŒ…å«çš„javaå¯¹è±¡ã€‚æ¥çœ‹æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, Object[] args) &#123; // ç¡®ä¿beanç±»å®é™…ä¸Šå·²ç»è§£æè¿‡äº†ï¼Œå¯ä»¥å®ä¾‹åŒ– Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName); if (beanClass != null &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;&amp; !mbd.isNonPublicAccessAllowed()) &#123; //å¼‚å¸¸ï¼šBean class isn't public, and non-public access not allowed:beanName &#125; //1. ä½¿ç”¨å·¥å‚æ–¹æ³•æ¥è¿›è¡Œbeançš„å®ä¾‹åŒ– if (mbd.getFactoryMethodName() != null) &#123; return instantiateUsingFactoryMethod(beanName, mbd, args); &#125; // é‡æ–°åˆ›å»ºç›¸åŒçš„beanæ—¶å¿«æ·æ–¹å¼... boolean resolved = false; boolean autowireNecessary = false; if (args == null) &#123; synchronized (mbd.constructorArgumentLock) &#123; if (mbd.resolvedConstructorOrFactoryMethod != null) &#123; resolved = true; autowireNecessary = mbd.constructorArgumentsResolved; &#125; &#125; &#125; if (resolved) &#123; if (autowireNecessary) &#123; return autowireConstructor(beanName, mbd, null, null); &#125; else &#123; return instantiateBean(beanName, mbd); &#125; &#125; // 2.éœ€è¦ç¡®å®šæ„é€ å‡½æ•°...,ä½¿ç”¨æ„é€ å‡½æ•°è¿›è¡Œbeanå®ä¾‹åŒ– Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName); if (ctors != null || mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_CONSTRUCTOR || mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) &#123; return autowireConstructor(beanName, mbd, ctors, args); &#125; //3.æ²¡æœ‰ç‰¹æ®Šçš„å¤„ç†ï¼šåªéœ€ä½¿ç”¨æ— å‚æ•°æ„é€ å‡½æ•°ã€‚ï¼ˆé»˜è®¤æ„é€ å‡½æ•°ï¼‰ return instantiateBean(beanName, mbd);&#125; ä»ä¸Šé¢è¿™æ®µä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¯¹è±¡çš„ç”Ÿæˆæœ‰è®¸å¤šä¸åŒçš„æ–¹å¼ï¼Œæœ‰é€šè¿‡å·¥å‚çš„ï¼Œä¹Ÿæœ‰é€šè¿‡å®¹å™¨çš„autowireç‰¹æ€§ç”Ÿæˆçš„ã€‚å½“ç„¶è¿™äº›ç”Ÿæˆæ–¹å¼éƒ½æ˜¯ç”±ç›¸å…³çš„BeanDefinitionæ¥æŒ‡å®šçš„ã€‚ Springä¸­é…ç½®Beançš„æ–¹å¼æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ç§æ˜¯é€šè¿‡xmlæ–‡ä»¶æ¥é…ç½®ï¼Œè¿˜æœ‰å°±æ˜¯é€šè¿‡æ³¨è§£çš„æ–¹å¼æ¥é…ç½®ã€‚ demo1 123&lt;bean id="user" class="com.glmapper.test.User"&gt; &lt;property name="name" value="glmapper"&gt;&lt;/property&gt; &lt;/bean&gt; è¿™ç§æ–¹å¼ï¼Œé€šè¿‡classæä¾›çš„æƒé™å®šåï¼Œspringå°±å¯ä»¥åˆ©ç”¨åå°„æœºåˆ¶åˆ›å»ºè¿™ä¸ªbeanã€‚ demo2 123&lt;bean id="user" class="com.glmapper.test.UserFactory" factory-method="getUser"&gt; &lt;constructor-arg value="glmapper"&gt;&lt;/constructor-arg&gt; &lt;/bean&gt; è¿™ç§æ˜¯åˆ©ç”¨é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºçš„ï¼Œæä¾›çš„classå¹¶éæ˜¯ç±»çš„æƒé™å®šåï¼Œ è€Œæ˜¯é™æ€å·¥å‚çš„å…¨ç±»åï¼›é™¤æ­¤ä¹‹å¤–è¿˜éœ€è¦æŒ‡å®šè·å–beançš„æ–¹æ³•ï¼ˆæ­¤å¤„æ˜¯getUserï¼‰å’Œå‚æ•°ï¼ˆå‚æ•°æ˜¯glmapperï¼‰ã€‚ demo3 123456789101112131415161718192021222324252627&lt;bean id=&quot;userFactory&quot; class=&quot;com.glmapper.test.UserInstanceFactory&quot;&gt; &lt;!--ç”¨ä¸€ä¸ªé›†åˆæ¥ä¿å­˜æˆ‘å½“å‰çš„å¯¹è±¡å®ä¾‹--&gt; &lt;property name=&quot;map&quot;&gt; &lt;map&gt; &lt;entry key=&quot;user1&quot;&gt; &lt;bean class=&quot;com.glmapper.test.User&quot;&gt; &lt;property name=&quot;name&quot; value=&quot;glmapper1&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;/entry&gt; &lt;entry key=&quot;user2&quot;&gt; &lt;bean class=&quot;com.glmapper.test.User&quot;&gt; &lt;property name=&quot;name&quot; value=&quot;glmapper2&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;/entry&gt; &lt;/map&gt; &lt;/property&gt; &lt;/bean&gt; //å®ä¾‹1 &lt;bean id=&quot;user1&quot; factory-bean=&quot;userFactory&quot; factory-method=&quot;getUserInstance&quot;&gt; &lt;constructor-arg value=&quot;user1&quot;&gt;&lt;/constructor-arg&gt; &lt;/bean&gt;//å®ä¾‹2 &lt;bean id=&quot;user2&quot; factory-bean=&quot;userFactory&quot; factory-method=&quot;getUserInstance&quot;&gt; &lt;constructor-arg value=&quot;user2&quot;&gt;&lt;/constructor-arg&gt; &lt;/bean è¿™ç§æ–¹å¼å’Œé™æ€å·¥å‚çš„åŒºåˆ«åœ¨äºæˆ‘ä»¬éœ€è¦å…ˆå®ä¾‹åŒ–ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨è¿™ä¸ªå·¥å‚å¯¹è±¡æ¥åˆ›å»ºæˆ‘ä»¬çš„beanã€‚getUserInstanceé€šè¿‡keyå€¼æ¥è·å–æˆ‘ä»¬å·²ç»å®ä¾‹åŒ–å¥½çš„å¯¹è±¡ï¼ˆå½“ç„¶æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ­¤å¤„ä»¥mapæ¥ä¸¾ä¸ªä¾‹å­ï¼‰ã€‚å…³äºæ³¨è§£çš„å’Œä½¿ç”¨FactoryBeanæ¥å£çš„è¿™é‡Œå°±æš‚æ—¶ä¸è¯´ï¼ŒåæœŸå†èŠ OKï¼Œç»§ç»­æ¥åˆ†é’Ÿï¼Œä¸Šé¢è¯´åˆ°çš„æ˜¯ä»¥å·¥å‚æ–¹æ³•åˆ›å»ºbeanï¼Œå…·ä½“çš„æºç æœ‰ç‚¹é•¿ï¼Œè¿™é‡Œå°±ä¸æ”¾äº†ï¼Œå¤§æ¦‚æ€è·¯å°±å¦‚ä¸Šé¢æ‰€æåˆ°çš„é‚£å‡ ç§æ–¹å¼ã€‚æ¥ä¸‹æ¥çœ‹ä¸‹å¸¸è§çš„ä½¿ç”¨instantiateBeanæ–¹å¼ï¼ˆä½¿ç”¨å®ƒçš„é»˜è®¤æ„é€ å‡½æ•°ï¼‰æ¥æ„å»ºbeançš„ä»£ç ï¼š 1234567891011121314151617181920212223242526protected BeanWrapper instantiateBean(final String beanName, final RootBeanDefinition mbd) &#123; try &#123; Object beanInstance; final BeanFactory parent = this; //è·å–ç³»ç»Ÿå®‰å…¨æ¥å£ã€‚ //å¦‚æœå·²ç»ä¸ºå½“å‰åº”ç”¨ç¨‹åºå»ºç«‹äº†å®‰å…¨ç®¡ç†å™¨ï¼Œåˆ™è¿”å›è¯¥å®‰å…¨ç®¡ç†å™¨; //å¦åˆ™ï¼Œè¿”å›nullã€‚ if (System.getSecurityManager() != null) &#123; beanInstance = AccessController.doPrivileged(new PrivilegedAction&lt;Object&gt;() &#123; @Override public Object run() &#123; return getInstantiationStrategy().instantiate(mbd, beanName, parent); &#125; &#125;, getAccessControlContext()); &#125; else &#123; beanInstance = getInstantiationStrategy().instantiate(mbd, beanName, parent); &#125; BeanWrapper bw = new BeanWrapperImpl(beanInstance); initBeanWrapper(bw); return bw; &#125; catch (Throwable ex) &#123; //å¼‚å¸¸ï¼šInstantiation of bean failed &#125;&#125; å¯ä»¥çœ‹å‡ºï¼Œä¸Šé¢çš„åˆ›å»ºéƒ½æ˜¯é€šè¿‡ï¼š 1getInstantiationStrategy().instantiate(mbd, beanName, parent); è¿™æ ·ä¸€æ®µä»£ç æ¥å®Œæˆçš„ï¼Œæ˜¯çš„ï¼Œè¿™é‡Œå·²ç»å¿«æ¥è¿‘çœŸç›¸äº†ã€‚ä»è¯­ä¹‰ä¸Šæ¥åˆ†æï¼Œå…ˆæ˜¯è·å–äº†ä¸€ç§ç­–ç•¥ï¼Œç„¶ååˆ©ç”¨å½“å‰è·å–çš„ç­–ç•¥å†å»æ‰§è¡Œå®ä¾‹åŒ–ã€‚OKï¼Œæˆ‘ä»¬çœ‹ä¸‹getInstantiationStrategy()æ‹¿åˆ°çš„æ˜¯ä»€ä¹ˆï¼š 123456//è¿”å›å®ä¾‹åŒ–ç­–ç•¥ç”¨äºåˆ›å»ºbeanå®ä¾‹ã€‚protected InstantiationStrategy getInstantiationStrategy() &#123; return this.instantiationStrategy;&#125;//é»˜è®¤çš„å®ä¾‹åŒ–æµ‹è¯•æ˜¯ä½¿ç”¨CGLIBä»£ç†private InstantiationStrategy instantiationStrategy = new CglibSubclassingInstantiationStrategy(); çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬æ¸…æ¥šäº†ï¼Œé»˜è®¤æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œåœ¨springä¸­ä¼šä½¿ç”¨Cglibæ¥è¿›è¡Œbeançš„å®ä¾‹åŒ–ï¼ˆå…³äºcglibæ­¤å¤„ä¸å†èµ˜è¿°ï¼‰ã€‚æˆ‘ä»¬çœ‹ä¸‹CglibSubclassingInstantiationStrategyè¿™ä¸ªç±»çš„ç”³æ˜ï¼š 1public class CglibSubclassingInstantiationStrategy extends SimpleInstantiationStrategy å®ƒç»§æ‰¿è‡ªSimpleInstantiationStrategy ï¼Œè¿™ä¸ªåˆæ˜¯ä»€ä¹ˆé¬¼å‘¢ï¼Ÿ SimpleInstantiationStrategyæ˜¯Springç”¨æ¥ç”ŸæˆBeanå¯¹è±¡çš„é»˜è®¤ç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æä¾›äº†ä¸¤ç§å®ä¾‹åŒ–javaå¯¹è±¡çš„æ–¹æ³•ï¼Œä¸€ç§æ˜¯åŸºäºjavaè‡ªèº«åå°„æœºåˆ¶çš„BeanUtilsï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯åŸºäºCglibã€‚ å¦‚ä½•åˆ›å»ºçš„å°±ä¸è¯´äº†ï¼›åˆ°è¿™é‡ŒcreateBeanInstanceå°±è¯´å®Œäº†ï¼ˆBeanå·²ç»åˆ›å»ºäº†ï¼‰ï¼›ä½†æ˜¯ä»…ä»…æ˜¯åˆ›å»ºï¼Œspringè¿˜æ²¡æœ‰å¤„ç†å®ƒä»¬ï¼Œæ¯”å¦‚è¯´beanå¯¹è±¡çš„å±æ€§ï¼Œä¾èµ–å…³ç³»ç­‰ç­‰ã€‚è¿™äº›å°±æ˜¯ä¸Šé¢æåˆ°çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•populateBeanï¼› è¿™ä¸ªæ–¹æ³•å…¶å®å°±åšäº†ä¸€ä»¶äº‹ï¼šä½¿ç”¨beanå®šä¹‰ä¸­çš„å±æ€§å€¼åœ¨ç»™å®šçš„BeanWrapperä¸­å¡«å……beanå®ä¾‹ã€‚åˆ†æ®µæ¥çœ‹ï¼šä¸‹é¢è¿™æ®µä»£ç æ˜¯å…ˆå°†BeanDefinitionä¸­è®¾ç½®çš„propertyå€¼å°è£…æˆPropertyValuesï¼Œç„¶åæ£€æµ‹æˆ‘ä»¬çš„BeanWrapperæ˜¯å¦ä¸ºNullï¼Œå¦‚æœä¸ºnullåˆ™æŠ›å‡ºå¼‚å¸¸æˆ–è€…è·³è¿‡å½“å‰ç©ºå®ä¾‹èµ‹å€¼é˜¶æ®µ1234567891011//è·å–åˆ°BeanDefinitionä¸­è®¾ç½®çš„propertyå€¼ï¼Œå°è£…æˆPropertyValuesPropertyValues pvs = mbd.getPropertyValues();if (bw == null) &#123; if (!pvs.isEmpty()) &#123; //å¼‚å¸¸ï¼šCannot apply property values to null instance &#125; else &#123; // Skip property population phase for null instance. return; &#125;&#125; ä¸‹é¢è¿™æ®µä»£ç çš„æ„æ€æ˜¯ç»™ä»»ä½•InstantiationAwareBeanPostProcessorsæä¾›åœ¨è®¾ç½®å±æ€§ä¹‹å‰ä¿®æ”¹beançŠ¶æ€çš„æœºä¼šã€‚12345678910111213141516boolean continueWithPropertyPopulation = true;if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; if (bp instanceof InstantiationAwareBeanPostProcessor) &#123; InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp; if (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) &#123; continueWithPropertyPopulation = false; break; &#125; &#125; &#125;&#125;if (!continueWithPropertyPopulation) &#123; return;&#125; ä¸‹é¢å°±æ˜¯å¯¹å…·ä½“æ³¨å…¥æ–¹å¼çš„å¤„ç†ï¼š 1234567891011121314151617//å¤„ç†autowireçš„æ³¨å…¥ï¼›å¯ä»¥æ ¹æ®beançš„åç§°å’Œç±»å‹æ¥æ³¨å…¥if (mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_NAME || mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_TYPE) &#123; MutablePropertyValues newPvs = new MutablePropertyValues(pvs); // åˆ™æ ¹æ®åç§°æ·»åŠ åŸºäºè‡ªåŠ¨è£…é…çš„å±æ€§å€¼ã€‚ if (mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_NAME) &#123; autowireByName(beanName, mbd, bw, newPvs); &#125; // æ ¹æ®ç±»å‹æ·»åŠ åŸºäºè‡ªåŠ¨è£…é…çš„å±æ€§å€¼ã€‚ if (mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_TYPE) &#123; autowireByType(beanName, mbd, bw, newPvs); &#125; pvs = newPvs;&#125; ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œåœ¨æ»¡è¶³çš„æƒ…å†µä¸‹åšçš„å¤„ç†åˆ†åˆ«æ˜¯ï¼š åœ¨å·¥å‚å°†ç»™å®šå±æ€§å€¼åº”ç”¨åˆ°ç»™å®šçš„beanåï¼Œå¯¹å…¶è¿›è¡Œåå¤„ç†ã€‚ å…è®¸æ£€æŸ¥æ‰€æœ‰çš„ä¾èµ–å…³ç³»æ˜¯å¦è¢«æ»¡è¶³ï¼Œä¾‹å¦‚åŸºäºbeanå±æ€§è®¾ç½®å™¨ä¸Šçš„â€œRequiredâ€æ³¨è§£ã€‚è¿˜å…è®¸æ›¿æ¢è¦åº”ç”¨çš„å±æ€§å€¼ï¼Œé€šå¸¸é€šè¿‡åˆ›å»ºåŸºäºåŸå§‹PropertyValuesçš„æ–°MutablePropertyValueså®ä¾‹ï¼Œæ·»åŠ æˆ–åˆ é™¤ç‰¹å®šå€¼ã€‚ æ‰§è¡Œä¾èµ–æ€§æ£€æŸ¥ 123456789101112131415161718192021222324//è¿”å›è¿™ä¸ªå·¥å‚æ˜¯å¦æ‹¥æœ‰ä¸€ä¸ªInstantiationAwareBeanPostProcessorboolean hasInstAwareBpps = hasInstantiationAwareBeanPostProcessors();//è¿”å›ä¾èµ–æ£€æŸ¥ä»£ç ã€‚boolean needsDepCheck = (mbd.getDependencyCheck() != RootBeanDefinition.DEPENDENCY_CHECK_NONE);if (hasInstAwareBpps || needsDepCheck) &#123;//ä»ç»™å®šçš„BeanWrapperä¸­æå–ä¸€ç»„å·²è¿‡æ»¤çš„PropertyDescriptorsï¼Œ//ä¸åŒ…æ‹¬åœ¨è¢«å¿½ç•¥çš„ä¾èµ–æ€§æ¥å£ä¸Šå®šä¹‰çš„è¢«å¿½ç•¥çš„ä¾èµ–ç±»å‹æˆ–å±æ€§ï¼ˆè¯‘æ³¨ï¼‰ã€‚ PropertyDescriptor[] filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching); if (hasInstAwareBpps) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; if (bp instanceof InstantiationAwareBeanPostProcessor) &#123; InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp; pvs = ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName); if (pvs == null) &#123; return; &#125; &#125; &#125; &#125; if (needsDepCheck) &#123; checkDependencies(beanName, mbd, filteredPds, pvs); &#125;&#125; æœ€åæ˜¯å¯¹å±æ€§è¿›è¡Œæ³¨å…¥ï¼š 1applyPropertyValues(beanName, mbd, bw, pvs); è¿™ä¸ªæ–¹æ³•æè¿°çš„æ˜¯å¯¹å±æ€§è¿›è¡Œè§£æç„¶åæ³¨å…¥çš„è¿‡ç¨‹ï¼›å…ˆæ¥åˆ†æä¸‹applyPropertyValuesçš„ç”³æ˜ï¼š12protected void applyPropertyValues(String beanName, BeanDefinition mbd, BeanWrapper bw, PropertyValues pvs) beanName beanåç§° mbd åˆå¹¶çš„bean definition bw åŒ…è£…ç›®æ ‡å¯¹è±¡çš„BeanWrapper pvs æ–°çš„å±æ€§å€¼ ä»£ç åˆ†æ®µæ¥çœ‹ï¼š å‚æ•°éªŒè¯ 123if (pvs == null || pvs.isEmpty()) &#123; return;&#125; pvså‚æ•°å¤„ç† 1234567891011121314151617if (pvs instanceof MutablePropertyValues) &#123; mpvs = (MutablePropertyValues) pvs; if (mpvs.isConverted()) &#123; // ä½¿ç”¨é¢„å…ˆè½¬æ¢åçš„å€¼ã€‚ try &#123; bw.setPropertyValues(mpvs); return; &#125; catch (BeansException ex) &#123; //å¼‚å¸¸ï¼šError setting property values &#125; &#125; original = mpvs.getPropertyValueList(); &#125; else &#123; original = Arrays.asList(pvs.getPropertyValues()); &#125; valueResolveræ¥è§£æBeanDefinition 12BeanDefinitionValueResolver valueResolver = new BeanDefinitionValueResolver(this, beanName, mbd, converter); ä¸ºè§£æå€¼åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œæ³¨å…¥åˆ°beanä¸­çš„æ˜¯å‰¯æœ¬çš„æ•°æ® 12// Create a deep copy, resolving any references for values.List&lt;PropertyValue&gt; deepCopy = new ArrayList&lt;PropertyValue&gt;(original.size()); éå†å¤„ç† 123456789101112131415161718192021222324252627282930313233343536boolean resolveNecessary = false;for (PropertyValue pv : original) &#123; //è¿”å›æ­¤æŒæœ‰è€…æ˜¯å¦å·²ç»åŒ…å«è½¬æ¢åçš„å€¼ï¼ˆtrueï¼‰ï¼Œè¿˜æ˜¯éœ€è¦è½¬æ¢å€¼ï¼ˆfalseï¼‰ã€‚ if (pv.isConverted()) &#123; deepCopy.add(pv); &#125; else &#123; String propertyName = pv.getName(); Object originalValue = pv.getValue(); //çœ‹ä¸‹é¢çš„æ³¨é‡ŠresolveValueIfNecessary Object resolvedValue = valueResolver.resolveValueIfNecessary(pv, originalValue); Object convertedValue = resolvedValue; boolean convertible = bw.isWritableProperty(propertyName) &amp;&amp; !PropertyAccessorUtils.isNestedOrIndexedProperty(propertyName); if (convertible) &#123; convertedValue = convertForProperty(resolvedValue, propertyName, bw, converter); &#125; // å¯èƒ½å°†è½¬æ¢çš„å€¼å­˜å‚¨åœ¨åˆå¹¶çš„beanå®šä¹‰ä¸­ï¼Œä»¥é¿å…ä¸ºæ¯ä¸ªåˆ›å»ºçš„beanå®ä¾‹é‡æ–°è½¬æ¢ã€‚ if (resolvedValue == originalValue) &#123; if (convertible) &#123; pv.setConvertedValue(convertedValue); &#125; deepCopy.add(pv); &#125; else if (convertible &amp;&amp; originalValue instanceof TypedStringValue &amp;&amp; !((TypedStringValue) originalValue).isDynamic() &amp;&amp; !(convertedValue instanceof Collection || ObjectUtils.isArray(convertedValue))) &#123; pv.setConvertedValue(convertedValue); deepCopy.add(pv); &#125; else &#123; resolveNecessary = true; deepCopy.add(new PropertyValue(pv, convertedValue)); &#125; &#125;&#125; resolveValueIfNecessary ç»™å®šä¸€ä¸ªPropertyValueï¼Œè¿”å›ä¸€ä¸ªvalueï¼Œå¿…è¦æ—¶è§£æå¯¹å·¥å‚ä¸­å…¶ä»–beançš„å¼•ç”¨ã€‚valueå¯ä»¥æ˜¯ï¼š ä¸€ä¸ªBeanDefinitionï¼Œå®ƒå¯¼è‡´åˆ›å»ºä¸€ä¸ªç›¸åº”çš„æ–°çš„beanå®ä¾‹ã€‚ Singletonæ ‡å¿—å’Œè¿™æ ·çš„â€inner beansâ€çš„åå­—è¢«å¿½ç•¥ï¼šå†…éƒ¨beansæ˜¯åŒ¿ååŸå‹ã€‚ RuntimeBeanReference(å¿…é¡»è§£æ) ManagedList ManagedSet ManagedMap ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡æˆ–nullï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯å­¤ç«‹çš„ã€‚ ä¸‹é¢è¿™æ®µä»£ç æ—¶ä¾èµ–æ³¨å…¥å‘ç”Ÿçš„åœ°æ–¹ï¼Œå…¶å®é™…ä¸Šæ˜¯åœ¨BeanWrapperImplä¸­æ¥å®Œæˆã€‚123456try &#123; bw.setPropertyValues(new MutablePropertyValues(deepCopy));&#125;catch (BeansException ex) &#123; //å¼‚å¸¸ï¼šError setting property values&#125; ä¸Šé¢è¯´åˆ°springæ˜¯é€šè¿‡BeanDefinitionValueResolveræ¥è§£æBeanDefinitionçš„ï¼Œç„¶åå†æ³¨å…¥åˆ°propertyä¸­ï¼Œå…³äºè¿™ä¸ªè¿‡ç¨‹åœ¨ä¸‹ä¸€ç¯‡ä¸­æ¥è¯´ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥ï¼ˆä¸€ï¼‰getBean]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase8%2F</url>
    <content type="text"><![CDATA[åœ¨Springæºç ç³»åˆ—ï¼šBeanFactoryçš„åˆ›å»ºæ–‡ç« ä¸­æˆ‘ä»¬è°ˆåˆ°äº†BeanFactoryè¿™å®¹å™¨ï¼Œè¿™ä¸ªé‡Œé¢æä¾›äº†æ³¨å…¥çš„å®ç°æ¥å£ã€‚å…¶å…·ä½“çš„å®ç°è¿˜éœ€è¦ä»AbstractBeanFactoryå’ŒDefaultListableBeanFactoryä¸­æ¥çœ‹ã€‚ä»Šå¤©å°±å…ˆæ’¸ä¸€ä¸‹AbstractBeanFactoryè¿™ä¸ªç±»ä¸­çš„getBeanè¿™ä¸ªæ–¹æ³•ã€‚ 1ã€getBeanæ–¹æ³• getBeanæä¾›äº†å››ä¸ªé‡è½½æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š12345678910111213141516171819//é€šè¿‡nameè·å–Bean@Overridepublic Object getBean(String name) throws BeansException &#123; return doGetBean(name, null, null, false);&#125;//é€šè¿‡nameå’Œç±»å‹è·å–Bean@Overridepublic &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType) throws BeansException &#123; return doGetBean(name, requiredType, null, false);&#125;//é€šè¿‡nameå’Œå¯¹è±¡å‚æ•°è·å–Bean@Overridepublic Object getBean(String name, Object... args) throws BeansException &#123; return doGetBean(name, null, args, false);&#125;//é€šè¿‡nameã€ç±»å‹å’Œå‚æ•°è·å–Beanpublic &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType, Object... args) throws BeansException &#123; return doGetBean(name, requiredType, args, false);&#125; ä»è¿™å››ä¸ªé‡è½½æ–¹æ³•çš„æ–¹æ³•ä½“ä¸­å¯ä»¥çœ‹å‡ºï¼Œä»–ä»¬éƒ½æ˜¯é€šè¿‡doGetBeanæ¥å®ç°çš„ã€‚æ‰€ä»¥doGetBeanå…¶å®æ‰æ˜¯çœŸæ­£è·å–Beançš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯è§¦å‘ä¾èµ–æ³¨å…¥å‘ç”Ÿçš„åœ°æ–¹ã€‚ï¼ˆè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œåˆ†æ®µæ¥è¯´ï¼‰ 2ã€doGetBean å…ˆæ¥çœ‹ä¸‹æ–¹æ³•çš„å®šä¹‰ï¼š 1234@SuppressWarnings("unchecked") protected &lt;T&gt; T doGetBean( final String name, final Class&lt;T&gt; requiredType, final Object[] args, boolean typeCheckOnly) throws BeansException &#123; name è¦æ£€ç´¢çš„beançš„åç§° requiredType è¦æ£€ç´¢çš„beanæ‰€éœ€çš„ç±»å‹ args ä½¿ç”¨æ˜¾å¼å‚æ•°åˆ›å»ºbeanå®ä¾‹æ—¶ä½¿ç”¨çš„å‚æ•°ï¼ˆä»…åœ¨åˆ›å»ºæ–°å®ä¾‹æ—¶åº”ç”¨ï¼Œè€Œä¸æ˜¯åœ¨æ£€ç´¢ç°æœ‰å®ä¾‹æ—¶åº”ç”¨ï¼‰ typeCheckOnly æ˜¯å¦ä¸ºç±»å‹æ£€æŸ¥è€Œè·å¾—å®ä¾‹ï¼Œè€Œä¸æ˜¯å®é™…ä½¿ç”¨ 12345678//è¿”å›beanåç§°ï¼Œå‰¥ç¦»å·¥å‚å¼•ç”¨å‰ç¼€ï¼Œå¹¶å°†åˆ«åè§£æä¸ºè§„èŒƒåç§°ã€‚final String beanName = transformedBeanName(name);//å£°æ˜å½“å‰éœ€è¦è¿”å›çš„beanå¯¹è±¡Object bean;// å…ˆä»ç¼“å­˜ä¸­è·å–beanï¼Œå¤„ç†å·²ç»è¢«åˆ›å»ºçš„å•ä¾‹æ¨¡å¼çš„beanï¼Œ//å¯¹äºæ­¤ç±»beançš„è¯·æ±‚ä¸éœ€è¦é‡å¤çš„åˆ›å»º(singleton)Object sharedInstance = getSingleton(beanName); å¦‚æœå½“å‰è·å–åˆ°çš„sharedInstanceä¸ä¸ºnullå¹¶ä¸”å‚æ•°ä¸ºç©ºï¼Œåˆ™è¿›è¡ŒFactoryBeançš„ç›¸å…³å¤„ç†ï¼Œå¹¶è·å–FactoryBeançš„å¤„ç†ç»“æœã€‚1234567891011121314if (sharedInstance != null &amp;&amp; args == null) &#123; if (logger.isDebugEnabled()) &#123; //è¿”å›æŒ‡å®šçš„singleton beanæ˜¯å¦æ­£åœ¨åˆ›å»ºï¼ˆåœ¨æ•´ä¸ªå·¥å‚å†…ï¼‰ã€‚ if (isSingletonCurrentlyInCreation(beanName)) &#123; logger.debug("Returning eagerly cached instance of singleton bean '" + beanName +"' that is not fully initialized yet - a consequence of a circular reference"); &#125; else &#123; logger.debug("Returning cached instance of singleton bean '" + beanName + "'"); &#125; &#125; //å®ŒæˆFactoryBeançš„ç›¸å…³å¤„ç†ï¼Œå¹¶ç”¨æ¥è·å–FactoryBeançš„å¤„ç†ç»“æœ bean = getObjectForBeanInstance(sharedInstance, name, beanName, null);&#125; å¦‚æœå½“å‰è·å–åˆ°çš„sharedInstanceä¸ºnullï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹åšäº†å“ªäº›å¤„ç†ï¼ˆä¸‹é¢çš„éƒ½åœ¨ä¸€ä¸ªå¤§çš„elseé‡Œé¢ï¼‰ï¼š 123else &#123; //åˆ†è§£åˆ°ä¸‹é¢&#125; 1234//åœ¨å½“å‰çº¿ç¨‹ä¸­ï¼Œè¿”å›æŒ‡å®šçš„prototype beanæ˜¯å¦æ­£åœ¨åˆ›å»ºã€‚if (isPrototypeCurrentlyInCreation(beanName)) &#123; throw new BeanCurrentlyInCreationException(beanName);&#125; ä¸‹é¢è¿™æ®µçš„ä½œç”¨æ˜¯å¯¹Iocå®¹å™¨ä¸­çš„BeanDefinitionæ˜¯å¦å­˜åœ¨è¿›è¡Œæ£€æµ‹ï¼Œå…ˆæ˜¯æ£€æµ‹å½“å‰BeanFactoryä¸­æ˜¯å¦èƒ½å¤Ÿè·å–åˆ°ï¼Œå¦‚æœå–ä¸åˆ°åˆ™ç»§ç»­åˆ°åŒäº²å®¹å™¨ä¸­è¿›è¡Œå°è¯•è·å–ï¼Œå¦‚æœåŒäº²è¿˜æ˜¯å–ä¸åˆ°ï¼Œåˆ™ç»§ç»­å‘ä¸Šä¸€çº§çˆ¶å®¹å™¨ä¸­å°è¯•è·å–ã€‚1234567891011121314// æ£€æŸ¥è¯¥å·¥å‚æ˜¯å¦å­˜åœ¨beanå®šä¹‰ã€‚BeanFactory parentBeanFactory = getParentBeanFactory();if (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) &#123; // å¦‚æœæ²¡æœ‰ï¼Œåˆ™ç»§ç»­æ£€æŸ¥çˆ¶ç±» String nameToLookup = originalBeanName(name); if (args != null) &#123; // ç”¨æ˜ç¡®çš„å‚æ•°ä»£è¡¨çˆ¶é¡¹ã€‚ return (T) parentBeanFactory.getBean(nameToLookup, args); &#125; else &#123; // å¦‚æœæ²¡æœ‰args - &gt;å§”æ‰˜ç»™æ ‡å‡†çš„getBeanæ–¹æ³•ã€‚ return parentBeanFactory.getBean(nameToLookup, requiredType); &#125;&#125; å°†æŒ‡å®šçš„beanæ ‡è®°ä¸ºå·²ç»åˆ›å»ºï¼ˆæˆ–å³å°†åˆ›å»ºï¼‰ï¼›è¿™é‡Œå…è®¸beanå·¥å‚ä¼˜åŒ–å…¶ç¼“å­˜ä»¥é‡å¤åˆ›å»ºæŒ‡å®šçš„beanã€‚123if (!typeCheckOnly) &#123; markBeanAsCreated(beanName);&#125; å…ˆæ ¹æ®beanNameæ¥è·å–BeanDefinitionï¼Œç„¶åè·å–å½“å‰beançš„æ‰€æœ‰ä¾èµ–beanï¼Œè¿™é‡Œæ˜¯é€šè¿‡é€’å½’è°ƒç”¨getBeanæ¥å®Œæˆï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¾èµ–çš„beanä¸ºæ­¢ã€‚12345678910111213141516final RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);//æ£€æŸ¥ç»™å®šçš„åˆå¹¶beanå®šä¹‰ï¼Œå¯èƒ½æŠ›å‡ºéªŒè¯å¼‚å¸¸ã€‚checkMergedBeanDefinition(mbd, beanName, args);// ä¿è¯å½“å‰beanä¾èµ–çš„beançš„åˆå§‹åŒ–ã€‚String[] dependsOn = mbd.getDependsOn();if (dependsOn != null) &#123; for (String dep : dependsOn) &#123; if (isDependent(beanName, dep)) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, "Circular depends-on relationship between '" + beanName + "' and '" + dep + "'"); &#125; registerDependentBean(dep, beanName); //é€’å½’å¤„ç†ä¾èµ–bean getBean(dep); &#125;&#125; ä¸‹é¢è¿™æ®µå°±æ˜¯åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ï¼›è¿™é‡Œé€šè¿‡è°ƒç”¨getSingletonæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå•ä¾‹beanå®ä¾‹ï¼›ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒgetSingletonçš„è°ƒç”¨æ˜¯é€šè¿‡getObjectè¿™ä¸ªå›è°ƒå‡½æ•°æ¥é—´æ¥è°ƒç”¨createBeanå®Œæˆçš„ã€‚ 12345678910111213141516171819if (mbd.isSingleton()) &#123; sharedInstance = getSingleton(beanName, new ObjectFactory&lt;Object&gt;() &#123; //å›è°ƒå‡½æ•°getObject @Override public Object getObject() throws BeansException &#123; try &#123; //åˆ›å»ºbean return createBean(beanName, mbd, args); &#125; catch (BeansException ex) &#123; //å‘ç”Ÿå¼‚å¸¸åˆ™é”€æ¯ destroySingleton(beanName); throw ex; &#125; &#125; &#125;); //è·å–ç»™å®šbeanå®ä¾‹çš„å¯¹è±¡ï¼Œæ— è®ºæ˜¯beanå®ä¾‹æœ¬èº«ï¼Œè¿˜æ˜¯FactoryBeanåˆ›å»ºçš„å¯¹è±¡ã€‚ bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);&#125; ä¸‹é¢æ˜¯åˆ›å»ºprototype bean123456789101112else if (mbd.isPrototype()) &#123; Object prototypeInstance = null; try &#123; beforePrototypeCreation(beanName); //åˆ›å»ºprototype bean prototypeInstance = createBean(beanName, mbd, args); &#125; finally &#123; afterPrototypeCreation(beanName); &#125; bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);&#125; æœ€åæ˜¯å¯¹åˆ›å»ºçš„beanè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œæ²¡æœ‰é—®é¢˜å°±è¿”å›å·²ç»åˆ›å»ºå¥½çš„beanï¼›æ­¤æ—¶è¿™ä¸ªbeanæ˜¯åŒ…å«ä¾èµ–å…³ç³»çš„bean 1234567891011121314if (requiredType != null &amp;&amp; bean != null &amp;&amp; !requiredType.isAssignableFrom(bean.getClass())) &#123; try &#123; return getTypeConverter().convertIfNecessary(bean, requiredType); &#125; catch (TypeMismatchException ex) &#123; if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Failed to convert bean &apos;&quot; + name + &quot;&apos; to required type &apos;&quot; + ClassUtils.getQualifiedName(requiredType) + &quot;&apos;&quot;, ex); &#125; throw new BeanNotOfRequiredTypeException(name, requiredType, bean.getClass()); &#125;&#125;//è¿”å›beanreturn (T) bean; getBeanæ˜¯ä¾èµ–æ³¨å…¥çš„èµ·ç‚¹ï¼Œä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œbeançš„åˆ›å»ºéƒ½æ˜¯é€šè¿‡createBeanæ¥å®Œæˆå…·ä½“çš„åˆ›å»ºçš„ã€‚createBeançš„å…·ä½“å®ç°æ˜¯åœ¨AbstractAutowireCapableBeanFactoryä¸­çš„ï¼Œè¿™é‡ŒcreateBeanä¸ä»…ä»…è´Ÿè´£åˆ›å»ºbeanï¼Œè¿˜éœ€è¦å®Œæˆå¯¹beançš„åˆå§‹åŒ–ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šä¾èµ–æ³¨å…¥-å¼•è¨€]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase7%2F</url>
    <content type="text"><![CDATA[Springæºç ç³»åˆ—ï¼šBeanDefinitionæºç è§£æ Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥(ä¸Š) Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥(ä¸­) Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥(ä¸‹) åœ¨ä¸Šé¢å››ç¯‡æ–‡ç« ä¸­å¤§æ¦‚åˆ†æäº†ä¸€ä¸‹Beançš„è½½å…¥ï¼Œå…¶å®è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åœ¨Iocå®¹å™¨ä¸­å»ºç«‹BeanDefinitionçš„æ•°æ®æ˜ å°„ã€‚ä½†æ˜¯å¯¹äºBeançš„å®ä¾‹åŒ–å¹¶æœªæ¶‰åŠï¼Œåœ¨ä¹‹å‰çš„åˆ†æä¸­ä¹Ÿæåˆ°ï¼Œbeançš„å®ä¾‹åŒ–æ˜¯åœ¨ä¾èµ–æ³¨å…¥æ˜¯æ‰å…·ä½“å®Œæˆã€‚ å…³äºä¾èµ–æ³¨å…¥å…³äºSpringï¼Œæˆ‘ä»¬æœ€å…ˆæƒ³åˆ°çš„å°±ä¸¤ä¸ªIocå’ŒAopï¼›ç„¶åå…³äºIocæˆ‘ä»¬åˆèƒ½ç‰µæ‰¯å‡ºä¸¤ä¸ªï¼šæ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥ã€‚æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥åœ¨ç½‘ä¸Šè¢«æ— æ•°å¤§ç¥äº¦æˆ–èœé¸Ÿè§£è¯»è¿‡ï¼Œè¿™é‡Œå°±ä¸ç½—åˆ—é‚£äº›æ¦‚å¿µäº†ï¼Œç›´æ¥çœ‹ï¼š ä¸ä½¿ç”¨Spring1234567public class UserService &#123; //æ‰‹åŠ¨newä¸€ä¸ª UserDao userDao = new UserDaoImpl(); public int insertUser(String userName) &#123; return userDao.insertUser(userName); &#125;&#125; ä½¿ç”¨Spring(ä»¥æ³¨è§£æ–¹å¼) 1234567public class UserService &#123; @Autowired private UserDao userDao; public int insertUser(String userName) &#123; return userDao.insertUser(userName); &#125;&#125; çœ‹èµ·æ¥è²Œä¼¼æ²¡æœ‰å•¥å¾ˆå¤§çš„æ”¹å˜ï¼ŒåŒºåˆ«å‘¢ï¼Ÿ æˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹åœ¨ä¸€ä¸ªç±»ä¸­è¿™ä¸¤ç§ç”³æ˜çš„åŒºåˆ«ï¼š UserDao userDao; userDaoæ˜¯UserDaoç±»å‹çš„å¼•ç”¨åç§°ã€‚ä»…ä»…æ˜¯å£°æ˜äº†ä¸€ä¸ªå˜é‡å¼•ç”¨åç§°ã€‚å¹¶æ²¡æœ‰åšå®ä¾‹åŒ–ï¼ŒuserDaoçš„å®ä¾‹åŒ–å¯ä»¥é€šè¿‡setæ–¹æ³•è¿›è¡Œè®¾ç½®ï¼ˆSpringä¸­ä¹‹å‰å¸¸ç”¨çš„å°±æ˜¯setæ–¹æ³•æ³¨å…¥ï¼‰ï¼›å½“æˆ‘ä»¬åˆå§‹åŒ–æŒæœ‰userDaoçš„è¿™ä¸ªç±»æ—¶æˆ‘ä»¬è¿˜ä¸çŸ¥é“userDaoåˆ°åº•å…·ä½“æŒ‡å‘å“ªä¸ªå †ä¸­çš„å¯¹è±¡åœ°å€ã€‚ UserDao userDao = new UserDaoImpl(); è€Œè¿™ä¸ªï¼Œç”³æ˜ä¸€ä¸ªå˜é‡åç§°ï¼Œå¹¶å°†userDaoç›´æ¥æŒ‡å‘new UserDaoImpl()åˆ›å»ºçš„å¯¹è±¡ã€‚ æˆ‘ä»¬æ¥çœ‹Springä¸­å…³äºæ³¨å…¥ä¹‹åå¯¹è±¡åœ°å€ä»¥åŠä¸ä½¿ç”¨æ³¨å…¥æ–¹å¼å¯¹è±¡çš„åœ°å€ï¼š 1ã€ç›´æ¥æ³¨å…¥2ã€æ³¨å…¥è¦†ç›–äº†æˆ‘è‡ªå·±çš„å¯¹è±¡3ã€è‡ªå·±æ‰‹åŠ¨new é€šè¿‡ä¸Šé¢ä¸‰å¹…å›¾å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºï¼Œè‡ªå·±æ‰‹åŠ¨newçš„å¯¹è±¡æ²¡æœ‰ä½¿ç”¨ä»£ç†çš„æ–¹å¼ï¼Œè€Œæ‰˜ç®¡ç»™Springæ³¨å…¥çš„å¯¹è±¡å‡æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®Œæˆçš„ã€‚ å…³äºåŠ¨æ€ä»£ç†ï¼šã€ŠçŒªå¼Ÿæ‹±Javaã€‹è¿è½½ç•ªå¤–ç¯‡ï¼šJavaä»£ç†ï¼ˆä¸­ï¼‰ æ€»ç»“ï¼šå½“æŸä¸ªè§’è‰²(å¯èƒ½æ˜¯ä¸€ä¸ªJavaå®ä¾‹ï¼Œè°ƒç”¨è€…)éœ€è¦å¦ä¸€ä¸ªè§’è‰²(å¦ä¸€ä¸ªJavaå®ä¾‹ï¼Œè¢«è°ƒç”¨è€…)çš„ååŠ©æ—¶ï¼Œåœ¨æœªä½¿ç”¨Springæ¥ç®¡ç†Beançš„ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ç”±è°ƒç”¨è€…æ¥åˆ›å»ºè¢«è°ƒç”¨è€…çš„å®ä¾‹ã€‚ä½†åœ¨Springé‡Œï¼Œåˆ›å»ºè¢«è°ƒç”¨è€…çš„å·¥ä½œä¸å†ç”±è°ƒç”¨è€…æ¥å®Œæˆï¼Œå› æ­¤ç§°ä¸ºæ§åˆ¶åè½¬;åˆ›å»ºè¢«è°ƒç”¨è€…å®ä¾‹çš„å·¥ä½œé€šå¸¸ç”±Springå®¹å™¨æ¥å®Œæˆï¼Œç„¶åæ³¨å…¥è°ƒç”¨è€…ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºä¾èµ–æ³¨å…¥ã€‚ ä¸‰ä¸ªé—®é¢˜é‚£ä¹ˆç°åœ¨è¦è€ƒè™‘é—®é¢˜å°±æ˜¯ï¼Œä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘æˆ‘ä»¬çš„ä¾èµ–æ³¨å…¥å‘¢ï¼ŸBeançš„å®ä¾‹åŒ–æ˜¯å¦å¿…é¡»åœ¨ä¾èµ–æ³¨å…¥æ—¶æ‰èƒ½å®Œæˆå‘¢ï¼Ÿåœ¨Springä¸­åˆæ˜¯é€šè¿‡å“ªäº›ç±»æ¥å®Œæˆæ³¨å…¥å·¥ä½œçš„å‘¢ï¼Ÿ 1ã€ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘æˆ‘ä»¬çš„ä¾èµ–æ³¨å…¥ ç­”ï¼šç”¨æˆ·ç¬¬ä¸€æ¬¡å‘å®¹å™¨è·å–Beançš„æ—¶å€™å‡ºå‘ã€‚ 2ã€Beançš„å®ä¾‹åŒ–æ˜¯å¦å¿…é¡»åœ¨ä¾èµ–æ³¨å…¥æ—¶æ‰èƒ½å®Œæˆ è¿™ä¸ªå…¶å®ä¸æ˜¯å¿…é¡»çš„ï¼Œå’±ä»¬éƒ½çŸ¥é“BeanDefinitionä¸­æœ‰lazy-initè¿™æ ·ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶è¿™ä¸ªå±æ€§çš„è®¾ç½®æ¥è®©å®¹å™¨å®Œæˆå¯¹Beançš„é¢„å®ä¾‹åŒ–ã€‚é¢„å®ä¾‹åŒ–å°±æ˜¯è¯´å®ƒçš„ä¾èµ–æ³¨å…¥æ˜¯åœ¨å®ä¾‹åŒ–è¿‡ç¨‹ä¸­å®Œæˆçš„ã€‚ ç¬¬ä¸€å’Œç¬¬äºŒä¸ªé—®é¢˜å°†ä¼šåœ¨åˆ†æç¬¬ä¸‰ä¸ªé—®é¢˜çš„æ—¶å€™æ…¢æ…¢çš„ç»†åŒ–åˆ†æã€‚æ‰€ä»¥ç¬¬ä¸‰ä¸ªé—®é¢˜å…¶å®æ²¡å•¥é¸Ÿç”¨ï¼Œä½†ä¹Ÿæ˜¯æœ€æœ€æœ€æ ¸å¿ƒçš„ï¼Œå°±æ˜¯ä¸ºäº†å¼•å‡ºåé¢å…³äºä¸€äº›å…·ä½“ç±»çš„åˆ†æçš„ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šSpringçš„ç‰ˆæœ¬å˜æ›´]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase0%2F</url>
    <content type="text"><![CDATA[Springæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è®¾è®¡å±‚é¢æ¡†æ¶ï¼Œå®ƒè§£å†³çš„æ˜¯ä¸šåŠ¡é€»è¾‘å±‚å’Œå…¶ä»–å„å±‚çš„æ¾è€¦åˆé—®é¢˜ï¼Œå› æ­¤å®ƒå°†é¢å‘æ¥å£çš„ç¼–ç¨‹æ€æƒ³è´¯ç©¿æ•´ä¸ªç³»ç»Ÿåº”ç”¨ã€‚Springæ˜¯äº2003 å¹´å…´èµ·çš„ä¸€ä¸ªè½»é‡çº§çš„Java å¼€å‘æ¡†æ¶ï¼Œç”±Rod Johnsonåˆ›å»ºã€‚ç®€å•æ¥è¯´ï¼ŒSpringæ˜¯ä¸€ä¸ªåˆ†å±‚çš„JavaSE/EEfull-stack(ä¸€ç«™å¼) è½»é‡çº§å¼€æºæ¡†æ¶ã€æ¥è‡ªç™¾åº¦ç™¾ç§‘ã€‘ã€‚ ç›®å‰Springå·²ç»å‘å±•åˆ°5.0.4 ç‰ˆæœ¬äº†ï¼Œä»Šå¤©å’±ä»¬å°±æ¥èŠä¸€èŠspringå„ä¸ªç‰ˆæœ¬éƒ½æä¾›äº†å“ªäº›æ–°çš„ç‰¹æ€§ã€‚ spring 2.xspringçš„2.xåŒ…æ‹¬ä¸‹é¢ä¸¤ä¸ªï¼š 2.0.0-2.0.8 2.5.0-2.5.6æ­¤æ—¶çš„springè¿˜æ˜¯å¾ˆå¹´è½»çš„ï¼Œæ‰€åŒ…å«çš„æ¨¡å—ä¹Ÿä¸æ˜¯å¾ˆå¤šã€‚å¦‚ä¸‹å›¾ï¼š 2.0 æ–°ç‰¹æ€§ XML Schemaçš„æ–°XMLé…ç½®è¯­æ³•çš„å‡ºç° æ–°çš„Beançš„ä½œç”¨åŸŸ ä»¥å‰çš„Springç‰ˆæœ¬å¯¹IoCå®¹å™¨çº§æ”¯æŒä¸¤ä¸ªä¸åŒçš„beanä½œç”¨åŸŸï¼ˆsingletonå’Œprototypeï¼‰ã€‚Spring 2.0åœ¨è¿™æ–¹é¢è¿›è¡Œäº†æ”¹è¿›ï¼Œä¸ä»…æ ¹æ®éƒ¨ç½²Springçš„ç¯å¢ƒï¼ˆä¾‹å¦‚Webç¯å¢ƒä¸­çš„è¯·æ±‚å’Œä¼šè¯ä½œç”¨åŸŸBeanï¼‰æä¾›äº†ä¸€äº›é¢å¤–çš„ä½œç”¨åŸŸï¼Œè¿˜æä¾›äº†â€œæŒ‚é’©â€ï¼‰ï¼Œä½¿Springç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªå·±çš„èŒƒå›´ã€‚ åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶singletonå’Œprototypeä½œç”¨åŸŸbeançš„åº•å±‚ï¼ˆå’Œå†…éƒ¨ï¼‰å®ç°å·²ç»æ”¹å˜ï¼Œä½†æ˜¯æ‰€è¿°æ”¹å˜å¯¹äºæœ€ç»ˆç”¨æˆ·æ˜¯å®Œå…¨é€æ˜çš„â€¦ä¸éœ€è¦æ”¹å˜ç°æœ‰çš„é…ç½®ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ç°æœ‰çš„é…ç½®å°†ä¼šä¸­æ–­ã€‚ å¯æ‰©å±•çš„XML æ”¯æŒ@AspectJæ–¹é¢ æ›´åŠ ç®€å•XMLé…ç½®(aop&amp;äº‹åŠ¡) å¼‚æ­¥JMS Spring MVCçš„è¡¨å•æ ‡ç­¾åº“ Java 5ï¼ˆTigerï¼‰æ”¯æŒ Spring 2.0ç°åœ¨æ”¯æŒç”¨Javaä»¥å¤–çš„è¯­è¨€ç¼–å†™çš„beanï¼Œç›®å‰æ”¯æŒçš„åŠ¨æ€è¯­è¨€æ˜¯JRubyï¼ŒGroovyå’ŒBeanShell æä¾›äº†ä¸€ä¸ªå…³äºä»»åŠ¡è°ƒåº¦çš„æŠ½è±¡æ¦‚å¿µ å¼•å…¥äº†å¯¹å„ç§æ³¨é‡Šçš„æ”¯æŒï¼Œç”¨äºé…ç½®ç›®çš„ï¼Œä¾‹å¦‚@ Transactionalï¼Œ @Requiredå’Œ@PersistenceContext / @PersistenceUnitã€‚ 2.5 æ–°ç‰¹æ€§ åœ¨Spring 2.0åœ¨æ•´ä¸ªæ¡†æ¶ä¸­å¯¹Java 5çš„æ·±å…¥æ”¯æŒä¹‹åï¼ŒSpring 2.5å¼•å…¥äº†å¯¹Java 6çš„ä¸“é—¨æ”¯æŒã€‚ @Autowiredç»“åˆå¯¹JSR-250æ³¨é‡Š@Resourceï¼Œ@ PostConstructå’Œ@PreDestroyçš„æ”¯æŒ ã€‚ åœ¨ç±»è·¯å¾„ä¸­è‡ªåŠ¨æ£€æµ‹ç»„ä»¶ Spring 2.5å¼•å…¥äº†æ”¯æŒç»„ä»¶æ‰«æï¼šåœ¨ç±»è·¯å¾„ä¸­è‡ªåŠ¨æ£€æµ‹å¸¦æ³¨é‡Šçš„ç»„ä»¶ã€‚å…¸å‹åœ°ï¼Œè¿™æ ·çš„ç»„ä»¶ç±»å°†ä¸å®šå‹å¦‚è¿›è¡Œæ³¨é‡Š@Componentï¼Œ @Repositoryï¼Œ@Serviceï¼Œ @Controllerã€‚æ ¹æ®åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡é…ç½®ï¼Œè¿™äº›ç»„ä»¶ç±»å°†è¢«è‡ªåŠ¨æ£€æµ‹å¹¶è½¬æ¢ä¸ºSpring beanå®šä¹‰ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸ªè¿™æ ·çš„beanæ˜¾å¼é…ç½®ã€‚ æ”¯æŒbeanåç§°åˆ‡å…¥ç‚¹å…ƒç´  Spring 2.5å¼•å…¥äº†å¯¹beanï¼ˆâ€¦ï¼‰ pointcutå…ƒç´ çš„æ”¯æŒï¼Œæ ¹æ®Springå®šä¹‰çš„beanåç§°åŒ¹é…ç‰¹å®šçš„å‘½åbean æ”¯æŒAspectJåŠ è½½æ—¶ç»‡å…¥ Spring 2.5æ˜¾ç€æ‰©å±•äº†SimpleJdbcTemplateçš„åŠŸèƒ½ï¼Œ å¹¶å¼•å…¥äº† SimpleJdbcCallå’ŒSimpleJdbcInsert æ“ä½œå¯¹è±¡ã€‚ åŸºäºæ³¨é‡Šçš„æ§åˆ¶å™¨ã€‚ Spring 2.5ä¸ºMVCæ§åˆ¶å™¨å¼•å…¥äº†ä¸€ä¸ªåŸºäºæ³¨é‡Šçš„ç¼–ç¨‹æ¨¡å‹ï¼Œä½¿ç”¨@ RequestMappingï¼Œ@ RequestParamï¼Œ@ ModelAttributeç­‰æ³¨è§£ã€‚è¿™ä¸ªæ³¨è§£æ”¯æŒå¯ç”¨äºServlet MVCå’ŒPortlet MVCã€‚ä»¥è¿™ç§é£æ ¼å®ç°çš„æ§åˆ¶å™¨ä¸å¿…æ‰©å±•ç‰¹å®šçš„åŸºç±»æˆ–å®ç°ç‰¹å®šçš„æ¥å£ã€‚æ­¤å¤–ï¼Œä»–ä»¬é€šå¸¸ä¸ç›´æ¥ä¾èµ–äºServletæˆ–Portlet APIï¼Œå°½ç®¡ä»–ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¿é—®Servletæˆ–Portletè®¾æ–½ã€‚ å¼•å…¥äº†Spring TestContextæ¡†æ¶ Spring 3.xspring 3.xåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªç³»åˆ—ï¼š 3.0.0-3.0.7 3.1.0-3.1.4 3.2.0-3.2.18 åœ¨2.xçš„æ¨¡å—ä¸Šé¡µæ‹“å±•äº†æ–°çš„æ¨¡å— 3.0.x æ–°ç‰¹æ€§ é’ˆå¯¹Java 5æ›´æ–°çš„æ ¸å¿ƒAPI spring è¡¨è¾¾è¯­è¨€ åŸºäºJavaçš„beanå…ƒæ•°æ®å’Œåœ¨ç»„ä»¶ä¸­å®šä¹‰beanå…ƒæ•°æ® é€šç”¨å‹è½¬æ¢ç³»ç»Ÿå’Œç°åœºæ ¼å¼åŒ–ç³»ç»Ÿ å…¨é¢çš„RESTæ”¯æŒ å£°æ˜å¼æ¨¡å‹éªŒè¯ æ—©æœŸæ”¯æŒJava EE 6 æ”¯æŒåµŒå…¥å¼æ•°æ®åº“ 3.1.x æ–°ç‰¹æ€§ ç¼“å­˜æŠ½è±¡ Beanå®šä¹‰é…ç½®æ–‡ä»¶ ç¯å¢ƒæŠ½è±¡ PropertySourceæŠ½è±¡ Springçš„XMLåç§°ç©ºé—´çš„ä»£ç ç­‰ä»·ç‰© æ”¯æŒHibernate 4.x TestContextæ¡†æ¶æ”¯æŒ@Configurationç±»å’Œbeanå®šä¹‰é…ç½®æ–‡ä»¶ æ›´ç®€æ´çš„æ„é€ å‡½æ•°æ³¨å…¥çš„å‘½åç©ºé—´ æ”¯æŒé’ˆå¯¹éæ ‡å‡†JavaBeansè®¾ç½®å™¨çš„æ³¨å…¥ æ”¯æŒServlet 3åŸºäºä»£ç çš„Servlet Containeré…ç½® æ”¯æŒServlet 3 MultipartResolver æ²¡æœ‰persistence.xmlçš„JPA EntityManagerFactoryå¼•å¯¼ ç”¨äºæ³¨é‡Šçš„æ§åˆ¶å™¨å¤„ç†çš„æ–°çš„åŸºäºHandlerMethodçš„æ”¯æŒç±» Flashå±æ€§å’ŒRedirectAttributes(è¯·æ±‚é‡å®šå‘å‚æ•°çš„æ”¯æŒ) â€œconsumesâ€ and â€œproducesâ€ conditions in @RequestMapping æ”¹è¿›äº†å¯¹é€šè¿‡â€™Content-Typeâ€™æ ‡é¢˜æŒ‡å®šæ–¹æ³•æ¶ˆè€—çš„åª’ä½“ç±»å‹ä»¥åŠé€šè¿‡æ ‡é¢˜æŒ‡å®šçš„å¯ç”Ÿæˆç±»å‹çš„æ”¯æŒâ€™Acceptâ€™ URIæ¨¡æ¿å˜é‡å¢å¼º @Valid on @RequestBodyæ§åˆ¶å™¨æ–¹æ³•å‚æ•° æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ä¸Šçš„@RequestPartæ³¨é‡Š UriComponentsBuilderå’ŒUriComponents 3.2.x æ–°ç‰¹æ€§ æ”¯æŒåŸºäºServlet 3çš„å¼‚æ­¥è¯·æ±‚å¤„ç† Spring MVCæµ‹è¯•æ¡†æ¶ @ControllerAdviceæ³¨è§£ åŸºäºä»£ç çš„Servlet 3+å®¹å™¨åˆå§‹åŒ–çš„æŠ½è±¡åŸºç±» ResponseEntityExceptionHandlerç±»å¼•å…¥ åœ¨RestTemplateå’Œä¸­çš„ @RequestBodyå‚æ•°æ”¯æŒæ³›å‹ç±»å‹ JackJSON 2å’Œç›¸å…³çš„æ”¹è¿› @RequestBodyæ”¹è¿› HTTP PATCHæ–¹æ³• ä½¿ç”¨æ³¨é‡Šç‚¹å’Œbeanå®šä¹‰æ–¹æ³•çš„å…ƒæ³¨é‡Š åˆæ­¥æ”¯æŒJCache 0.5 å…¨çƒæ—¥æœŸå’Œæ—¶é—´æ ¼å¼ æ•´ä¸ªæ¡†æ¶çš„å¹¶å‘ä¼˜åŒ– æ–°çš„åŸºäºGradleçš„æ„å»ºå’Œç§»åŠ¨åˆ°GitHub ç²¾ç‚¼çš„Java SE 7 / OpenJDK 7æ”¯æŒ Spring 4.xspring 4åŒ…æ‹¬ä»¥ä¸‹ç³»åˆ—ç‰ˆæœ¬ï¼š 4.0.0-4.0.9 4.1.0-4.1.9 4.2.0-4.2.9 4.3.0-4.3.13 spring 4.0.x æ–°ç‰¹æ€§ åˆ é™¤å¼ƒç”¨çš„è½¯ä»¶åŒ…å’Œæ–¹æ³• å¯é€‰çš„ç¬¬ä¸‰æ–¹ä¾èµ–å·²è¢«æå‡åˆ°2010/2011æœ€ä½ï¼ˆå³Spring 4é€šå¸¸åªæ”¯æŒ2010å¹´æœ«æˆ–ä¹‹åå‘å¸ƒçš„ç‰ˆæœ¬ï¼‰ï¼šç‰¹åˆ«æ˜¯ï¼ŒHibernate 3.6+ï¼ŒEhCache 2.1+ï¼ŒQuartz 1.8+ï¼ŒGroovy 1.8+å’ŒJoda-Time 2.0+ã€‚ä½œä¸ºè§„åˆ™çš„ä¸€ä¸ªä¾‹å¤–ï¼ŒSpring 4éœ€è¦æœ€è¿‘çš„Hibernate Validator 4.3+ï¼Œå¹¶ä¸”å¯¹Jacksonçš„æ”¯æŒå·²ç»é›†ä¸­åœ¨2.0+ä»¥ä¸Šï¼ˆå½“å‰Spring 3.2å·²ç»ä¿ç•™äº†å¯¹Jackson 1.8 / 1.9çš„æ”¯æŒ;ç°åœ¨åªæ˜¯å¼ƒç”¨äº†å½¢æˆï¼‰ã€‚ Java 8ï¼ˆä»¥åŠ6å’Œ7ï¼‰ å¯ä»¥ä½¿ç”¨Springçš„å›è°ƒæ¥å£ä½¿ç”¨ lambdaè¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨ Java EE 6å’Œ7 Java EE 6æˆ–æ›´é«˜ç‰ˆæœ¬ç°åœ¨è¢«è®¤ä¸ºæ˜¯Spring Framework 4çš„åŸºå‡†ï¼ŒJPA 2.0å’ŒServlet 3.0è§„èŒƒç‰¹åˆ«ç›¸å…³ã€‚ä¸ºäº†ä¸Google App Engineå’Œè¾ƒæ—©çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¿æŒå…¼å®¹ï¼Œå¯ä»¥å°†Spring 4åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Servlet 2.5ç¯å¢ƒä¸­ã€‚ä¸è¿‡ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨Servlet 3.0+ï¼Œè¿™æ˜¯Springå¼€å‘ç¯å¢ƒä¸­æµ‹è¯•è®¾ç½®çš„æµ‹è¯•å’Œæ¨¡æ‹ŸåŒ…ä¸­çš„å…ˆå†³æ¡ä»¶ã€‚ Groovy Beanå®šä¹‰DSL æ ¸å¿ƒå®¹å™¨æ”¹è¿› Springç°åœ¨å°†æ³›å‹ç±»å‹ä½œä¸ºæ³¨å…¥Beansæ—¶é™å®šç¬¦çš„å½¢å¼ ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨Spring Data Repositoryï¼Œåˆ™ç°åœ¨å¯ä»¥è½»æ¾æ³¨å…¥ä¸€ä¸ªç‰¹å®šçš„å®ç°ï¼š @Autowired Repository customerRepositoryã€‚ å¦‚æœæ‚¨ä½¿ç”¨Springçš„å…ƒæ³¨é‡Šæ”¯æŒï¼Œç°åœ¨å¯ä»¥å¼€å‘è‡ªå®šä¹‰æ³¨é‡Šæ¥ æ˜¾ç¤ºæºæ³¨é‡Šä¸­çš„ç‰¹å®šå±æ€§ã€‚ beanç°åœ¨å¯ä»¥åœ¨è‡ªåŠ¨è£…é…åˆ°åˆ—è¡¨å’Œæ•°ç»„ä¸­æ—¶è¿›è¡Œæ’åºã€‚æ— è®ºæ˜¯æ ‡æ³¨å’Œæ¥å£çš„æ”¯æŒã€‚ @OrderOrdered è¯¥@Lazyæ³¨é‡Šç°åœ¨å¯ä»¥åœ¨æ³¨å…¥ç‚¹ä½¿ç”¨ï¼Œä»¥åŠå¯¹@Bean å®šä¹‰ã€‚ è¯¥@Descriptionæ‰¹æ³¨å·²ç»æ¨å‡ºäº†ä½¿ç”¨åŸºäºJavaçš„é…ç½®å¼€å‘ã€‚ å·²ç»é€šè¿‡æ³¨é‡Šæ·»åŠ  äº†æœ‰æ¡ä»¶åœ°è¿‡æ»¤beançš„é€šç”¨æ¨¡å‹@Conditionalã€‚è¿™ä¸@Profileæ”¯æŒç±»ä¼¼ï¼Œä½†å…è®¸ä»¥ç¼–ç¨‹æ–¹å¼å¼€å‘ç”¨æˆ·å®šä¹‰çš„ç­–ç•¥ã€‚ åŸºäºCGLIBçš„ä»£ç†ç±»ä¸å†éœ€è¦é»˜è®¤çš„æ„é€ å‡½æ•°ã€‚æ”¯æŒé€šè¿‡æä¾›objenesis å…¶é‡æ–°æ‰“åŒ…åº“åœ¨çº¿ï¼Œå¹¶å°†å…¶ä½œä¸ºSpringæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚æœ‰äº†è¿™ä¸ªç­–ç•¥ï¼Œæ‰€æœ‰çš„æ„é€ å‡½æ•°éƒ½ä¸å†è¢«è°ƒç”¨ä»£ç†å®ä¾‹ã€‚ æ•´ä¸ªæ¡†æ¶ç°åœ¨éƒ½æœ‰ç®¡ç†æ—¶åŒºçš„æ”¯æŒï¼Œä¾‹å¦‚LocaleContextã€‚ web æ¨¡å—æ”¯æŒ å¯ä»¥åœ¨Spring MVCåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ–°çš„@RestControlleræ³¨é‡Šï¼Œä¸éœ€è¦æ·»åŠ @ResponseBodyåˆ°æ¯ä¸ª @RequestMappingæ–¹æ³•ä¸­ã€‚ è¯¥AsyncRestTemplateå·²æ·»åŠ ï¼Œå…è®¸å¼‚æ­¥éé˜»å¡æ”¯æŒå¼€å‘RESTå®¢æˆ·ç«¯æ—¶ã€‚ å¼€å‘Spring MVCåº”ç”¨ç¨‹åºæ—¶æä¾›äº†å…¨é¢çš„æ—¶åŒºæ”¯æŒã€‚ æµ‹è¯•æ”¹è¿› WebSocketï¼ŒSockJSå’ŒSTOMPæ¶ˆæ¯ä¼ é€’ spring 4.1.x æ–°ç‰¹æ€§ JMSæ”¹è¿› ç¼“å­˜æ”¹è¿› ç½‘ç»œæ”¹è¿› WebSocketæ¶ˆæ¯ä¼ é€’æ”¹è¿› æµ‹è¯•æ”¹è¿› spring 4.2.x æ–°ç‰¹æ€§ Spring 4 å®˜æ–¹æ–‡æ¡£ æ ¸å¿ƒå®¹å™¨æ”¹è¿› æ•°æ®è®¿é—®æ”¹è¿› spring 4.3.x æ–°ç‰¹æ€§ æ”¯æŒæ–°çš„åŒ…å’ŒæœåŠ¡ ç›¸å…³æ”¹è¿› ç›®å‰è¿˜æ²¡æœ‰ç”¨è¿‡spring5ï¼Œæ€»ä¼šæœ‰æ†§æ†¬ã€‚å½“æˆ‘ä»¬ä½¿ç”¨springè¶Šæ¥è¶Šç®€å•æ—¶ï¼Œå±æœºä¹Ÿåœ¨ä¸€æ­¥æ­¥é€¼è¿‘ï¼›çœ‹åˆ°è¡¨è±¡ï¼Œè¿›ä¸€æ­¥ï¼Œå†è¿›ä¸€æ­¥ï¼]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥(ä¸‹)]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase5%2F</url>
    <content type="text"><![CDATA[åœ¨Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥(ä¸Š)ä¸­å·²ç»å¤§æ¦‚æ‹äº†ä¸€ä¸‹è§£æè¿‡ç¨‹ï¼Œæœ¬ç¯‡å°†è®°å½•ä¸€ä¸‹beançš„æ³¨å†Œè¿‡ç¨‹ã€‚beançš„æ³¨å†Œå°±æ˜¯DefaultListableBeanFactoryä¸­registerBeanDefinitionæ–¹æ³•æ¥å®Œæˆçš„ã€‚é‚£æˆ‘å°±æ¥çœ‹registerBeanDefinitionè¿™ä¸ªæ–¹æ³•çš„å…·ä½“é€»è¾‘ã€‚1ã€beanDefinitionç±»å‹åˆ¤æ–­å’ŒéªŒè¯è¿™é‡Œçš„éªŒè¯ä¸»è¦æ˜¯éªŒè¯ä¸èƒ½å°†é™æ€å·¥å‚æ–¹æ³•ä¸æ–¹æ³•é‡å†™ç›¸ç»“åˆ(é™æ€å·¥å‚æ–¹æ³•å¿…é¡»åˆ›å»ºå®ä¾‹);if (beanDefinition instanceof AbstractBeanDefinition) { try { ((AbstractBeanDefinition) beanDefinition).validate(); } catch (BeanDefinitionValidationException ex) { throw new BeanDefinitionStoreException(beanDefinition.getResourceDescription(), beanName,â€œValidation of bean definition failedâ€, ex); }}2ã€å°è¯•ä»beanDefinitionMapä¸­è·å–è€çš„beanè¿™é‡Œå°±æ˜¯å…ˆæ ¹æ®beanNameä»beanDefinitionMapå»å–BeanDefinitionï¼Œå¹¶å°†ç»“æœç»™oldBeanDefinitionã€‚BeanDefinition oldBeanDefinition;oldBeanDefinition = this.beanDefinitionMap.get(beanName);3ã€beanDefinitionMapä¸­å·²ç»å­˜åœ¨åä¸ºbeanNameçš„Beandefinitionå¦‚æœå½“å‰beanDefinitionMapä¸­å·²ç»å­˜åœ¨åä¸ºbeanNameçš„Beandefinitionäº†(å³æ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒåç§°çš„beanDefinitionå·²ç»åœ¨Iocå®¹å™¨ä¸­æ³¨å†Œè¿‡äº†)ã€‚ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›è¡Œä»¥ä¸‹å…·ä½“ç­–ç•¥ï¼šå¦‚æœä¸å…è®¸beanè¢«è¦†ç›–ï¼Œåˆ™ç›´æ¥æŠ›å‡ºä¸èƒ½é‡æ–°æ³¨å†Œï¼Œbeanå·²ç»å­˜åœ¨è¿™æ ·çš„å¼‚å¸¸ä¿¡æ¯ä½¿ç”¨æ¡†æ¶ç”Ÿæˆçš„Beanæ¥ä»£æ›¿ç”¨æˆ·è‡ªå®šä¹‰çš„beanè¦†ç›–åŸæœ‰çš„Beandefinitionif (oldBeanDefinition != null) { if (!isAllowBeanDefinitionOverriding()) { //çœç•¥å¼‚å¸¸ä»£ç  } else if (oldBeanDefinition.getRole() &lt; beanDefinition.getRole()) { //çœç•¥å¼‚å¸¸ä»£ç  } else if (!beanDefinition.equals(oldBeanDefinition)) { //æç¤ºè¦†ç›–logä¿¡æ¯ } else { //æç¤ºè¦†ç›–logä¿¡æ¯ } //è¦†ç›–åŸæœ‰çš„Beandefinition this.beanDefinitionMap.put(beanName, beanDefinition);}4ã€beanDefinitionMapä¸å­˜åœ¨åä¸ºbeanNameçš„Beandefinition//æ£€æŸ¥beançš„åˆ›å»ºé˜¶æ®µæ˜¯å¦å·²ç»å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¦å·²ç»åˆ›å»ºäº†if (hasBeanCreationStarted()) { //Cannot modify startup-time collection elements anymore (for stable iteration) // æ— æ³•ä¿®æ”¹å¯åŠ¨æ—¶é—´æ”¶é›†å…ƒç´ ï¼ˆç”¨äºç¨³å®šè¿­ä»£ï¼‰ï¼ˆè¯‘æ³¨ï¼‰ //æ³¨å†Œè¿‡ç¨‹éœ€è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ‰€æœ‰éœ€è¦åŠ é”åŒæ­¥ synchronized (this.beanDefinitionMap) { //æ³¨å†Œåˆ°beanDefinitionMapä¸­ this.beanDefinitionMap.put(beanName, beanDefinition); //ä¸‹é¢å°±æ˜¯å°†å½“å‰beanNameå­˜æ”¾åˆ°beanDefinitionNamesä¸­ List&lt;String&gt; updatedDefinitions = new ArrayList&lt;String&gt;( this.beanDefinitionNames.size() + 1); updatedDefinitions.addAll(this.beanDefinitionNames); updatedDefinitions.add(beanName); this.beanDefinitionNames = updatedDefinitions; //å¦‚æœå•ä¾‹æ¨¡å¼çš„beanåå•ä¸­æœ‰è¯¥beançš„nameï¼Œé‚£ä¹ˆç§»é™¤æ‰å®ƒã€‚ //ä¹Ÿå°±æ˜¯è¯´ç€ï¼Œå°†ä¸€ä¸ªåŸæœ¬æ˜¯å•ä¾‹æ¨¡å¼çš„beané‡æ–°æ³¨å†Œæˆä¸€ä¸ªæ™®é€šçš„bean if (this.manualSingletonNames.contains(beanName)) { Set&lt;String&gt; updatedSingletons = new LinkedHashSet&lt;String&gt;(this.manualSingletonNames); updatedSingletons.remove(beanName); this.manualSingletonNames = updatedSingletons; } }}// ä»å¤„äºå¯åŠ¨é˜¶æ®µï¼Œbeanè¿˜æ²¡æœ‰å¼€å§‹æ³¨å†Œelse { // Still in startup registration phase this.beanDefinitionMap.put(beanName, beanDefinition); this.beanDefinitionNames.add(beanName); this.manualSingletonNames.remove(beanName);}this.frozenBeanDefinitionNames = null;5ã€æ‰§è¡Œç¼“å­˜æ¸…é™¤1ï¼šoldBeanDefinitionå¦‚æœå­˜åœ¨ï¼Œä¸”æ‰§è¡Œåˆ°äº†è¿™é‡Œä¹Ÿæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œè¯´æ˜è¯¥BeanDefinitionå·²ç»è¢«è¦†ç›–ï¼Œç¼“å­˜éœ€è¦æ›´æ–°ã€‚2ï¼šå¦‚æœæ˜¯å•ä¾‹æ¨¡å¼çš„beanå¯¹è±¡åˆ™Setä¸­åŒ…å«è¯¥beanNameï¼Œæ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜è¯¥BeanDefinitionå·²ç»ä»ä¸€ä¸ªå•ä¾‹æ¨¡å¼çš„beanå˜ä¸ºäº†ä¸€ä¸ªæ™®é€šçš„beanï¼Œæ‰€ä»¥ç¼“å­˜ä¹Ÿéœ€è¦æ›´æ–°ã€‚if (oldBeanDefinition != null || containsSingleton(beanName)) { resetBeanDefinition(beanName);}OKï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹resetBeanDefinitionè¿™ä¸ªæ–¹æ³•:è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯é‡ç½®ç»™å®šbeançš„æ‰€æœ‰beanå®šä¹‰ç¼“å­˜ï¼ŒåŒ…æ‹¬ä»å®ƒæ´¾ç”Ÿçš„beançš„ç¼“å­˜ã€‚protected void resetBeanDefinition(String beanName) { // å¦‚æœå·²ç»åˆ›å»ºï¼Œåˆ™åˆ é™¤ç»™å®šbeançš„åˆå¹¶beanå®šä¹‰ã€‚ clearMergedBeanDefinition(beanName); // å¦‚æœæœ‰çš„è¯ï¼Œä»singleton é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤ç›¸åº”çš„beanã€‚ //ä½†æ˜¯è¿™ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œè€Œåªæ˜¯ä¸ºäº†è¦†ç›–ä¸Šä¸‹æ–‡çš„é»˜è®¤bean //ï¼ˆå°±æ˜¯ä»manualSingletonNamesä¸­ç§»é™¤ï¼‰ destroySingleton(beanName); //é€’å½’çš„æ–¹å¼æ¥ é‡ç½®å…·æœ‰ç»™å®šbeanä½œä¸ºçˆ¶é¡¹çš„æ‰€æœ‰beanå®šä¹‰ã€‚ for (String bdName : this.beanDefinitionNames) { if (!beanName.equals(bdName)) { BeanDefinition bd = this.beanDefinitionMap.get(bdName); if (beanName.equals(bd.getParentName())) { resetBeanDefinition(bdName); } } }}Beançš„æ³¨å†Œå°±åˆ°è¿™é‡Œäº†ï¼Œä¸‹ä¸€ç¯‡å­¦ä¹ çš„æ˜¯DefaultListableBeanFactoryè¿™ä¸ªé›†å¤§æˆè€…å®¹å™¨ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥ï¼ˆä¸­ï¼‰]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase6%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸€ç¯‡æ˜¯å°†Beançš„è§£ææ³¨å†Œæµç¨‹è¿›è¡Œäº†æ¢³ç†ï¼Œå¯¹äºä¸€äº›ç»†èŠ‚é—®é¢˜æ²¡æœ‰è¿›è¡Œç»†ç©¶ï¼Œæ¯”å¦‚è¯´å…ƒç´ å±æ€§å€¼çš„å¤„ç†ï¼Œæ„é€ å‡½æ•°çš„å¤„ç†ç­‰ç­‰ã€‚æœ¬ç¯‡å°±å­¦ä¹ è®°å½•ä¸€ä¸‹ç›¸å…³ç‚¹ã€‚ é¦–å…ˆæ¥çœ‹ä¸‹æ˜¯åœ¨å“ªä¸ªåœ°æ–¹å…·ä½“ç”ŸæˆBeanDefinitiondçš„ã€‚ä¸‹é¢æ˜¯æ–¹æ³•è¯·æ±‚çš„é¡ºåºã€‚ DefaultBeanDefinitionDocumentReader.parseDefaultElement DefaultBeanDefinitionDocumentReader.processBeanDefinition BeanDefinitionParserDelegate.parseBeanDefinitionElement å…³äºå…ƒç´ çš„è§£æç»å¤§å¤šæ•°éƒ½æ˜¯åœ¨BeanDefinitionParserDelegateåŠå…¶å­ç±»ä¸­å®Œæˆçš„ã€‚OKï¼Œæ¥çœ‹ä¸‹parseBeanDefinitionElementè¿™ä¸ªæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public AbstractBeanDefinition parseBeanDefinitionElement( Element ele, String beanName, BeanDefinition containingBean) &#123; this.parseState.push(new BeanEntry(beanName)); String className = null; //åœ¨è¿™é‡Œæ˜¯è¯»å–&lt;bean&gt;çš„classåå­—ï¼Œç„¶åè½½å…¥åˆ°BeanDefinitionä¸­ï¼Œå¹¶æœªåšå®ä¾‹åŒ– if (ele.hasAttribute(CLASS_ATTRIBUTE)) &#123; className = ele.getAttribute(CLASS_ATTRIBUTE).trim(); &#125; try &#123; String parent = null; if (ele.hasAttribute(PARENT_ATTRIBUTE)) &#123; parent = ele.getAttribute(PARENT_ATTRIBUTE); &#125; //ç”ŸæˆBeanDefinitionå¯¹è±¡ AbstractBeanDefinition bd = createBeanDefinition(className, parent); //è§£æå½“å‰beançš„å±æ€§ parseBeanDefinitionAttributes(ele, beanName, containingBean, bd); //è®¾ç½®descriptionä¿¡æ¯ bd.setDescription(DomUtils.getChildElementValueByTagName(ele, DESCRIPTION_ELEMENT)); //å¯¹beançš„å…ƒç´ ä¿¡æ¯è¿›è¡Œè§£æ parseMetaElements(ele, bd); parseLookupOverrideSubElements(ele, bd.getMethodOverrides()); parseReplacedMethodSubElements(ele, bd.getMethodOverrides()); //è§£æbeançš„æ„é€ å‡½æ•°è®¾ç½® parseConstructorArgElements(ele, bd); //è§£æpropertyè®¾ç½® parsePropertyElements(ele, bd); parseQualifierElements(ele, bd); bd.setResource(this.readerContext.getResource()); bd.setSource(extractSource(ele)); return bd; &#125; //å¼‚å¸¸1ï¼šClassNotFoundException catch (ClassNotFoundException ex) &#123; error("Bean class [" + className + "] not found", ele, ex); &#125; //å¼‚å¸¸2ï¼šNoClassDefFoundError catch (NoClassDefFoundError err) &#123; error("Class that bean class [" + className + "] depends on not found", ele, err); &#125; //å…¶ä»–æœªçŸ¥é”™è¯¯ catch (Throwable ex) &#123; error("Unexpected failure during bean definition parsing", ele, ex); &#125; finally &#123; this.parseState.pop(); &#125; return null;&#125; æ­¤å¤„æˆ‘ä»¬ä»¥è§£æpropertyä¸ºä¾‹ï¼Œçœ‹ä¸‹å…·ä½“çš„å¤„ç†ç»†èŠ‚ï¼š 12345678910111213//è§£æç»™å®šbeanå…ƒç´ çš„å±æ€§å­å…ƒç´ ã€‚public void parsePropertyElements(Element beanEle, BeanDefinition bd) &#123; //è·å–å­å…ƒç´ èŠ‚ç‚¹ NodeList nl = beanEle.getChildNodes(); //éå† for (int i = 0; i &lt; nl.getLength(); i++) &#123; Node node = nl.item(i); //æ˜¯å¦åŒ…å«propertyæ ‡è¯† if (isCandidateElement(node) &amp;&amp; nodeNameEquals(node, PROPERTY_ELEMENT)) &#123; parsePropertyElement((Element) node, bd); &#125; &#125;&#125; æ¥ç€æ˜¯æ‰§è¡Œå…·ä½“property,åœ¨parsePropertyElementä¸­å®Œæˆï¼š 12345678910111213141516171819202122232425262728//è§£æä¸€ä¸ªpropertyå…ƒç´ ã€‚public void parsePropertyElement(Element ele, BeanDefinition bd) &#123; //é¦–å…ˆè·å–åˆ°propertyçš„åç§° String propertyName = ele.getAttribute(NAME_ATTRIBUTE); //æ£€æŸ¥æ˜¯å¦æœ‰name if (!StringUtils.hasLength(propertyName)) &#123; error("Tag 'property' must have a 'name' attribute", ele); return; &#125; this.parseState.push(new PropertyEntry(propertyName)); try &#123; //éªŒè¯åœ¨åŒä¸€ä¸ªbeanä¸­å­˜åœ¨åŒåçš„propertyï¼Œå­˜åœ¨çš„è¯å°±ä¸è§£æäº†ï¼Œç›´æ¥è¿”å› if (bd.getPropertyValues().contains(propertyName)) &#123; error("Multiple 'property' definitions for property '" + propertyName + "'", ele); return; &#125; //è§£æå‡ºpropertyçš„å€¼ Object val = parsePropertyValue(ele, bd, propertyName); //å°è£…æˆPropertyValueå¯¹è±¡ PropertyValue pv = new PropertyValue(propertyName, val); parseMetaElements(ele, pv); pv.setSource(extractSource(ele)); bd.getPropertyValues().addPropertyValue(pv); &#125; finally &#123; this.parseState.pop(); &#125;&#125; åœ¨parsePropertyValueä¸­ï¼Œæ˜¯å¯¹æ‰€æœ‰çš„propertyå­å…ƒç´ è¿›è¡Œå…·ä½“è§£æçš„ã€‚æˆ‘ä»¬çŸ¥é“propertyä¸­é™¤äº†å•å€¼ä¹‹å¤–ï¼Œè¿˜ä¼šåŒ…æ‹¬å¦‚ï¼šlistï¼Œsetï¼Œmapï¼Œpropç­‰é›†åˆå…ƒç´ ï¼›è¿™äº›éƒ½ä¼šè¢«å°è£…æˆå¯¹åº”çš„Managerdå¯¹è±¡ã€‚æ¯”å¦‚ï¼šManagedListç­‰ã€‚ä¸åŒçš„é›†åˆç±»å‹é¡µåŒæ ·å¯¹åº”ä¸€ç§è§£ææ–¹æ³•ï¼Œæ¯”å¦‚è§£ælistçš„æ˜¯ä½¿ç”¨parseListElementã€‚è¿™äº›è§£æéƒ½æ˜¯åœ¨BeanDefinitionParserDelegateç±»ä¸­å®Œæˆçš„ã€‚è¿™ä¸ªåé¢æˆ‘ä¼šæŠ½ä¸€ç¯‡æ¥å­¦ä¹ BeanDefinitionParserDelegateè¿™ä¸ªç±»ã€‚ Beançš„è½½å…¥è¿‡ç¨‹å°±æ˜¯è¿™æ ·é€šè¿‡å±‚å±‚è§£ææ¥å®Œæˆçš„ï¼Œä½†æ˜¯å¯¹äºç›®å‰çš„Iocå®¹å™¨æ¥è¯´ï¼Œä»…ä»…æ˜¯å®Œæˆäº†å¯¹Beanå¯¹è±¡ç®¡ç†çš„ä¸€äº›æ•°æ®å‡†å¤‡å·¥ä½œï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–å·¥ä½œï¼Œç›®å‰çš„BeanDefginitonä¸­åŒ…å«çš„å°±æ˜¯ä¸€äº›é™æ€çš„é…ç½®ä¿¡æ¯ï¼ŒBeançš„å®ä¾‹åŒ–è¿˜æ²¡æœ‰è¿›è¡Œï¼Œè¿™ä¸ªå®ä¾‹åŒ–çš„è¿‡ç¨‹æ˜¯åœ¨ä¾èµ–æ³¨å…¥æ—¶å€™å®Œæˆçš„ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥(ä¸Š)]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase4%2F</url>
    <content type="text"><![CDATA[ç»§ä¸Šä¸€ç¯‡BeanFactoryçš„åˆ›å»ºä¹‹åï¼Œå…¶å®å°±æ˜¯BeanDefinitionè½½å…¥äº†ã€‚åŒæ ·ä¹Ÿæ˜¯åœ¨AbstractRefreshableApplicationContextç±»çš„refreshBeanFactoryæ–¹æ³•ä¸­å®Œæˆï¼š//åˆ›å»ºé»˜è®¤çš„DefaultListableBeanFactoryå·¥å‚DefaultListableBeanFactory beanFactory = createBeanFactory();//è®¾ç½®IdbeanFactory.setSerializationId(getId());//è¿™ä¸ªæ–¹æ³•å…¶å®å°±æ˜¯è®¾ç½®äº†allowBeanDefinitionOverridingå’ŒallowCircularReferencesä¸¤ä¸ªå±æ€§customizeBeanFactory(beanFactory);//è°ƒç”¨å­ç±»çš„åŠ è½½beanå®šä¹‰æ–¹æ³•ï¼Œè¿™é‡Œä¼šè°ƒç”¨XmlWebApplicationContextå­ç±»çš„å¤å†™æ–¹æ³•loadBeanDefinitions(beanFactory);è¿™é‡Œçš„loadBeanDefinitionsä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒAbstractRefreshableApplicationContextç±»ä¸­å¹¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„å®ç°ï¼ŒäºŒæ˜¯é€šè¿‡å­ç±»XmlWebApplicationContextçš„loadBeanDefinitionså®Œæˆå…·ä½“å®ç°ã€‚protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException { //åˆ›å»ºXmlBeanDefinitionReaderï¼Œå¹¶é€šè¿‡å›è°ƒè®¾ç½®åˆ°BeanFactoryä¸­ XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory); //ä¸ºXmlBeanDefinitionReaderé…ç½®Environment beanDefinitionReader.setEnvironment(getEnvironment()); //ä¸ºXmlBeanDefinitionReaderé…ç½®ResourceLoaderï¼Œ //å› ä¸ºDefaultResourceLoaderæ˜¯çˆ¶ç±»ï¼Œæ‰€ä»¥thiså¯ä»¥ç›´æ¥è¢«ä½¿ç”¨ beanDefinitionReader.setResourceLoader(this); beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this)); // å…è®¸å­ç±»æä¾›readerçš„è‡ªå®šä¹‰åˆå§‹åŒ–ï¼Œç„¶åç»§ç»­å®é™…åŠ è½½beanå®šä¹‰ã€‚ initBeanDefinitionReader(beanDefinitionReader); loadBeanDefinitions(beanDefinitionReader);}initBeanDefinitionReaderåˆå§‹åŒ–ç”¨äºåŠ è½½æ­¤ä¸Šä¸‹æ–‡çš„beanå®šä¹‰çš„beanå®šä¹‰è¯»å–å™¨ï¼›é»˜è®¤å®ç°æ˜¯ç©ºçš„ã€‚ç„¶åä¸‹é¢é€šè¿‡é‡è½½çš„loadBeanDefinitionsæ¥åšå…·ä½“çš„beanè§£æï¼ˆè¿™é‡Œç”¨åˆ°çš„æ˜¯XmlBeanDefinitionReaderè¿™ä¸ªè§£æå™¨ï¼‰ï¼›ä½¿ç”¨ç»™å®šçš„XmlBeanDefinitionReaderåŠ è½½bean definitionsã€‚protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws IOException { String[] configLocations = getConfigLocations(); //éå†xmlæ–‡ä»¶ if (configLocations != null) { for (String configLocation : configLocations) { reader.loadBeanDefinitions(configLocation); } }}æ­¤æ—¶ä¼šå°†æˆ‘ä»¬çš„applicationContext.xmlè¯»å…¥ï¼ˆå½“ç„¶å¦‚ä½•è¿˜æœ‰å…¶ä»–çš„springé…ç½®æ–‡ä»¶ï¼ŒåŒæ ·ä¼šä¸€å—æ‹¿åˆ°è·¯å¾„ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šç„¶åç»§ç»­é€šè¿‡loadBeanDefinitionsçš„é‡è½½æ–¹æ³•ç»§ç»­å§”æ‰˜è°ƒç”¨ã€‚æœ€åäº¤ç»™AbstractBeanDefinitionReaderçš„loadBeanDefinitionsæ¥å®Œæˆï¼›è¿™ä¸ªä»£ç æ¯”è¾ƒé•¿ï¼Œæ‹†å¼€ä¸€æ­¥ä¸€æ­¥æ¥è¯´ï¼Œå…ˆçœ‹ä¸‹æ•´ä½“çš„ï¼špublic int loadBeanDefinitions(String location, Set&lt;Resource&gt; actualResources) throws BeanDefinitionStoreException { //è·å–ResourceLoaderèµ„æºå®šä½å™¨ ResourceLoader resourceLoader = getResourceLoader(); //å¦‚æœå®šä½å™¨ä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ if (resourceLoader == null) { throw new BeanDefinitionStoreException( â€œCannot import bean definitions from location [â€œ + location + â€œ]: no ResourceLoader availableâ€); } //æ˜¯å¦æ˜¯ResourcePatternResolverç±»å‹çš„å®šä½å™¨ if (resourceLoader instanceof ResourcePatternResolver) { // Resource pattern matching available. try { Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location); int loadCount = loadBeanDefinitions(resources); if (actualResources != null) { for (Resource resource : resources) { actualResources.add(resource); } } if (logger.isDebugEnabled()) { logger.debug(â€œLoaded â€œ + loadCount + â€œ bean definitions from location pattern [â€œ + location + â€œ]â€); } return loadCount; } catch (IOException ex) { throw new BeanDefinitionStoreException( â€œCould not resolve bean definition resource pattern [â€œ + location + â€œ]â€, ex); } } //éResourcePatternResolverç±»å‹çš„ else { // Can only load single resources by absolute URL. Resource resource = resourceLoader.getResource(location); int loadCount = loadBeanDefinitions(resource); if (actualResources != null) { actualResources.add(resource); } if (logger.isDebugEnabled()) { logger.debug(â€œLoaded â€œ + loadCount + â€œ bean definitions from location [â€œ + location + â€œ]â€); } return loadCount; }}ä¸Šé¢çš„ä»£ç ä¸­éœ€è¦è¯´æ˜ä¸‹ä¸ºä»€ä¹ˆè¦åˆ¤æ–­å½“å‰resourceLoaderæ˜¯å¦æ˜¯ResourcePatternResolverç±»å‹çš„ï¼Œå› ä¸ºResourceLoaderåªæ˜¯æä¾›äº†å¯¹classpathå‰ç¼€çš„æ”¯æŒã€‚è€ŒResourcePatternResolveræä¾›äº†å¯¹classpathå‰ç¼€çš„æ”¯æŒã€‚ä¹Ÿå°±æ˜¯è¯´ResourceLoaderæä¾›classpathä¸‹å•èµ„æºæ–‡ä»¶çš„è½½å…¥ï¼Œè€ŒResourcePatternResolveræä¾›å¤šèµ„æºæ–‡ä»¶çš„è½½å…¥ã€‚å…ˆçœ‹ä¸‹å‡å¦‚æ˜¯ResourcePatternResolverç±»å‹çš„ï¼ˆç•¥å»äº†éƒ¨åˆ†logä»£ç ï¼‰ï¼štry { //å…ˆå¾—åˆ°æˆ‘ä»¬çš„resources Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location); //è§£æå¹¶è¿”å›beanDefinitionçš„æ•°é‡ int loadCount = loadBeanDefinitions(resources); //åŠ è½½è¿‡ç¨‹ä¸­å·²ç»è¢«è§£æè¿‡çš„å®é™…çš„Resourceçš„å¡«å……é›†åˆ if (actualResources != null) { for (Resource resource : resources) { actualResources.add(resource); } } return loadCount;}catch (IOException ex) { throw new BeanDefinitionStoreException( â€œCould not resolve bean definition resource pattern [â€œ + location + â€œ]â€, ex);}éResourcePatternResolverç±»å‹æƒ…å†µï¼š// Can only load single resources by absolute URL.//åªèƒ½é€šè¿‡ç»å¯¹URLåŠ è½½å•ä¸ªèµ„æºResource resource = resourceLoader.getResource(location);//è§£æå¹¶è¿”å›beanDefinitionçš„æ•°é‡int loadCount = loadBeanDefinitions(resource);if (actualResources != null) { actualResources.add(resource);}return loadCount;ç„¶åç»§ç»­é€šè¿‡é‡è½½æ–¹æ³•loadBeanDefinitions(Resourceâ€¦ resources)æ¥è§£æï¼ˆAbstractBeanDefinitionReaderç±»ä¸­ï¼‰public int loadBeanDefinitions(Resourceâ€¦ resources) throws BeanDefinitionStoreException { Assert.notNull(resources, â€œResource array must not be nullâ€); //åˆå§‹åŒ–beanDefinitonä¸ªæ•° int counter = 0; //éå†å½“å‰èµ„æºæ•°ç»„ for (Resource resource : resources) { //è§£æå…·ä½“resourceä¸­çš„bean counter += loadBeanDefinitions(resource); } return counter;}ç„¶åäº¤ç»™å­ç±»XmlBeanDefinitionReaderä¸­çš„loadBeanDefinitions(Resource resource)æ–¹æ³•ï¼špublic int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException { return loadBeanDefinitions(new EncodedResource(resource));}ç»§ç»­é€šè¿‡é‡è½½æ–¹æ³•loadBeanDefinitions(EncodedResource encodedResource)æ‰§è¡Œï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬åªå…³æ³¨æœ€æ ¸å¿ƒçš„ä»£ç ï¼š//è·å–è¾“å…¥æµInputStream inputStream = encodedResource.getResource().getInputStream();try { //èµ„æºè¯»å–inputSource InputSource inputSource = new InputSource(inputStream); if (encodedResource.getEncoding() != null) { inputSource.setEncoding(encodedResource.getEncoding()); } //å§”æ‰˜ç»™doLoadBeanDefinitionsæ¥å®Œæˆ return doLoadBeanDefinitions(inputSource, encodedResource.getResource());}finally { inputStream.close();}doLoadBeanDefinitionsæ˜¯XmlBeanDefinitionReaderä¸­çš„æ–¹æ³•ï¼Œæ¥çœ‹æ ¸å¿ƒä»£ç ï¼š//è§£ææˆç¬¦åˆw3cæ ‡å‡†çš„DocumentDocument doc = doLoadDocument(inputSource, resource);//ç»§ç»­äº¤ç»™registerBeanDefinitionsæ¥å¤„ç†return registerBeanDefinitions(doc, resource);è¿™ä¸ªæ—¶å€™å·²ç»å°†loadBeanDefinitionsæ¢æˆregisterBeanDefinitionsäº†ï¼Œä¹Ÿå°±æ˜¯è½½å…¥å¹¶æ³¨å†Œï¼›registerBeanDefinitionsåŒæ ·ä¹Ÿæ˜¯XmlBeanDefinitionReaderä¸­çš„æ–¹æ³•ï¼špublic int registerBeanDefinitions(Document doc, Resource resource) throwsBeanDefinitionStoreException { //å¾—åˆ°documentReaderç”¨æ¥è¯»å–documentæ–‡æ¡£ BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader(); //æ³¨å†Œä¹‹å‰çš„beanä¸ªæ•° int countBefore = getRegistry().getBeanDefinitionCount(); //è§£æå¹¶æ³¨å†Œbean documentReader.registerBeanDefinitions(doc, createReaderContext(resource)); return getRegistry().getBeanDefinitionCount() - countBefore;}ä»ç„¶æ²¡æœ‰å¤„ç†ï¼Œç»§ç»­äº¤ç»™BeanDefinitionDocumentReaderçš„registerBeanDefinitionsæ–¹æ³•æ¥å®Œæˆï¼š//è¿™ä¸ªå®ç°æ ¹æ®â€œspring-beansâ€XSDï¼ˆæˆ–DTDï¼‰è§£æbeanå®šä¹‰ã€‚public void registerBeanDefinitions(Document doc, XmlReaderContext readerContext) { this.readerContext = readerContext; logger.debug(â€œLoading bean definitionsâ€); Element root = doc.getDocumentElement(); doRegisterBeanDefinitions(root);}è¿˜æ˜¯æ²¡å¤„ç†ï¼Œåˆç»†åŒ–ä¸€æ­¥ï¼Œäº¤ç»™DefaultBeanDefinitionDocumentReaderçš„doRegisterBeanDefinitions(Element root)æ–¹æ³•ï¼šprotected void doRegisterBeanDefinitions(Element root) { BeanDefinitionParserDelegate parent = this.delegate; this.delegate = createDelegate(getReaderContext(), root, parent); if (this.delegate.isDefaultNamespace(root)) { String profileSpec = root.getAttribute(PROFILE_ATTRIBUTE); if (StringUtils.hasText(profileSpec)) { String[] specifiedProfiles = StringUtils.tokenizeToStringArray( profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS); if (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) { if (logger.isInfoEnabled()) { logger.info(â€œSkipped XML bean definition file due to specified profiles [â€œ + profileSpec + â€œ] not matching: â€œ + getReaderContext().getResource()); } return; } } } preProcessXml(root); parseBeanDefinitions(root, this.delegate); postProcessXml(root); this.delegate = parent;}ä»»ä½•åµŒå¥—çš„&lt;beans&gt;å…ƒç´ éƒ½å°†å¯¼è‡´æ­¤æ–¹æ³•çš„é€’å½’ã€‚ ä¸ºäº†æ­£ç¡®ä¼ æ’­å’Œä¿å­˜&lt;beans&gt; default- å±æ€§ï¼Œè¯·è·Ÿè¸ªå½“å‰ï¼ˆçˆ¶ï¼‰å§”æ‰˜ï¼Œè¯¥å§”æ‰˜å¯èƒ½ä¸ºnullã€‚ ä¸ºäº†å›é€€çš„ç›®çš„ï¼Œåˆ›å»ºä¸€ä¸ªå¼•ç”¨çˆ¶å¯¹è±¡çš„æ–°ï¼ˆå­ï¼‰å§”æ‰˜ï¼Œç„¶åæœ€ç»ˆé‡ç½®this.delegateå›åˆ°å®ƒçš„åŸå§‹ï¼ˆçˆ¶ï¼‰å¼•ç”¨ã€‚è¿™ä¸ªè¡Œä¸ºæ¨¡ä»¿äº†ä¸€å †å§”æ‰˜ï¼Œè€Œå®é™…ä¸Šå¹¶ä¸éœ€è¦ä¸€ä¸ªå§”æ‰˜ã€‚ï¼ˆç¿»è¯‘çš„æœ‰ç‚¹è¹©è„šï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯è¿™ï¼‰æ‰€ä»¥è¯´DefaultBeanDefinitionDocumentReaderè‡ªå·±ä¹Ÿæ²¡å¹²è¿™äº‹ï¼Œåˆç»™äº†BeanDefinitionParserDelegateï¼Œç„¶åå°±æ˜¯preProcessXml()ã€parseBeanDefinitions()ã€postProcessXml()æ–¹æ³•ï¼›å…¶ä¸­preProcessXml()å’ŒpostProcessXml()é»˜è®¤æ˜¯ç©ºæ–¹æ³•ï¼Œè‡ªå·±æ²¡æœ‰å®ç°ã€‚å…·ä½“è§£æåœ¨parseBeanDefinitions(root, this.delegate)ä¸­å®Œæˆã€‚BeanDefinitionParserDelegateç”¨äºå°† Document çš„å†…å®¹è½¬æˆ BeanDefinitionå®ä¾‹ï¼›BeanDefinitionDocumentReader æœ¬èº«ä¸å…·å¤‡è¯¥åŠŸèƒ½è€Œæ˜¯äº¤ç»™äº†è¯¥ç±»æ¥å®Œæˆã€‚protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) { //æŸ¥çœ‹å®šä¹‰çš„å‘½åç©ºé—´æ˜¯å¦ä¸ºé»˜è®¤çš„å‘½åç©ºé—´ if (delegate.isDefaultNamespace(root)) { NodeList nl = root.getChildNodes(); for (int i = 0; i &lt; nl.getLength(); i++) { Node node = nl.item(i); if (node instanceof Element) { Element ele = (Element) node; if (delegate.isDefaultNamespace(ele)) { parseDefaultElement(ele, delegate); } else { delegate.parseCustomElement(ele); } } } } else { delegate.parseCustomElement(root); }}è¿™ä¸ªæ–¹æ³•å°±æ˜¯è§£ææ–‡æ¡£ä¸­æ ¹ç›®å½•ä¸‹çš„å…ƒç´ ï¼šâ€œimportâ€ï¼Œâ€œaliasâ€ï¼Œâ€œbeanâ€ã€‚private void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) { //è§£æä¸€ä¸ªâ€œimportâ€å…ƒç´ ï¼Œå¹¶å°†ç»™å®šèµ„æºçš„beanå®šä¹‰åŠ è½½åˆ°beanå·¥å‚ä¸­ã€‚ if (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) { importBeanDefinitionResource(ele); } //å¤„ç†ç»™å®šçš„åˆ«åå…ƒç´ ï¼Œå‘æ³¨å†Œè¡¨æ³¨å†Œåˆ«åã€‚ else if (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) { processAliasRegistration(ele); } //å¤„ç†ç»™å®šçš„beanå…ƒç´ ï¼Œè§£æbeanå®šä¹‰å¹¶å°†å…¶æ³¨å†Œåˆ°æ³¨å†Œè¡¨ä¸­ã€‚ else if (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) { processBeanDefinition(ele, delegate); } //åœ¨ç»™å®šçš„æ ¹&lt;beans /&gt;å…ƒç´ å†…æ³¨å†Œæ¯ä¸ªbeanå®šä¹‰ã€‚ else if (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) { // recurse doRegisterBeanDefinitions(ele); }}å…ˆæ¥çœ‹processBeanDefinitionè¿™ä¸ªæ–¹æ³•ï¼›BeanDefinitionHolderæ˜¯ä¸€ä¸ªBeanDefinitionçš„æŒæœ‰è€…ï¼Œå…¶å®šä¹‰äº†ä¸€ä¸‹å˜é‡ï¼Œå¹¶å¯¹ä»¥ä¸‹å˜é‡æä¾›getå’Œsetæ“ä½œã€‚è¿™ä¸ªåœ¨åé¢çš„è¯´é“BeanDefinitionä½“ç³»çš„æ—¶å€™å†èŠã€‚protected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) { //è·å–ä¸€ä¸ªBeanDefinitionHolder BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele); if (bdHolder != null) { //é¦–å…ˆæ ¹æ®è‡ªå®šä¹‰å±æ€§è¿›è¡Œè£…é¥°ã€‚ //åŸºäºè‡ªå®šä¹‰åµŒå¥—å…ƒç´ è¿›è¡Œè£…é¥°ã€‚ bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder); try { // æ³¨å†Œæœ€ç»ˆè£…é¥°çš„å®ä¾‹ã€‚ BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry()); } catch (BeanDefinitionStoreException ex) { getReaderContext().error(â€œFailed to register bean definition with name â€˜â€œ + bdHolder.getBeanName() + â€œâ€˜â€œ, ele, ex); } // å‘é€æ³¨å†Œäº‹ä»¶ã€‚ getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder)); }}æ¥ç€çœ‹registerBeanDefinitionè¿™ä¸ªæ–¹æ³•ï¼šé€šè¿‡ç»™å®šçš„beanå·¥å‚æ³¨å†Œç»™å®šçš„bean definition ã€‚public static void registerBeanDefinition( BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry) throws BeanDefinitionStoreException { // åœ¨ä¸»åç§°ä¸‹æ³¨å†Œbeanå®šä¹‰ã€‚ String beanName = definitionHolder.getBeanName(); registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition()); // å¦‚æœæœ‰çš„è¯ï¼Œæ³¨å†Œbeanåç§°çš„åˆ«åï¼Œ String[] aliases = definitionHolder.getAliases(); if (aliases != null) { for (String alias : aliases) { registry.registerAlias(beanName, alias); } }}registerBeanDefinitioné‡Œé¢åˆé€šè¿‡è°ƒç”¨BeanDefinitionRegistryæ¥å£çš„å®ç°DefaultListableBeanFactoryæ¥å®Œæˆå…·ä½“çš„æ³¨å†Œè¿‡ç¨‹ã€‚å…³äºDefaultListableBeanFactoryä¸­registerBeanDefinitionæ–¹æ³•çš„è§£æé€»è¾‘å°†åœ¨Springæºç ç³»åˆ—ï¼šBeanDefinitionè½½å…¥(ä¸‹)ä¸­æ¥è¯´.æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šBeanFactoryçš„åˆ›å»º]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase3%2F</url>
    <content type="text"><![CDATA[Springçš„Iocå®¹å™¨å…¶å®å°±æ˜¯ä¸€ä¸ªbeançš„å…³ç³»ç½‘ï¼Œä¾èµ–äºcoreï¼Œbeanï¼Œcontextä¸‰ä¸ªç»„ä»¶æ¥æ„å»ºçš„ã€‚åœ¨springä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯å¯¹äºbeançš„ç®¡ç†ã€‚è€Œbeanåˆä¾æ‰˜äºæˆ‘ä»¬çš„å®¹å™¨ã€‚æœ¬æ–‡å°†ä»é¡¶å±‚åˆ†æä¸€ä¸‹springä¸­beanFactoryçš„å…·ä½“åˆ›å»ºè¿‡ç¨‹ï¼Œä¸ºåç»­çš„beançš„ç”Ÿå‘½å‘¨æœŸæä¾›ä¸€ä¸ªåŸºç¡€ã€‚ BeanFactoryçš„ç»§æ‰¿ä½“ç³» ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒBeanFactoryæœ‰ä¸‰ä¸ªå­ç±»ï¼š ListableBeanFactory HierarchicalBeanFactory AutowireCapableBeanFactory ï¼ˆä¸Šè¿°ä¸‰ä¸ªç±»çš„å­ç±»ä½“ç³»å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªå·±å¯¹ç€æºç çœ‹ä¸‹ï¼Œå®åœ¨å¤ªå¤šï¼‰ çœ‹ä¸‹ä¸Šå›¾ä¸­æœ€åº•å±‚çš„DefaultListableBeanFactoryç±»çš„å®šä¹‰ï¼š12public class DefaultListableBeanFactory extends AbstractAutowireCapableBeanFactory implements ConfigurableListableBeanFactory, BeanDefinitionRegistry, Serializable è¿™ä¸ªå…¶å®å°±æ˜¯BeanFactoryçš„é»˜è®¤å®ç°ç±»ï¼Œå®ƒç›´æ¥æˆ–è€…é—´æ¥çš„å®ç°äº†æ‰€æœ‰çš„æ¥å£ã€‚å…¶å®åœ¨çœ‹springæºç çš„æ—¶å€™éƒ½ä¼šé‡åˆ°ç±»ä¼¼çš„è®¾è®¡æ¨¡å¼ï¼Œå¯¹äºæŸä¸€ä¸ªå…·ä½“çš„åŠŸèƒ½ï¼Œé€šå¸¸éƒ½ä¼šå®šä¹‰å¾ˆå¤šå±‚çš„æ¥å£ï¼Œå±‚å±‚åŒ…è£…ï¼Œå±‚å±‚å§”æ‰˜ã€‚è¿™ç§åšæ³•çš„å¥½å¤„å°±æ˜¯ï¼Œå¯¹äºä¸åŒçš„åœºåˆéƒ½ä¼šæœ‰ç‰¹å®šçš„æ¥å£ï¼›è¿™æ ·ä¸€æ¥å°±å¯ä»¥åœ¨springå†…éƒ¨å¯¹å¯¹è±¡çš„ä¼ é€’å’Œè½¬åŒ–æ“ä½œéƒ½ä¼šæœ‰ä¸€äº›è®¿é—®é™åˆ¶ã€‚ ä¾‹å¦‚ListableBeanFactoryæ¥å£è¡¨ç¤ºè¿™äº›Beanæ˜¯å¯åˆ—è¡¨çš„ï¼Œè€ŒHierarchicalBeanFactoryè¡¨ç¤ºçš„æ˜¯è¿™äº›Beanæ˜¯æœ‰ç»§æ‰¿å…³ç³»çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªBeanæœ‰å¯èƒ½æœ‰çˆ¶Beanã€‚AutowireCapableBeanFactoryæ¥å£å®šä¹‰Beançš„è‡ªåŠ¨è£…é…è§„åˆ™ã€‚è¿™å››ä¸ªæ¥å£å…±åŒå®šä¹‰äº†Beançš„é›†åˆã€Beanä¹‹é—´çš„å…³ç³»ã€ä»¥åŠBeanè¡Œä¸ºã€‚ BeanFactoryçš„åˆ›å»º åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è¯´è¿‡äº†å®¹å™¨çš„åˆ·æ–°è¿‡ç¨‹ã€‚BeanFactoryçš„åˆ›å»ºä¹Ÿåœ¨wac.refresh()æ–¹æ³•ä¸­ã€‚å…·ä½“çœ‹ä¸‹åˆ°åº•æ˜¯é€šè¿‡å“ªäº›å­ç±»æ¥å®Œæˆçš„ï¼š 12// é€šçŸ¥å­ç±»åˆ·æ–°å†…éƒ¨çš„beanå·¥å‚ã€‚ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); 1.AbstractApplicationContextä¸­çš„obtainFreshBeanFactory ä¸‹é¢æ˜¯obtainFreshBeanFactoryçš„æ–¹æ³•é€»è¾‘ï¼š12345678910protected ConfigurableListableBeanFactory obtainFreshBeanFactory() &#123; //è¿™ä¸ªæ˜¯å…·ä½“åˆ›å»ºçš„æ–¹æ³•ï¼Œç”±å­ç±»å®ç° refreshBeanFactory(); //è·å–BeanFactoryå®ä¾‹å¯¹è±¡ï¼ˆConfigurableListableBeanFactoryç±»å‹çš„ï¼‰ ConfigurableListableBeanFactory beanFactory = getBeanFactory(); if (logger.isDebugEnabled()) &#123; logger.debug("Bean factory for " + getDisplayName() + ": " + beanFactory); &#125; return beanFactory;&#125; refreshBeanFactoryå¹¶æœªæœ‰å…·ä½“çš„å®ç°é€»è¾‘ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡å§”æ‰˜ç»™å­ç±»çš„refreshBeanFactoryæ–¹æ³•æ¥å®ç°ï¼Œåœ¨AbstractApplicationContextä¸­refreshBeanFactoryæ˜¯ä¸€ä¸ªæŠ½è±¡æ¨¡æ¿æ–¹æ³•ï¼š 1protected abstract void refreshBeanFactory() throws BeansException, IllegalStateException; 2.refreshBeanFactoryæ–¹æ³•(AbstractRefreshableApplicationContextç±»ä¸­)ï¼š ä¸‹é¢åªæ³¨é‡Šä¸beanFactoryåˆ›å»ºç›¸å…³çš„ä»£ç  1234567891011121314151617181920212223protected final void refreshBeanFactory() throws BeansException &#123; //æ˜¯å¦å·²ç»æœ‰BeanFactoryäº† if (hasBeanFactory()) &#123; //é”€æ¯åŸæœ‰çš„Bean destroyBeans(); //å…³é—­å·¥å‚ closeBeanFactory(); &#125; try &#123; //åˆ›å»ºä¸€ä¸ªæ–°çš„beanFactory DefaultListableBeanFactory beanFactory = createBeanFactory(); beanFactory.setSerializationId(getId()); customizeBeanFactory(beanFactory); loadBeanDefinitions(beanFactory); synchronized (this.beanFactoryMonitor) &#123; this.beanFactory = beanFactory; &#125; &#125; catch (IOException ex) &#123; throw new ApplicationContextException("I/O error parsing bean definition source for " + getDisplayName(), ex); &#125;&#125; è¿™ä¸ªæ–¹æ³•æ˜¯å®ç°æ‰§è¡Œè¿™ä¸ªä¸Šä¸‹æ–‡çš„åº•å±‚beanå·¥å‚çš„å®é™…åˆ·æ–°ï¼Œå¦‚æœæœ‰çš„è¯ä¹‹å‰æœ‰BeanFactoryå­˜åœ¨ï¼Œåˆ™å…³é—­ä»¥å‰çš„beanå·¥å‚ã€‚å¹¶ä¸ºä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸçš„ä¸‹ä¸€ä¸ªé˜¶æ®µåˆå§‹åŒ–ä¸€ä¸ªæ–°é²œçš„beanå·¥å‚ã€‚ 3.createBeanFactory(AbstractRefreshableApplicationContextç±»ä¸­) 123protected DefaultListableBeanFactory createBeanFactory() &#123; return new DefaultListableBeanFactory(getInternalParentBeanFactory());&#125; è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ºå½“å‰ä¸Šä¸‹æ–‡åˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„beanå·¥å‚ã€‚æ¯æ¬¡è°ƒç”¨refresh()æ–¹æ³•æ˜¯éƒ½ä¼šåˆ›å»ºå°è¯•åˆ›å»ºã€‚é»˜è®¤å®ç°æ˜¯åˆ›å»ºä¸€ä¸ªDefaultListableBeanFactoryã€‚å¹¶é€šè¿‡getInternalParentBeanFactoryï¼ˆï¼‰è·å–å†…éƒ¨beanå·¥å‚æ¥ä½œä¸ºçˆ¶çº§beanå·¥å‚ã€‚å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™ï¼Œä¾‹å¦‚è‡ªå®šä¹‰DefaultListableBeanFactoryçš„è®¾ç½®ã€‚ getInternalParentBeanFactoryï¼ˆAbstractApplicationContextç±»ä¸­ï¼‰ 1234protected BeanFactory getInternalParentBeanFactory() &#123; return (getParent() instanceof ConfigurableApplicationContext) ? ((ConfigurableApplicationContext) getParent()).getBeanFactory() : getParent();&#125; 4.DefaultListableBeanFactoryçš„æ„é€ å‡½æ•° 1234567/** * é€šè¿‡ç»™å®šçš„çˆ¶ç±»åˆ›å»ºä¸€ä¸ªæ–°çš„DefaultListableBeanFactoryå®¹å™¨ * @param parentBeanFactory the parent BeanFactory */public DefaultListableBeanFactory(BeanFactory parentBeanFactory) &#123; super(parentBeanFactory);&#125; super(parentBeanFactory)è°ƒç”¨çš„æ˜¯AbstractAutowireCapableBeanFactoryçš„æ„é€ å‡½æ•°123456789/** * é€šè¿‡ç»™å®šçš„çˆ¶ç±»æ„å»ºæ–°çš„AbstractAutowireCapableBeanFactory * @param parentBeanFactory parent bean factory, or &#123;@code null&#125; if none */public AbstractAutowireCapableBeanFactory(BeanFactory parentBeanFactory) &#123; this(); //è®¾ç½®çˆ¶å·¥å‚ setParentBeanFactory(parentBeanFactory);&#125; this(),è¿˜æ˜¯AbstractAutowireCapableBeanFactoryçš„æ„é€ å‡½æ•°ï¼š123456789/** * æ„å»ºä¸€ä¸ªæ–°çš„AbstractAutowireCapableBeanFactory. */public AbstractAutowireCapableBeanFactory() &#123; super(); ignoreDependencyInterface(BeanNameAware.class); ignoreDependencyInterface(BeanFactoryAware.class); ignoreDependencyInterface(BeanClassLoaderAware.class);&#125; super() ; AbstractBeanFactoryçš„æ„é€ å‡½æ•° 12345/** * æ„å»ºä¸€ä¸ªæ–°çš„AbstractBeanFactory. */public AbstractBeanFactory() &#123;&#125;]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šBeanDefinition æºç è§£æ]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase2%2F</url>
    <content type="text"><![CDATA[Beançš„å®šä¹‰ä¸»è¦ç”±BeanDefinitionæ¥æè¿°çš„ã€‚ä½œä¸ºSpringä¸­ç”¨äºåŒ…è£…Beançš„æ•°æ®ç»“æ„ï¼Œä»Šå¤©å°±æ¥çœ‹çœ‹å®ƒçš„é¢çº±ä¸‹çš„çœŸå®¹å§ã€‚ é¦–å…ˆå°±æ˜¯BeanDefinitionçš„ç±»å®šä¹‰ï¼š1public interface BeanDefinition extends AttributeAccessor, BeanMetadataElement å¯¹ï¼Œæ²¡é”™ï¼Œè¿™è´§æ˜¯ä¸ªæ¥å£ï¼Œè€Œä¸æ˜¯ç±»ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è«åå¥‡å¦™å‘¢ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“åœ¨JAVAä¸­ï¼Œæ¥å£æ˜¯ä¸èƒ½ç”¨æ¥newå‡ºæ–°çš„å¯¹è±¡çš„ï¼Œé‚£ä¹ˆåœ¨Springä¸­ï¼Œåˆ°åº•å°†XMLè§£æå‡ºæ¥çš„BeanåŒ…è£…æˆäº†ä»€ä¹ˆå‘¢ï¼Ÿï¼ˆè¿™ä¸ªå¯†ç­‰ä¸‹æ­å¼€ï¼‰ å…ˆæ¥çœ‹çœ‹BeanDefinitionä¸€ä¸ªç»§æ‰¿ç»“æ„å§ï¼ˆå‡æ˜¯ä¸BeanDefinitionæœ‰ç›´æ¥å…³è”çš„ç±»æˆ–è€…æ¥å£ï¼‰ï¼ ä»ç±»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒBeanDefinitionç»§æ‰¿äº†AttributeAccessorå’ŒBeanMetadataElementä¸¤ä¸ªæ¥å£ï¼›ä¸€ä¸ªä¸€ä¸ªçœ‹ã€‚ AttributeAccessor AttributeAccessoræ¥å£å®šä¹‰äº†æœ€åŸºæœ¬çš„å¯¹ä»»æ„å¯¹è±¡çš„å…ƒæ•°æ®çš„ä¿®æ”¹æˆ–è€…è·å–ï¼Œä¸»è¦æ–¹æ³•æœ‰ï¼š1234567891011//å°†nameå®šä¹‰çš„å±æ€§è®¾ç½®ä¸ºæä¾›çš„valueå€¼ã€‚å¦‚æœvalueçš„å€¼ä¸ºnullï¼Œåˆ™è¯¥å±æ€§ä¸º&#123;@link #removeAttribute removed&#125;ã€‚//é€šå¸¸ï¼Œç”¨æˆ·åº”è¯¥æ³¨æ„é€šè¿‡ä½¿ç”¨å®Œå…¨é™å®šçš„åç§°ï¼ˆå¯èƒ½ä½¿ç”¨ç±»æˆ–åŒ…åç§°ä½œä¸ºå‰ç¼€ï¼‰æ¥é˜²æ­¢ä¸å…¶ä»–å…ƒæ•°æ®å±æ€§é‡å ã€‚void setAttribute(String name, Object value);//è·å–æ ‡è¯†ä¸ºnameçš„å±æ€§çš„å€¼ã€‚Object getAttribute(String name);//åˆ é™¤æ ‡è¯†ä¸ºnameçš„å±æ€§ï¼Œå¹¶è¿”å›å±æ€§å€¼Object removeAttribute(String name);//å¦‚æœåä¸ºnameçš„å±æ€§æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚boolean hasAttribute(String name);//è¿”å›æ‰€æœ‰å±æ€§çš„åç§°ã€‚String[] attributeNames(); BeanMetadataElement BeanMetadataElementæ¥å£æä¾›äº†ä¸€ä¸ªgetResource()æ–¹æ³•,ç”¨æ¥ä¼ è¾“ä¸€ä¸ªå¯é…ç½®çš„æºå¯¹è±¡ã€‚ 12//è¿”å›æ­¤å…ƒæ•°æ®å…ƒç´ çš„é…ç½®æºå¯¹è±¡ï¼ˆå¯èƒ½ä¸ºnullï¼‰ã€‚Object getSource(); BeanDifinitionæºç åˆ†æä¸€ä¸ªBeanDefinitionæè¿°äº†ä¸€ä¸ªbeançš„å®ä¾‹ï¼ŒåŒ…æ‹¬å±æ€§å€¼ï¼Œæ„é€ æ–¹æ³•å‚æ•°å€¼å’Œç»§æ‰¿è‡ªå®ƒçš„ç±»çš„æ›´å¤šä¿¡æ¯ã€‚BeanDefinitionä»…ä»…æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„æ¥å£ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å…è®¸BeanFactoryPostProcessor ä¾‹å¦‚PropertyPlaceHolderConfigure èƒ½å¤Ÿæ£€ç´¢å¹¶ä¿®æ”¹å±æ€§å€¼å’Œåˆ«çš„beançš„å…ƒæ•°æ®ï¼ˆè¯‘æ³¨ï¼‰ã€‚ 123//æ ‡å‡†å•ä¾‹ä½œç”¨åŸŸçš„ä½œç”¨åŸŸæ ‡è¯†ç¬¦ï¼šâ€œsingletonâ€ã€‚//å¯¹äºæ‰©å±•çš„beanå·¥å‚å¯èƒ½æ”¯æŒæ›´å¤šçš„ä½œç”¨åŸŸã€‚String SCOPE_SINGLETON = ConfigurableBeanFactory.SCOPE_SINGLETON; 123//æ ‡å‡†åŸå‹ä½œç”¨åŸŸçš„èŒƒå›´æ ‡è¯†ç¬¦ï¼šâ€œprototypeâ€ã€‚//å¯¹äºæ‰©å±•çš„beanå·¥å‚å¯èƒ½æ”¯æŒæ›´å¤šçš„ä½œç”¨åŸŸã€‚String SCOPE_PROTOTYPE = ConfigurableBeanFactory.SCOPE_PROTOTYPE; 12//è¡¨ç¤ºBeanDefinitionæ˜¯åº”ç”¨ç¨‹åºä¸»è¦éƒ¨åˆ†çš„è§’è‰²æç¤ºã€‚ é€šå¸¸å¯¹åº”äºç”¨æˆ·å®šä¹‰çš„beanã€‚int ROLE_APPLICATION = 0; ROLE_SUPPORT =1å®é™…ä¸Šå°±æ˜¯è¯´ï¼Œæˆ‘è¿™ä¸ªBeanæ˜¯ç”¨æˆ·çš„ï¼Œæ˜¯ä»é…ç½®æ–‡ä»¶ä¸­è¿‡æ¥çš„ã€‚1234//è¡¨ç¤ºBeanDefinitionæ˜¯æŸäº›å¤§å‹é…ç½®çš„æ”¯æŒéƒ¨åˆ†çš„è§’è‰²æç¤ºï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¤–éƒ¨ComponentDefinitionã€‚//å½“æŸ¥çœ‹æŸä¸ªç‰¹å®šçš„ComponentDefinitionæ—¶ï¼Œè®¤ä¸ºbeanéå¸¸é‡è¦ï¼Œ//ä»¥ä¾¿åœ¨æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„æ•´ä½“é…ç½®æ—¶èƒ½å¤Ÿæ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚int ROLE_SUPPORT = 1; ROLE_INFRASTRUCTURE = 2å°±æ˜¯æˆ‘è¿™Beanæ˜¯Springè‡ªå·±çš„ï¼Œå’Œä½ ç”¨æˆ·æ²¡æœ‰ä¸€æ¯›é’±å…³ç³»ã€‚123//è§’è‰²æç¤ºè¡¨æ˜ä¸€ä¸ªBeanDefinitionæ˜¯æä¾›ä¸€ä¸ªå®Œå…¨èƒŒæ™¯çš„è§’è‰²ï¼Œå¹¶ä¸”ä¸æœ€ç»ˆç”¨æˆ·æ²¡æœ‰å…³ç³»ã€‚//è¿™ä¸ªæç¤ºç”¨äºæ³¨å†Œå®Œå…¨æ˜¯ComponentDefinitionå†…éƒ¨å·¥ä½œçš„ä¸€éƒ¨åˆ†çš„beanint ROLE_INFRASTRUCTURE = 2; ä¸Šé¢æ˜¯BeanDifinitionçš„ä¸€äº›åŸºæœ¬å±æ€§ä¿¡æ¯ï¼Œä¸€ä¸ªå°±æ˜¯æ ‡è¯†ä¸‹å½“å‰Beançš„ä½œç”¨åŸŸï¼Œå¦å¤–å°±æ˜¯æ ‡è¯†ä¸€ä¸‹è¿™ä¸ªBeanæ˜¯å†…éƒ¨çš„è¿˜æ˜¯å¤–éƒ¨çš„ã€‚ä¸‹é¢æ¥çœ‹è¿™ä¸ªæ¥å£ä¸ºå…¶å­ç±»éƒ½æä¾›äº†å“ªäº›å…·ä½“çš„è¡Œä¸ºæ–¹æ³•ï¼š 1.å½“å‰Beançˆ¶ç±»åç§°get&amp;setæ–¹æ³•1234//å¦‚æœçˆ¶ç±»å­˜åœ¨ï¼Œè®¾ç½®è¿™ä¸ªbeanå®šä¹‰çš„çˆ¶å®šä¹‰çš„åç§°ã€‚void setParentName(String parentName);//å¦‚æœçˆ¶ç±»å­˜åœ¨ï¼Œåˆ™è¿”å›å½“å‰Beançš„çˆ¶ç±»çš„åç§°String getParentName(); 2.å½“å‰Beançš„className get&amp;setæ–¹æ³•123456789//æŒ‡å®šæ­¤beanå®šä¹‰çš„beanç±»åç§°ã€‚//ç±»åç§°å¯ä»¥åœ¨bean factoryåæœŸå¤„ç†ä¸­ä¿®æ”¹ï¼Œé€šå¸¸ç”¨å®ƒçš„è§£æå˜ä½“æ›¿æ¢åŸæ¥çš„ç±»åç§°ã€‚void setBeanClassName(String beanClassName);//è¿”å›æ­¤beanå®šä¹‰çš„å½“å‰beanç±»åç§°ã€‚//éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ä¸€å®šæ˜¯åœ¨è¿è¡Œæ—¶ä½¿ç”¨çš„å®é™…ç±»åï¼Œä»¥é˜²å­ç±»å®šä¹‰è¦†ç›–/ç»§æ‰¿å…¶çˆ¶ç±»çš„ç±»åã€‚//æ­¤å¤–ï¼Œè¿™å¯èƒ½åªæ˜¯è°ƒç”¨å·¥å‚æ–¹æ³•çš„ç±»ï¼Œæˆ–è€…å®ƒ åœ¨è°ƒç”¨æ–¹æ³•çš„å·¥å‚beanå¼•ç”¨çš„æƒ…å†µä¸‹ç”šè‡³å¯èƒ½æ˜¯ç©ºçš„ã€‚//å› æ­¤ï¼Œä¸è¦è®¤ä¸ºè¿™æ˜¯åœ¨è¿è¡Œæ—¶å®šä¹‰çš„beanç±»å‹ï¼Œè€Œåªæ˜¯å°†å…¶ç”¨äºåœ¨å•ç‹¬çš„beanå®šä¹‰çº§åˆ«è¿›è¡Œè§£æã€‚String getBeanClassName(); 3.Beançš„ä½œç”¨åŸŸget&amp;setæ–¹æ³•1234//è¦†ç›–æ­¤beançš„ç›®æ ‡èŒƒå›´ï¼ŒæŒ‡å®šä¸€ä¸ªæ–°çš„èŒƒå›´åç§°ã€‚void setScope(String scope);//è¿”å›æ­¤beançš„å½“å‰ç›®æ ‡ä½œç”¨åŸŸçš„åç§°ï¼Œå¦‚æœæ²¡æœ‰ç¡®å®šï¼Œè¿”å›nullString getScope(); 4.æ‡’åŠ è½½çš„get&amp;setæ–¹æ³• 123456//è®¾ç½®è¿™ä¸ªbeanæ˜¯å¦åº”è¯¥è¢«å»¶è¿Ÿåˆå§‹åŒ–ã€‚å¦‚æœ&#123;false&#125;ï¼Œé‚£ä¹ˆè¿™ä¸ªbeanå°†åœ¨å¯åŠ¨æ—¶ç”±beanå·¥å‚å®ä¾‹åŒ–ï¼Œ//è¿™äº›å·¥å‚æ‰§è¡Œå•ä¾‹çš„ç«‹å³åˆå§‹åŒ–ã€‚//æ‡’åŠ è½½ &lt;bean lazy-init="true/false"&gt;void setLazyInit(boolean lazyInit);//è¿”å›è¿™ä¸ªbeanæ˜¯å¦åº”è¯¥è¢«å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå³ä¸æ˜¯åœ¨å¯åŠ¨æ—¶ç«‹å³å®ä¾‹åŒ–ã€‚åªé€‚ç”¨äºå•ä¾‹beanã€‚boolean isLazyInit(); 5.ä¾èµ–å…³ç³»è®¾ç½®12345//è®¾ç½®è¿™ä¸ªbeanä¾èµ–è¢«åˆå§‹åŒ–çš„beançš„åå­—ã€‚ beanå·¥å‚å°†ä¿è¯è¿™äº›beané¦–å…ˆè¢«åˆå§‹åŒ–ã€‚//&lt;bean depends-on=""&gt;void setDependsOn(String... dependsOn);//è¿”å›è¿™ä¸ªbeanä¾èµ–çš„beanåç§°ã€‚String[] getDependsOn(); 6.æ˜¯å¦æ˜¯è‡ªåŠ¨è½¬é…è®¾ç½®123456789//è®¾ç½®è¿™ä¸ªbeanæ˜¯å¦æ˜¯è·å¾—è‡ªåŠ¨è£…é…åˆ°å…¶ä»–beançš„å€™é€‰äººã€‚//éœ€è¦æ³¨æ„æ˜¯ï¼Œæ­¤æ ‡å¿—æ—¨åœ¨ä»…å½±å“åŸºäºç±»å‹çš„è‡ªåŠ¨è£…é…ã€‚//å®ƒä¸ä¼šå½±å“æŒ‰åç§°çš„æ˜¾å¼å¼•ç”¨ï¼Œå³ä½¿æŒ‡å®šçš„beanæ²¡æœ‰æ ‡è®°ä¸ºautowireå€™é€‰ï¼Œä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚//å› æ­¤ï¼Œå¦‚æœåç§°åŒ¹é…ï¼Œé€šè¿‡åç§°çš„è‡ªåŠ¨è£…é…å°†æ³¨å…¥ä¸€ä¸ªbeanã€‚void setAutowireCandidate(boolean autowireCandidate);//è¿”å›è¿™ä¸ªbeanæ˜¯å¦æ˜¯è‡ªåŠ¨è£…é…åˆ°å…¶ä»–beançš„å€™é€‰è€…ã€‚å°±æ˜¯æ˜¯å¦åœ¨å…¶ä»–ç±»ä¸­ä½¿ç”¨autowiredæ¥æ³¨å…¥å½“å‰Beançš„//æ˜¯å¦ä¸ºè¢«è‡ªåŠ¨è£…é… &lt;bean autowire-candidate="true/false"&gt;boolean isAutowireCandidate(); 7.ä¸»å€™é€‰Bean1234//æ˜¯å¦ä¸ºä¸»å€™é€‰bean ä½¿ç”¨æ³¨è§£ï¼š@Primaryvoid setPrimary(boolean primary);//è¿”å›è¿™ä¸ªbeanæ˜¯å¦æ˜¯ä¸»è¦çš„autowireå€™é€‰è€…ã€‚boolean isPrimary(); 8.å®šä¹‰åˆ›å»ºè¯¥Beanå¯¹è±¡çš„å·¥å‚ç±»1234//æŒ‡å®šè¦ä½¿ç”¨çš„å·¥å‚beanï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ è¿™æ˜¯è°ƒç”¨æŒ‡å®šçš„å·¥å‚æ–¹æ³•çš„beançš„åç§°ã€‚void setFactoryBeanName(String factoryBeanName);//è¿”å›å·¥å‚beançš„åå­—ï¼Œå¦‚æœæœ‰çš„è¯ã€‚String getFactoryBeanName(); 9.åˆ›å»ºè¯¥Beanå¯¹è±¡çš„å·¥å‚æ–¹æ³• 123456//å¦‚æœæœ‰çš„è¯ï¼ŒæŒ‡å®šå·¥å‚æ–¹æ³•ã€‚//è¿™ä¸ªæ–¹æ³•å…ˆå°†é€šè¿‡æ„é€ å‡½æ•°å‚æ•°è¢«è°ƒç”¨ï¼Œæˆ–è€…å¦‚æœå‚æ•°ï¼Œå°†è°ƒç”¨è¯¥æ–¹æ³•çš„æ— å‚æ•°æ„é€ ã€‚//æ–¹æ³•å°†åœ¨æŒ‡å®šçš„å·¥å‚beanï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¸Šè¢«è°ƒç”¨ï¼Œæˆ–è€…ä½œä¸ºæœ¬åœ°beanç±»çš„é™æ€æ–¹æ³•è¢«è°ƒç”¨ã€‚void setFactoryMethodName(String factoryMethodName);//å¦‚æœå­˜åœ¨ï¼Œè¿”å›å·¥å‚æ–¹æ³•åString getFactoryMethodName(); 10.è¿”å›æ­¤beançš„æ„é€ å‡½æ•°å‚æ•°å€¼ã€‚12//è¿”å›æ­¤beançš„æ„é€ å‡½æ•°å‚æ•°å€¼ã€‚ConstructorArgumentValues getConstructorArgumentValues(); 11.è·å–æ™®é€šå±æ€§é›†åˆ12//è·å–æ™®é€šå±æ€§é›†åˆMutablePropertyValues getPropertyValues(); 12.å½“å‰Beançš„åŸºæœ¬ç‰¹æ€§123456//æ˜¯å¦æ˜¯å•ä¾‹çš„boolean isSingleton();//æ˜¯å¦æ˜¯å¤šä¾‹çš„boolean isPrototype();//æ˜¯å¦æ˜¯æŠ½è±¡ç±»boolean isAbstract(); 13.å½“å‰Beançš„åº”ç”¨12//è·å–è¿™ä¸ªbeançš„åº”ç”¨int getRole(); 13.å¯è¯»æè¿°12//è¿”å›å¯¹beanå®šä¹‰çš„å¯è¯»æè¿°ã€‚String getDescription(); 12//è¿”å›è¯¥beanå®šä¹‰æ¥è‡ªçš„èµ„æºçš„æè¿°String getResourceDescription(); 123//è¿”å›åŸå§‹çš„BeanDefinition;å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›nullã€‚å…è®¸æ£€ç´¢è£…é¥°çš„beanå®šä¹‰ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚//æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ç›´æ¥çš„å‘èµ·è€…ã€‚ è¿­ä»£åŸå§‹é“¾ï¼Œæ‰¾åˆ°ç”¨æˆ·å®šä¹‰çš„åŸå§‹BeanDefinitionã€‚BeanDefinition getOriginatingBeanDefinition(); ä»ä¸Šé¢çš„å±æ€§å’Œæ–¹æ³•åˆ†æå¯ä»¥çœ‹å‡ºï¼ŒBeanDefinitionå¯¹äºä¸€ä¸ªBeançš„æè¿°åšäº†è¾ƒä¸ºå®Œæ•´çš„ä¸€å¥—çº¦æŸã€‚è¿™ä¸ºåç»­çš„å­ç±»æä¾›çš„æœ€åŸºæœ¬çš„èŒè´£å’Œå±æ€§ã€‚ æ¬¢è¿å…³æ³¨glmapperå·¥ä½œå®¤å…¬ä¼—å·]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringMVCç³»åˆ—æºç ï¼šDispatcherServlet]]></title>
    <url>%2F2018%2F11%2F10%2Fspring-base-webmvc3%2F</url>
    <content type="text"><![CDATA[å‰é¢ä¸¤ç¯‡æ–‡ç« ç›´æ¥å¯¹SpringMVCé‡Œé¢çš„ç»„ä»¶è¿›è¡Œäº†æºç åˆ†æï¼Œå¯èƒ½å¾ˆå¤šå°ä¼™ä¼´éƒ½ä¼šè§‰å¾—æœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘ã€‚æ‰€ä»¥ä»Šå¤©å†å²”å›æ¥è¯´ä¸€è¯´SpringMVCçš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œä»¥æ­¤ä¸ºè½´å¿ƒæ¥å­¦ä¹ æ•´ä¸ªSpringMVCçš„çŸ¥è¯†ä½“ç³»ã€‚ SpringMVCåœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿå‰é¢åœ¨ã€Šé¡¹ç›®å¼€å‘æ¡†æ¶-SSMã€‹ä¸€ç¯‡æ–‡ç« ä¸­å·²ç»è¯¦ç»†çš„ä»‹ç»è¿‡äº†SSMé¡¹ç›®ä¸­å…³äºSpringçš„ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œå¯¹äºä¸€ä¸ªSpringåº”ç”¨ï¼Œå¿…ä¸å¯å°‘çš„æ˜¯ï¼š 12345678910&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;!-- &lt;param-value&gt;classpath*:config/applicationContext.xml&lt;/param-value&gt; --&gt; &lt;param-value&gt;classpath:spring/applicationContext.xml&lt;/param-value&gt;&lt;/context-param&gt;&lt;!-- é…ç½®ä¸€ä¸ªç›‘å¬å™¨å°†è¯·æ±‚è½¬å‘ç»™ Springæ¡†æ¶ --&gt;&lt;!-- Springç›‘å¬å™¨ --&gt;&lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;&lt;/listener&gt; é€šè¿‡ContextLoadListeneræ¥å®ŒæˆSpringå®¹å™¨çš„åˆå§‹åŒ–ä»¥åŠBeançš„è£…è½½ã€ŠSpringæŠ€æœ¯å†…å¹•å­¦ä¹ ï¼šSpringçš„å¯åŠ¨è¿‡ç¨‹ã€‹ã€‚é‚£ä¹ˆå¦‚æœåœ¨æˆ‘ä»¬éœ€è¦æä¾›WEBåŠŸèƒ½ï¼Œåˆ™è¿˜éœ€è¦å¦å¤–ä¸€ä¸ªï¼Œé‚£å°±æ˜¯SpringMVC,å½“ç„¶æˆ‘ä»¬åŒæ ·éœ€è¦ä¸€ä¸ªç”¨æ¥åˆå§‹åŒ–SpringMVCçš„é…ç½®ï¼ˆåˆå§‹åŒ–9å¤§ç»„ä»¶çš„è¿‡ç¨‹ï¼šå‰é¢ä¸¤ç¯‡ã€ŠSpringMVCæºç ç³»åˆ—ï¼šHandlerMappingã€‹å’Œã€ŠSpringMVCæºç ç³»åˆ—ï¼šAbstractHandlerMappingã€‹æ˜¯å…³äºHnadlerMappingçš„ï¼Œå½“ç„¶ä¸ä»…ä»…è¿™ä¸¤ä¸ªï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªé‡è¦çš„å­ç±»ï¼Œåç»­ä¼šæŒç»­æ›´æ–°ï¼‰ï¼š 1234567891011121314151617&lt;servlet&gt; &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!-- é…ç½®springMVCéœ€è¦åŠ è½½çš„é…ç½®æ–‡ä»¶ spring-dao.xml,spring-service.xml,spring-web.xml Mybatisï¼ˆå¦‚æœæœ‰ï¼‰ - &gt; spring -&gt; springmvc --&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring/spring-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;async-supported&gt;true&lt;/async-supported&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt; &lt;!-- é»˜è®¤åŒ¹é…æ‰€æœ‰çš„è¯·æ±‚ --&gt; &lt;url-pattern&gt;*.htm&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; å½“æˆ‘ä»¬åœ¨web.xmlä¸­é…ç½®å¥½ä¸Šè¿°å†…å®¹ï¼ˆå½“ç„¶è¿˜å¾—ä¿è¯å’±ä»¬çš„Springçš„é…ç½®ä»¥åŠSpringMVCçš„é…ç½®æ–‡ä»¶æ²¡æœ‰é—®é¢˜çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¯åŠ¨webå®¹å™¨ï¼ˆå¦‚jettyï¼‰ï¼Œå°±å¯ä»¥é€šè¿‡åœ¨æµè§ˆå™¨è¾“å…¥è¯¸å¦‚ï¼šhttp://localhost:80/myproject/index.do çš„æ–¹å¼æ¥è®¿é—®æˆ‘ä»¬çš„åº”ç”¨äº†ã€‚ ä¿—è¯è¯´çŸ¥å…¶ç„¶ï¼Œä¹‹æ°”æ‰€ä»¥ç„¶ï¼›é‚£ä¹ˆä¸ºä»€ä¹ˆåœ¨é…ç½®å¥½ç›¸å…³çš„é…ç½®æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½è®¿é—®æˆ‘ä»¬çš„SSMé¡¹ç›®äº†å‘¢ï¼Ÿä»å‘é€ä¸€æ¡é‚£æ ·çš„è¯·æ±‚ï¼ˆhttp://localhost:80/myproject/index.doï¼‰å±•ç¤ºå‡ºæœ€åçš„ç•Œé¢ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨ï¼ŒSpringå¸®æˆ‘ä»¬åšäº†å“ªäº›äº‹æƒ…å‘¢ï¼Ÿï¼ˆSpringIOCå®¹å™¨çš„åˆå§‹åŒ–åœ¨ã€Š[SpringæŠ€æœ¯å†…å¹•-å®¹å™¨åˆ·æ–°ï¼šwac.refresh](https://juejin.im/post/5a3f5b43f265da432e5c37ea)ã€‹æ–‡ä¸­å·²ç»å¤§æ¦‚çš„è¯´äº†ä¸‹å¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼‰ SpringMVCå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹å…ˆé€šè¿‡ä¸‹é¢è¿™å¼ å›¾æ¥æ•´ä¸ªäº†è§£ä¸‹SpringMVCè¯·æ±‚å¤„ç†çš„è¿‡ç¨‹ï¼›å›¾ä¸­ä»1-13ï¼Œå¤§ä½“ä¸Šæè¿°äº†è¯·æ±‚ä»å‘é€åˆ°ç•Œé¢å±•ç¤ºçš„è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚ä»ä¸Šé¢è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°æœ‰ä¸€ä¸ªDispatcherServletè¿™æ ·ä¸€ä¸ªç±»ï¼Œå¤„äºå„ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­çš„åˆ†å‘ç«™ã€‚å®é™…ä¸Šï¼Œåœ¨SpringMVCä¸­ï¼Œæ•´ä¸ªå¤„ç†è¿‡ç¨‹çš„é¡¶å±‚è®¾è®¡éƒ½åœ¨è¿™é‡Œé¢ã€‚é€šå¸¸æˆ‘ä»¬å°†DispatcherServletç§°ä¸ºSpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ï¼Œå®ƒæ˜¯SpringMVCä¸­æœ€æ ¸å¿ƒçš„ç±»ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ­å¼€DispatcherServletçš„é¢çº±å§ï¼ DispatcherServletOKï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹DispatcherServletçš„ç±»å®šä¹‰ï¼š1public class DispatcherServlet extends FrameworkServlet DispatcherServletç»§æ‰¿è‡ªFrameworkServletï¼Œå°±è¿™æ ·ï¼Ÿä¸‹é¢æ‰æ˜¯ä»–å®¶çš„æ—è°±ï¼š é¦–å…ˆä¸ºä»€ä¹ˆè¦æœ‰ç»¿è‰²çš„éƒ¨é—¨ï¼Œæœ‰çš„åŒå­¦å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼Œç»¿è‰²éƒ¨åˆ†ä¸æ˜¯Springçš„ï¼Œè€Œæ˜¯javaè‡ªå·±çš„ï¼›Springé€šè¿‡HttpServletBeanè¿™ä½å¹´è½»äººæˆåŠŸçš„æ‹¥æœ‰äº†JAVA WEB è¡€ç»Ÿï¼ˆæœ¬æ¥Springå°±æ˜¯ç”¨JAVAå†™çš„ï¼Œå“ˆå“ˆï¼‰ã€‚å…³äºServletè¿™ä¸ªå°ä¼™ä¼´å¯ä»¥çœ‹ä¸‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œæœ‰ç®€å•çš„ä»‹ç»äº†è¿™ä¸ªæ¥å£ã€‚ è¯è¯´å›æ¥ï¼Œæ—¢ç„¶DispatcherServletå½’æ ¹æ­åº•æ˜¯ä¸€ä¸ªServletï¼Œé‚£ä¹ˆå°±è‚¯å®šå…·æœ‰ServletåŠŸèƒ½è¡Œä¸ºã€‚ æ•²é»‘æ¿ï¼ï¼ï¼Servletçš„ç”Ÿå‘½å‘¨æœŸæ˜¯å•¥ï¼ˆinit-&gt;service-&gt;destroy ï¼š åŠ è½½-&gt;å®ä¾‹åŒ–-&gt;æœåŠ¡-&gt;é”€æ¯ï¼‰ã€‚ å…¶å®è¿™é‡Œæˆ‘æƒ³è¯´çš„å°±æ˜¯serviceè¿™ä¸ªæ–¹æ³•ï¼Œå½“ç„¶ï¼Œåœ¨DispatcherServletä¸­å¹¶æ²¡æœ‰serviceæ–¹æ³•ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªdoServiceæ–¹æ³•ï¼ï¼ˆå¼•çš„å¥½éš¾â€¦ï¼‰ doServiceæ˜¯DispatcherServletçš„å…¥å£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748protected void doService(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; if (logger.isDebugEnabled()) &#123; String resumed = WebAsyncUtils.getAsyncManager(request).hasConcurrentResult() ? " resumed" : ""; logger.debug("DispatcherServlet with name '" + getServletName() + "'" + resumed + " processing " + request.getMethod() + " request for [" + getRequestUri(request) + "]"); &#125; // åœ¨includeçš„æƒ…å†µä¸‹ä¿ç•™è¯·æ±‚å±æ€§çš„å¿«ç…§ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨includeä¹‹åæ¢å¤åŸå§‹å±æ€§ã€‚ Map&lt;String, Object&gt; attributesSnapshot = null; //ç¡®å®šç»™å®šçš„è¯·æ±‚æ˜¯å¦æ˜¯åŒ…å«è¯·æ±‚ï¼Œå³ä¸æ˜¯ä»å¤–éƒ¨è¿›å…¥çš„é¡¶çº§HTTPè¯·æ±‚ã€‚ //æ£€æŸ¥æ˜¯å¦å­˜åœ¨â€œjavax.servlet.include.request_uriâ€è¯·æ±‚å±æ€§ã€‚ å¯ä»¥æ£€æŸ¥åªåŒ…å«è¯·æ±‚ä¸­çš„ä»»ä½•è¯·æ±‚å±æ€§ã€‚ //(å¯ä»¥çœ‹ä¸‹é¢å…³äºisIncludeRequestè§£é‡Š) if (WebUtils.isIncludeRequest(request)) &#123; attributesSnapshot = new HashMap&lt;String, Object&gt;(); Enumeration&lt;?&gt; attrNames = request.getAttributeNames(); while (attrNames.hasMoreElements()) &#123; String attrName = (String) attrNames.nextElement(); if (this.cleanupAfterInclude || attrName.startsWith("org.springframework.web.servlet")) &#123; attributesSnapshot.put(attrName, request.getAttribute(attrName)); &#125; &#125; &#125; // ä½¿æ¡†æ¶å¯ç”¨äºhandlerå’Œviewå¯¹è±¡ã€‚ request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext()); request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver); request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver); request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource()); //FlashMapç”¨äºä¿å­˜è½¬å‘è¯·æ±‚çš„å‚æ•°çš„ FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response); if (inputFlashMap != null) &#123; request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap)); &#125; request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap()); request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager); try &#123; doDispatch(request, response); &#125; finally &#123; if (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123; // Restore the original attribute snapshot, in case of an include. if (attributesSnapshot != null) &#123; restoreAttributesAfterInclude(request, attributesSnapshot); &#125; &#125; &#125;&#125; PSï¼šâ€œjavax.servlet.include.request_uriâ€æ˜¯INCLUDE_REQUEST_URI_ATTRIBUTEå¸¸é‡çš„å€¼ã€‚isIncludeRequest(request)æ–¹æ³•çš„ä½œç”¨æˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€æ¡JSPçš„æŒ‡ä»¤æ¥ç†è§£ï¼š 1&lt;jsp:incluede page="index.jsp"/&gt; è¿™æ¡æŒ‡ä»¤æ˜¯æŒ‡åœ¨ä¸€ä¸ªé¡µé¢ä¸­åµŒå¥—äº†å¦ä¸€ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“JSPåœ¨è¿è¡ŒæœŸé—´æ˜¯ä¼šè¢«ç¼–è¯‘æˆç›¸åº”çš„Servletç±»æ¥è¿è¡Œçš„ï¼Œæ‰€ä»¥åœ¨Servletä¸­ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„åŠŸèƒ½å’Œè°ƒç”¨è¯­æ³•ï¼Œè¿™å°±æ˜¯RequestDispatch.include()æ–¹æ³•ã€‚ é‚£ä¹ˆåœ¨ä¸€ä¸ªè¢«åˆ«çš„servletä½¿ç”¨RequestDispatcherçš„includeæ–¹æ³•è°ƒç”¨è¿‡çš„servletä¸­ï¼Œå¦‚æœå®ƒæƒ³çŸ¥é“é‚£ä¸ªè°ƒç”¨å®ƒçš„servletçš„ä¸Šä¸‹æ–‡ä¿¡æ¯è¯¥æ€ä¹ˆåŠå‘¢ï¼Œé‚£å°±å¯ä»¥é€šè¿‡requestä¸­çš„attributeä¸­çš„å¦‚ä¸‹å±æ€§è·å–ï¼š 12345javax.servlet.include.request_urijavax.servlet.include.context_pathjavax.servlet.include.servlet_pathjavax.servlet.include.path_infojavax.servlet.include.query_string åœ¨doServiceä¸­ï¼Œä¸‹é¢çš„tryå—ä¸­å¯ä»¥çœ‹åˆ°ï¼š 123try &#123; doDispatch(request, response);&#125; doServiceå¹¶æ²¡æœ‰ç›´æ¥è¿›è¡Œå¤„ç†ï¼ŒäºŒæ˜¯å°†è¯·æ±‚äº¤ç»™äº†doDispatchè¿›è¡Œå…·ä½“çš„å¤„ç†ã€‚å½“ç„¶åœ¨è°ƒç”¨doDispatchä¹‹å‰ï¼ŒdoServiceä¹Ÿæ˜¯åšäº†ä¸€äº›äº‹æƒ…çš„ï¼Œæ¯”å¦‚è¯´åˆ¤æ–­è¯·æ±‚æ˜¯ä¸æ˜¯incldeè¯·æ±‚ï¼Œè®¾ç½®ä¸€äº›requestå±æ€§ç­‰ã€‚ FlashMapæ”¯æ’‘çš„Redirectå‚æ•°ä¼ é€’é—®é¢˜åœ¨doServiceä¸­é™¤äº†webApplicationContextã€localeResolverã€themeResolveå’ŒthemeSourceå››ä¸ªæä¾›ç»™handlerå’Œviewä½¿ç”¨çš„å››ä¸ªå‚æ•°å¤–ï¼Œåé¢çš„ä¸‰ä¸ªéƒ½æ˜¯å’ŒFlashMapæœ‰å…³çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š1234567//FlashMapç”¨äºä¿å­˜è½¬å‘è¯·æ±‚çš„å‚æ•°çš„FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response);if (inputFlashMap != null) &#123; request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));&#125;request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap());request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager); æ³¨é‡Šä¸­æåˆ°ï¼ŒFlashMapä¸»è¦ç”¨äºRedirectè½¬å‘æ—¶å‚æ•°çš„ä¼ é€’ï¼› å°±æ‹¿è¡¨å•é‡å¤æäº¤è¿™ä¸ªé—®é¢˜æ¥è¯´,ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ï¼šåœ¨å¤„ç†å®Œpostè¯·æ±‚ä¹‹åï¼Œç„¶åRedirectåˆ°ä¸€ä¸ªgetçš„è¯·æ±‚ï¼Œè¿™æ ·å³ä½¿ç”¨æˆ·åˆ·æ–°ä¹Ÿä¸ä¼šæœ‰é‡å¤æäº¤çš„é—®é¢˜ã€‚ä½†æ˜¯é—®é¢˜åœ¨äº,å‰é¢çš„postè¯·æ±‚æ—¶æäº¤è®¢å•ï¼Œæäº¤å®Œåredirectåˆ°ä¸€ä¸ªæ˜¾ç¤ºè®¢å•çš„é¡µé¢ï¼Œæ˜¾ç„¶åœ¨æ˜¾ç¤ºè®¢å•çš„é¡µé¢æˆ‘ä»¬éœ€è¦çŸ¥é“è®¢å•çš„ä¿¡æ¯ï¼Œä½†æ˜¯redirectæœ¬èº«æ˜¯æ²¡æœ‰å‚æ•°ä¼ é€’åŠŸèƒ½çš„ï¼ŒæŒ‰ç…§æ™®é€šçš„æ¨¡å¼å¦‚æœæƒ³ä¼ é€’å‚æ•°ï¼Œå°±åªèƒ½å°†å‚æ•°æ‹¼æ¥åœ¨urlä¸­ï¼Œä½†æ˜¯urlåœ¨getè¯·æ±‚ä¸‹åˆæ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼›å¦å¤–ï¼Œå¯¹äºä¸€äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›è‡ªå·±çš„å‚æ•°æš´éœ²åœ¨urlä¸­ã€‚ å¯¹äºä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨FlashMapæ¥è¿›è¡Œå‚æ•°ä¼ é€’äº†ï¼›æˆ‘ä»¬éœ€è¦åœ¨redirectä¹‹å‰å°†éœ€è¦çš„å‚æ•°å†™å…¥OUTPUT_FLASH_MAP_ATTRIBUTEï¼Œä¾‹å¦‚ï¼š 1234ServletRequestAttributes SRAttributes = (ServletRequestAttributes)(RequestContextHolder.getRequestAttributes());HttpServletRequest req = SRAttributes.getRequest();FlashMap flashMap = (FlashMap)(req.getAttribute(DispatcherServlet.OUTPUT_FLASH_MAP_ATTRIBUTE));flashMap.put("myname","glmapper_2018"); è¿™æ ·åœ¨redirectä¹‹åçš„handlerä¸­springå°±ä¼šè‡ªåŠ¨å°†å…¶è®¾ç½®åˆ°modelé‡Œé¢ã€‚ä½†æ˜¯å¦‚æœä»…ä»…æ˜¯è¿™æ ·ï¼Œæ¯æ¬¡redirectæ—¶éƒ½å†™ä¸Šé¢é‚£æ ·ä¸€æ®µä»£ç æ˜¯ä¸æ˜¯åˆæ˜¾å¾—å¾ˆé¸¡è‚‹å‘¢ï¼Ÿå½“ç„¶ï¼Œspringä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†æ›´åŠ æ–¹ä¾¿çš„ç”¨æ³•ï¼Œå³åœ¨æˆ‘ä»¬çš„handleræ–¹æ³•çš„å‚æ•°ä¸­ä½¿ç”¨RedirectAttributesç±»å‹å˜é‡å³å¯ï¼ˆå‰æ®µæ—¶é—´ç”¨åˆ°è¿™ä¸ªï¼Œæœ¬æ¥æ˜¯æƒ³å•ç‹¬å†™ä¸€ç¯‡å…³äºå‚æ•°ä¼ é€’é—®é¢˜çš„ï¼Œå€Ÿæ­¤æœºä¼šå°±çœç•¥ä¸€ç¯‡å§ï¼Œå¼å¼â€¦ï¼‰ï¼Œæ¥çœ‹ä¸€æ®µä»£ç ï¼š 123456789101112131415161718@RequestMapping("/detail/&#123;productId&#125;")public ModelAndView detail(HttpServletRequest request,HttpServletResponse response,RedirectAttributes attributes, @PathVariable String productId) &#123; if (StringUtils.isNotBlank(productId)) &#123; logger.info("[äº§å“è¯¦æƒ…]:detail = &#123;&#125;",JSONObject.toJSONString(map)); mv.addObject("detail",JSONObject.toJSONString(getDetail(productId))); mv.addObject("title", "è¯¦æƒ…"); mv.setViewName("detail.ftl");&#125;//å¦‚æœæ²¡æœ‰è·å–åˆ°productIdelse&#123; attributes.addFlashAttribute("msg", "äº§å“ä¸å­˜åœ¨"); attributes.addFlashAttribute("productName", productName); attributes.addFlashAttribute("title", "æœ‰ç‚¹é—®é¢˜ï¼"); mv.setViewName("redirect:"/error/fail.htm");&#125;return mv;&#125; è¿™æ®µä»£ç æ—¶æˆ‘å‰æ®µæ—¶é—´åšå…¨å±€é”™è¯¯å¤„ç†æ¨¡å—æ—¶å¯¹åŸæœ‰ä¸šåŠ¡é€»è¾‘é”™è¯¯è¿”å›çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå› ä¸ºè¦å°†é”™è¯¯ç»Ÿä¸€å¤„ç†ï¼Œå°±ä¸å¯èƒ½åœ¨å…·ä½“çš„handlerä¸­ç›´æ¥è¿”å›åˆ°é”™è¯¯ç•Œé¢ï¼Œæ‰€ä»¥å°±å°†æ‰€æœ‰çš„é”™è¯¯å¤„ç†éƒ½redirectåˆ°error/fail.htmè¿™ä¸ªhandler methodä¸­å¤„ç†ã€‚redirectçš„å‚æ•°é—®é¢˜ä¸Šé¢å·²ç»æè¿°è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸åœ¨ç»†è¯´ï¼Œå°±æ˜¯ç®€å•çš„ä¾‹å­å’ŒèƒŒæ™¯ï¼ŒçŸ¥é“æ€ä¹ˆå»ä½¿ç”¨RedirectAttributesã€‚ RedirectAttributesè¿™ä¸ªåŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç›¸å½“äºå­˜åœ¨äº†ä¸€ä¸ªsessionä¸­ï¼Œä½†æ˜¯è¿™ä¸ªsessionåœ¨ç”¨è¿‡ä¸€æ¬¡ä¹‹åå°±é”€æ¯äº†ï¼Œå³åœ¨fail.htmè¿™ä¸ªæ–¹æ³•ä¸­è·å–ä¹‹åå¦‚æœå†è¿›è¡Œredirectï¼Œå‚æ•°è¿˜ä¼šä¸¢å¤±ï¼Œé‚£ä¹ˆå°±åœ¨fail.htmä¸­ç»§ç»­ä½¿ç”¨RedirectAttributesæ¥å­˜å‚¨å‚æ•°å†ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªhandlerã€‚ doDispatchæ–¹æ³•ä¸ºäº†å·æ‡’ï¼Œä¸Šé¢å¼ºè¡Œæ’å…¥äº†å¯¹Springä¸­redirectå‚æ•°ä¼ é€’é—®é¢˜çš„è§£é‡Šã€‚å›å½’åˆ°å’±ä»¬çš„doDispatchæ–¹æ³•ã€‚ ä½œç”¨ï¼šå¤„ç†å®é™…çš„è°ƒåº¦åˆ°handlerã€‚handlerå°†é€šè¿‡æŒ‰é¡ºåºåº”ç”¨servletçš„HandlerMappingsæ¥è·å¾—ã€‚HandlerAdapterå°†é€šè¿‡æŸ¥è¯¢servletå·²å®‰è£…çš„HandlerAdapteræ¥æŸ¥æ‰¾æ”¯æŒå¤„ç†ç¨‹åºç±»çš„ç¬¬ä¸€ä¸ªHandlerAdapterã€‚æ‰€æœ‰çš„HTTPæ–¹æ³•éƒ½ç”±è¿™ä¸ªæ–¹æ³•å¤„ç†ã€‚è¿™å–å†³äºHandlerAdapteræˆ–å¤„ç†ç¨‹åºè‡ªå·±å†³å®šå“ªäº›æ–¹æ³•æ˜¯å¯ä»¥æ¥å—çš„ã€‚ å…¶å®åœ¨doDispatchä¸­æœ€æ ¸å¿ƒçš„ä»£ç å°±4è¡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ï¼š æ ¹æ®requestæ‰¾åˆ°æˆ‘ä»¬çš„handler 12// Determine handler for the current request. mappedHandler = getHandler(processedRequest); æ ¹æ®handleræ‰¾åˆ°å¯¹åº”çš„HandlerAdapter 12// Determine handler adapter for the current request. HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); HandlerAdapterå¤„ç†handler 12// Actually invoke the handler. mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); è°ƒç”¨processDispatchResultæ–¹æ³•å¤„ç†ä¸Šè¿°è¿‡ç¨‹ä¸­å¾—ç»“æœç»¼åˆï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬æ‰¾åˆ°viewå¹¶ä¸”æ¸²æŸ“è¾“å‡ºç»™ç”¨æˆ·1processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException); æˆ‘ä»¬ä»¥ä¸Šè¿°ä¸ºè½´å¿ƒï¼Œæ¥çœ‹ä¸‹å®ƒçš„æ•´ä¸ªæºç (å…·ä½“ä»£ç å«ä¹‰åœ¨ä»£ç ä¸­æ ‡æ³¨)ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; //å½“å‰è¯·æ±‚request HttpServletRequest processedRequest = request; //å¤„ç†å™¨é“¾ï¼ˆhandlerå’Œæ‹¦æˆªå™¨ï¼‰ HandlerExecutionChain mappedHandler = null; //ç”¨æˆ·æ ‡è¯†multipartRequestï¼ˆæ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼‰ boolean multipartRequestParsed = false; WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request); try &#123; //å¾ˆç†Ÿæ‚‰å§ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¿”å›ç»™ç”¨æˆ·çš„åŒ…è£…è§†å›¾ ModelAndView mv = null; //å¤„ç†è¯·æ±‚è¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚è¿™ä¸ªå¼‚å¸¸æ˜¯ä¸åŒ…æ‹¬æ¸²æŸ“è¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸çš„ Exception dispatchException = null; try &#123; //æ£€æŸ¥æ˜¯ä¸æ˜¯ä¸Šä¼ è¯·æ±‚ processedRequest = checkMultipart(request); multipartRequestParsed = (processedRequest != request); // é€šè¿‡å½“å‰è¯·æ±‚ç¡®å®šç›¸åº”çš„handler mappedHandler = getHandler(processedRequest); //å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼šå°±ä¼šæŠ¥å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸æˆ‘ä»¬åœ¨æ­å»ºSpringMVCåº”ç”¨æ—¶ä¼šç»å¸¸é‡åˆ°ï¼š //No mapping found for HTTP request with URI XXX in //DispatcherServlet with name XXX if (mappedHandler == null || mappedHandler.getHandler() == null) &#123; noHandlerFound(processedRequest, response); return; &#125; // æ ¹æ®handleræ‰¾åˆ°HandlerAdapter HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); //å¤„ç†GETå’ŒHeadè¯·æ±‚çš„Last-Modified //è·å–è¯·æ±‚æ–¹æ³• String method = request.getMethod(); //è¿™ä¸ªæ–¹æ³•æ˜¯ä¸æ˜¯GETæ–¹æ³• boolean isGet = "GET".equals(method); if (isGet || "HEAD".equals(method)) &#123; long lastModified = ha.getLastModified(request, mappedHandler.getHandler()); if (logger.isDebugEnabled()) &#123; logger.debug("Last-Modified value for [" + getRequestUri(request) + "] is: " + lastModified); &#125; if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123; return; &#125; &#125; //è¿™é‡Œå°±æ˜¯æˆ‘ä»¬SpringMVCæ‹¦æˆªå™¨çš„preHandleæ–¹æ³•çš„å¤„ç† if (!mappedHandler.applyPreHandle(processedRequest, response)) &#123; return; &#125; // è°ƒç”¨å…·ä½“çš„Handlerï¼Œå¹¶ä¸”è¿”å›æˆ‘ä»¬çš„mvå¯¹è±¡. mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); //å¦‚æœéœ€è¦å¼‚æ­¥å¤„ç†çš„è¯å°±ç›´æ¥è¿”å› if (asyncManager.isConcurrentHandlingStarted()) &#123; return; &#125; //è¿™ä¸ªå…¶å®å°±æ˜¯å¤„ç†è§†å›¾ï¼ˆviewï¼‰ä¸ºç©ºçš„æƒ…å†µï¼Œä¼šæ ¹æ®requestè®¾ç½®é»˜è®¤çš„view applyDefaultViewName(processedRequest, mv); //è¿™é‡Œå°±æ˜¯æˆ‘ä»¬SpringMVCæ‹¦æˆªå™¨çš„postHandleæ–¹æ³•çš„å¤„ç† mappedHandler.applyPostHandle(processedRequest, response, mv); &#125; catch (Exception ex) &#123; dispatchException = ex; &#125; catch (Throwable err) &#123; // As of 4.3, we're processing Errors thrown from handler methods as well, // making them available for @ExceptionHandler methods and other scenarios. dispatchException = new NestedServletException("Handler dispatch failed", err); &#125; //å¤„ç†è¿”å›ç»“æœï¼›ï¼ˆå¼‚å¸¸å¤„ç†ã€é¡µé¢æ¸²æŸ“ã€æ‹¦æˆªå™¨çš„afterCompletionè§¦å‘ç­‰ï¼‰ processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException); &#125; catch (Exception ex) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, ex); &#125; catch (Throwable err) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, new NestedServletException("Handler processing failed", err)); &#125; finally &#123; //åˆ¤æ–­æ˜¯å¦æ‰§è¡Œå¼‚æ­¥è¯·æ±‚ if (asyncManager.isConcurrentHandlingStarted()) &#123; // å¦‚æœæ˜¯çš„è¯ï¼Œå°±æ›¿ä»£æ‹¦æˆªå™¨çš„postHandle å’Œ afterCompletionæ–¹æ³•æ‰§è¡Œ if (mappedHandler != null) &#123; mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response); &#125; &#125; else &#123; // åˆ é™¤ä¸Šä¼ è¯·æ±‚çš„èµ„æº if (multipartRequestParsed) &#123; cleanupMultipart(processedRequest); &#125; &#125; &#125;&#125; æ•´ä½“æ¥çœ‹ï¼ŒdoDispatchåšäº†ä¸¤ä»¶äº‹æƒ…ï¼š å¤„ç†è¯·æ±‚ é¡µé¢æ¸²æŸ“ doDispatchå¤„ç†è¿‡ç¨‹æµç¨‹å›¾ é‚£ä¸Šé¢å°±æ˜¯æ•´ä¸ªDispatcherServletçš„ä¸€ä¸ªå¤§æ¦‚å†…å®¹äº†ï¼Œå…³äºSpringMVCå®¹å™¨çš„åˆå§‹åŒ–ï¼Œæˆ‘ä»¬åœ¨å…ˆæŠŠDispatcherServletä¸­æ¶‰åŠåˆ°çš„ä¹å¤§ç»„ä»¶æ’¸å®Œä¹‹åå†å›å¤´æ¥å­¦ä¹ ã€‚å…³äºä¹å¤§ç»„ä»¶ç›®å‰å·²ç»æœ‰è¿‡ä¸¤ç¯‡æ˜¯å…³äºHandlerMappingçš„äº†ï¼Œç”±äºæˆ‘ä»¬æ‰“ç®—å¯¹äºæ•´ä¸ªSpringMVCä½“ç³»ç»“æ„éƒ½è¿›è¡Œä¸€æ¬¡æ¢³ç†ï¼Œå› æ­¤ï¼Œä¼šå°†ä¹å¤§ç»„ä»¶ä»æ¥å£è®¾è®¡ä»¥åŠå­ç±»éƒ½ä¼šé€šè¿‡æºç çš„æ–¹å¼æ¥å‘ˆç°ã€‚ å¤§å®¶å¦‚æœæœ‰ä»€ä¹ˆæ„è§æˆ–è€…å»ºè®®å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€ï¼Œä¹Ÿå¯ä»¥ç»™æˆ‘ä»¬å‘é‚®ä»¶ï¼ˆglmapper_2018@163.comï¼‰!æ¬¢è¿å°ä¼™ä¼´ä¸æˆ‘ä»¬ä¸€èµ·äº¤æµï¼Œä¸€èµ·æˆé•¿ã€‚]]></content>
      <categories>
        <category>spring mvc</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>web</tag>
        <tag>mvc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringMVCæºç ç³»åˆ—ï¼šAbstractHandlerMapping]]></title>
    <url>%2F2018%2F11%2F10%2Fspring-base-webmvc2%2F</url>
    <content type="text"><![CDATA[AbstractHandlerMappingæ˜¯å®ç°HandlerMappingæ¥å£çš„ä¸€ä¸ªæŠ½è±¡åŸºç±»ã€‚æ”¯æŒæ’åºï¼Œé»˜è®¤å¤„ç†ç¨‹åºï¼Œå¤„ç†ç¨‹åºæ‹¦æˆªå™¨ï¼ŒåŒ…æ‹¬ç”±è·¯å¾„æ¨¡å¼æ˜ å°„çš„å¤„ç†ç¨‹åºæ‹¦æˆªå™¨ã€‚æ‰€æœ‰çš„HandlerMappingéƒ½ç»§æ‰¿è‡ªAbstractHandlerMappingã€‚å¦å¤–ï¼Œæ­¤åŸºç±»ä¸æ”¯æŒPATH_WITHIN_HANDLER_MAPPING_ATTRIBUTEçš„æš´éœ²ï¼Œæ­¤å±æ€§çš„æ”¯æŒå–å†³äºå…·ä½“çš„å­ç±»ï¼Œé€šå¸¸åŸºäºè¯·æ±‚URLæ˜ å°„ã€‚ å‰é¢è¯´åˆ°ï¼ŒHandlerMappingçš„ä½œç”¨å°±æ˜¯é€šè¿‡requestæŸ¥æ‰¾Handlerå’ŒInterceptorsã€‚å…·ä½“çš„è·å–å‡æ˜¯é€šè¿‡å­ç±»æ¥å®ç°çš„ã€‚ 1.AbstractHandlerMapping çš„ç±»å®šä¹‰12public abstract class AbstractHandlerMapping extends WebApplicationObjectSupport implements HandlerMapping, Ordered &#123; AbstractHandlerMappingç»§æ‰¿äº†WebApplicationObjectSupportï¼Œåˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æ¨¡æ¿æ–¹æ³•initApplicationContextï¼›AbstractHandlerMappingçš„åˆ›å»ºä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å®Œæˆçš„ã€‚åŒæ—¶å®ç°äº†HandlerMappingå’ŒOrderedæ¥å£ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„æ”¯æŒæ’åºçš„åŸå› ã€‚ 2.AbstractHandlerMappingå±æ€§åˆ†æ æ’åºå€¼ order é»˜è®¤å€¼ä¸ºIntegerçš„æœ€å¤§å€¼ï¼Œåé¢æ³¨é‡Šçš„æ„æ€æ˜¯å’Œæ²¡æœ‰æ’åºæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºåªæœ‰ç†è®ºä¸Šæ‰å¯èƒ½è¶…è¿‡Integer.MAX_VALUEã€‚ 1private int order = Integer.MAX_VALUE; // default: same as non-Ordered é»˜è®¤å¤„ç†å™¨ defaultHandler 1private Object defaultHandler; Springå·¥å…·ç±» urlPathHelper Helperç±»ç”¨äºURLè·¯å¾„åŒ¹é…ã€‚æä¾›å¯¹RequestDispatcherä¸­URLè·¯å¾„çš„æ”¯æŒï¼ŒåŒ…æ‹¬å¹¶æ”¯æŒä¸€è‡´çš„URLè§£ç ã€‚ 1private UrlPathHelper urlPathHelper = new UrlPathHelper(); springå·¥å…·ç±» PathMatcher(AntPathMatcher) ç”¨äºåŸºäºå­—ç¬¦ä¸²çš„è·¯å¾„åŒ¹é…çš„ç­–ç•¥æ¥å£ã€‚ 1private PathMatcher pathMatcher = new AntPathMatcher(); æ‹¦æˆªå™¨åˆ—è¡¨ interceptors ç”¨äºé…ç½®SpringMVCçš„æ‹¦æˆªå™¨ï¼Œé…ç½®æ–¹å¼ç”±ä¸¤ç§ï¼š 1.æ³¨å†ŒHandlerMappingæ—¶é€šè¿‡å±æ€§è®¾ç½® 2.é€šè¿‡å­ç±»çš„extendInterceptorsé’©å­æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼ˆextendInterceptorsæ–¹æ³•æ˜¯åœ¨initApplicationContextä¸­è°ƒç”¨çš„ï¼‰ interceptorså¹¶ä¸ä¼šç›´æ¥ä½¿ç”¨ï¼ŒäºŒæ˜¯é€šè¿‡initInterceptorsæ–¹æ³•æŒ‰ç…§ç±»å‹åˆ†é…åˆ°mappedInterceptorså’ŒadaptedInterceptorsä¸­è¿›è¡Œä½¿ç”¨ï¼Œinterceptorsåªç”¨äºé…ç½®ã€‚ 1private final List&lt;Object&gt; interceptors = new ArrayList&lt;Object&gt;(); adaptedInterceptors è¢«åˆ†é…åˆ°adaptedInterceptorsä¸­çš„ç±»å‹çš„æ‹¦æˆªå™¨ä¸éœ€è¦è¿›è¡ŒåŒ¹é…ï¼Œåœ¨getHandlerä¸­ä¼šå…¨éƒ¨æ·»åŠ åˆ°è¿”å›å€¼HandlerExecutionChainé‡Œé¢ã€‚ä»– åªèƒ½ä» interceptorsä¸­è·å–ã€‚ 1private final List&lt;HandlerInterceptor&gt; adaptedInterceptors = new ArrayList&lt;HandlerInterceptor&gt;(); corsProcessor CorsProcessorä½œç”¨æ˜¯æ¥å—è¯·æ±‚å’ŒCorsConfigurationå¹¶æ›´æ–°å“åº”çš„ç­–ç•¥ã€‚ æ­¤ç»„ä»¶ä¸å…³å¿ƒå¦‚ä½•é€‰æ‹©CorsConfigurationï¼Œè€Œæ˜¯é‡‡å–åç»­æ“ä½œï¼Œä¾‹å¦‚åº”ç”¨CORSéªŒè¯æ£€æŸ¥ï¼Œå¹¶æ‹’ç»å“åº”æˆ–å°†CORSå¤´æ·»åŠ åˆ°å“åº”ä¸­ã€‚ 1private CorsProcessor corsProcessor = new DefaultCorsProcessor(); corsConfigSource æ ¹æ®è·¯å¾„æ¨¡å¼ä¸Šæ˜ å°„çš„CorsConfigurationé›†åˆæä¾›æ¯ä¸ªè¯·æ±‚çš„CorsConfigurationå®ä¾‹ã€‚æ”¯æŒç²¾ç¡®çš„è·¯å¾„æ˜ å°„URIï¼ˆå¦‚â€œ/ adminâ€ï¼‰ä»¥åŠAntæ ·å¼çš„è·¯å¾„æ¨¡å¼ï¼ˆå¦‚â€œ/ admin / **â€ï¼‰ 12private final UrlBasedCorsConfigurationSource corsConfigSource = new UrlBasedCorsConfigurationSource(); è·¨åŸŸç›¸å…³é—®é¢˜ CorsConfiguration å…·ä½“å°è£…è·¨åŸŸé…ç½®ä¿¡æ¯çš„pojoCorsConfigurationSource requestä¸è·¨åŸŸé…ç½®ä¿¡æ¯æ˜ å°„çš„å®¹å™¨CorsProcessor å…·ä½“è¿›è¡Œè·¨åŸŸæ“ä½œçš„ç±» 3.AbstractHandlerMapping ä¸­çš„get&amp;setæ–¹æ³•3.1 setOrderæŒ‡å®šæ­¤HandlerMapping beançš„æ’åºå€¼ã€‚123public final void setOrder(int order) &#123; this.order = order;&#125; 3.2 setDefaultHandleræŒ‡å®šæ­¤HandlerMapping beançš„æ’åºå€¼ã€‚è®¾ç½®æ­¤å¤„ç†ç¨‹åºæ˜ å°„çš„é»˜è®¤å¤„ç†ç¨‹åºã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç‰¹å®šçš„æ˜ å°„ï¼Œè¿™ä¸ªå¤„ç†ç¨‹åºå°†è¢«è¿”å›ã€‚ç¼ºçœå€¼ä¸ºnullï¼Œè¡¨ç¤ºæ²¡æœ‰é»˜è®¤å¤„ç†ç¨‹åºã€‚123public void setDefaultHandler(Object defaultHandler) &#123; this.defaultHandler = defaultHandler;&#125; 3.3 getDefaultHandlerè¿”å›æ­¤å¤„ç†ç¨‹åºæ˜ å°„çš„é»˜è®¤å¤„ç†ç¨‹åºï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›nullã€‚123public Object getDefaultHandler() &#123; return this.defaultHandler;&#125; 3.4 setAlwaysUseFullPathå¦‚æœURLæŸ¥æ‰¾å§‹ç»ˆä½¿ç”¨å½“å‰servletä¸Šä¸‹æ–‡ä¸­çš„å®Œæ•´è·¯å¾„ï¼Œè¯·è¿›è¡Œè®¾ç½®ã€‚ å¦åˆ™ï¼Œå¦‚æœé€‚ç”¨ï¼Œåˆ™ä½¿ç”¨å½“å‰servletæ˜ å°„ä¸­çš„è·¯å¾„ï¼ˆå³ï¼Œåœ¨web.xmlä¸­â€œâ€¦ / *â€servletæ˜ å°„çš„æƒ…å†µä¸‹ï¼‰ã€‚é»˜è®¤æ˜¯â€œfalseâ€ã€‚setAlwaysUseFullPathä¸­çš„å®ç°å…·ä½“æ˜¯å§”æ‰˜ç»™urlPathHelperå’ŒcorsConfigSourceæ¥å®Œæˆçš„ã€‚1234public void setAlwaysUseFullPath(boolean alwaysUseFullPath) &#123; this.urlPathHelper.setAlwaysUseFullPath(alwaysUseFullPath); this.corsConfigSource.setAlwaysUseFullPath(alwaysUseFullPath);&#125; 3.5 setUrlDecodeå¦‚æœä¸Šä¸‹æ–‡è·¯å¾„å’Œè¯·æ±‚URIåº”è¯¥è¢«URLè§£ç ï¼Œåˆ™è®¾ç½®ã€‚ä¸¤è€…éƒ½æ˜¯ç”±Servlet APIè¿”å›â€œundecodedâ€ï¼Œä¸servletè·¯å¾„ç›¸åã€‚æ ¹æ®Servletè§„èŒƒï¼ˆISO-8859-1ï¼‰ä½¿ç”¨è¯·æ±‚ç¼–ç æˆ–é»˜è®¤ç¼–ç ã€‚setUrlDecodeä¸­çš„å®ç°å…·ä½“æ˜¯å§”æ‰˜ç»™urlPathHelperå’ŒcorsConfigSourceæ¥å®Œæˆçš„ã€‚1234public void setUrlDecode(boolean urlDecode) &#123; this.urlPathHelper.setUrlDecode(urlDecode); this.corsConfigSource.setUrlDecode(urlDecode);&#125; 3.6 setRemoveSemicolonContentå¦‚æœâ€œ;â€ ï¼ˆåˆ†å·ï¼‰å†…å®¹åº”è¯¥ä»è¯·æ±‚URIä¸­å»é™¤,åˆ™è®¾ç½®ã€‚é»˜è®¤å€¼æ˜¯trueã€‚setRemoveSemicolonContentä¸­çš„å®ç°å…·ä½“æ˜¯å§”æ‰˜ç»™urlPathHelperå’ŒcorsConfigSourceæ¥å®Œæˆçš„ã€‚1234public void setRemoveSemicolonContent(boolean removeSemicolonContent) &#123; this.urlPathHelper.setRemoveSemicolonContent(removeSemicolonContent); this.corsConfigSource.setRemoveSemicolonContent(removeSemicolonContent);&#125; 3.7 setUrlPathHelperè®¾ç½®UrlPathHelperä»¥ç”¨äºè§£ææŸ¥æ‰¾è·¯å¾„ã€‚ä½¿ç”¨å®ƒå¯ä»¥ç”¨è‡ªå®šä¹‰å­ç±»è¦†ç›–é»˜è®¤çš„UrlPathHelperï¼Œæˆ–è€…è·¨å¤šä¸ªHandlerMappingså’ŒMethodNameResolverså…±äº«é€šç”¨çš„UrlPathHelperè®¾ç½®ã€‚12345public void setUrlPathHelper(UrlPathHelper urlPathHelper) &#123; Assert.notNull(urlPathHelper, &quot;UrlPathHelper must not be null&quot;); this.urlPathHelper = urlPathHelper; this.corsConfigSource.setUrlPathHelper(urlPathHelper);&#125; 3.8 getUrlPathHelperè¿”å›UrlPathHelperå®ç°ä»¥ç”¨äºè§£ææŸ¥æ‰¾è·¯å¾„ã€‚123public UrlPathHelper getUrlPathHelper() &#123; return urlPathHelper;&#125; 3.9 setPathMatcherå°†PathMatcherå®ç°è®¾ç½®ä¸ºç”¨äºåŒ¹é…æ³¨å†Œçš„URLæ¨¡å¼çš„URLè·¯å¾„ã€‚ é»˜è®¤æ˜¯AntPathMatcherã€‚12345public void setPathMatcher(PathMatcher pathMatcher) &#123; Assert.notNull(pathMatcher, &quot;PathMatcher must not be null&quot;); this.pathMatcher = pathMatcher; this.corsConfigSource.setPathMatcher(pathMatcher);&#125; 3.10 setInterceptorsè®¾ç½®æ‹¦æˆªå™¨ä»¥åº”ç”¨æ­¤å¤„ç†ç¨‹åºæ˜ å°„æ˜ å°„çš„æ‰€æœ‰å¤„ç†ç¨‹åºã€‚æ”¯æŒçš„æ‹¦æˆªå™¨ç±»å‹æ˜¯HandlerInterceptorï¼ŒWebRequestInterceptorå’ŒMappedInterceptorã€‚æ˜ å°„æ‹¦æˆªå™¨ä»…é€‚ç”¨äºè¯·æ±‚ä¸å…¶è·¯å¾„æ¨¡å¼ç›¸åŒ¹é…çš„URLã€‚æ˜ å°„çš„æ‹¦æˆªå™¨Beanåœ¨åˆå§‹åŒ–æœŸé—´ä¹Ÿä¼šæŒ‰ç±»å‹æ£€æµ‹åˆ°ã€‚123ublic void setInterceptors(Object... interceptors) &#123; this.interceptors.addAll(Arrays.asList(interceptors));&#125; å…¶ä»–å‡ ä¸ªget&amp;setæ–¹æ³•å°±ä¸åˆ—å‡ºæ¥äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œé˜…è¯»... 4. AbstractHandlerMappingçš„åˆ›å»ºå› ä¸ºAbstractHandlerMappingç»§æ‰¿äº†WebApplicationObjectSupportç±»ï¼Œå› æ­¤AbstractHandlerMappingçš„åˆ›å»ºå°±æ˜¯ä¾æ‰˜äºæ¨¡æ¿æ–¹æ³•initApplicationContextæ¥å®Œæˆçš„ã€‚123456@Overrideprotected void initApplicationContext() throws BeansException &#123; extendInterceptors(this.interceptors); detectMappedInterceptors(this.adaptedInterceptors); initInterceptors();&#125; ä»æ–¹æ³•ç»“æ„å¯ä»¥äº†è§£åˆ°ï¼ŒinitApplicationContextä¸­åŒ…æ‹¬ä¸‰ä¸ªå­å¤„ç†æ–¹æ³•ã€‚ extendInterceptorsï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œåœ¨AbstractHandlerMappingä¸­å¹¶æ²¡æœ‰å…·ä½“å®ç°ï¼ˆæ–¹æ³•ä½“æ˜¯ç©ºçš„ï¼‰ï¼Œä¸»è¦æ˜¯ç”¨äºç»™å­ç±»æä¾›ä¸€ä¸ªæ·»åŠ ï¼ˆä¿®æ”¹ï¼‰Interceptorsçš„å…¥å£ï¼ˆç°æœ‰çš„SpringMVCå®ç°ä¸­å‡æœªä½¿ç”¨ï¼‰ã€‚ detectMappedInterceptorsï¼šç”¨äºå°†SpringMVCå®¹å™¨åŠçˆ¶å®¹å™¨ä¸­çš„æ‰€æœ‰MappedInterceptorç±»å‹çš„Beanæ·»åŠ åˆ°MappedInterceptorså±æ€§ä¸­ã€‚ æ£€æµ‹MappedInterceptorç±»å‹çš„beanï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æ˜ å°„çš„æ‹¦æˆªå™¨åˆ—è¡¨ä¸­ã€‚ é™¤äº†å¯èƒ½é€šè¿‡setInterceptorsæä¾›çš„ä»»ä½•MappedInterceptorsä¹‹å¤–ï¼Œè¿˜ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä»å½“å‰ä¸Šä¸‹æ–‡åŠå…¶ç¥–å…ˆä¸­æ·»åŠ æ‰€æœ‰MappedInterceptorç±»å‹çš„Beanã€‚å­ç±»å¯ä»¥è¦†ç›–å’Œä¼˜åŒ–è¿™ä¸ªç­–ç•¥ã€‚ 12345protected void detectMappedInterceptors(List&lt;HandlerInterceptor&gt; mappedInterceptors) &#123; mappedInterceptors.addAll( BeanFactoryUtils.beansOfTypeIncludingAncestors( getApplicationContext(), MappedInterceptor.class, true, false).values());&#125; initInterceptorsï¼šåˆå§‹åŒ–æŒ‡å®šçš„æ‹¦æˆªå™¨ï¼Œæ£€æŸ¥MappedInterceptorså¹¶æ ¹æ®éœ€è¦è°ƒæ•´HandlerInterceptorså’ŒWebRequestInterceptorsã€‚ï¼ˆå½“å‰Springç‰ˆæœ¬æ—¶4.3.6ï¼‰ 1234567891011protected void initInterceptors() &#123; if (!this.interceptors.isEmpty()) &#123; for (int i = 0; i &lt; this.interceptors.size(); i++) &#123; Object interceptor = this.interceptors.get(i); if (interceptor == null) &#123; throw new IllegalArgumentException(&quot;Entry number &quot; + i + &quot; in interceptors array is null&quot;); &#125; this.adaptedInterceptors.add(adaptInterceptor(interceptor)); &#125; &#125;&#125; è¿™ä¸ªæ˜¯4.1.5ç‰ˆæœ¬çš„initInterceptorsæ–¹æ³•ï¼š 12345678910111213141516protected void initInterceptors() &#123; if (!this.interceptors.isEmpty()) &#123; for (int i = 0; i &lt; this.interceptors.size(); i++) &#123; Object interceptor = this.interceptors.get(i); if (interceptor == null) &#123; throw new IllegalArgumentException(&quot;Entry number &quot; + i + &quot; in interceptors array is null&quot;); &#125; if (interceptor instanceof MappedInterceptor) &#123; this.mappedInterceptors.add((MappedInterceptor) interceptor); &#125; else &#123; this.adaptedInterceptors.add(adaptInterceptor(interceptor)); &#125; &#125; &#125; &#125; åœ¨4.1.5ä¸­ç‰ˆæœ¬ä¸­ï¼ŒinitInterceptorsçš„å·¥ä½œæ˜¯å°†interceptorså±æ€§é‡Œé¢æ‰€åŒ…å«çš„å¯¹è±¡æŒ‰ç…§ç±»å‹æ·»åŠ åˆ°adaptedInterceptorsæˆ–è€…mappedInterceptorsä¸­ã€‚åœ¨4.1.5ç‰ˆæœ¬ä¸­mappedInterceptorsæ˜¯AbstractHandlerMappingçš„å±æ€§ä¹‹ä¸€ã€‚ä¸»è¦åŸå› æ˜¯å› ä¸ºï¼ŒspringMVCè‡ª4.2å¼€å§‹æ·»åŠ äº†è·¨åŸŸçš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å±æ€§ä¸­çš„åä¸¤ä¸ªã€‚PSï¼šåœ¨é˜…è¯»Springç›¸å…³æºç æ—¶éœ€è¦å…³æ³¨ä¸åŒç‰ˆæœ¬çš„å˜æ›´åŠåŒºåˆ«ï¼Œä¸è¦åªå…³æ³¨æŸä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦å¤–å°±æ˜¯ä¸ªäººè§‰å¾—é˜…è¯»æºç çš„å…³æ³¨ç‚¹åº”è¯¥åœ¨ç¼–ç æ–¹å¼ã€è®¾è®¡æ¨¡å¼ä½¿ç”¨ã€è®¾è®¡æ€æƒ³åŠç†å¿µï¼Œè€Œä¸ä»…ä»…æ˜¯çŸ¥é“ä»–æ˜¯å¦‚ä½•å®ç°çš„ã€‘ è¿™é‡Œé¡ºä¾¿è¯´ä¸‹mappedInterceptorsçš„ä½œç”¨ï¼šmappedInterceptorsä¸­çš„æ‹¦æˆªå™¨åœ¨ä½¿ç”¨æ—¶éœ€è¦ä¸è¯·æ±‚çš„urlè¿›è¡ŒåŒ¹é…ï¼Œåªæœ‰åŒ¹é…æˆåŠŸåæ‰ä¼šæ·»åŠ åˆ°getHandlerçš„è¿”å›å€¼HandlerExecytionChainé‡Œã€‚ adaptInterceptoræ–¹æ³•: ä½¿ç»™å®šçš„æ‹¦æˆªå™¨å¯¹è±¡é€‚é…HandlerInterceptoræ¥å£ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ”¯æŒçš„æ‹¦æˆªå™¨ç±»å‹æ˜¯HandlerInterceptorå’ŒWebRequestInterceptorã€‚æ¯ä¸ªç»™å®šçš„WebRequestInterceptorå°†è¢«å°è£…åœ¨WebRequestHandlerInterceptorAdapterä¸­ã€‚å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™ã€‚1234567891011protected HandlerInterceptor adaptInterceptor(Object interceptor) &#123; if (interceptor instanceof HandlerInterceptor) &#123; return (HandlerInterceptor) interceptor; &#125; else if (interceptor instanceof WebRequestInterceptor) &#123; return new WebRequestHandlerInterceptorAdapter((WebRequestInterceptor) interceptor); &#125; else &#123; throw new IllegalArgumentException(&quot;Interceptor type not supported: &quot; + interceptor.getClass().getName()); &#125;&#125; 5.Handlerå’ŒInterceptorçš„è·å–HandlerMappingæ˜¯é€šè¿‡getHandleræ–¹æ³•æ¥è·å–Handlerå’ŒInterceptorçš„ã€‚å› æ­¤åœ¨æŠ½è±¡åŸºç±»AbstractHandlerMappingä¸­æä¾›äº†å…·ä½“çš„å®ç°ã€‚å¹¶ä¸”åœ¨AbstractHandlerMappingä¸­ï¼ŒgetHandlerä½¿ç”¨finalå…³é”®å­—ä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»ä¸èƒ½å†è¿›è¡Œå¯¹æ­¤æ–¹æ³•è¿›è¡Œè¦†ç›–é‡å†™äº†ã€‚ getHandlerçš„ä½œç”¨å°±æ˜¯æŸ¥æ‰¾ç»™å®šè¯·æ±‚çš„handlerï¼Œå¦‚æœæ‰¾ä¸åˆ°ç‰¹å®šè¯·æ±‚ï¼Œåˆ™è¿”å›åˆ°é»˜è®¤handlerã€‚123456789101112131415161718192021222324252627282930@Overridepublic final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception &#123; //é€šè¿‡getHandlerInternalæ–¹æ³•æ¥è·å–handler Object handler = getHandlerInternal(request); //å¦‚æœå‰ä¸€ä¸ªæ–¹æ³•æ²¡æœ‰è·å–åˆ°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„handler if (handler == null) &#123; //é»˜è®¤çš„Handlerå°±æ˜¯AbstractHandlerMappingä¸­çš„handlerå±æ€§é€šè¿‡setå¾—åˆ°çš„å€¼ handler = getDefaultHandler(); &#125; //å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°Handerï¼Œåˆ™ç›´æ¥è¿”å›Null if (handler == null) &#123; return null; &#125; // Bean name or resolved handler? //å¦‚æœæ‰¾åˆ°çš„handleræ˜¯Stringç±»å‹çš„ï¼Œ if (handler instanceof String) &#123; //åˆ™ä»¥å®ƒä¸ºååˆ°spring Mvcçš„å®¹å™¨ä¸­æŸ¥æ‰¾ç›¸åº”çš„Bean String handlerName = (String) handler; handler = getApplicationContext().getBean(handlerName); &#125; //å…ˆæ ¹æ®handlerå’Œrequeståˆ›å»ºä¸€ä¸ªHandlerExecutionChainå¯¹è±¡ï¼Œ HandlerExecutionChain executionChain = getHandlerExecutionChain(handler, request); if (CorsUtils.isCorsRequest(request)) &#123; CorsConfiguration globalConfig = this.corsConfigSource.getCorsConfiguration(request); CorsConfiguration handlerConfig = getCorsConfiguration(handler, request); CorsConfiguration config = (globalConfig != null ? globalConfig.combine(handlerConfig) : handlerConfig); executionChain = getCorsHandlerExecutionChain(request, executionChain, config); &#125; return executionChain;&#125; getHandlerInternalï¼š 1protected abstract Object getHandlerInternal(HttpServletRequest request) throws Exception; æŸ¥æ‰¾ç»™å®šè¯·æ±‚çš„handlerï¼Œå¦‚æœæ‰¾ä¸åˆ°ç‰¹å®šè¯·æ±‚ï¼Œåˆ™è¿”å›nullã€‚ è¿™ä¸ªæ–¹æ³•è¢«getHandlerè°ƒç”¨; å¦‚æœè®¾ç½®äº†nullè¿”å›å€¼ï¼Œå°†å¯¼è‡´é»˜è®¤handlerã€‚åœ¨CORS pre-flightè¯·æ±‚ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•åº”è¯¥è¿”å›ä¸€ä¸ªä¸åŒ¹é…é£è¡Œå‰è¯·æ±‚çš„åŒ¹é…é¡¹ï¼Œè€Œæ˜¯æ ¹æ®URLè·¯å¾„ï¼Œâ€œAccess-Control-Request-Methodâ€å¤´ä¸­çš„HTTPæ–¹æ³•å’Œå¤´æ–‡ä»¶ ä»â€œAccess-Control-Request-Headersâ€å¤´éƒ¨è·å¾—ï¼Œä»è€Œå…è®¸CORSé…ç½®é€šè¿‡getCorsConfigurationsè·å¾—ï¼Œæ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªé¢„å…ˆæ„å»ºçš„HandlerExecutionChainï¼Œå°†ä¸€ä¸ªå¤„ç†ç¨‹åºå¯¹è±¡ä¸åŠ¨æ€ç¡®å®šçš„æ‹¦æˆªå™¨ç»„åˆåœ¨ä¸€èµ·ã€‚çŠ¶æ€æŒ‡å®šçš„æ‹¦æˆªå™¨å°†è¢«åˆå¹¶åˆ°è¿™ä¸ªç°æœ‰çš„é“¾ä¸­ã€‚ getHandlerExecutionChainï¼š getLookupPathForRequest:è¿”å›ç»™å®šè¯·æ±‚çš„æ˜ å°„æŸ¥æ‰¾è·¯å¾„ï¼Œå¦‚æœé€‚ç”¨çš„è¯ï¼Œåœ¨å½“å‰çš„servletæ˜ å°„ä¸­ï¼Œæˆ–è€…åœ¨webåº”ç”¨ç¨‹åºä¸­è¿”å›ã€‚å¦‚æœåœ¨RequestDispatcherä¸­è°ƒç”¨includeè¯·æ±‚ï¼Œåˆ™æ£€æµ‹åŒ…å«è¯·æ±‚URLã€‚1234567891011121314151617181920212223protected HandlerExecutionChain getHandlerExecutionChain(Object handler, HttpServletRequest request) &#123; //å¦‚æœhandleræ˜¯HandlerExecutionChainç±»å‹åˆ™ç›´æ¥å¼ºè½¬ä¸ºHandlerExecutionChainç±»å‹ï¼Œ //å¦‚æœä¸æ˜¯åˆ™æ ¹æ®handleråˆ›å»ºä¸€ä¸ªæ–°çš„HandlerExecutionChainå®ä¾‹å¯¹è±¡ HandlerExecutionChain chain = (handler instanceof HandlerExecutionChain ? (HandlerExecutionChain) handler : new HandlerExecutionChain(handler)); //è¿”å›ç»™å®šè¯·æ±‚çš„æ˜ å°„æŸ¥æ‰¾è·¯å¾„ String lookupPath = this.urlPathHelper.getLookupPathForRequest(request); //éå†å½“å‰adaptedInterceptorsé“¾è¡¨ for (HandlerInterceptor interceptor : this.adaptedInterceptors) &#123; //å¦‚æœæ˜¯MappedInterceptorç±»å‹åˆ™ if (interceptor instanceof MappedInterceptor) &#123; MappedInterceptor mappedInterceptor = (MappedInterceptor) interceptor; //æ‹¦æˆªå™¨æ˜¯å¦åº”ç”¨äºç»™å®šçš„è¯·æ±‚è·¯å¾„ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›true if (mappedInterceptor.matches(lookupPath, this.pathMatcher)) &#123; chain.addInterceptor(mappedInterceptor.getInterceptor()); &#125; &#125; else &#123; chain.addInterceptor(interceptor); &#125; &#125; return chain;&#125; ä¸ºç»™å®šçš„handleræ„å»ºä¸€ä¸ªHandlerExecutionChainï¼ŒåŒ…æ‹¬å¯ç”¨çš„æ‹¦æˆªå™¨ã€‚é»˜è®¤å®ç°ç”¨ç»™å®šçš„handlerï¼Œhandleræ˜ å°„çš„é€šç”¨æ‹¦æˆªå™¨ä»¥åŠä¸å½“å‰è¯·æ±‚URLç›¸åŒ¹é…çš„ä»»ä½•MappedInterceptorsæ„å»ºæ ‡å‡†çš„HandlerExecutionChainã€‚æ‹¦æˆªå™¨æŒ‰ç…§ä»–ä»¬æ³¨å†Œçš„é¡ºåºæ·»åŠ ã€‚ä¸ºäº†æ‰©å±•/é‡æ–°æ’åˆ—æ‹¦æˆªå™¨åˆ—è¡¨ï¼Œå­ç±»å¯ä»¥è¦†ç›–å®ƒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼ å…¥çš„handlerå¯¹è±¡å¯èƒ½æ˜¯åŸå§‹handleræˆ–é¢„æ„å»ºçš„HandlerExecutionChainã€‚è¿™ä¸ªæ–¹æ³•åº”è¯¥æ˜ç¡®åœ°å¤„ç†è¿™ä¸¤ç§æƒ…å†µï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„HandlerExecutionChainæˆ–è€…æ‰©å±•ç°æœ‰çš„é“¾ã€‚ä¸ºäº†ç®€å•åœ°åœ¨è‡ªå®šä¹‰å­ç±»ä¸­æ·»åŠ æ‹¦æˆªå™¨ï¼Œå¯ä»¥è€ƒè™‘è°ƒç”¨super.getHandlerExecutionChainï¼ˆhandlerï¼Œrequestï¼‰å¹¶åœ¨è¿”å›çš„é“¾å¯¹è±¡ä¸Šè°ƒç”¨HandlerExecutionChainï¼ƒaddInterceptorã€‚ getCorsHandlerExecutionChainï¼š 1234567891011121314protected HandlerExecutionChain getCorsHandlerExecutionChain(HttpServletRequest request, HandlerExecutionChain chain, CorsConfiguration config) &#123; //é€šè¿‡è¯·æ±‚å¤´çš„httpæ–¹æ³•æ˜¯å¦optionsåˆ¤æ–­æ˜¯å¦é¢„è¯·æ±‚ï¼Œ if (CorsUtils.isPreFlightRequest(request)) &#123; HandlerInterceptor[] interceptors = chain.getInterceptors(); //å¦‚æœæ˜¯ä½¿ç”¨PreFlightRequestæ›¿æ¢å¤„ç†å™¨ chain = new HandlerExecutionChain(new PreFlightHandler(config), interceptors); &#125; else &#123; //å¦‚æœæ˜¯æ™®é€šè¯·æ±‚ï¼Œæ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨CorsInterceptorã€‚ chain.addInterceptor(new CorsInterceptor(config)); &#125; return chain;&#125; æ›´æ–°HandlerExecutionChainè¿›è¡Œä¸CORSï¼ˆHTTPè®¿é—®æ§åˆ¶ï¼šè·¨åŸŸèµ„æºå…±äº«ï¼‰ç›¸å…³çš„å¤„ç†ã€‚ å¯¹äºpre-flightè¯·æ±‚ï¼Œé»˜è®¤å®ç°ç”¨ä¸€ä¸ªç®€å•çš„HttpRequestHandleræ¥æ›¿æ¢é€‰æ‹©çš„handlerï¼Œè¯¥HttpRequestHandlerè°ƒç”¨å·²é…ç½®çš„setCorsProcessorã€‚ï¼ˆå°†å¤„ç†å™¨æ›¿æ¢ä¸ºå†…éƒ¨ç±»PreFlightHandlerï¼‰ å¯¹äºæ™®é€šçš„è¯·æ±‚ï¼Œé»˜è®¤å®ç°æ’å…¥ä¸€ä¸ªHandlerInterceptorï¼Œå®ƒæ‰§è¡Œä¸CORSæœ‰å…³çš„æ£€æŸ¥å¹¶æ·»åŠ CORSå¤´ã€‚ï¼ˆæ·»åŠ CorsInterceptoræ‹¦æˆªå™¨ï¼‰ AbstractHandlerMappingä¸­çš„ä¸¤ä¸ªå†…éƒ¨ç±»è¿™ä¸¤ä¸ªå†…éƒ¨ç±»å°±æ˜¯ç”¨æ¥æ ¡éªŒrequestæ˜¯å¦corsï¼Œå¹¶å°è£…å¯¹åº”çš„Adapterçš„ã€‚ PreFlightRequestæ˜¯CorsProcessorå¯¹äºHttpRequestHandlerçš„ä¸€ä¸ªé€‚é…å™¨ã€‚è¿™æ ·HandlerAdapterç›´æ¥ä½¿ç”¨HttpRequestHandlerAdapterå¤„ç†ã€‚ CorsInterceptor æ˜¯CorsProcessorå¯¹äºHandlerInterceptorAdapterçš„é€‚é…å™¨ã€‚ å…·ä½“çš„ç±»ä¿¡æ¯å¦‚ä¸‹ï¼š PreFlightHandler123456789101112131415161718private class PreFlightHandler implements HttpRequestHandler, CorsConfigurationSource &#123; private final CorsConfiguration config; public PreFlightHandler(CorsConfiguration config) &#123; this.config = config; &#125; @Override public void handleRequest(HttpServletRequest request, HttpServletResponse response) throws IOException &#123; corsProcessor.processRequest(this.config, request, response); &#125; @Override public CorsConfiguration getCorsConfiguration(HttpServletRequest request) &#123; return this.config; &#125;&#125; CorsInterceptor1234567891011121314151617181920private class CorsInterceptor extends HandlerInterceptorAdapter implements CorsConfigurationSource &#123; private final CorsConfiguration config; public CorsInterceptor(CorsConfiguration config) &#123; this.config = config; &#125; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; return corsProcessor.processRequest(this.config, request, response); &#125; @Override public CorsConfiguration getCorsConfiguration(HttpServletRequest request) &#123; return this.config; &#125;&#125; è‡³æ­¤AbstractHandlerMappingä¸­çš„ä¸€äº›æºç å°±ç»“æŸäº†ï¼ŒAbstractHandlerMappingä¸ºHandlerMappingçš„åŠŸèƒ½æä¾›çš„ä¸€äº›å…·ä½“çš„æ¨¡æ¿æè¿°ï¼Œä½†æ˜¯å…·ä½“çš„ç»†èŠ‚å®ç°è¿˜éœ€è¦ä»å…¶å­ç±»ä¸­æ¥æ…¢æ…¢åˆ†æã€‚å…³äºè¿™éƒ¨åˆ†ä¸­æ¶‰åŠåˆ°çš„å¦‚HandlerExecutionChainï¼Œcorsè·¨åŸŸç­‰é—®é¢˜ï¼Œåé¢ä¼šæ ¹æ®å®é™…æƒ…å†µå¦å¼€ç¯‡å¹…æ¥å­¦ä¹ ã€‚ å¤§å®¶å¦‚æœæœ‰ä»€ä¹ˆæ„è§æˆ–è€…å»ºè®®å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€ï¼Œä¹Ÿå¯ä»¥ç»™æˆ‘ä»¬å‘é‚®ä»¶ï¼ˆglmapper_2018@163.comï¼‰!æ¬¢è¿å°ä¼™ä¼´ä¸æˆ‘ä»¬ä¸€èµ·äº¤æµï¼Œä¸€èµ·æˆé•¿ã€‚]]></content>
      <categories>
        <category>spring mvc</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>web</tag>
        <tag>mvc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringMVCæºç ç³»åˆ—ï¼šHandlerMapping]]></title>
    <url>%2F2018%2F11%2F10%2Fspring-base-webmvc1%2F</url>
    <content type="text"><![CDATA[HandlerMappingæ¥å£æ˜¯ç”¨æ¥æŸ¥æ‰¾Handlerçš„ã€‚åœ¨SpringMvcä¸­ï¼ŒDispatcherServletå¤„ç†åˆ†å‘å¾ˆå¤šè¯·æ±‚ï¼Œè€Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸€ä¸ªHandleræ¥å¤„ç†ï¼Œå…·ä½“æ¥å—åˆ°ä¸€ä¸ªè¯·æ±‚åä½¿ç”¨å“ªä¸ªHandleræ¥å¤„ç†å‘¢ï¼Ÿè¿™å°±æ˜¯Handlerè¦åšçš„äº‹æƒ…ã€‚å› æ­¤ï¼ŒHandlerMappingçš„ä½œç”¨å°±æ˜¯æ ¹æ®requestæ‰¾åˆ°ç›¸åº”çš„å¤„ç†å™¨Handlerå’ŒInterceptorsã€‚ ä¸‹é¢æ˜¯Springä¸­å¯¹HandlerMappingæ¥å£çš„è¯´æ˜ï¼š This class can be implemented by application developers, although this is not necessary, as BeanNameUrlHandlerMapping and DefaultAnnotationHandlerMapping are included in the framework. The former is the default if no HandlerMapping bean is registered in the application context.è¿™ä¸ªç±»å¯ä»¥ç”±åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å®ç°ï¼Œå°½ç®¡è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºBeanNameUrlHandlerMappingå’ŒDefaultAnnotationHandlerMappingå·²ç»åŒ…å«åœ¨æ¡†æ¶ä¸­ï¼Œä½œä¸ºHandlerMappingçš„é»˜è®¤å®ç°ã€‚ å¦‚æœåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰æ³¨å†ŒHandlerMapping beanï¼ŒBeanNameUrlHandlerMappingæ˜¯é»˜è®¤å€¼ã€‚ HandlerMapping implementations can support mapped interceptors but do not have to. A handler will always be wrapped in a HandlerExecutionChain instance, optionally accompanied by some HandlerInterceptor instances.The DispatcherServlet will first call each HandlerInterceptor&#39;s preHandle method in the given order, finally invoking the handler itself if all preHandle methods have returned trueHandlerMappingå®ç°å¯ä»¥æ”¯æŒæ˜ å°„çš„æ‹¦æˆªå™¨ï¼Œä½†ä¸å¿…å¦‚æ­¤ï¼›handlerå°†å§‹ç»ˆè¢«å°è£…åœ¨HandlerExecutionChainå®ä¾‹ä¸­ï¼Œå¹¶å¯ç”±ä¸€äº›HandlerInterceptorå®ä¾‹æ‰§è¡Œã€‚åœ¨ç»™å®šçš„é¡ºåºä¸­ï¼ŒDispatcherServletå°†é¦–å…ˆè°ƒç”¨æ¯ä¸ªHandlerInterceptorçš„preHandleæ–¹æ³•ï¼Œå¦‚æœæ‰€æœ‰çš„preHandleæ–¹æ³•éƒ½è¿”å›trueï¼Œé‚£ä¹ˆæœ€åè°ƒç”¨handleræœ¬èº«ã€‚ The ability to parameterize this mapping is a powerful and unusual capability of this MVC framework. For example, it is possible to write a custom mapping based on session state, cookie state or many other variables. No other MVC framework seems to be equally flexible.å‚æ•°åŒ–è¿™ä¸ªæ˜ å°„çš„èƒ½åŠ›æ˜¯è¿™ä¸ªMVCæ¡†æ¶çš„ä¸€ä¸ªå¼ºå¤§ä¸”ä¸åŒå¯»å¸¸çš„èƒ½åŠ›ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®ä¼šè¯çŠ¶æ€ï¼ŒcookieçŠ¶æ€æˆ–è®¸å¤šå…¶ä»–å˜é‡ç¼–å†™è‡ªå®šä¹‰æ˜ å°„ã€‚ æ²¡æœ‰å…¶ä»–MVCæ¡†æ¶ä¼¼ä¹åŒæ ·çµæ´»ã€‚ Note: Implementations can implement the Ordered interface to be able to specify a sorting order and thus a priority for getting applied by DispatcherServlet. Non-Ordered instances get treated as lowest priority.æ³¨ï¼šå®ç°å¯ä»¥å®ç°Orderedæ¥å£ï¼Œä»¥ä¾¿èƒ½å¤ŸæŒ‡å®šæ’åºé¡ºåºï¼Œä»è€ŒæŒ‡å®šç”±DispatcherServletåº”ç”¨çš„ä¼˜å…ˆçº§ã€‚ æ— åºå®ä¾‹è¢«è§†ä¸ºæœ€ä½ä¼˜å…ˆçº§ã€‚ 1.æ¥å£å¸¸é‡1.1ã€PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTEHttpServletRequestå±æ€§çš„åç§°ï¼Œå®ƒåŒ…å«å¤„ç†ç¨‹åºæ˜ å°„ä¸­çš„è·¯å¾„ï¼Œæ¯”å¦‚æ¨¡å¼åŒ¹é…ï¼Œæˆ–è€…å®Œå…¨ç›¸å…³çš„URI(é€šå¸¸åœ¨DispatcherServletçš„æ˜ å°„ä¸­)ã€‚æ­¤å±æ€§ä¸éœ€è¦æ‰€æœ‰HandlerMappingå®ç°æ”¯æŒã€‚åŸºäºurlçš„HandlerMappingsé€šå¸¸ä¼šæ”¯æŒå®ƒï¼Œä½†æ˜¯å¤„ç†ç¨‹åºä¸åº”è¯¥æœŸæœ›è¿™ä¸ªè¯·æ±‚å±æ€§åœ¨æ‰€æœ‰åœºæ™¯ä¸­éƒ½å­˜åœ¨ã€‚12345678910/** * Name of the &#123;@link HttpServletRequest&#125; attribute that contains the path * within the handler mapping, in case of a pattern match, or the full * relevant URI (typically within the DispatcherServlet&apos;s mapping) else. * &lt;p&gt;Note: This attribute is not required to be supported by all * HandlerMapping implementations. URL-based HandlerMappings will * typically support it, but handlers should not necessarily expect * this request attribute to be present in all scenarios. */String PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.pathWithinHandlerMapping&quot;; 1.2ã€BEST_MATCHING_PATTERN_ATTRIBUTEHttpServletRequestå±æ€§çš„åç§°ï¼ŒåŒ…æ‹¬å¤„ç†ç¨‹åºæ˜ å°„ä¸­çš„æœ€ä½³åŒ¹é…æ¨¡å¼123456789/** * Name of the &#123;@link HttpServletRequest&#125; attribute that contains the * best matching pattern within the handler mapping. * &lt;p&gt;Note: This attribute is not required to be supported by all * HandlerMapping implementations. URL-based HandlerMappings will * typically support it, but handlers should not necessarily expect * this request attribute to be present in all scenarios. */String BEST_MATCHING_PATTERN_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.bestMatchingPattern&quot;; 1.3ã€INTROSPECT_TYPE_LEVEL_MAPPINGHttpServletRequestå±æ€§çš„åç§°ï¼ŒæŒ‡ç¤ºæ˜¯å¦åº”è¯¥æ£€æŸ¥ç±»å‹çº§åˆ«çš„æ˜ å°„ã€‚ 1234567/** * Name of the boolean &#123;@link HttpServletRequest&#125; attribute that indicates * whether type-level mappings should be inspected. * &lt;p&gt;Note: This attribute is not required to be supported by all * HandlerMapping implementations. */String INTROSPECT_TYPE_LEVEL_MAPPING = HandlerMapping.class.getName() + &quot;.introspectTypeLevelMapping&quot;; 1.4ã€URI_TEMPLATE_VARIABLES_ATTRIBUTEåŒ…å«URIæ¨¡æ¿æ˜ å°„çš„HttpServletRequestå±æ€§çš„åç§°ï¼Œå°†å˜é‡åç§°æ˜ å°„åˆ°å€¼ã€‚123456789/** * Name of the &#123;@link HttpServletRequest&#125; attribute that contains the URI * templates map, mapping variable names to values. * &lt;p&gt;Note: This attribute is not required to be supported by all * HandlerMapping implementations. URL-based HandlerMappings will * typically support it, but handlers should not necessarily expect * this request attribute to be present in all scenarios. */String URI_TEMPLATE_VARIABLES_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.uriTemplateVariables&quot;; 1.5ã€MATRIX_VARIABLES_ATTRIBUTEåŒ…å«å¸¦æœ‰URIçŸ©é˜µå˜é‡çš„æ˜ å°„çš„HttpServletRequestå±æ€§çš„åç§°ã€‚æ­¤å±æ€§ä¸éœ€è¦æ‰€æœ‰HandlerMappingå®ç°æ”¯æŒï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨ï¼Œè¿™å–å†³äºHandlerMappingæ˜¯å¦è¢«é…ç½®ä¸ºåœ¨è¯·æ±‚URIä¸­ä¿ç•™çŸ©é˜µå˜é‡å†…å®¹ã€‚ 123456789/** * Name of the &#123;@link HttpServletRequest&#125; attribute that contains a map with * URI matrix variables. * &lt;p&gt;Note: This attribute is not required to be supported by all * HandlerMapping implementations and may also not be present depending on * whether the HandlerMapping is configured to keep matrix variable content * in the request URI. */String MATRIX_VARIABLES_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.matrixVariables&quot;; 1.6ã€PRODUCIBLE_MEDIA_TYPES_ATTRIBUTEHttpServletRequestå±æ€§çš„åç§°ï¼Œè¯¥å±æ€§åŒ…å«å¯ç”¨äºæ˜ å°„å¤„ç†ç¨‹åºçš„å¯ç”Ÿæˆçš„MediaTypesé›†åˆã€‚ 12345678/** * Name of the &#123;@link HttpServletRequest&#125; attribute that contains the set of * producible MediaTypes applicable to the mapped handler. * &lt;p&gt;Note: This attribute is not required to be supported by all * HandlerMapping implementations. Handlers should not necessarily expect * this request attribute to be present in all scenarios. */String PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE = HandlerMapping.class.getName() + &quot;.producibleMediaTypes&quot;; 2.æ ¸å¿ƒæ–¹æ³•HandlerMappingæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š1HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception; ä»æ–¹æ³•å®šä¹‰å¯ä»¥çœ‹å‡ºï¼ŒgetHandleræ–¹æ³•å°±æ˜¯é€šè¿‡requestæ¥è·å–ä¸€ä¸ªHandlerExecutionChainï¼›è¯¥æ–¹æ³•åœ¨ä¸åŒçš„å­ç±»ä¸­éƒ½æœ‰å®ç°ï¼Œå…·ä½“çš„å®ç°åé¢è¯´å­ç±»çš„æ—¶å€™åœ¨è¯¦ç»†åˆ†æã€‚ 3.HandlerMappingçš„å­ç±»å›¾ä¸­é»„è‰²éƒ¨åˆ†è¡¨ç¤ºå·²ç»è¿‡æ—¶çš„ç±»ï¼Œæ—¶é—´å¼€å‘ä¸­ä¸å»ºè®®å†ä½¿ç”¨ã€‚ åœ¨HandlerMappingçš„ä½“ç³»ä¸­å¯ä»¥çœ‹å‡ºï¼ŒHandlerMappingä¸‹å±å­ç±»å¯åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯ï¼› AbstractHandlerMethodMapping AbstractUrlHandlerMapping ä¸Šè¿°ä¸¤ä¸ªæŠ½è±¡ç±»åˆå‡æ˜¯AbstractHandlerMappingçš„å­ç±»ã€‚å…³äºAbstractHandlerMappingæˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« æ¥å­¦ä¹ ã€‚ å¤§å®¶å¦‚æœæœ‰ä»€ä¹ˆæ„è§æˆ–è€…å»ºè®®å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€ï¼Œä¹Ÿå¯ä»¥ç»™æˆ‘ä»¬å‘é‚®ä»¶ï¼ˆglmapper_2018@163.comï¼‰!æ¬¢è¿å°ä¼™ä¼´ä¸æˆ‘ä»¬ä¸€èµ·äº¤æµï¼Œä¸€èµ·æˆé•¿ã€‚]]></content>
      <categories>
        <category>spring mvc</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>web</tag>
        <tag>mvc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-Builder å»ºé€ è€…æ¨¡å¼]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-design-model-builder%2F</url>
    <content type="text"><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„å››å¤§åŸºç¡€ç‰¹æ€§èœé¸Ÿæˆé•¿ç³»åˆ—-å¤šæ€ã€æ¥å£å’ŒæŠ½è±¡ç±»èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„6ç§è®¾è®¡åŸåˆ™èœé¸Ÿæˆé•¿ç³»åˆ—-å•ä¾‹æ¨¡å¼èœé¸Ÿæˆé•¿ç³»åˆ—-å·¥å‚æ¨¡å¼ å»ºé€ è€…æ¨¡å¼ä¹Ÿæ˜¯åˆ›å»ºå‹ä¸­çš„ä¸€ç§ï¼Œç”¨äºè´Ÿè´£åˆ›å»ºå¯¹è±¡ã€‚å»ºé€ è€…æ¨¡å¼å¯ä»¥å°†ä¸€ä¸ªäº§å“çš„å†…éƒ¨è¡¨è±¡ä¸äº§å“çš„ç”Ÿæˆè¿‡ç¨‹åˆ†å‰²å¼€æ¥ï¼Œä»è€Œå¯ä»¥ä½¿ä¸€ä¸ªå»ºé€ è¿‡ç¨‹ç”Ÿæˆå…·æœ‰ä¸åŒçš„å†…éƒ¨è¡¨è±¡çš„äº§å“å¯¹è±¡ã€‚ ä»€ä¹ˆæ˜¯äº§å“çš„å†…éƒ¨è¡¨è±¡ï¼Ÿä¸€ä¸ªäº§å“å¸¸æœ‰ä¸ç”¨çš„ç»„æˆæˆåˆ†ä½œä¸ºäº§å“çš„é›¶ä»¶ï¼Œè¿™äº›é›¶ä»¶æœ‰å¯èƒ½æ˜¯å¯¹è±¡ï¼Œä¹Ÿæœ‰å¯èƒ½ä¸æ˜¯å¯¹è±¡ï¼Œä»–ä»¬é€šå¸¸åˆå«åšäº§å“çš„å†…éƒ¨è¡¨è±¡ã€‚ä¸åŒçš„äº§å“å¯ä»¥æœ‰ä¸åŒçš„å†…éƒ¨è¡¨è±¡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æœ‰ä¸åŒçš„é›¶ä»¶ã€‚ä½¿ç”¨å»ºé€ è€…æ¨¡å¼å¯ä»¥ä½¿å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“æ‰€ç”Ÿæˆçš„äº§å“å¯¹è±¡æœ‰å“ªäº›é›¶ä»¶ï¼Œæ¯ä¸ªäº§å“çš„å¯¹åº”é›¶ä»¶å½¼æ­¤æœ‰ä½•ä¸åŒï¼Œæ˜¯æ€ä¹ˆå»ºé€ å‡ºæ¥çš„ï¼Œä»¥åŠæ€æ ·ç»„æˆäº§å“ã€‚ å·¥å‚æ¨¡å¼ä¸å»ºé€ è€…æ¨¡å¼ä¸Šä¸€ç¯‡æˆ‘ä»¬è®¨è®ºäº†å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬çŸ¥é“å·¥å‚æ¨¡å¼ä¸€èˆ¬éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªäº§å“ï¼Œæ³¨é‡çš„æ˜¯æŠŠè¿™ä¸ªäº§å“åˆ›å»ºå‡ºæ¥å°±è¡Œï¼Œåªè¦åˆ›å»ºå‡ºæ¥ï¼Œä¸å…³å¿ƒè¿™ä¸ªäº§å“çš„ç»„æˆéƒ¨åˆ†ã€‚ä»ä»£ç ä¸Šçœ‹ï¼Œå·¥å‚æ¨¡å¼å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨è¿™ä¸ªæ–¹æ³•å°±èƒ½ç”Ÿäº§å‡ºäº§å“ã€‚é‚£ä¹ˆå¯¹äºå»ºé€ è€…æ¨¡å¼å‘¢ï¼Ÿå»ºé€ è€…æ¨¡å¼ä¹Ÿæ˜¯åˆ›å»ºä¸€ä¸ªäº§å“ï¼Œä½†æ˜¯ä¸ä»…è¦æŠŠè¿™ä¸ªäº§å“åˆ›å»ºå‡ºæ¥ï¼Œè¿˜è¦å…³ç³»è¿™ä¸ªäº§å“çš„ç»„æˆç»†èŠ‚ï¼Œ ç»„æˆè¿‡ç¨‹ã€‚ä»ä»£ç ä¸Šçœ‹ï¼ˆä¸‹é¢ç»™å‡ºï¼‰ï¼Œå»ºé€ è€…æ¨¡å¼åœ¨å»ºé€ äº§å“æ—¶ï¼Œè¿™ä¸ªäº§å“æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå»ºé€ è€…æ¨¡å¼ä¼šæ ¹æ®è¿™äº›ç›¸åŒæ–¹æ³•ä½†æ˜¯ä¸åŒæ‰§è¡Œé¡ºåºå»ºé€ å‡ºä¸åŒç»„æˆç»†èŠ‚çš„äº§å“ã€‚ å»ºé€ è€…æ¨¡å¼çš„ç»“æ„ç»“æ„ç»„ä»¶è§’è‰²è¯´æ˜ï¼š æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰:æŠ½è±¡ç±»ï¼Œ è§„èŒƒäº§å“çš„ç»„å»ºï¼Œä¸€èˆ¬æ˜¯ç”±å­ç±»å®ç°å…·ä½“çš„ç»„ä»¶è¿‡ç¨‹ å…·ä½“å»ºé€ è€…ï¼ˆConcreteBuilder ï¼‰ï¼šå…·ä½“çš„æ„å»ºå™¨ å¯¼æ¼”è€…ï¼ˆDirectorï¼‰ : ç»Ÿä¸€ç»„è£…è¿‡ç¨‹(å¯çœç•¥) äº§å“ï¼ˆProductï¼‰:äº§å“çš„æŠ½è±¡ç±» Directorè§’è‰²æ˜¯ä¸å®¢æˆ·ç«¯æ‰“äº¤é“çš„è§’è‰²ã€‚Directorå°†å®¢æˆ·ç«¯åˆ›å»ºäº§å“çš„è¯·æ±‚åˆ’åˆ†ä¸ºå¯¹å„ä¸ªé›¶ä»¶çš„å»ºé€ è¯·æ±‚ï¼Œå†å°†è¿™äº›è¯·æ±‚å§”æ´¾ç»™å…·ä½“çš„ConcreteBuilderè§’è‰²ã€‚ConcreteBuilderæ˜¯åšå…·ä½“å»ºé€ å·¥ä½œçš„ï¼Œä½†æ˜¯å¯¹å®¢æˆ·ç«¯æ˜¯é€æ˜çš„ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæ¯æœ‰ä¸€ä¸ªäº§å“ç±»ï¼Œå°±æœ‰ä¸€ä¸ªç›¸åº”çš„å…·ä½“å»ºé€ è€…ç±»ã€‚è¿™äº›äº§å“åº”å½“æœ‰ä¸€æ ·æ•°ç›®çš„é›¶ä»¶ï¼Œè€Œæ¯æœ‰ä¸€ä¸ªé›¶ä»¶å°±ç›¸åº”çš„åœ¨æ‰€æœ‰çš„å»ºé€ è€…è§’è‰²é‡Œæœ‰ä¸€ä¸ªå»ºé€ æ–¹æ³•ã€‚ å»ºé€ ä¸€å°é‚®ä»¶é€šè¿‡ä»£ç æ¥çœ‹ä¸‹å„ä¸ªè§’è‰²çš„èŒè´£ï¼š Director 123456789101112131415161718192021222324package com.glmapper.model.builder;/** * * å¯¼æ¼”è€…ç±» * @author glmapper * @time 2017å¹´12æœˆ30æ—¥ä¸Šåˆ11:33:26 * @version glmapper_v1.0 * */public class Director &#123; private Builder builder; /** * äº§å“æ„é€ æ–¹æ³•ï¼Œè´Ÿè´£è°ƒç”¨å„ä¸ªé›¶ä»¶å»ºé€ æ–¹æ³• */ public EmailProduct construct()&#123; builder = new ConcreteBuilder(); builder.buildFromAddress(); builder.buildToAddress(); builder.buildSubject(); builder.buildContent(); builder.buildSupplement(); return builder.returnEmailProduct(); &#125;&#125; Builder 1234567891011121314151617181920212223242526272829303132333435package com.glmapper.model.builder;/** * æŠ½è±¡å»ºé€ è€… æä¾›ä¸åŒçš„æ„å»ºç»„ä»¶æ–¹æ³• * @author glmapper * @time 2017å¹´12æœˆ30æ—¥ä¸Šåˆ11:31:34 * @version glmapper_v1.0 * */public interface Builder &#123; /** * æ„å»ºå‘ä»¶äººä¿¡æ¯ */ public void buildFromAddress(); /** * æ„å»ºæ”¶ä»¶äººä¿¡æ¯ */ public void buildToAddress(); /** * æ„å»ºé‚®ä»¶å†…å®¹ */ public void buildContent(); /** * æ„å»ºé‚®ä»¶é™„ä»¶ */ public void buildSupplement(); /** * æ„å»ºé‚®ä»¶ä¸»é¢˜ */ public void buildSubject(); /** * è¿”å›æ„å»ºçš„äº§å“ */ public EmailProduct returnEmailProduct(); &#125; ConcreteBuilder 1234567891011121314151617181920212223242526272829303132333435363738package com.glmapper.model.builder;/** * * å…·ä½“äº§å“çš„å»ºé€ å™¨ * @author glmapper * @time 2017å¹´12æœˆ30æ—¥ä¸Šåˆ11:31:11 * @version glmapper_v1.0 * */public class ConcreteBuilder implements Builder&#123; private EmailProduct emailProduct = new EmailProduct(); public void buildFromAddress() &#123; emailProduct.setFromAddress(&quot;00001111@glmapper.com&quot;); &#125; public void buildToAddress() &#123; emailProduct.setToAddress(&quot;00001112@glmapper.com&quot;); &#125; public void buildContent() &#123; emailProduct.setContent(&quot;æˆ‘å†™äº†ä¸€ä¸ªå»ºé€ è€…æ¨¡å¼çš„ä¾‹å­ï¼Œå¸Œæœ›å¤§ä½¬ç»™ç‚¹æ„è§&quot;); &#125; public void buildSupplement() &#123; emailProduct.setSupplement(&quot;é™„ä»¶ï¼šBuilderDemo.rar&quot;); &#125; public void buildSubject() &#123; emailProduct.setSubject(&quot;ç»™å¤§ä½¬çš„ä¸€å°å»ºé€ è€…æ¨¡å¼çš„Demo&quot;); &#125; public EmailProduct returnEmailProduct() &#123; System.out.println(emailProduct.toString()); return emailProduct; &#125;&#125; Product 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package com.glmapper.model.builder;/** * äº§å“ç±»ï¼ˆäº§å“ç±»ä¸­åŒ…æ‹¬ä¸åŒç»„ä»¶ï¼šæ­¤å¤„ä½¿ç”¨å­—æ®µæ–¹å¼æ¨¡å¼ç»„ä»¶ï¼‰ * @author glmapper * @time 2017å¹´12æœˆ30æ—¥ä¸Šåˆ11:30:13 * @version glmapper_v1.0 * */public class EmailProduct &#123; /** * å‘ä»¶åœ°å€ */ private String fromAddress; /** * æ”¶ä»¶åœ°å€ */ private String toAddress; /** * é‚®ä»¶ä¸»é¢˜ */ private String subject; /** * é‚®ä»¶å†…å®¹ */ private String content; /** * é‚®ä»¶é™„ä»¶ */ private String supplement; public String getFromAddress() &#123; return fromAddress; &#125; public void setFromAddress(String fromAddress) &#123; this.fromAddress = fromAddress; &#125; public String getToAddress() &#123; return toAddress; &#125; public void setToAddress(String toAddress) &#123; this.toAddress = toAddress; &#125; public String getSubject() &#123; return subject; &#125; public void setSubject(String subject) &#123; this.subject = subject; &#125; public String getContent() &#123; return content; &#125; public void setContent(String content) &#123; this.content = content; &#125; public String getSupplement() &#123; return supplement; &#125; public void setSupplement(String supplement) &#123; this.supplement = supplement; &#125; @Override public String toString() &#123; return &quot;EmailProduct [fromAddress=&quot; + fromAddress + &quot;, toAddress=&quot; + toAddress + &quot;, subject=&quot; + subject + &quot;, content=&quot; + content + &quot;, supplement=&quot; + supplement + &quot;]&quot;; &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213package com.glmapper.model.builder;/** * å®¢æˆ·ç«¯ * @author glmapper * @time 2017å¹´12æœˆ30æ—¥ä¸Šåˆ11:45:53 * @version glmapper_v1.0 * */public class MainTest &#123; public static void main(String[] args) &#123; new Director().construct(); &#125;&#125; ç»“æœ 1234567891011121314å»ºé€ å‘ä»¶äººä¿¡æ¯ç»„ä»¶...å»ºé€ æ”¶ä»¶äººä¿¡æ¯ç»„ä»¶...å»ºé€ é‚®ä»¶ä¸»é¢˜ä¿¡æ¯ç»„ä»¶...å»ºé€ é‚®ä»¶å†…å®¹ä¿¡æ¯ç»„ä»¶...å»ºé€ é‚®ä»¶é™„ä»¶ä¿¡æ¯ç»„ä»¶...ï¼ˆä¸ºäº†æ–¹ä¾¿çœ‹ï¼Œè¿™é‡ŒæŠŠç»“æœçš„æ˜¾ç¤ºåšäº†è°ƒæ•´ï¼‰EmailProduct ï¼š[ fromAddress=00001111@glmapper.com, toAddress=00001112@glmapper.com, subject=ç»™å¤§ä½¬çš„ä¸€å°å»ºé€ è€…æ¨¡å¼çš„Demo, content=æˆ‘å†™äº†ä¸€ä¸ªå»ºé€ è€…æ¨¡å¼çš„ä¾‹å­ï¼Œå¸Œæœ›å¤§ä½¬ç»™ç‚¹æ„è§, supplement=é™„ä»¶ï¼šBuilderDemo.rar] å»ºé€ è€…æ¨¡å¼çš„å…³æ³¨ç‚¹æœ‰äº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡ä¼šæœ‰ä¸€äº›é‡è¦çš„æ€§è´¨ï¼Œåœ¨ä»–ä»¬æ²¡æœ‰æ°å½“çš„å€¼ä¹‹å‰ï¼Œå¯¹è±¡ä¸èƒ½ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„äº§å“æ¥ä½¿ç”¨ã€‚å°±å¦‚ä¸Šé¢å‘é€ä¸€ä¸ªç”µå­é‚®ä»¶æ‰€ç¤ºï¼Œç”µå­é‚®ä»¶æœ‰å‘ä»¶äººåœ°å€ã€æ”¶ä»¶äººåœ°å€ã€ä¸»é¢˜ã€å†…å®¹ã€é™„å½•ç­‰éƒ¨åˆ†ï¼Œè€Œåœ¨æ”¶ä»¶äººåœ°å€æ²¡æœ‰èµ‹å€¼ä¹‹å‰ï¼Œè¿™ä¸ªç”µå­é‚®ä»¶æ˜¯ä¸èƒ½å‘é€çš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡çš„ä¸€äº›æ€§è´¨å¿…é¡»æŒ‰ç…§æŸä¸ªé¡ºåºèµ‹å€¼æ‰æœ‰æ„ä¹‰ï¼Œåœ¨æŸä¸ªæ€§è´¨æ²¡æœ‰èµ‹å€¼ä¹‹å‰ï¼Œå¦ä¸€ä¸ªæ€§è´¨åˆ™æ— æ³•èµ‹å€¼ã€‚è¿™äº›æƒ…å†µä½¿å¾—æ€§è´¨æœ¬èº«çš„å»ºé€ æ¶‰åŠåˆ°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚ è€Œæ­¤æ—¶ï¼Œå¯¹è±¡ç›¸å½“äºä¸€ä¸ªæœ‰å¾…å»ºé€ çš„äº§å“ï¼Œè€Œå¯¹è±¡çš„è¿™äº›æ€§è´¨ç›¸å½“äºäº§å“çš„é›¶ä»¶ï¼Œå»ºé€ äº§å“çš„è¿‡ç¨‹æ˜¯å»ºé€ é›¶ä»¶çš„è¿‡ç¨‹ã€‚ç”±äºå»ºé€ é›¶ä»¶çš„è¿‡ç¨‹å¾ˆå¤æ‚ï¼Œå› æ­¤ï¼Œè¿™äº›é›¶ä»¶çš„å¥åœ¨è¿‡ç¨‹å¾€å¾€ä¼šè¢«â€œå¤–éƒ¨åŒ–â€åˆ°å¦ä¸€ä¸ªç§°ä½œä¸ºå»ºé€ è€…çš„å¯¹è±¡é‡Œï¼Œå»ºé€ è€…å¯¹è±¡è¿”å›ç»™å®¢æˆ·ç«¯çš„æ˜¯ä¸€ä¸ªå…¨éƒ¨é›¶ä»¶éƒ½å»ºé€ å®Œæ¯•çš„äº§å“å¯¹è±¡ã€‚ åœ¨å®é™…çš„åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œå»ºé€ è€…æ¨¡å¼ä¹Ÿæœ‰ä¸åŒçš„å˜ç§ï¼Œæ¯”å¦‚è¯´çœç•¥æŠ½è±¡å»ºé€ è€…è§’è‰²æˆ–è€…çœç•¥å¯¼æ¼”è€…è§’è‰²ç­‰ç­‰ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå»ºé€ è€…æ¨¡å¼å¯ä»¥é€šè¿‡çœç•¥æŸäº›è§’è‰²æ¥è¾¾åˆ°è¿‡åº¦åˆ°æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚ OKï¼Œå…³äºå»ºé€ è€…æ¨¡å¼çš„å…¶ä»–å˜ç§è¿™é‡Œå°±ä¸è®¨è®ºäº†ï¼Œç•™ä¸€ä¸ªæƒ³è±¡ç©ºé—´ï¼ï¼ˆè¿™æ®µå­—ä»£è¡¨ä¸€ä¸ªå¾®ç¬‘çš„è¡¨æƒ…(*ï¿£ï¸¶ï¿£)ï¼‰ javaä¸­å»ºé€ è€…æ¨¡å¼ï¼šJavaMailJavaMailæ˜¯ä¸€ç»„J2SEçš„æ‰©å±•APIçš„ä¸€ä¸ªç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªAPIæ¥å¼€å‘ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„ç”µå­é‚®ä»¶å®¢æˆ·ç«¯è½¯ä»¶ã€‚åœ¨JavaMailä¸­å°±ä¸»è¦ä½¿ç”¨äº†å»ºé€ è€…æ¨¡å¼ï¼Œå½“ç„¶è¿˜æœ‰æˆ‘ä»¬ä¸Šä¸€ç¯‡ä¸­è¯´é“çš„æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚ å»ºé€ è€…æ¨¡å¼åœ¨JavaMailä¸­çš„ä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041package com.glmapper.model.builder;import java.util.Properties;import javax.mail.Message;import javax.mail.Session;import javax.mail.Transport;import javax.mail.internet.InternetAddress;import javax.mail.internet.MimeMessage;/** * é‚®ä»¶å‘é€-å»ºé€ è€…æ¨¡å¼ * @author glmapper * @time 2017å¹´12æœˆ30æ—¥ä¸‹åˆ2:04:46 * @version glmapper_v1.0 * */public class MailSender &#123; private static MimeMessage message; public static void main(String[] args) &#123; //åŸºæœ¬å±æ€§ String smptHost = &quot;smpt.xxx.com&quot;; String fromAddress = &quot;00001111@glmapper.com&quot;; String toAddress = &quot;00001112@glmapper.com&quot;; Properties p= new Properties(); p.put(&quot;mail.smtp.host&quot;, smptHost); Session session = Session.getDefaultInstance(p); try &#123; InternetAddress to = new InternetAddress(toAddress); InternetAddress from = new InternetAddress(fromAddress); //åˆ›å»ºmessageå¯¹è±¡ message = new MimeMessage(session); //ä¸‹é¢å°±æ˜¯ç»„è£…é›¶ä»¶çš„è¿‡ç¨‹ message.setFrom(from); message.setRecipient(Message.RecipientType.TO, to); message.setSubject(&quot;hello builder&quot;); message.setText(&quot;æˆ‘å†™äº†ä¸€ä¸ªå»ºé€ è€…æ¨¡å¼çš„ä¾‹å­ï¼Œå¸Œæœ›å¤§ä½¬ç»™ç‚¹æ„è§&quot;); Transport.send(message); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; OK,å»ºé€ è€…æ¨¡å¼å°±åˆ°è¿™é‡Œäº†!]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—-å®¹å™¨åˆ·æ–°]]></title>
    <url>%2F2018%2F11%2F10%2Fspring-base-context-refresh%2F</url>
    <content type="text"><![CDATA[Springå¯¹äºç¨‹åºå‘˜è¯´æ¥è¯´éƒ½ä¸é™Œç”Ÿï¼›ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å¼€æºæŠ€æœ¯ï¼Œå¸®åŠ©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½çš„è¿›è¡Œé¡¹ç›®çš„å¼€å‘ä¸ç»´æŠ¤ã€‚ ä¸Šæ¬¡åœ¨Springçš„å¯åŠ¨è¿‡ç¨‹æ–‡ç« ä¸­å¯¹Springçš„å¯åŠ¨è¿‡ç¨‹åšäº†ä¸€ä¸ªè¾ƒä¸ºè¯¦ç»†çš„è¯´æ˜å’Œåˆ†æã€‚é‚£ä¹ˆåœ¨å®é™…çš„è¿‡ç¨‹ä¸­ï¼ŒSpringçš„å¯åŠ¨å®é™…ä¸Šå°±æ˜¯Springå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚æœ¬æ–‡å°†ä»æºç çš„è§’åº¦ç»“åˆè‡ªå·±æ–­ç‚¹æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿ç•™çš„ç°åœºæ¥åˆ†æä¸€ä¸‹å®¹å™¨çš„åˆ·æ–°è¿‡ç¨‹ï¼ˆä¸»è¦åˆ†æå‰å‡ ä¸ªæ–¹æ³•ï¼Œåé¢å‡ ä¸ªä¼šåˆ†å¼€æ¥è¯´ï¼‰ã€‚ Springçš„å¯åŠ¨æ˜¯é€šè¿‡ContextLoaderListeneræ¥è¿›è¡Œçš„ï¼Œåœ¨ContextLoaderListenerä¸­é€šè¿‡å§”æ‰˜çˆ¶ç±»ContextLoaderçš„initWebApplicationContextæ¥å®Œæˆå…·ä½“çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚å…·ä½“çš„å¯åŠ¨è¿‡ç¨‹å¯ä»¥çœ‹ä¸‹ä¹‹å‰çš„é‚£ç¯‡æ–‡ç« ã€‚ åœ¨initWebApplicationContextæ–¹æ³•æ˜¯ç”¨æ¥åˆ›å»ºå®¹å™¨çš„ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š ä»Šå¤©ä¸»è¦æ¥çœ‹configureAndRefreshWebApplicationContextæ–¹æ³•ä¸­æœ€åçš„wac.refresh()åˆ°åº•å‘ç”Ÿäº†å“ªäº›äº‹; 1ã€obtainFreshBeanFactoryï¼šBeanFactoryçš„åˆ·æ–°å’Œåˆ›å»ºrefresh()æ–¹æ³•ä¸»è¦ä¸ºIoCå®¹å™¨Beançš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æä¾›æ¡ä»¶ï¼ŒSpring IoCå®¹å™¨è½½å…¥Beanå®šä¹‰èµ„æºæ–‡ä»¶ä»å…¶å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³•å¯åŠ¨ï¼Œæ‰€ä»¥æ•´ä¸ªrefresh()ä¸­â€œConfigurableListableBeanFactory beanFactory =obtainFreshBeanFactory();â€è¿™å¥ä»¥åä»£ç çš„éƒ½æ˜¯æ³¨å†Œå®¹å™¨çš„ä¿¡æ¯æºå’Œç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œè½½å…¥è¿‡ç¨‹å°±æ˜¯ä»è¿™å¥ä»£ç å¯åŠ¨ã€‚AbstractApplicationContextçš„obtainFreshBeanFactory()æ–¹æ³•è°ƒç”¨å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³•ï¼Œå¯åŠ¨å®¹å™¨è½½å…¥Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„è¿‡ç¨‹ã€‚refresh()æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šåœ¨åˆ›å»ºIoCå®¹å™¨å‰ï¼Œå¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refreshä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨ã€‚refreshçš„ä½œç”¨ç±»ä¼¼äºå¯¹IoCå®¹å™¨çš„é‡å¯ï¼Œåœ¨æ–°å»ºç«‹å¥½çš„å®¹å™¨ä¸­å¯¹å®¹å™¨è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯¹Beanå®šä¹‰èµ„æºè¿›è¡Œè½½å…¥ã€‚å’ŒrefreshBeanFactoryæ–¹æ³•ç±»ä¼¼ï¼Œè½½å…¥Beanå®šä¹‰çš„æ–¹æ³•loadBeanDefinitionsä¹Ÿä½¿ç”¨äº†å§”æ´¾æ¨¡å¼ï¼Œåœ¨AbstractRefreshableApplicationContextç±»ä¸­åªå®šä¹‰äº†æŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°è°ƒç”¨å­ç±»å®¹å™¨ä¸­çš„æ–¹æ³•å®ç°ã€‚ //é€šçŸ¥å­ç±»å»åˆ·æ–°å†…éƒ¨bean å·¥å‚ å†æ¥çœ‹refreshBeanFactory æ­¤å®ç°æ‰§è¡Œè¯¥ä¸Šä¸‹æ–‡çš„åº•å±‚beanå·¥å‚çš„å®é™…åˆ·æ–°ï¼Œå…³é—­ä»¥å‰çš„beanå·¥å‚ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¹¶ä¸ºä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸçš„ä¸‹ä¸€é˜¶æ®µåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„beanå·¥å‚ã€‚ customizeBeanFactory(DefaultListableBeanFactory beanFactory) 1234567891011121314151617181920212223/** //é€šè¿‡å½“å‰ä¸Šä¸‹æ–‡æ¥è‡ªå®šä¹‰å†…éƒ¨beanå·¥å‚&lt;br&gt; * Customize the internal bean factory used by this context. * Called for each &#123;@link #refresh()&#125; attempt. * &lt;p&gt;The default implementation applies this context&apos;s * &#123;@linkplain #setAllowBeanDefinitionOverriding &quot;allowBeanDefinitionOverriding&quot;&#125; * and &#123;@linkplain #setAllowCircularReferences &quot;allowCircularReferences&quot;&#125; settings, * if specified. Can be overridden in subclasses to customize any of * &#123;@link DefaultListableBeanFactory&#125;&apos;s settings. * @param beanFactory the newly created bean factory for this context * @see DefaultListableBeanFactory#setAllowBeanDefinitionOverriding * @see DefaultListableBeanFactory#setAllowCircularReferences * @see DefaultListableBeanFactory#setAllowRawInjectionDespiteWrapping * @see DefaultListableBeanFactory#setAllowEagerClassLoading */ protected void customizeBeanFactory(DefaultListableBeanFactory beanFactory) &#123; if (this.allowBeanDefinitionOverriding != null) &#123; beanFactory.setAllowBeanDefinitionOverriding(this.allowBeanDefinitionOverriding); &#125; if (this.allowCircularReferences != null) &#123; beanFactory.setAllowCircularReferences(this.allowCircularReferences); &#125; &#125; XmlWebApplicationContextç±»ä¸­loadBeanDefinitionsï¼ˆbeanFactoryï¼‰12345678910111213141516@Override protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException &#123; // Create a new XmlBeanDefinitionReader for the given BeanFactory. XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory); // Configure the bean definition reader with this context&apos;s // resource loading environment. beanDefinitionReader.setEnvironment(getEnvironment()); beanDefinitionReader.setResourceLoader(this); beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this)); // Allow a subclass to provide custom initialization of the reader, // then proceed with actually loading the bean definitions. initBeanDefinitionReader(beanDefinitionReader); loadBeanDefinitions(beanDefinitionReader); &#125; AbstractApplicationContextè°ƒç”¨loadBeanDefinitions(DefaultListableBeanFactory beanFactory) ï¼Œæ­¤æ–¹æ³•æ ¹æ®é¦–å…ˆåˆ›å»ºXmlBeanDefinitionReaderå¯¹è±¡ï¼Œç„¶åé…ç½®è¯¥å¯¹è±¡çš„ä¸Šä¸‹æ–‡å’Œèµ„æºåŠ è½½ç¯å¢ƒï¼ŒåŒæ—¶è°ƒç”¨å­ç±»å®ç°çš„initBeanDefinitionReaderå¯¹XmlBeanDefinitionReaderè¿›è¡Œä¸ªæ€§åŒ–é…ç½®ï¼Œæœ€è¿‘åå…¥åˆ°initBeanDefinitionReader(beanDefinitionReader)çš„è°ƒç”¨ï¼š æ®ç»™å®šçš„BeanFactoryåˆ›å»ºXmlBeanDefinitionReader å¯¹è±¡ é…ç½®beanDefinitionReaderçš„ä¸Šä¸‹æ–‡å’Œèµ„æºåŠ è½½ç¯å¢ƒ ç”¨å­ç±»å®ç°çš„initBeanDefinitionReaderå¯¹XmlBeanDefinitionReaderè¿›è¡Œä¸ªæ€§åŒ–é…ç½®initBeanDefinitionReader(beanDefinitionReader); è°ƒç”¨è½½å…¥Beanå®šä¹‰çš„æ–¹æ³•ï¼Œåœ¨å½“å‰ç±»ä¸­åªå®šä¹‰äº†æŠ½è±¡çš„loadBeanDefinitionsæ–¹æ³•ï¼Œå…·ä½“çš„å®ç°è°ƒç”¨å­ç±»å®¹å™¨ è£…è½½beanå®šä¹‰é€šè¿‡XmlBeanDefinitionReaderã€‚ 123456789101112// Create a new XmlBeanDefinitionReader for the given BeanFactory. é€šè¿‡ç»™å®šçš„beanå·¥å‚åˆ›å»ºä¸€ä¸ªæ–°çš„XmlBeanDefinitionReader1.XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);2.ä½¿ç”¨ä¸Šä¸‹æ–‡çš„èµ„æºåŠ è½½ç¯å¢ƒé…ç½®beanå®šä¹‰è¯»å–å™¨ã€‚ beanDefinitionReader.setEnvironment(getEnvironment()); beanDefinitionReader.setResourceLoader(this); beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));3.å…è®¸å­ç±»æä¾›readerçš„è‡ªå®šä¹‰åˆå§‹åŒ–ï¼Œç„¶åç»§ç»­å®é™…åŠ è½½beanå®šä¹‰ã€‚ //é€šè¿‡åˆ¶å®šçš„XmlBeanDefinitionReaderæ¥è½½å…¥beandefinitionReader initBeanDefinitionReader(beanDefinitionReader) // é€šè¿‡åˆ¶å®šçš„XmlBeanDefinitionReaderæ¥è½½å…¥bean definitions loadBeanDefinitions(beanDefinitionReader) AbstractApplicationContextè°ƒç”¨loadBeanDefinitions(beanDefinitionReader)ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å–å¾—èµ„æºæˆ–èµ„æºè·¯å¾„ç„¶åé€šè¿‡ä¼ å…¥çš„readerå»åŠ è½½BeanDefinitionsã€‚ 2ã€loadBeanDefinitionsç›®å‰ä½¿ç”¨Springçš„é…ç½®éƒ½æ˜¯åŸºäºXMLçš„ï¼Œå› æ­¤ä½¿ç”¨XmlBeanDefinitionReader ä¸­çš„loadBeanDefinitionsæ–¹æ³•ã€‚ çœ‹doLoadBeanDefinitions,è¿™ä¸ªå°±æ˜¯å…·ä½“çš„è¯»å–æ–‡ä»¶é…ç½®ï¼Œç„¶åæ³¨å†ŒæˆBean 3ã€prepareBeanFactoryé…ç½®å·¥å‚çš„æ ‡å‡†ä¸Šä¸‹æ–‡ç‰¹æ€§ï¼Œå¦‚ä¸Šä¸‹æ–‡çš„ç±»è£…è½½å™¨å’Œåå¤„ç†å™¨ã€‚ å‘Šè¯‰å†…éƒ¨beanå·¥å‚ä½¿ç”¨ä¸Šä¸‹æ–‡çš„ç±»è£…å…¥å™¨ç­‰ã€‚ ä¸Šä¸‹æ–‡å›è°ƒé…ç½®beanå·¥å‚ã€‚ BeanFactoryæ¥å£æœªç™»è®°ä¸ºæ™®é€šå·¥å‚çš„è§£æå¼ã€‚MessageSourceç™»è®°ï¼ˆä¸ºè‡ªåŠ¨è£…é…åˆ›å»ºï¼‰ä½œä¸ºä¸€ä¸ªBean å¦‚æœåˆ›å»ºï¼›å°±å»å¯»æ‰¾LoadTimeWeaverï¼Œç„¶åå‡†å¤‡ç»„ç»‡ æ³¨å†Œé»˜è®¤ç¯å¢ƒbeanã€‚ é€šè¿‡æ–­ç‚¹æ¥çœ‹ä¸‹å½“å‰çš„beanFactory ç»§ç»­æ‰§è¡Œâ€¦ beanDefinitionMap manualSingletonNames 4ã€postProcessBeanFactoryæ³¨å†Œwebç‰¹æ€§çš„å…¨å±€åŸŸ 1).registerWebApplicationScopesæ³¨å†Œå…·æœ‰webç‰¹æ€§çš„åŸŸï¼›åŒ…æ‹¬ï¼šâ€requestâ€, â€œsessionâ€, â€œglobalSessionâ€, â€œapplicationâ€ çœ‹ä¸‹å­˜å‚¨ç»“æ„ï¼šregisterScopeæ–¹æ³•2).registerEnvironmentBeans æ³¨å†Œwebç‰¹æ€§ ç¯å¢ƒbeanï¼ˆâ€œcontextparametersâ€ã€â€œContextAttributeâ€ï¼‰ä¸ç»™å®šçš„WebApplicationContextä½¿ç”¨BeanFactoryã€‚ 1.servletContext2.servletConfig3.registerSingleton è¿™é‡Œæ˜¯æ‰¾åˆ°äº†æˆ‘ä»¬é»˜è®¤çš„é…ç½®æ–‡ä»¶å‚æ•°ï¼šbeanName=contextParameters æœ€åæ˜¯å°†contextAttributesæ”¾å…¥ï¼›contextAttributesä¸­åŒ…å«çš„å±æ€§å€¼æ¯”è¾ƒå¤šï¼Œå…·ä½“å¦‚ä¸‹é¢æ‰€ç¤ºï¼š ä¸»è¦åŒ…æ‹¬ï¼šjavax.servlet.context.tempdir,org.apache.catalina.resources, org.springframework.web.context.support.ServletContextScope, org.apache.tomcat.util.scan.MergedWebXml,org.apache.tomcat.InstanceManager,org.apache.catalina.jsp_classpath,javax.websocket.server.ServerContainer,org.apache.tomcat.JarScanner è¿™é‡Œæ˜¯æŠŠéœ€è¦çš„ä¸œè¥¿å…¨éƒ¨è½½å…¥è¿›æ¥äº†ï¼Œæœ‰å¾ˆå¤šã€‚å°±ä¸è´´äº†(mime-mapping)â€¦. 5ã€invokeBeanFactoryPostProcessorsBeanDefinitionRegistryPostProcessorå®ä¾‹åŒ–ï¼šæ ‡å‡†BeanFactoryPostProcessorçš„æ‰©å±•ï¼ŒBeanFactoryPostProcessorçš„ä½œç”¨æ˜¯ç”¨æ¥è¿›ä¸€æ­¥å®šä¹‰æ³¨å†Œçš„BeanDefinitionï¼ŒIoCå®¹å™¨æœ¬è´¨å°±æ˜¯Beanç®¡ç†ï¼Œæ‰€ä»¥BeanFactoryPostProcessoræœ¬èº«ä¹Ÿæ˜¯Beanï¼Œè¦å¯¹BeanFactoryPostProcessorçš„BeanDefinitionè¿›ä¸€æ­¥å®šä¹‰å°±é€šè¿‡BeanDefinitionRegistryPostProcessorè¿›è¡Œæ³¨å†Œï¼ŒBeanDefinitionRegistryPostProcessoråŠå…¶å­ç±»æ˜¯Iocå®¹å™¨æœ€å®ä¾‹åŒ–çš„ä¸€ç±»Beanã€‚å®ƒä»¬åœ¨ConfigurableApplicationContextï¼ˆApplicationContextå­æ¥å£ï¼‰å®ç°ç±»è°ƒç”¨refresh()æ–¹æ³•è°ƒç”¨invokeBeanFactoryPostProcessors(beanFactory);æ–¹æ³•æ—¶å°±è¢«å®ä¾‹åŒ–ã€‚ OKï¼Œä»Šå¤©å…³äºè¿™éƒ¨åˆ†çš„åˆ†æå°±åˆ°æ­¤ç»“æŸäº†ï¼Œåé¢çš„è¿‡ç¨‹ä¼šåœ¨ä¸‹ä¸€ç¯‡Springç³»åˆ—æ–‡ç« ä¸­ç»§ç»­æ¥è®²refreshä¸­çš„è¿‡ç¨‹ã€‚ å¦‚æœæ‚¨å¯¹ç³»åˆ—æ–‡ç« æœ‰ä»»ä½•æ„è§ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæ„Ÿè°¢å¤§å®¶ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-å·¥å‚æ¨¡å¼]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-design-model-factory%2F</url>
    <content type="text"><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„å››å¤§åŸºç¡€ç‰¹æ€§èœé¸Ÿæˆé•¿ç³»åˆ—-å¤šæ€ã€æ¥å£å’ŒæŠ½è±¡ç±»èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„6ç§è®¾è®¡åŸåˆ™èœé¸Ÿæˆé•¿ç³»åˆ—-å•ä¾‹æ¨¡å¼ ä¸Šä¸€ç¯‡æˆ‘ä»¬å·²ç»å¯¹åˆ›å»ºå‹æ¨¡å¼ä¸­çš„å•ä¾‹æ¨¡å¼è¿›è¡Œäº†å­¦ä¹ ï¼Œä»Šå¤©æ¥å­¦ä¹ å¦å¤–ä¸€ä¸ªæ¯”è¾ƒé‡è¦å¹¶ä¸”ç»å¸¸ä½¿ç”¨çš„æ¨¡å¼-å·¥å‚æ¨¡å¼ï¼›å·¥å‚æ¨¡å¼ä¸“é—¨è´Ÿè´£å°†å¤§é‡æœ‰å…±åŒæ¥å£çš„ç±»å®ä¾‹åŒ–ã€‚å…¶å¯ä»¥åŠ¨æ€çš„å†³å®šå°†å“ªä¸€ä¸ªç±»å®ä¾‹åŒ–ï¼Œä¸å¿…äº‹å…ˆçŸ¥é“æ¯æ¬¡è¦å®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚ å·¥å‚æ¨¡å¼å…·æœ‰ä»¥ä¸‹ä¸‰ç§å½¢æ€ï¼š ç®€å•å·¥å‚æ¨¡å¼ï¼šåˆç§°é™æ€å·¥å‚æ¨¡å¼ å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šåˆç§°å¤šæ€æ€§å·¥å‚æ¨¡å¼æˆ–è€…è™šæ‹Ÿæ„é€ å­æ¨¡å¼ æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šåˆç§°å·¥å…·ç®±æ¨¡å¼ æœ¬ç¯‡æ–‡ç« å°†å¯¹è¿™ä¸‰ç§å½¢æ€çš„å·¥å‚æ¨¡å¼è¿›è¡Œä¸€äº›åŸºæœ¬çš„å­¦ä¹ ï¼Œå¹¶é€šè¿‡ä¾‹å­æ¥ç›´è§‚çš„æ„Ÿå—ä¸‹ä¸åŒå½¢æ€çš„å…·ä½“å®ç°æ–¹å¼ã€‚æœ€åå†åˆ†æä¸‹JAVAä»¥åŠSpringä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚ 1ã€ç®€å•å·¥å‚æ¨¡å¼ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç®€å•å·¥å‚æ¨¡å¼æ¶‰åŠåˆ°å·¥å‚è§’è‰²ã€æŠ½è±¡äº§å“è§’è‰²ä»¥åŠå…·ä½“äº§å“è§’è‰²ç­‰ä¸‰ä¸ªè§’è‰²ã€‚å„è§’è‰²èŒèƒ½å¦‚ä¸‹ï¼š å·¥å‚ç±»ï¼šæ‹…ä»»è¿™ä¸ªè§’è‰²çš„æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒï¼Œå«æœ‰ä¸åº”ç”¨ç´§å¯†ç›¸å…³çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚å·¥å‚ç±»åœ¨å®¢æˆ·ç«¯çš„ç›´æ¥è°ƒç”¨ä¸‹åˆ›å»ºäº§å“å¯¹è±¡ï¼Œå®ƒå¾€å¾€ç”±ä¸€ä¸ªå…·ä½“çš„javaç±»å®ç° æŠ½è±¡äº§å“ï¼šæ‹…ä»»è¿™ä¸ªè§’è‰²çš„ç±»æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼æ‰€åˆ›å»ºçš„å¯¹è±¡çš„çˆ¶ç±»ï¼Œæˆ–å®ƒä»¬å…±åŒæ‹¥æœ‰çš„æ¥å£ã€‚æŠ½è±¡äº§å“è§’è‰²å¯ä»¥ç”¨ä¸€ä¸ªjavaæ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥å®ç° å…·ä½“äº§å“ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼æ‰€åˆ›å»ºçš„ä»»ä½•å¯¹è±¡éƒ½æ˜¯è¿™ä¸ªè§’è‰²çš„å®ä¾‹ï¼Œå…·ä½“äº§å“è§’è‰²ç”±ä¸€ä¸ªjavaç±»å®ç° æ¥çœ‹ä¾‹å­ï¼Œè€ƒè™‘åˆ°ä»Šå¤©æœ‰å°ä¼™ä¼´æ¥æˆ‘è¿™åšå®¢ï¼Œæœ¬demoå°†ä»¥åšèœæ¥å®ç°ä¸€æ³¢ã€‚é¦–å…ˆå·¥å‚å°±æ˜¯å¨æˆ¿ï¼ŒæŠ½è±¡ç±»å°±æ˜¯ç¬¼ç»Ÿçš„èœï¼Œå®ç°ç±»å°±æ˜¯å…·ä½“å“ªä¸ªèœã€‚ æŠ½è±¡äº§å“ 1234567891011121314package com.glmapper.design.factory;/** * æŠ½è±¡ç±»è§’è‰²ï¼šfoodæ¥å£ï¼Œçº¦æŸç±»å‹ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸Šåˆ10:38:36 * */public interface IFood &#123; /** * æä¾›ä¸€ä¸ªå±•ç¤ºé£Ÿç‰©ç»†èŠ‚çš„æ–¹æ³• * @param foodName é£Ÿç‰©åç§° */ public void showFood();&#125; å…·ä½“äº§å“-é±¼ 1234567891011121314package com.glmapper.design.factory;/** * å…·ä½“äº§å“-é£Ÿç‰©é±¼ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸Šåˆ10:51:29 * */public class FishFood implements IFood&#123; @Override public void showFood() &#123; System.out.println(&quot;ä¸€ç›˜é±¼&quot;); &#125;&#125; å…·ä½“äº§å“-åœŸè±†ä¸ 123456789101112131415package com.glmapper.design.factory;/** * * å…·ä½“é£Ÿç‰©ï¼šåœŸè±†ä¸ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸Šåˆ10:47:17 * */public class ShreddedPotatoesFood implements IFood&#123; @Override public void showFood() &#123; System.out.println(&quot;ä¸€ç›˜åœŸè±†ä¸&quot;); &#125;&#125; å·¥å‚è§’è‰² - é£Ÿç‰©å·¥å‚ 12345678910111213141516171819202122232425package com.glmapper.design.factory;/** * å·¥å‚è§’è‰²-é£Ÿç‰©å·¥å‚ * * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸Šåˆ10:41:10 * */public class SimpleFoodFactory &#123; /** * æä¾›ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºè·å–é£Ÿç‰© * @param foodType é£Ÿç‰©ç±»å‹ * @return å…·ä½“é£Ÿç‰© */ public static IFood getFood(String foodType)&#123; IFood food = null; if (foodType.equals(&quot;fish&quot;)) &#123; food = new FishFood(); &#125; if (foodType.equals(&quot;potatoes&quot;)) &#123; food = new ShreddedPotatoesFood(); &#125; return food; &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516package com.glmapper.design.factory;/** * å®¢æˆ·ç«¯ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸Šåˆ10:45:17 * */public class MainTest &#123; public static void main(String[] args) &#123; IFood fishfood = SimpleFoodFactory.getFood(&quot;fish&quot;); fishfood.showFood(); IFood potatoesfood = SimpleFoodFactory.getFood(&quot;potatoes&quot;); potatoesfood.showFood(); &#125;&#125; ç»“æœ 12ä¸€ç›˜é±¼ä¸€ç›˜åœŸè±†ä¸ OKï¼Œèœåšå®Œäº†ï¼Œå¯ä»¥åƒäº†ã€‚ã€‚ã€‚ æˆ‘ä»¬æ¥è®¨è®ºä¸‹ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šæ¨¡å¼çš„æ ¸å¿ƒæ˜¯å·¥å‚ç±»ï¼Œè¿™ä¸ªç±»å«æœ‰å¿…è¦çš„åˆ¤æ–­é€»è¾‘ï¼Œå¯ä»¥å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºå“ªä¸€ä¸ªäº§å“ç±»çš„å®ä¾‹ã€‚è€Œå®¢æˆ·ç«¯åˆ™å¯ä»¥å…é™¤ç›´æ¥åˆ›å»ºäº§å“å¯¹è±¡çš„è´£ä»»ï¼Œè€Œä»…ä»…è´Ÿè´£æ¶ˆè´¹äº§å“å³å¯ã€‚ç”¨ä¸€å¥è¯æ¥è¯´å°±æ˜¯ï¼šç®€å•å·¥å‚æ¨¡å¼è¿™ä¸ªåšæ³•å®ç°äº†å¯¹è´£ä»»çš„åˆ†å‰²ã€‚ç¼ºç‚¹ï¼šé›†ä¸­äº†æ‰€æœ‰äº§å“çš„åˆ›å»ºé€»è¾‘ï¼Œå½¢æˆäº†ä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„å…¨èŒç±»ï¼Œä½†æ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨è®¨è®ºè®¾è®¡åŸåˆ™çš„æ—¶å€™è¯´è¿‡ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œè¿™ç§å°±å¾ˆæ˜æ˜¾ç ´åäº†å•ä¸€èŒè´£è¿™æ¡åŸåˆ™ï¼Œå¦å¤–ä¹Ÿä¸æ»¡è¶³å¼€é—­åŸåˆ™çš„çº¦æŸã€‚å½“æˆ‘ä»¬éœ€è¦è¿›è¡Œå“ç±»æ‰©å±•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸æ–­çš„å»ä¿®æ”¹æˆ‘ä»¬çš„å·¥å‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸€æ–¹é¢æ˜¯å·¥å‚ç±»ä¼šæ€¥é€Ÿçš„è†¨èƒ€ï¼Œå¦ä¸€æ–¹é¢å› ä¸ºå›Šæ‹¬äº†ä¸åŒçš„äº§å“å¯¹äºæˆ‘ä»¬åæœŸçš„ç»´æŠ¤é€ æˆä¸€å®šçš„å½±å“ã€‚ 2ã€å·¥å‚æ–¹æ³•æ¨¡å¼è¿™ä¸ªæ—¶å€™ä¸€ä¸ªåŒäº‹è¯´ä»–æ˜¯å—æ–¹äººï¼Œå¦å¤–ä¸€ä¸ªåŒäº‹è¯´ä»–æ˜¯åŒ—æ–¹äººï¼Œåƒä¸æƒ¯ä»Šå¤©çš„èœã€‚ å¥½å§ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œé‚£æˆ‘å°±åªèƒ½ç‚¹å¤–å–äº†ã€‚ã€‚ã€‚ä½†æ˜¯ä¸ºäº†é˜²æ­¢ä»–ä»¬å˜å¦è‡ªå·±çš„å®¶ä¹¡ï¼Œæˆ‘éœ€è¦åšä¸€ä¸ªè®¡åˆ’ï¼Œä¸‹é¢å°±æ˜¯è®¡åˆ’å›¾ï¼š ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼çš„è§’è‰²åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š æŠ½è±¡å·¥å‚ï¼šæ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒï¼Œä¸åº”ç”¨ç¨‹åºæ— å…³ã€‚ä»»ä½•åœ¨æ¨¡å¼ä¸­åˆ›å»ºçš„å¯¹è±¡çš„å·¥å‚ç±»å¿…é¡»å®ç°è¿™ä¸ªæ¥å£ã€‚ å…·ä½“å·¥å‚ï¼šè¿™æ˜¯å®ç°æŠ½è±¡å·¥å‚æ¥å£çš„å…·ä½“å·¥å‚ç±»ï¼ŒåŒ…å«ä¸åº”ç”¨ç¨‹åºå¯†åˆ‡ç›¸å…³çš„é€»è¾‘ï¼Œå¹¶ä¸”å—åˆ°åº”ç”¨ç¨‹åºè°ƒç”¨ä»¥åˆ›å»ºäº§å“å¯¹è±¡ã€‚ æŠ½è±¡äº§å“ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼æ‰€åˆ›å»ºçš„å¯¹è±¡çš„è¶…ç±»å‹ï¼Œä¹Ÿå°±æ˜¯äº§å“å¯¹è±¡çš„å…±åŒçˆ¶ç±»æˆ–å…±åŒæ‹¥æœ‰çš„æ¥å£ å…·ä½“äº§å“ï¼šè¿™ä¸ªè§’è‰²å®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ã€‚æŸå…·ä½“äº§å“æœ‰ä¸“é—¨çš„å…·ä½“å·¥å‚åˆ›å»ºï¼Œå®ƒä»¬ä¹‹é—´å¾€å¾€ä¸€ä¸€å¯¹åº”ã€‚ å› ä¸ºæˆ‘çš„åŒäº‹éƒ½æ˜¯æ¥è‡ªä¸åŒåœ°æ–¹çš„ï¼Œä»–ä»¬çš„å£å‘³ä¹Ÿéƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯å‘¢åŒäº‹éƒ½æ˜¯ç¬¬ä¸€æ¬¡æ¥æˆ‘å®¶åƒé¥­ï¼Œæ‰€ä»¥ä¸ºäº†æ‹›å¾…å‘¨å…¨ï¼Œæ ¹æ®åŒäº‹ä¸åŒçš„å£å‘³å«ä¸åŒå£å‘³çš„é±¼ã€‚ æŠ½è±¡å·¥å‚è§’è‰²ï¼šè·å–é£Ÿç‰© 1234567891011package com.glmapper.design.factory;/** * * è§’è‰²1ï¼šæŠ½è±¡å·¥å‚ - è´Ÿè´£è·å–é£Ÿç‰© * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸‹åˆ1:59:28 */public interface MethodFoodFactory &#123; //è·å–é£Ÿç‰©çš„æ–¹æ³• public IFishFood getFood();&#125; å…·ä½“å·¥å‚1ï¼šè·å–å—æ–¹é£Ÿç‰©-é±¼ 123456789101112package com.glmapper.design.factory;/** * å—æ–¹å£å‘³å¤–å– - é±¼ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸‹åˆ2:03:36 */public class SouthFishFactory implements MethodFoodFactory&#123; @Override public IFishFood getFood() &#123; return new SouthFishFood(); &#125;&#125; å…·ä½“å·¥å‚2ï¼šè·å–åŒ—æ–¹é£Ÿç‰©-é±¼ 1234567891011121314package com.glmapper.design.factory;/** * åŒ—æ–¹å£å‘³å¤–å– - é±¼ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸‹åˆ2:03:36 */public class NorthFishFactory implements MethodFoodFactory&#123; @Override public IFishFood getFood() &#123; // TODO Auto-generated method stub return new NorthFishFood(); &#125;&#125; å…·ä½“äº§å“1ï¼šå—æ–¹é£Ÿç‰©- é±¼ 123456789101112package com.glmapper.design.factory;/** * å—æ–¹å£å‘³-é±¼ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸‹åˆ2:16:17 */public class SouthFishFood implements IFishFood&#123; @Override public void showFood() &#123; System.out.println(&quot;æ¥è‡ªå—æ–¹å¨å¸ˆåšçš„é±¼&quot;); &#125;&#125; å…·ä½“äº§å“2ï¼šåŒ—æ–¹é£Ÿç‰©-é±¼ 123456789101112package com.glmapper.design.factory;/** * åŒ—æ–¹å£å‘³ - é±¼ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸‹åˆ2:12:55 */public class NorthFishFood implements IFishFood &#123; @Override public void showFood() &#123; System.out.println(&quot;æ¥è‡ªåŒ—æ–¹å¨å¸ˆåšçš„é±¼&quot;); &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415161718package com.glmapper.design.factory;/** * å®¢æˆ·ç«¯ * @author glmapper * @date 2017å¹´12æœˆ24æ—¥ä¸Šåˆ10:45:17 */public class MainTest &#123; public static void main(String[] args) &#123; //ç‚¹ä¸€ä¸ªå—æ–¹å£å‘³å¤–å– MethodFoodFactory southFoodFactory = new SouthFishFactory(); //ç‚¹ä¸€ä¸ªåŒ—æ–¹å£å‘³å¤–å– MethodFoodFactory northFoodFactory = new NorthFishFactory(); //æ‹¿åˆ°å—æ–¹å£å‘³å¤–å–é±¼ southFoodFactory.getFood().showFood(); //æ‹¿åˆ°åŒ—æ–¹å£å‘³å¤–å–é±¼ northFoodFactory.getFood().showFood(); &#125;&#125; ç»“æœï¼š12æ¥è‡ªå—æ–¹å¨å¸ˆåšçš„é±¼æ¥è‡ªåŒ—æ–¹å¨å¸ˆåšçš„é±¼ OKï¼Œè¿™æ ·æˆ‘ä»¬å°±æ»¡è¶³äº†ä¸åŒåŒºåŸŸåŒæ—¶å…³äºé±¼å£å‘³çš„éœ€æ±‚äº†ï¼Œä»¥åå‡å€¼åŠ è–ªå°±æŒ‡æœ›ä»–ä»¬äº†ã€‚ã€‚ã€‚ å…³äºå·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼š1ã€ åœ¨å·¥å‚æ–¹æ³•ä¸­ï¼Œç”¨æˆ·åªéœ€è¦çŸ¥é“æ‰€è¦äº§å“çš„å…·ä½“å·¥å‚ï¼Œæ— é¡»å…³ç³»å…·ä½“çš„åˆ›å»ºè¿‡ç¨‹ï¼Œç”šè‡³ä¸éœ€è¦å…·ä½“äº§å“ç±»çš„ç±»åã€‚2ã€ åœ¨ç³»ç»Ÿå¢åŠ æ–°çš„äº§å“æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªå…·ä½“äº§å“ç±»å’Œå¯¹åº”çš„å®ç°å·¥å‚ï¼Œæ— éœ€å¯¹åŸå·¥å‚è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œå¾ˆå¥½åœ°ç¬¦åˆäº†â€œå¼€é—­åŸåˆ™â€ç¼ºç‚¹ï¼šæ¯æ¬¡å¢åŠ ä¸€ä¸ªäº§å“æ—¶ï¼Œéƒ½éœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“ç±»å’Œå¯¹è±¡å®ç°å·¥å‚ï¼Œæ˜¯çš„ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°æˆå€å¢åŠ ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ç³»ç»Ÿå…·ä½“ç±»çš„ä¾èµ–ã€‚è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆå¥½äº‹ã€‚ 3ã€æŠ½è±¡å·¥å‚æ¨¡å¼å‡†å¤‡åƒé¥­çš„æ—¶å€™çªç„¶åˆæ¥äº†å‡ ä½åŒäº‹ï¼Œè€Œä¸”ä»–ä»¬æœ‰çš„å–œæ¬¢åƒé…¸èœé±¼ï¼Œæœ‰çš„å–œæ¬¢åƒçº¢çƒ§é±¼ï¼Œè¿™å°±å¾ˆå¤´ç–¼ã€‚äºæ˜¯ï¼Œåªèƒ½æ ¹æ®ä»–ä»¬çš„éœ€è¦ç»§ç»­ç‚¹å¤–å–ã€‚ï¼ˆè¿™ä¸ªå°±ç»™å‡ºä¸€ä¸ªç»“æ„å›¾ï¼Œå¹¶ä¸”å°†æ¯ç§è§’è‰²éƒ½ç”¨å…·ä½“çš„åœºæ™¯æ¥è¯´æ˜äº†ï¼Œå…·ä½“çš„ä»£ç å¯ä»¥å‚è€ƒè¿™ä¸ªå›¾ä¾‹è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚ï¼‰ OKï¼Œç»ˆäºå¯ä»¥åƒé¥­äº†ï¼ 4ã€ä¸‰ç§å½¢æ€çš„å·¥å‚æ¨¡å¼åœ¨javaä¸­çš„ä½¿ç”¨4.1ã€ç®€å•å·¥å‚æ¨¡å¼åœ¨javaä¸­çš„ä½¿ç”¨java.text.DateFormat ï¼ˆä¸€ä¸ªæŠ½è±¡ç±»ï¼‰è¿™ä¸ªç±»ç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½ç”¨åˆ°è¿‡ï¼Œåœ¨java APIä¸­ï¼Œè¿™ä¸ªç±»ç®—æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼çš„å…¸å‹åº”ç”¨äº†ï¼ˆæ­¤å¤„è¿˜æ˜¯ä¸ä¸Šç¯‡ä¸€æ ·ï¼Œä¸è€ƒè™‘æœŸæºç ç»†èŠ‚ï¼Œä¹Ÿä¸ä»‹ç»åŸºæœ¬ç”¨æ³•ï¼‰ã€‚æ¥çœ‹å®ƒçš„å‡ ä¸ªæ–¹æ³•ï¼š public final static DateFormat getDateInstance() public final static DateFormat getDateInstance(int style) public final static DateFormat getDateInstance(int style, Locale aLocale) ä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå´æä¾›äº†å¾ˆå¤šçš„é™æ€å·¥å‚æ–¹æ³•ï¼Œå°±åƒä¸Šé¢åˆ—ä¸¾çš„é‚£ä¸‰ä¸ªä¸€æ ·ã€‚æœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ï¼Œä¸ºå•¥å­ä¸€ä¸ªæŠ½è±¡ç±»é˜”ä»¥æœ‰è‡ªå·±çš„å®ä¾‹ï¼Œå¹¶é€šè¿‡å‡ ä¸ªæ–¹æ³•æä¾›è‡ªå·±çš„å®ä¾‹ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒæŠ½è±¡ç±»æ˜¯ä¸å¯ä»¥æœ‰è‡ªå·±çš„å®ä¾‹å¯¹è±¡çš„ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDateFormatçš„å·¥å‚æ–¹æ³•æ˜¯é™æ€çš„ï¼Œå¹¶ä¸æ˜¯æ™®é€šçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦é€šè¿‡åˆ›å»ºå®ä¾‹å¯¹è±¡çš„æ–¹å¼å»è°ƒç”¨ã€‚ 1234public final static DateFormat getDateInstance()&#123; return get(0, DEFAULT, 2, Locale.getDefault(Locale.Category.FORMAT));&#125; getDateInstanceæ–¹æ³•å¹¶æ²¡æœ‰é€šè¿‡è°ƒç”¨DateFormatçš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚ 4.2ã€å·¥å‚æ–¹æ³•æ¨¡å¼åœ¨javaä¸­çš„åº”ç”¨java.net.URLç±»ï¼Œç±»å›¾å¦‚ä¸‹ï¼ŒURLå¯¹è±¡é€šè¿‡ä¸€ä¸ªå·¥å‚æ–¹æ³•openConnection()è¿”å›ä¸€ä¸ªURLConnectionç±»å‹çš„å¯¹è±¡ã€‚URLConnectionæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå› æ­¤æ‰€è¿”è¿˜çš„ä¸å¯èƒ½æ˜¯è¿™ä¸ªæŠ½è±¡ç±»çš„å®ä¾‹ï¼Œè€Œå¿…ç„¶æ˜¯å…¶å…·ä½“å­ç±»çš„å®ä¾‹ã€‚ 4.3ã€æŠ½è±¡å·¥å‚æ¨¡å¼åœ¨javaä¸­çš„åº”ç”¨æ ¹æ®javaä¸æ¨¡å¼ä¸€ä¹¦çš„ä»‹ç»ï¼Œåœ¨javaä¸­ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼çš„æ˜¯ JAVA awtçš„peeræ¶æ„ï¼Œé€šè¿‡æŠ½è±¡å·¥å‚æ¨¡å¼æ¥æ„å»ºåˆ†å±äºä¸åŒæ“ä½œç³»ç»Ÿçš„peeræ„ä»¶ã€‚è¿™ä¸ªæˆ‘ä¹Ÿæ²¡ç”¨è¿‡ï¼Œäº†è§£å³å¯ã€‚ å…³äºSpringä¸­å·¥å‚æ¨¡å¼çš„ä½¿ç”¨ä¼šåœ¨åç»­Springæºç åˆ†æç³»åˆ—ä¸­ç»™å¤§å®¶è¯¦ç»†åˆ†æï¼Œè¿™é‡Œå°±ä¸é‡å¤äº†ã€‚ ä»Šå¤©çš„å­¦ä¹ å°±åˆ°æ­¤ç»“æŸäº†ï¼Œç¥å¤§å®¶å‘¨æœ«æ„‰å¿«ã€‚è¯è¯´ä»Šå¤©å¹³å®‰å¤œï¼Œå¤§å®¶éƒ½æ˜¯åœ¨å®¶å†™ä»£ç å—ï¼Ÿ å¦‚æœæ‚¨å¯¹ç³»åˆ—æ–‡ç« æœ‰ä»»ä½•æ„è§ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæ„Ÿè°¢å¤§å®¶ã€‚]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-å•ä¾‹æ¨¡å¼]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-design-model-singleton%2F</url>
    <content type="text"><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„å››å¤§åŸºç¡€ç‰¹æ€§èœé¸Ÿæˆé•¿ç³»åˆ—-å¤šæ€ã€æ¥å£å’ŒæŠ½è±¡ç±»èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„6ç§è®¾è®¡åŸåˆ™ å‰é¢å·²ç»å°†è®¾è®¡æ¨¡å¼ä¸­çš„åŸºæœ¬å†…å®¹æ’¸äº†ä¸€ä¸‹ï¼Œä»Šå¤©å¼€å§‹æ­£å¼å¼€å§‹è®¾è®¡æ¨¡å¼ç³»åˆ—çš„å†…å®¹ï¼Œå› ä¸ºç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå…³äºè®¾è®¡æ¨¡å¼çš„æŠ€æœ¯åšå®¢ï¼Œä»ä¸åŒçš„è§’åº¦å¯¹è®¾è®¡æ¨¡å¼éƒ½åšäº†å¾ˆè¯¦ç»†çš„è§£è¯»ï¼›æœ¬ç³»åˆ—çš„æ¨¡å¼é™¤äº†åŸºæœ¬çš„æ¦‚å¿µå’Œæ¨¡å‹ä¹‹å¤–ï¼Œè¿˜ä¼šç»“åˆjavaè‡ªèº«ä½¿ç”¨çš„å’ŒSpringä¸­ä½¿ç”¨çš„ä¸€äº›æ¡ˆä¾‹æ¥è¿›è¡Œå­¦ä¹ åˆ†æã€‚æ°´å¹³æœ‰é™ï¼Œå¦‚æœå­˜åœ¨ä¸å½“ä¹‹å¤„ï¼Œå¸Œæœ›å¤§å®¶å¤šææ„è§ï¼Œç°å¸¸æ„Ÿè°¢ï¼è®¾è®¡æ¨¡å¼ä¸­æ€»ä½“åˆ†ä¸ºä¸‰ç±»:ä¸€ã€åˆ›å»ºå‹(5)ï¼š å·¥å‚æ–¹æ³•[Factory Method] æŠ½è±¡å·¥å‚[Abstract Factory] åŸå‹[Prototype] å»ºé€ è€…[Builder] å•ä¾‹[Singleton] è¿˜æœ‰ä¸€ä¸ªç®€å•å·¥å‚[Simple Factory]ï¼Œç›®å‰æœ‰ä¸¤ç§ï¼Œæœ‰çš„æŠŠå•ä¾‹æ¨¡å¼ä½œä¸ºè¿™5ç§ä¹‹ä¸€ï¼Œæœ‰çš„æ˜¯å°†ç®€å•å·¥å‚ä½œä¸ºè¿™5ç§ä¹‹ä¸€ã€‚è¿™é‡Œä¸åšè®¨è®ºï¼ŒåŸåˆ™ä¸Šä¸¤ä¸ªéƒ½æ˜¯ï¼Œåªæ˜¯åˆ’åˆ†è§„åˆ™ä¸åŒã€‚ äºŒã€ç»“æ„å‹(7) é€‚é…å™¨[Adapter] æ¡¥æ¥[Bridge] ç»„åˆ[Composite] è£…é¥°[Decorator] å¤–è§‚[Facade] äº«å…ƒ[Flyweight] ä»£ç†[Proxy] ä¸‰ã€è¡Œä¸ºå‹(11) ç­–ç•¥[Strategy] æ¨¡æ¿æ–¹æ³•[Template method] èŒè´£é“¾[Chain of Responsibility] è¿­ä»£å™¨[Iterator] çŠ¶æ€[State] è®¿é—®è€…[Visitor] å‘½ä»¤[Command] å¤‡å¿˜å½•[Memento] è§‚å¯Ÿè€…[Observer] ä¸­ä»‹è€…[Mediator] è§£é‡Šå™¨[Interpreter] å•ä¾‹æ¨¡å¼é¦–å…ˆå®ƒæ˜¯ä¸€ç§åˆ›å»ºå‹æ¨¡å¼ï¼Œä¸å…¶ä»–æ¨¡å¼åŒºåˆ«åœ¨äºï¼šå•ä¾‹æ¨¡å¼ç¡®ä¿è¢«åˆ›å»ºçš„ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ç§°å½“å‰è¿™ä¸ªç±»ä¸ºå•ä¾‹ç±»ã€‚ ä»ä¸Šé¢è¿™æ®µè¯ä¸­æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œå•ä¾‹æ¨¡å¼å…·å¤‡ä»¥ä¸‹ä¸‰ä¸ªè¦ç‚¹ï¼š æŸä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ å¿…é¡»è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹[å…·ä½“çš„å¯¹è±¡åˆ›å»ºç”±ç±»æœ¬èº«è´Ÿè´£ï¼Œå…¶ä»–ç±»ä¸è´Ÿè´£å½“å‰ç±»çš„åˆ›å»º] å¿…é¡»å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹[ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰ç±»éœ€è¦å¯¹å¤–æä¾›ä¸€ä¸ªè·å–å½“å‰å®ä¾‹çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸”è¯¥æ–¹æ³•ä¸èƒ½æ˜¯ç§æœ‰çš„] OKï¼Œæ¥çœ‹å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼ã€‚ æ–¹å¼ä¸€ï¼šé¥¿æ±‰å¼123456789101112131415161718192021222324252627package com.glmapper.design.singleton;/** * å•ä¾‹æ¨¡å¼-é¥¿æ±‰å¼ * @author glmapper * @date 2017å¹´12æœˆ17æ—¥ä¸‹åˆ10:30:38 */public class EagerSingleton &#123; /** * å†…éƒ¨ç›´æ¥æä¾›ä¸€ä¸ªeagerSingletonInstanceï¼› * æˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«static finalä¿®é¥°äº†ï¼Œé‚£ä¹ˆè¯¥å˜é‡å°†ä¼šè¢«è§†ä¸ºå¸¸é‡ã€‚ * æ»¡è¶³è¦ç‚¹ï¼šè‡ªè¡Œåˆ›å»º */ private static final EagerSingleton eagerSingletonInstance = new EagerSingleton(); /** * æä¾›ä¸€ä¸ªç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œè¿™æ ·å…¶ä»–ç±»å°±æ— æ³•é€šè¿‡new * EagerSingleton()æ¥è·å–å¯¹è±¡äº†ï¼ŒåŒæ ·ä¹Ÿä¿è¯äº†å½“å‰ç±»ä¸å¯ä»¥è¢«ç»§æ‰¿ * æ»¡è¶³è¦ç‚¹ï¼šæŸä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ */ private EagerSingleton()&#123;&#125; /** * å¯¹å¤–æä¾›ä¸€ä¸ªè·å–å®ä¾‹çš„æ–¹æ³• * æ»¡è¶³è¦ç‚¹ï¼šå‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ */ public static EagerSingleton getInstance()&#123; return eagerSingletonInstance; &#125;&#125; æ–¹å¼äºŒï¼šæ‡’æ±‰å¼ 1234567891011121314151617181920212223package com.glmapper.design.singleton;/** * å•ä¾‹æ¨¡å¼-æ‡’æ±‰å¼ * @author glmapper * @date 2017å¹´12æœˆ17æ—¥ä¸‹åˆ10:45:54 */public class LazySingleton &#123; //æä¾›ä¸€ä¸ªç§æœ‰é™æ€å˜é‡ï¼Œæ³¨æ„åŒºåˆ«ä¸é¥¿æ±‰å¼ä¸­çš„static finalã€‚ private static LazySingleton lazySingletonInstance = null ; //åŒæ ·éœ€è¦æä¾›ä¸€ä¸ªç§æœ‰çš„æ„é€ æ–¹æ³•ï¼Œå…¶ä½œç”¨ä¸é¥¿æ±‰å¼ä¸­çš„ä½œç”¨ä¸€æ · private LazySingleton()&#123;&#125; /** * 1.ä½¿ç”¨synchronizedæ¥ä¿è¯çº¿ç¨‹åŒæ­¥ * 2.å®ä¾‹çš„å…·ä½“åˆ›å»ºè¢«å»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•æ—¶æ¥è¿›è¡Œ * 3.å¦‚æœå½“å‰å®ä¾‹å·²ç»å­˜åœ¨ï¼Œä¸å†é‡å¤åˆ›å»º */ public synchronized static LazySingleton getInstance()&#123; if (lazySingletonInstance == null) &#123; lazySingletonInstance = new LazySingleton(); &#125; return lazySingletonInstance; &#125;&#125; é¥¿æ±‰å¼å•ä¾‹ç±»åœ¨è‡ªå·±è¢«åŠ è½½æ—¶å°±è‡ªå·±å®ä¾‹åŒ–äº†ï¼Œå³ä¾¿åŠ è½½å™¨æ˜¯é™æ€çš„ï¼Œåœ¨é¥¿æ±‰å¼å•ä¾‹ç±»è¢«åŠ è½½æ—¶ä»ä¼šå°†è‡ªå·±å®ä¾‹åŒ–ã€‚ä»èµ„æºåˆ©ç”¨è§’åº¦æ¥è¯´ï¼Œè¿™ä¸ªæ¯”æ‡’æ±‰å¼å•ä¾‹ç±»ç¨å¾®çš„å·®ä¸€äº›ã€‚å¦‚æœä»é€Ÿåº¦å’Œå“åº”æ—¶é—´æ¥çœ‹ï¼Œé¥¿æ±‰å¼å°±ä¼šæ¯”æ‡’æ±‰å¼å¥½ä¸€äº›ã€‚æ‡’æ±‰å¼åœ¨å•ä¾‹ç±»è¿›è¡Œå®ä¾‹åŒ–æ—¶ï¼Œå¿…é¡»å¤„ç†å¥½åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶é¦–æ¬¡å¼•ç”¨æ­¤ç±»æ—¶çš„è®¿é—®é™åˆ¶é—®é¢˜ã€‚ æ–¹å¼ä¸‰ï¼šç™»è®°å¼ 123456789101112131415161718192021222324252627282930313233343536373839package com.glmapper.design.singleton;import java.util.HashMap;/** * å•ä¾‹æ¨¡å¼-ç™»è®°å¼ * @author glmapper * @date 2017å¹´12æœˆ17æ—¥ä¸‹åˆ10:58:36 */public class RegisterSingleton &#123; //æä¾›ä¸€ä¸ªç§æœ‰çš„HashMapç±»å‹çš„registerSingletonInstanceå­˜å‚¨è¯¥RegisterSingletonç±»å‹çš„å•ä¾‹ private static HashMap&lt;String,Object&gt; registerSingletonInstance = new HashMap&lt;&gt;(); //é€šè¿‡staticé™æ€ä»£ç å—æ¥è¿›è¡Œåˆå§‹åŒ–RegisterSingletonå½“å‰ç±»çš„å®ä¾‹ï¼Œå¹¶å°†å½“å‰å®ä¾‹å­˜å…¥registerSingletonInstance static &#123; RegisterSingleton singleton = new RegisterSingleton(); registerSingletonInstance.put(singleton.getClass().getName(), singleton); &#125; /** * æ³¨æ„åŒºåˆ«ï¼Œæ­¤å¤„æä¾›çš„æ˜¯éprivateç±»å‹çš„ï¼Œè¯´æ˜å½“å‰ç±»å¯ä»¥è¢«ç»§æ‰¿ */ protected RegisterSingleton()&#123;&#125; /** * è·å–å®ä¾‹çš„æ–¹æ³• */ public static RegisterSingleton getInstance(String name)&#123; //å¦‚æœnameä¸ºç©ºï¼Œåˆ™é‚£ä¹ˆé»˜è®¤ä¸ºå½“å‰ç±»çš„å…¨é™å®šå if (name == null) &#123; name =&quot;com.glmapper.design.singleton.RegisterSingleton&quot;; &#125; //å¦‚æœmapä¸­æ²¡æœ‰æŸ¥è¯¢åˆ°æŒ‡å®šçš„å•ä¾‹ï¼Œåˆ™å°†é€šè¿‡Class.forName(name)æ¥åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå¹¶å­˜å…¥mapä¸­ if (registerSingletonInstance.get(name)==null) &#123; try &#123; registerSingletonInstance.put(name, Class.forName(name).newInstance()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; //è¿”å›å®ä¾‹ return (RegisterSingleton) registerSingletonInstance.get(name); &#125;&#125; ç™»è®°å¼å•ä¾‹æ˜¯Gofä¸ºäº†å…‹æœé¥¿æ±‰å¼å’Œæ‡’æ±‰å¼å•ä¾‹ç±»å‡ä¸å¯è¢«ç»§æ‰¿çš„ç¼ºç‚¹è€Œè®¾è®¡çš„ã€‚ 12345678910111213141516171819202122232425262728package com.glmapper.design.singleton;/** * ç™»è®°å¼-å•ä¾‹-å­ç±» * @author glmapper * @date 2017å¹´12æœˆ17æ—¥ä¸‹åˆ11:14:03 * */public class ChildRegisterSingleton extends RegisterSingleton&#123; /** * ç”±äºå­ç±»å¿…é¡»å…è®¸çˆ¶ç±»ä»¥æ„é€ æ–¹æ³•è°ƒç”¨äº§ç”Ÿå®ä¾‹ï¼Œå› æ­¤ï¼Œå­ç±»çš„æ„é€ æ–¹æ³•å¿…é¡» * æ˜¯publicç±»å‹çš„ã€‚ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œå°±ç­‰äºè¯´å¯ä»¥å…è®¸ä»¥new * ChildRegisterSingleton()çš„æ–¹å¼äº§ç”Ÿå®ä¾‹ï¼Œè€Œä¸å¿…åœ¨çˆ¶ç±»çš„ç™»è®°ä¸­ã€‚ */ public ChildRegisterSingleton()&#123;&#125; //å®¢æˆ·ç«¯æµ‹è¯•è·å–å®ä¾‹ public static void main(String[] args) &#123; ChildRegisterSingleton crs1 = (ChildRegisterSingleton) getInstance( &quot;com.glmapper.design.singleton.ChildRegisterSingleton&quot;); ChildRegisterSingleton crs2 = (ChildRegisterSingleton) getInstance( &quot;com.glmapper.design.singleton.ChildRegisterSingleton&quot;); System.out.println(crs1 == crs2); &#125;&#125;è¿”å›ï¼štrue è¿™ä¸ªåŒå¿—ä»¬å¯ä»¥è‡ªè¡ŒéªŒè¯ï¼Œè‚¯å®šæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ä¸èƒ½ä½¿ç”¨newï¼Œå› ä¸ºå‰æçº¦æŸæ˜¯ï¼Œéœ€åœ¨çˆ¶ç±»ä¸­ç™»è®°çš„æ‰æ˜¯å•ä¾‹ã€‚ æ–¹å¼å››ï¼šåŒé‡æ£€æµ‹æ¨¡å¼ï¼ŒåŒé‡æ£€æµ‹æ–¹å¼åœ¨æŸäº›ä¹¦ä¸Šæˆ–è€…æ–‡çŒ®ä¸­è¯´å¯¹äºjavaè¯­è¨€æ¥è¯´æ˜¯ä¸æˆç«‹çš„ï¼Œä½†æ˜¯ç›®å‰ç¡®å®æ˜¯é€šè¿‡æŸç§æŠ€å·§å®Œæˆäº†åœ¨javaä¸­ä½¿ç”¨åŒé‡æ£€æµ‹æœºåˆ¶çš„å•ä¾‹æ¨¡å¼çš„å®ç°ï¼Œï¼›è¿™ç§æŠ€å·§åé¢æ¥è¯´ï¼›å…³äºä¸ºä»€ä¹ˆjavaè¯­è¨€å¯¹äºåŒé‡æ£€æµ‹æˆä¾‹ä¸æˆç«‹ï¼Œå¤§å®¶å¯ä»¥åœ¨[BLOCH01]æ–‡çŒ®ä¸­çœ‹ä¸‹å…·ä½“æƒ…å†µã€‚å…ˆæ¥çœ‹ä¸€ä¸ªå•çº¿ç¨‹æ¨¡å¼ä¸‹çš„æƒ…å†µï¼š 123456789101112131415package com.glmapper.design.singleton;/** * ä¸€ä¸ªé”™è¯¯çš„å•ä¾‹ä¾‹å­ * @author glmapper * @date 2017å¹´12æœˆ17æ—¥ä¸‹åˆ11:53:04 */public class DoubleCheckSingleton &#123; private static DoubleCheckSingleton instance=null; public static DoubleCheckSingleton getDoubleCheckSingleton()&#123; if (instance == null) &#123; instance = new DoubleCheckSingleton(); &#125; return instance; &#125;&#125; è¿™ä¸ªå¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­ï¼Œå¯¹äºA/Bä¸¤ä¸ªçº¿ç¨‹ï¼Œå› ä¸ºstep 1å¹¶æ²¡æœ‰ä½¿ç”¨åŒæ­¥ç­–ç•¥ï¼Œå› æ­¤çº¿ç¨‹A/Bå¯èƒ½ä¼šåŒæ—¶è¿›è¡Œ// step 2ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¼šå¯èƒ½åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ã€‚é‚£ä¹ˆæ­£ç¡®çš„æ–¹å¼å¦‚ä¸‹ï¼šä½¿ç”¨synchronizedå…³é”®å­—æ¥ä¿è¯åŒæ­¥ã€‚ 12345678910111213141516package com.glmapper.design.singleton;/** * è¿™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„æ‰“å¼€æ–¹å¼å“¦ã€‚ã€‚ã€‚ * @author glmapper * @date 2017å¹´12æœˆ17æ—¥ä¸‹åˆ11:53:04 */public class DoubleCheckSingleton &#123; private static DoubleCheckSingleton instance=null; //ä½¿ç”¨synchronizedæ¥ä¿è¯getDoubleCheckSingletonåŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—® public synchronized static DoubleCheckSingleton getDoubleCheckSingleton()&#123; if (instance == null) &#123; instance = new DoubleCheckSingleton(); &#125; return instance; &#125;&#125; è¿™ç§æ–¹å¼è™½ç„¶ä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨å¦å¤–ä¸€ç§é—®é¢˜ï¼šåŒæ­¥åŒ–æ“ä½œä»…ä»…åœ¨instanceé¦–æ¬¡åˆå§‹åŒ–æ“ä½œä¹‹å‰ä¼šèµ·åˆ°ä½œç”¨ï¼Œå¦‚æœinstanceå·²ç»å®Œæˆäº†åˆå§‹åŒ–ï¼Œå¯¹äºgetDoubleCheckSingletonæ¯ä¸€æ¬¡è°ƒç”¨æ¥è¯´éƒ½ä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ï¼Œé€ æˆä¸€ä¸ªä¸å¿…è¦çš„ç“¶é¢ˆã€‚é‚£æˆ‘ä»¬å°±é€šè¿‡ä½¿ç”¨æ›´åŠ ç»†ç²’åº¦åŒ–çš„é”ï¼Œæ¥é€‚å½“çš„å‡å°é¢å¤–çš„å¼€é”€ã€‚OKï¼Œä¸‹é¢å†æ¥ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­ï¼š 1234567891011121314151617181920212223package com.glmapper.design.singleton;/** * ä¸€ä¸ªé”™è¯¯çš„å•ä¾‹ä¾‹å­ * @author glmapper * @date 2017å¹´12æœˆ17æ—¥ä¸‹åˆ11:53:04 */public class DoubleCheckSingleton &#123; private static DoubleCheckSingleton instance=null; //ä½¿ç”¨synchronizedæ¥ä¿è¯getDoubleCheckSingletonåŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—® public static DoubleCheckSingleton getDoubleCheckSingleton()&#123; if (instance == null) &#123; //1 // Bçº¿ç¨‹æ£€æµ‹åˆ°uniqueInstanceä¸ä¸ºç©º synchronized (DoubleCheckSingleton.class) &#123; //2 if (instance == null) &#123; //3 instance = new DoubleCheckSingleton();//4 // Açº¿ç¨‹è¢«æŒ‡ä»¤é‡æ’äº†ï¼Œåˆšå¥½å…ˆèµ‹å€¼äº†ï¼›ä½†è¿˜æ²¡æ‰§è¡Œå®Œæ„é€ å‡½æ•°ã€‚ &#125; &#125; &#125; // åé¢Bçº¿ç¨‹æ‰§è¡Œæ—¶å°†å¼•å‘ï¼šå¯¹è±¡å°šæœªåˆå§‹åŒ–é”™è¯¯ã€‚ return instance;//5 &#125;&#125; çœ‹èµ·æ¥æ²¡ä»€ä¹ˆæ¯›ç—…å‘€ï¼Ÿæˆ‘ä»¬æ¥åˆ†æï¼Œä¸¤ä¸ªçº¿ç¨‹Aå’ŒBï¼ŒåŒæ—¶åˆ°è¾¾1,ä¸”éƒ½é€šè¿‡äº†1çš„æ£€æµ‹ã€‚æ­¤æ—¶Aåˆ°äº†4ï¼ŒBåœ¨2ã€‚æ­¤æ—¶Bçº¿ç¨‹æ£€æµ‹åˆ°instanceä¸ä¸ºç©ºï¼ŒAçº¿ç¨‹è¢«æŒ‡ä»¤é‡æ’äº†ï¼Œåˆšå¥½å…ˆèµ‹å€¼äº†ï¼›ä½†è¿˜æ²¡æ‰§è¡Œå®Œæ„é€ å‡½æ•°ï¼›å†æ¥ä¸‹æ¥Bçº¿ç¨‹æ‰§è¡Œæ—¶å°†å¼•å‘ï¼šå¯¹è±¡å°šæœªåˆå§‹åŒ–é”™è¯¯ï¼ˆ5ï¼‰ã€‚ å¯¹äºä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡volatileå…³é”®å­—æ¥ä¿®é¥°instanceå¯¹è±¡ï¼Œæ¥ä¿è¯instanceå¯¹è±¡çš„å†…å­˜å¯è§æ€§å’Œé˜²æ­¢æŒ‡ä»¤é‡æ’åºã€‚è¿™ä¸ªä¹Ÿå°±æ˜¯å‰é¢è¯´åˆ°çš„â€œæŠ€å·§â€ã€‚ 123private static DoubleCheckSingleton instance=null;æ”¹ä¸ºï¼šprivate static volatile DoubleCheckSingleton instance=null; æœ¬ç¯‡å°†å•ä¾‹æ¨¡å¼çš„å‡ ç§æƒ…å†µè¿›è¡Œäº†åˆ†æã€‚åé¢å°†ä¼šå¯¹å°†javaä¸­å’ŒSpringä¸­æ‰€ä½¿ç”¨çš„å•ä¾‹åœºæ™¯è¿›è¡Œå…·ä½“çš„æ¡ˆä¾‹åˆ†æã€‚ JAVAä¸­çš„å•ä¾‹æ¨¡å¼ä½¿ç”¨JAVAä¸­å¯¹äºå•ä¾‹æ¨¡å¼çš„ä½¿ç”¨æœ€ç»å…¸çš„å°±æ˜¯RunTimeè¿™ä¸ªç±»ã€‚æ³¨é‡Šè§£è¯»ï¼šæ¯ä¸ªJavaåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªRuntimeç±»çš„å•ä¸ªå®ä¾‹ï¼Œå…è®¸åº”ç”¨ç¨‹åºä¸è¿è¡Œåº”ç”¨ç¨‹åºçš„ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚ å½“å‰è¿è¡Œæ—¶å¯ä»¥ä»getRuntimeæ–¹æ³•è·å¾—ã€‚åº”ç”¨ç¨‹åºä¸èƒ½åˆ›å»ºå®ƒè‡ªå·±çš„è¿™ä¸ªç±»çš„å®ä¾‹ã€‚ çœ‹è¿‡ä¸Šç¯‡æ–‡ç« çš„å°ä¼™ä¼´å¯èƒ½æ¯”è¾ƒæ¸…æ¥šï¼Œè¿™é‡ŒRunTimeä½¿ç”¨çš„æ˜¯æ‡’æ±‰å¼å•ä¾‹çš„æ–¹å¼æ¥åˆ›å»ºçš„ã€‚Runtimeæä¾›äº†ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•getRuntimeæ–¹æ³•ç”¨äºè·å–Runtimeå®ä¾‹ã€‚Runtimeè¿™ä¸ªç±»çš„å…·ä½“æºç åˆ†æå’Œåªèƒ½æ­¤å¤„ä¸åšåˆ†æã€‚ Springä¸­çš„å•ä¾‹Springä¾èµ–æ³¨å…¥Beanå®ä¾‹é»˜è®¤æ˜¯å•ä¾‹çš„ã€‚Springä¸­beançš„ä¾èµ–æ³¨å…¥éƒ½æ˜¯ä¾èµ–AbstractBeanFactoryçš„getBeanæ–¹æ³•æ¥å®Œæˆçš„ã€‚é‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹åœ¨getBeanä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆã€‚ org.springframework.beans.factory.suppor.AbstractBeanFactoryä»ä¸Šé¢è¿™å¼ å›¾ä¸­æˆ‘ä»¬å•¥ä¹Ÿçœ‹ä¸å‡ºï¼ŒåªçŸ¥é“åœ¨getBeanä¸­åˆè°ƒç”¨äº†doGetBeanæ–¹æ³•ï¼ˆSpringä¸­è¿˜æœ‰javaæºç ä¸­æœ‰å¾ˆå¤šç±»ä¼¼çš„å†™æ³•ï¼Œå¥½å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥é€šè¿‡å­ç±»ç»§æ‰¿ï¼Œç»§è€Œç¼–å†™æˆ‘ä»¬è‡ªå·±çš„å¤„ç†é€»è¾‘ï¼‰ã€‚OKï¼Œå†æ¥çœ‹çœ‹doGetBeanæ–¹æ³•ã€‚ æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šï¼šè¿”å›æŒ‡å®šçš„beanå¯ä»¥å…±äº«æˆ–ç‹¬ç«‹çš„å®ä¾‹ ï¼ˆè°·æ­Œ+æœ‰é“+ç™¾åº¦ï¼‰ name:è¦æ£€ç´¢çš„beançš„åç§° requiredType:è¦æ£€ç´¢çš„beanæ‰€éœ€çš„ç±»å‹ args:å¦‚æœä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•çš„æ˜¾å¼å‚æ•°åˆ›å»ºåŸå‹ï¼Œåˆ™ä½¿ç”¨å‚æ•°ã€‚ åœ¨å…¶ä»–æƒ…å†µä¸‹ä½¿ç”¨éç©ºargså€¼æ˜¯æ— æ•ˆçš„ã€‚ typeCheckOnly:è·å¾—å®ä¾‹æ˜¯å¦æ˜¯ä¸ºäº†ç±»å‹æ£€æŸ¥ï¼Œè€Œä¸æ˜¯å®é™…çš„ä½¿ç”¨ è¿™ä¸ªæ–¹æ³•ä½“å†…çš„ä»£ç éå¸¸çš„å¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ¬æ–‡ä¸æ˜¯æ¥å­¦ä¹ Springçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªçœ‹æˆ‘ä»¬å…³å¿ƒçš„éƒ¨åˆ†ï¼Œä¸ºæ‰‹å·¥æ³¨å†Œçš„singletonæ£€æŸ¥å•ä¾‹ç¼“å­˜ã€‚,ä»è¿™ä¸ªæ³¨é‡Šå¯ä»¥çœ‹å‡ºï¼Œæ­¤å¤„å°±æ˜¯æˆ‘ä»¬è·å–å®ä¾‹çš„åœ°æ–¹ï¼Œå†å¾€ä¸‹çœ‹ã€‚ æ­¤å¤„å’Œä¸Šé¢çš„getBeanä¸€æ ·ï¼Œä¹Ÿæ˜¯é€šè¿‡æ¨¡æ¿æ–¹æ³•çš„æ–¹å¼è¿›è¡Œè°ƒç”¨çš„ã€‚OKï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†è·å–å•ä¾‹å®ä¾‹çš„å…·ä½“å®ç°è¿‡ç¨‹ã€‚è¿”å›æ³¨å†Œåœ¨ç»™å®šåç§°ä¸‹çš„(åŸå§‹çš„)singletonå¯¹è±¡ã€‚æ£€æŸ¥å·²ç»å®ä¾‹åŒ–çš„å•ä¾‹ï¼Œå¹¶ä¸”è¿˜å…è®¸æå‰å¼•ç”¨å½“å‰åˆ›å»ºçš„å•ä¾‹ï¼ˆè§£æå¾ªç¯å¼•ç”¨ï¼‰ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯é¥¿æ±‰å¼ä¸­çš„åŒé‡æ£€æµ‹æœºåˆ¶æ¥å®ç°çš„ã€‚ OKï¼Œè‡³æ­¤å•ä¾‹æ¨¡å¼çš„å­¦ä¹ å°±ç»“æŸäº†ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« å°†ä¼šä»‹ç»å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ï¼Œå·¥å‚æ–¹æ³•ï¼ŒæŠ½è±¡å·¥å‚ï¼‰ã€‚]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ€ä¹ˆå†™ä¸€ä¸ªæ­»é”ï¼Ÿ]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-base-thread-deadlock%2F</url>
    <content type="text"><![CDATA[åˆšæŠŠæ‰‹å¤´ä¸Šçš„é¡¹ç›®ä»£ç æ’¸å®Œï¼Œé—²æ¥çœ‹çœ‹åšå®¢ï¼Œç„¶åå°±çœ‹åˆ°äº†çº¿ç¨‹è¿™å—çš„ä¸œè¥¿ã€‚ä¹‹å‰æœ‰ç®€å•çš„è®°å½•è¿‡çº¿ç¨‹å’Œè¿›è¡Œçš„é›¶ç¢çŸ¥è¯†ã€‚JAVAåŸºç¡€çŸ¥è¯†ç³»åˆ—â€”è¿›ç¨‹ã€çº¿ç¨‹å®‰å…¨ çœ‹ç€çœ‹ç€å°±æƒ³ç€æ€ä¹ˆèƒ½å†™ä¸€ä¸ªæ­»é”å‘¢ï¼Œæ‰“å¼€eclipseï¼Œçªç„¶æ„Ÿè§‰æ— ä»ä¸‹æ‰‹ï¼›ä¹‹å‰éƒ½æ˜¯ä¸€ç›´åœ¨è§£å†³é˜»å¡ã€æ­»é”è¿™äº›é—®é¢˜ï¼Œç°åœ¨åè¿‡æ¥å»å†™ä¸€ä¸ªæ­»é”æ„Ÿè§‰æœ‰ç‚¹è«åå¥‡å¦™ã€‚ã€‚ã€‚ ok,å†™ä¸€ä¸ªæ­»é”å°±è¦æœ‰ä¸€ç§åœºæ™¯ï¼Œå¹¶ä¸”æ»¡è¶³æ­»é”çš„æ¡ä»¶ã€‚ äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ ä¸å‰¥å¤ºæ¡ä»¶:è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ é¦–å…ˆè¦æœ‰ç«äº‰çš„èµ„æºï¼Œå¹¶ä¸”ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºã€‚é‚£æˆ‘ä»¬å…ˆå¼„ä¸¤ä¸ªèµ„æºï¼š 12Object lock=new Object();Object lock2=new Object(); ç„¶åæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼š 12345Tr1 tr1=new Tr1(lock, lock2);Tr2 tr2=new Tr2(lock, lock2); Thread t1=new Thread(tr1);Thread t2=new Thread(tr2); å¯åŠ¨ï¼š 12t1.start();t2.start(); é‚£ä¹ˆå¯¹äºlockï¼Œlock2æ€ä¹ˆå†çº¿ç¨‹å†…éƒ¨äº§ç”Ÿç«äº‰å…³ç³»å‘¢ï¼Ÿæ¥çœ‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.glmapper.base.synchronize;public class Tr1 implements Runnable &#123; Object lock; Object lock2; public Tr1(Object lock,Object lock2)&#123; this.lock= lock; this.lock2= lock2; &#125; @Override public void run() &#123; //è·å–lock synchronized (lock) &#123; System.out.println(Thread.currentThread().getName()+&quot;è·å–äº†locké”&quot;); try &#123; Thread.sleep(3000); &#125; catch (Exception e) &#123; &#125; //è·å–lock2 synchronized (lock2) &#123; System.out.println(Thread.currentThread().getName()+&quot;è·å–äº†lock2é”&quot;); &#125; &#125; &#125;&#125;public class Tr2 implements Runnable &#123; Object lock; Object lock2; public Tr2(Object lock,Object lock2)&#123; this.lock= lock; this.lock2= lock2; &#125; @Override public void run() &#123; //è·å–lock2 synchronized (lock2) &#123; System.out.println(Thread.currentThread().getName()+&quot;è·å–äº†lock2é”&quot;); try &#123; Thread.sleep(3000); &#125; catch (Exception e) &#123; &#125; //è·å–lock synchronized (lock) &#123; System.out.println(Thread.currentThread().getName()+&quot;è·å–äº†locké”&quot;); &#125; &#125; &#125;&#125; åˆ†æä¸€ä¸‹ï¼šå½“çº¿ç¨‹1è·å–lockæ—¶ï¼Œçº¿ç¨‹2è·å–äº†lock2é”ï¼›ç„¶åçº¿ç¨‹1ç»§ç»­æ‰§è¡Œï¼Œåˆ°è¿™é‡Œï¼Œ 123synchronized (lock2) &#123; System.out.println(Thread.currentThread().getName()+&quot;è·å–äº†lock2é”&quot;);&#125; æ­¤æ—¶éœ€è¦è·å–åˆ°lock2è¿™ä¸ªé”ï¼Œä½†æ˜¯lock2ç°åœ¨è¢«çº¿ç¨‹2æŒæœ‰ï¼›åŒæ—¶ï¼Œçº¿ç¨‹2ä¹Ÿå¼€å§‹æ‰§è¡Œåˆ°ï¼š 123synchronized (lock) &#123; System.out.println(Thread.currentThread().getName()+&quot;è·å–äº†locké”&quot;);&#125; æ­¤æ—¶çº¿ç¨‹2ä¹Ÿåœ¨å°è¯•è·å–lockè¿™æŠŠé”ï¼Œä½†æ˜¯lockåˆè¢«çº¿ç¨‹1æŒæœ‰äº†ã€‚ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œé€ æˆäº†æ­»é”ã€‚OKï¼Œå®Œæˆäº†ã€‚ã€‚ã€‚å½“æˆ‘å‡†å¤‡å…³æœºæ—¶ï¼Œå‘ç°è¿˜åœ¨ç­‰å‘¢ï¼Ÿï¼Ÿï¼Ÿé‚£ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿæˆ‘ä»¬å¼€çœ‹ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆâ€¦. é€šè¿‡jpsæ¥çœ‹ä¸‹æˆ‘ä»¬ç¨‹åºè¿›ç¨‹ ä½¿ç”¨jstack -l ã€pidã€‘ æ¥çœ‹ä¸‹ä¿¡æ¯ ä¸¤ä¸ªçº¿ç¨‹éƒ½å¤„äºBLOCKEDçŠ¶æ€äº†â€¦,ç»§ç»­å¾€ä¸‹çœ‹found 1 deadlock.å¦‚æˆ‘ä»¬æ‰€æ„¿ï¼Œæ­»é”å‘ç”Ÿäº†ï¼]]></content>
      <categories>
        <category>java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>çº¿ç¨‹</tag>
        <tag>thread</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„6ç§è®¾è®¡åŸåˆ™]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-bird-three%2F</url>
    <content type="text"><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—æ‹–äº†ä¸€å‘¨å¤šäº†ï¼Œä»Šå¤©ç»§ç»­ä¹‹å‰çš„æ€è·¯æ¥è¿›è¡Œã€‚æŒ‰ç…§ä¹‹å‰çš„è§„åˆ’ï¼Œè¿™ç¯‡ä¸»è¦æ¥å­¦ä¹ è®¾è®¡åŸåˆ™å…ˆå…³çŸ¥è¯†ã€‚é€šè¿‡æœ¬æ–‡å­¦ä¹ ï¼Œå¸Œæœ›å¤§å®¶ä¸€æ–¹é¢èƒ½æ˜¯èƒ½å¤Ÿè®¤è¯†è¿™äº›åŸåˆ™æ˜¯ä»€ä¹ˆï¼Œèƒ½å¤Ÿåœ¨æ—¥å¸¸çš„å¼€å‘ä¸­èµ·åˆ°æ€æ ·çš„çº¦æŸï¼Œå¹¶ä¸”ç”¨è¿™äº›åŸåˆ™æ¥æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¦ä¸€æ–¹é¢æ˜¯å¯¹åç»­çš„è®¾è®¡æ¨¡å¼çš„å­¦ä¹ èƒ½å¤Ÿæœ‰ä¸€äº›åŸºç¡€ã€‚ èœé¸Ÿæˆé•¿ç³»åˆ—-æ¦‚è¿°èœé¸Ÿæˆé•¿ç³»åˆ—-é¢å‘å¯¹è±¡çš„å››å¤§åŸºç¡€ç‰¹æ€§èœé¸Ÿæˆé•¿ç³»åˆ—-å¤šæ€ã€æ¥å£å’ŒæŠ½è±¡ç±» è®¾è®¡åŸåˆ™ï¼Œåœ¨javaä¸æ¨¡å¼è¿™æœ¬ä¹¦ä¸­æœ‰æåˆ°ï¼Œç”¨äºæé«˜ç³»ç»Ÿå¯ç»´æŠ¤æ€§çš„åŒæ—¶ï¼Œä¹Ÿæé«˜ç³»ç»Ÿçš„å¯å¤ç”¨æ€§ã€‚è¿™æœ¬ä¹¦ä¸­ä¸»è¦è®²äº†å…­ç§è®¾è®¡åŸåˆ™ï¼š â€œå¼€-é—­â€åŸåˆ™ é‡Œæ°æ›¿æ¢åŸåˆ™ ä¾èµ–å€’ç½®åŸåˆ™ æ¥å£éš”ç¦»åŸåˆ™ å•ä¸€èŒè´£åŸåˆ™ è¿ªç‰¹ç±³æ³•åˆ™ è¿™äº›è®¾è®¡åŸåˆ™é¦–å…ˆéƒ½æ˜¯å¤ç”¨çš„åŸåˆ™ï¼Œéµå¾ªè¿™äº›åŸåˆ™å¯ä»¥æœ‰æ•ˆçš„æé«˜ç³»ç»Ÿçš„å¤ç”¨æ€§ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚ â€œå¼€-é—­â€åŸåˆ™ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªäººçš„è§£é‡Šï¼Œä»–æ˜¯è¿™æ ·æ¥æ¯”å–»çš„ï¼šä¸€ä¸ªæœ¬å­ï¼Œå·²ç»å†™å®Œäº†ï¼Œä½ ä¸å¯èƒ½æ’•å‡ å¼ çº¸ç²˜ä¸Šå»å§ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ä¹°ä¸ªæ–°çš„ã€‚é“ç†å°±æ˜¯è¿™æ ·ï¼Œä¸€ä¸ªå·²ç»åšå¥½çš„ç¨‹åºï¼Œä¸æ”¯æŒä¿®æ”¹çš„ï¼Œå› ä¸ºä¿®æ”¹çš„è¯ï¼Œæœ‰å¯èƒ½é€ æˆç¨‹åºæ— æ³•è¿è¡Œæˆ–æŠ¥é”™ï¼Œæ‰€ä»¥ï¼Œé€šå¸¸ç¨‹åºåªæ”¯æŒæ‰©å±•ï¼Œä¸æ”¯æŒä¿®æ”¹ã€‚ 1.ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·ä¸€ä¸ªåŸåˆ™æ¥ä½œä¸ºç¨‹åºè®¾è®¡çš„ä¸€ç§çº¦æŸå‘¢ï¼Ÿåœ¨è½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œç”±äºè½¯ä»¶åŠŸèƒ½æˆ–è€…ç»“æ„çš„å˜åŒ–ã€å‡çº§å’Œç»´æŠ¤ç­‰åŸå› éœ€è¦å¯¹è½¯ä»¶åŸæœ‰ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ä¿®æ”¹çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šç»™æ—§ä»£ç ä¸­å¼•å…¥é”™è¯¯ï¼Œä¹Ÿå¯èƒ½ä¼šä½¿æˆ‘ä»¬ä¸å¾—ä¸å¯¹æ•´ä¸ªåŠŸèƒ½è¿›è¡Œé‡æ„ï¼Œå¹¶ä¸”è¿˜éœ€è¦è¿›è¡Œè½¯ä»¶çš„é‡æ–°æµ‹è¯•ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›åœ¨è½¯ä»¶è®¾è®¡ä¹‹åˆï¼Œèƒ½å¤Ÿç”¨ä¸€ç§åŸåˆ™æ¥è¿›è¡Œä¸€äº›åŸºæœ¬çš„çº¦æŸï¼Œä½¿å¾—åœ¨è½¯ä»¶åæœŸçš„åŠŸèƒ½å˜æ›´ã€æ‰©å±•æˆ–è€…ç»´æŠ¤æ›´åŠ å®¹æ˜“ 2.å¼€é—­åŸåˆ™è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå½“è½¯ä»¶éœ€è¦è¿›è¡Œæ”¹å˜æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é€šè¿‡æ‰©å±•è½¯ä»¶å®ä½“çš„è¡Œä¸ºæ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç æ¥å®ç°å˜åŒ–ã€‚é€šè¿‡è¿™æ ·ä¸€ç§åŸåˆ™ï¼Œå¯ä»¥å¾ˆå¥½çš„å®ç°åœ¨ä¿è¯åŸæœ‰åŠŸèƒ½ç¨³å®šçš„å‰æä¸‹æ‰©å±•æ–°çš„åŠŸèƒ½ 3.ä»€ä¹ˆæ˜¯å¼€é—­åŸåˆ™å‘¢ï¼Ÿä¸€ä¸ªè½¯ä»¶å®ä½“(ç±»ã€æ¨¡å—æˆ–å‡½æ•°)åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ‰©å±•æˆ–è€…ä¿®æ”¹è½¯ä»¶åŠŸèƒ½æ—¶ï¼Œåº”å°½é‡åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œ ä¸¾ä¸ªç®€å•çš„æ —å­ï¼šç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œç³»ç»Ÿéœ€è¦é€šè¿‡QQæ¥è¿›è¡ŒéªŒè¯ç™»å½•ã€‚OKï¼Œæˆ‘ä»¬æ¥æ’¸ä»£ç ï¼š ç”¨æˆ·ç±»User 1234567891011121314151617181920212223package com.glmapper.framerwork;/** * ç”¨æˆ·ä¿¡æ¯ç±» * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:54:09 * */public class User &#123; private String userName;//ç”¨æˆ·å private String passWord;//å¯†ç  public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public String getPassWord() &#123; return passWord; &#125; public void setPassWord(String passWord) &#123; this.passWord = passWord; &#125;&#125; QQæ ¸å¿ƒéªŒè¯é€»è¾‘ 12345678910111213141516package com.glmapper.framerwork;/** * QQéªŒè¯å™¨ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:49:24 */public class QQAuther &#123; /** * ç”¨äºéªŒè¯QQç™»å½•ä¿¡æ¯ */ public boolean validateQQ(User user) &#123; //æ¨¡æ‹Ÿä¸‹é€»è¾‘ return user.toString()==null?false:true; &#125;&#125; æ ¸å¿ƒéªŒè¯æœåŠ¡ç±» 12345678910111213141516171819202122package com.glmapper.framerwork;/** * * ç”¨äºéªŒè¯çš„æ ¸å¿ƒæœåŠ¡ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:47:04 * */public class AuthService &#123; //æŒæœ‰ä¸€ä¸ªQQéªŒè¯å™¨å¯¹è±¡ private QQAuther qqAuther; //é€šè¿‡æ„é€ å™¨æ³¨å…¥qqAutherå¯¹è±¡ public AuthService(QQAuther qqAuther) &#123; this.qqAuther = qqAuther; &#125; /* * éªŒè¯ç”¨æˆ·åˆæ³•æ€§ */ public boolean validateUser(User user)&#123; return qqAuther.validateQQ(user); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819package com.glmapper.framerwork;/** * å®¢æˆ·ç«¯è°ƒç”¨éªŒè¯ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:50:13 * */public class AuthClient &#123; public static void main(String[] args) &#123; //è·å–ç”¨æˆ·ä¿¡æ¯ User user = UserHolder.getUser(); QQAuther qqAuther = new QQAuther(); AuthService authService = new AuthService(qqAuther); //è·å–éªŒè¯ç»“æœ boolean isOK = authService.validateUser(user); System.out.println(isOK); &#125;&#125; OK,å®Œäº‹äº†ï¼ä½†æ˜¯ç°åœ¨éœ€è¦æ¥å…¥å¾®åšçš„å¼€æ”¾å¹³å°æ¥å£ï¼›ä¿®æ”¹ä»£ç â€¦ã€‚å¢åŠ ä¸€ä¸ªå¾®åšéªŒè¯å™¨ï¼š123456789101112131415package com.glmapper.framerwork;/** * å¾®åšæ ¸å¿ƒéªŒè¯å™¨ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ11:01:10 */public class WeiBoAuther &#123; /** * ç”¨äºéªŒè¯QQç™»å½•ä¿¡æ¯ */ public boolean validateWeiBo(User user) &#123; return user.toString()==null?false:true; &#125;&#125; æ ¸å¿ƒéªŒè¯æœåŠ¡ä¿®æ”¹ï¼š 1234567891011121314151617181920212223242526272829package com.glmapper.framerwork;/** * * ç”¨äºéªŒè¯çš„æ ¸å¿ƒæœåŠ¡ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:47:04 * */public class AuthService &#123; //æŒæœ‰ä¸€ä¸ªQQéªŒè¯å™¨å¯¹è±¡ private Object obj; //é€šè¿‡æ„é€ å™¨æ³¨å…¥qqAutherå¯¹è±¡ public AuthService(Object obj) &#123; this.obj = obj; &#125; /* * éªŒè¯ç”¨æˆ·åˆæ³•æ€§ */ public boolean validateUser(User user)&#123; //è¿™é‡Œä»…ä½œä¸ºæ¨¡æ‹Ÿï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šé€šè¿‡ä½¿ç”¨å®šä¹‰æšä¸¾&amp;å·¥å‚æ¨¡å¼æ¥å®Œæˆ if (obj instanceof QQAuther) &#123; return new QQAuther().validateQQ(user); &#125; if(obj instanceof WeiBoAuther)&#123; return new WeiBoAuther().validateWeiBo(user); &#125; return false; &#125;&#125; å®¢æˆ·ç«¯æ”¹å˜ï¼š 12345678910111213141516171819202122232425package com.glmapper.framerwork;/** * å®¢æˆ·ç«¯è°ƒç”¨éªŒè¯ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:50:13 * */public class AuthClient &#123; public static void main(String[] args) &#123; //è·å–ç”¨æˆ·ä¿¡æ¯ User user = UserHolder.getUser(); //QQ QQAuther qqAuther = new QQAuther(); boolean isQQOK = new AuthService(qqAuther).validateUser(user); System.out.println(isQQOK); //å¾®åš WeiBoAuther weiBoAuther = new WeiBoAuther(); boolean isWeiBoOK = new AuthService(weiBoAuther).validateUser(user); System.out.println(isWeiBoOK); &#125;&#125; OKï¼Œæ”¹è¿›å®Œæˆï¼ä½†æ˜¯åˆæœ‰æ–°çš„éœ€æ±‚ï¼Œæ¥å…¥å¾®ä¿¡â€¦.ã€‚å‡å¦‚æˆ‘ä»¬ç°åœ¨æŠŠå¾®ä¿¡å¼€æ”¾å¹³å°ä¹Ÿæ¥å…¥äº†ï¼Œç„¶ååˆæ¥éœ€æ±‚è¦æ¥å…¥æ”¯ä»˜å®è´¦æˆ·ã€è‹å®æ˜“è´­è´¦æˆ·ç­‰ç­‰ã€‚ã€‚ã€‚å°±éœ€è¦ä¸æ–­çš„ä¿®æ”¹ä»£ç ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨è®¾è®¡ä¹‹åˆç”¨åˆ°æˆ‘ä»¬çš„å¼€é—­åŸåˆ™æ¥åšä¸€ä¸ªçº¦æŸäº†ã€‚ç»§ç»­æ’¸ï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ç”¨äºçº¦æŸï¼š éªŒè¯å™¨æ¥å£ï¼Œç”¨äºè¢«QQ/WEIBO/å¾®ä¿¡/è‹å®æ˜“è´­ç­‰å¼€å‘å¹³å°éªŒè¯å™¨å®ç° 12345678910111213package com.glmapper.framerwork;/** * å®šä¹‰ä¸€ä¸ªçº¦æŸæ¥å£ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ11:32:32 * */public interface ValidateInteface &#123; /** * æä¾›ä¸€ä¸ªéªŒè¯å…¥å£ */ boolean validate(User user);&#125; QQä¿®æ”¹ä¹‹å 123456789101112131415package com.glmapper.framerwork;/** * QQéªŒè¯å™¨ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:49:24 */public class QQAuther implements ValidateInteface&#123; /** * ç”¨äºéªŒè¯QQç™»å½•ä¿¡æ¯ */ @Override public boolean validate(User user) &#123; return user.toString()==null?false:true; &#125;&#125; å¾®åšä¿®æ”¹ä¹‹å 12345678910111213141516package com.glmapper.framerwork;/** * å¾®åšæ ¸å¿ƒéªŒè¯å™¨ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ11:01:10 */public class WeiBoAuther implements ValidateInteface&#123; /** * ç”¨äºéªŒè¯QQç™»å½•ä¿¡æ¯ */ @Override public boolean validate(User user) &#123; // TODO Auto-generated method stub return user.toString()==null?false:true; &#125;&#125; æ ¸å¿ƒéªŒè¯æœåŠ¡ 1234567891011121314151617181920package com.glmapper.framerwork;/** * ç”¨äºéªŒè¯çš„æ ¸å¿ƒæœåŠ¡ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:47:04 */public class AuthService &#123; //æŒæœ‰ä¸€ä¸ªQQéªŒè¯å™¨å¯¹è±¡ private ValidateInteface validate; //é€šè¿‡æ„é€ å™¨æ³¨å…¥qqAutherå¯¹è±¡ public AuthService(ValidateInteface validate) &#123; this.validate = validate; &#125; /* * éªŒè¯ç”¨æˆ·åˆæ³•æ€§ */ public boolean validateUser(User user)&#123; return validate.validate(user); &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415161718192021package com.glmapper.framerwork;/** * å®¢æˆ·ç«¯è°ƒç”¨éªŒè¯ * @author glmapper * @date 2017å¹´12æœˆ9æ—¥ä¸‹åˆ10:50:13 * */public class AuthClient &#123; public static void main(String[] args) &#123; //è·å–ç”¨æˆ·ä¿¡æ¯ User user = UserHolder.getUser(); //QQ ValidateInteface qqAuther = new QQAuther(); boolean isQQOK = new AuthService(qqAuther).validateUser(user); System.out.println(isQQOK); //å¾®åš ValidateInteface weiBoAuther = new WeiBoAuther(); boolean isWeiBoOK = new AuthService(weiBoAuther).validateUser(user); System.out.println(isWeiBoOK); &#125;&#125; æ”¹è¿›ä¹‹åæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¯¹äºåŸæ¥çš„æ ¸å¿ƒéªŒè¯æœåŠ¡ç±»ã€å„éªŒè¯å™¨ç±»ï¼Œæ— è®ºå¢åŠ ä»€ä¹ˆæ–¹å¼æ¥å…¥ï¼Œæˆ‘ä»¬éƒ½ä¸éœ€è¦å»ä¿®æ”¹å®ƒçš„ä»£ç äº†ã€‚è€Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ–°å¢ä¸€ä¸ªéªŒè¯å™¨ï¼ˆä¾‹å¦‚è‹å®æ˜“è´­éªŒè¯å™¨ï¼‰ï¼Œç„¶åç»§æ‰¿ValidateInterfaceæ¥å£å°±è¡Œäº†ã€‚æ€»ä½“æ¥é¦–ï¼Œå¼€é—­åŸåˆ™çš„æ ¸å¿ƒæ˜¯ï¼š æŠ½è±¡åŒ– å¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™ï¼ˆ1.ä¸å¯å˜æ€§ä¸åº”è¯¥æ•£è½åœ¨ä»£ç çš„å¤šå¤„ï¼Œè€Œåº”å½“è¢«å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œé¢ï¼›2.ä¸€ç§å¯å˜æ€§ä¸åº”å½“ä¸å¦å¤–ä¸€ç§å¯å˜æ€§æ··åˆåœ¨ä¸€èµ·ï¼‰ ï¼ˆå¤§å®¶å¦‚æœæœ‰æ›´ç®€å•æš´åŠ›çš„ä¾‹å­ï¼Œå¯ä»¥ç•™è¨€ï¼›è¿™ä¸ªä¾‹å­æƒ³äº†å¾ˆå¤šéƒ½æ„Ÿè§‰ä¸æ˜¯å¾ˆæ°å½“ï¼Œè¿˜æ˜¯ä»å·¥ä½œä¸­æŠ½è±¡å‡ºæ¥çš„ï¼‰ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ä»»ä½•çˆ¶ç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°é‡Œæ°æ›¿æ¢åŸåˆ™ç®—æ˜¯å¯¹â€œå¼€é—­â€åŸåˆ™çš„è¡¥å……ï¼Œä¸Šé¢ä¹Ÿæåˆ°ï¼Œå®ç°â€œå¼€é—­â€åŸåˆ™çš„å…³é”®æ­¥éª¤æ˜¯æŠ½è±¡åŒ–ï¼Œè€Œçˆ¶ç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„ä¸€ç§å…·ä½“ä½“ç°ï¼Œæ‰€ä»¥é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚ æ‘˜è‡ªjavaä¸æ¨¡å¼ä¸­çš„å®šä¹‰:å¦‚æœå¯¹æ¯ä¸€ä¸ªç±»å‹ä¸º T1çš„å¯¹è±¡ o1ï¼Œéƒ½æœ‰ç±»å‹ä¸º T2 çš„å¯¹è±¡o2ï¼Œä½¿å¾—ä»¥ T1å®šä¹‰çš„æ‰€æœ‰ç¨‹åº P åœ¨æ‰€æœ‰çš„å¯¹è±¡ o1 éƒ½ä»£æ¢æˆ o2 æ—¶ï¼Œç¨‹åº P çš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç±»å‹ T2 æ˜¯ç±»å‹ T1 çš„å­ç±»å‹ã€‚ ä¸‹å›¾ä¸­æè¿°äº†ä¸€ç§ç»§æ‰¿å…³ç³»ï¼Œä»æœ€é«˜å±‚çš„åŠ¨ç‰©ä¸€ç›´è¡ç”Ÿå‡ºå…·ä½“çš„åŠ¨ç‰©ã€‚OKï¼Œå†™ä¸€æ®µæ–­ç æ¥çœ‹çœ‹ï¼š é¡¶å±‚æŠ½è±¡çˆ¶ç±»-Animal 12345678910package com.glmapper.framework.model.lsp;/** * é¡¶å±‚æŠ½è±¡çˆ¶ç±»åŠ¨ç‰©ç±» * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸Šåˆ10:51:30 */public abstract class Animal &#123; //æä¾›ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä»¥ä¾›ä¸åŒå­ç±»æ¥è¿›è¡Œå…·ä½“çš„å®ç° public abstract void eatFood(String foodName);&#125; å…·ä½“åŠ¨ç‰©ç±»å‹-Dog 12345678910111213 package com.glmapper.framework.model.lsp;/** *å­ç±»-å°ç‹— * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸Šåˆ10:54:17 * */public class Dog extends Animal&#123; @Override public void eatFood(String foodName) &#123; System.out.println(&quot;å°ç‹—åƒ&quot;+foodName); &#125;&#125; å…·ä½“åŠ¨ç‰©-å“ˆå£«å¥‡ 12345678910111213141516 package com.glmapper.framework.model.lsp;/** * å…·ä½“å°ç‹—çš„ç§ç±»-å­ç±»å“ˆå£«å¥‡ * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸Šåˆ10:56:59 * */public class HSQDog extends Dog&#123; /** * é‡å†™çˆ¶ç±»æ–¹æ³• */ @Override public void eatFood(String foodName) &#123; System.out.println(&quot;å“ˆå£«å¥‡åƒ&quot;+foodName); &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415package com.glmapper.framework.model.lsp;//å®¢æˆ·ç«¯ç¨‹åºpublic class ClientMain &#123; public static void main(String[] args) &#123; //å­ç±» HSQDog hsqdog=new HSQDog(); hsqdog.eatFood(&quot;é¥¼å¹²&quot;); //çˆ¶ç±» Dog dog = new HSQDog(); dog.eatFood(&quot;é¥¼å¹²&quot;); //é¡¶å±‚çˆ¶ç±» Animal animal = new HSQDog(); animal.eatFood(&quot;é¥¼å¹²&quot;); &#125;&#125; è¿è¡Œç»“æœ 123å“ˆå£«å¥‡åƒé¥¼å¹²å“ˆå£«å¥‡åƒé¥¼å¹²å“ˆå£«å¥‡åƒé¥¼å¹² å¯ä»¥çœ‹å‡ºæˆ‘ä»¬æœ€å¼€å§‹è¯´çš„é‚£å¥è¯ä»»ä½•çˆ¶ç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ï¼Œåè¿‡æ¥æ˜¯ä¸æˆç«‹çš„ã€‚æˆ‘çš„ç†è§£æ˜¯å­ç±»é€šè¿‡é›†æˆè·å–çš„çˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸ºï¼Œå¹¶ä¸”å­ç±»è‡ªèº«ä¹Ÿå…·æœ‰è‡ªå·±çš„å±æ€§å’Œè¡Œä¸ºï¼›çˆ¶ç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹å¿…ç„¶æ˜¯éœ€è¦ç”¨åˆ°çˆ¶ç±»çš„å±æ€§æˆ–è€…è¡Œä¸ºï¼Œè€Œå­ç±»éƒ½æ¶µç›–äº†çˆ¶ç±»çš„è¿™äº›ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥åšåˆ°æ›¿æ¢ã€‚åè¿‡æ¥ä¸è¡Œæ˜¯å› ä¸ºçˆ¶ç±»åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­åªæ˜¯å……å½“äº†ä¸€ç§ç±»å‹çº¦æŸï¼Œå®ƒå¯èƒ½ä¸å…·æœ‰å­ç±»çš„æŸäº›ç‰¹å¾ï¼Œå› æ­¤å°±æ— æ³•åšåˆ°çœŸæ­£çš„æ›¿æ¢ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“å­ç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸ä¼šå—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½è¢«çœŸæ­£çš„å¤ç”¨ï¼Œè€Œå­ç±»ä¹Ÿæ‰èƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„åŠŸèƒ½ã€‚ ä¾èµ–å€’è½¬åŸåˆ™å®ç°â€œå¼€é—­â€åŸåˆ™çš„å…³é”®æ˜¯æŠ½è±¡åŒ–ï¼Œå¹¶ä¸”ä»æŠ½è±¡åŒ–å¯¼å‡ºå…·ä½“åŒ–å®ç°ã€‚å¦‚æœè¯´å¼€é—­åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ç›®æ ‡çš„è¯ï¼Œä¾èµ–å€’è½¬åŸåˆ™å°±æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ä¸»è¦æœºåˆ¶ï¼ˆjavaä¸æ¨¡å¼ï¼‰ã€‚ä¾èµ–å€’è½¬åŸåˆ™ï¼šè¦ä¾èµ–ä¸æŠ½è±¡ï¼Œä¸ä¾èµ–äºå…·ä½“å®ç°ã€‚ æ€ä¹ˆç†è§£å‘¢? 1ï¼‰é«˜å±‚æ¨¡å—ä¸åº”è¯¥ç›´æ¥ä¾èµ–äºåº•å±‚æ¨¡å—çš„å…·ä½“å®ç°ï¼Œè€Œåº”è¯¥ä¾èµ–äºåº•å±‚çš„æŠ½è±¡ã€‚æ¢è¨€ä¹‹ï¼Œæ¨¡å—é—´çš„ä¾èµ–æ˜¯é€šè¿‡æŠ½è±¡å‘ç”Ÿï¼Œå®ç°ç±»ä¹‹é—´ä¸å‘ç”Ÿç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œå…¶ä¾èµ–å…³ç³»æ˜¯é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»äº§ç”Ÿçš„ã€‚ 2ï¼‰æ¥å£å’ŒæŠ½è±¡ç±»ä¸åº”è¯¥ä¾èµ–äºå®ç°ç±»ï¼Œè€Œå®ç°ç±»ä¾èµ–æ¥å£æˆ–æŠ½è±¡ç±»ã€‚è¿™ä¸€ç‚¹å…¶å®ä¸ç”¨å¤šè¯´ï¼Œå¾ˆå¥½ç†è§£ï¼Œâ€œé¢å‘æ¥å£ç¼–ç¨‹â€æ€æƒ³æ­£æ˜¯è¿™ç‚¹çš„æœ€å¥½ä½“ç° é¦–å…ˆæ˜¯ç¬¬ä¸€ç‚¹ï¼Œä»å¤ç”¨çš„è§’åº¦æ¥è¯´ï¼Œé«˜å±‚æ¬¡çš„æ¨¡å—æ˜¯è®¾è®¡è€…åº”å½“å¤ç”¨çš„ã€‚ä½†æ˜¯åœ¨ä¼ ç»Ÿçš„è¿‡ç¨‹æ€§çš„è®¾è®¡ä¸­ï¼Œå¤ç”¨å´ä¾§é‡äºå…·ä½“å±‚æ¬¡æ¨¡å—çš„å¤ç”¨ã€‚æ¯”å¦‚ç®—æ³•çš„å¤ç”¨ï¼Œæ•°æ®ç»“æ„çš„å¤ç”¨ï¼Œå‡½æ•°åº“çš„å¤ç”¨ç­‰ï¼Œéƒ½ä¸å¯é¿å…æ˜¯å…·ä½“å±‚æ¬¡æ¨¡å—é‡Œé¢çš„å¤ç”¨ã€‚è¾ƒé«˜å±‚æ¬¡çš„ç»“æ„ä¾èµ–äºè¾ƒä½å±‚æ¬¡çš„ç»“æ„ï¼Œç„¶åè¾ƒä½å±‚æ¬¡çš„ç»“æ„åˆä¾èµ–äºæ›´ä½å±‚æ¬¡çš„ç»“æ„ï¼Œç›´åˆ°ä¾èµ–åˆ°æ¯ä¸€è¡Œä»£ç ä¸ºæ­¢ã€‚ç„¶åå¯¹ä½å±‚æ¬¡ä¿®æ”¹ä¹Ÿä¼šé€å±‚ä¿®æ”¹ï¼Œä¸€ç›´åˆ°æœ€é«˜å±‚çš„è®¾è®¡æ¨¡å—ä¸­ã€‚ å¯¹äºä¸€ä¸ªç³»ç»Ÿæ¥è¯´ï¼Œä¸€èˆ¬æŠ½è±¡å±‚æ¬¡è¶Šé«˜ï¼Œå®ƒçš„ç¨³å®šæ€§å°±è¶Šå¥½ï¼Œå› æ­¤ä¹Ÿæ˜¯ä½œä¸ºå¤ç”¨çš„é‡ç‚¹ã€‚ â€œå€’è½¬â€ï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‡å¤ç”¨åº”å½“å°†å¤ç”¨çš„é‡ç‚¹æ”¾åœ¨æŠ½è±¡å±‚ä¸Šï¼Œå¦‚æœæŠ½è±¡å±‚æ¬¡çš„æ¨¡å—ç›¸å¯¹ç‹¬ç«‹äºå…·ä½“å±‚æ¬¡æ¨¡å—çš„è¯ï¼Œé‚£ä¹ˆæŠ½è±¡å±‚æ¬¡çš„æ¨¡å—çš„å¤ç”¨ä¾¿æ˜¯ç›¸å¯¹è¾ƒä¸ºå®¹æ˜“çš„äº†ã€‚ åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸€ä¸ªjavaç¨‹åºéœ€è¦å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªæŠ½è±¡ç±»å‹çš„è¯ï¼Œåº”å½“ä½¿ç”¨è¿™ä¸ªæŠ½è±¡ç±»å‹ä½œä¸ºå˜é‡çš„é™æ€ç±»å‹ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬ç”»äº†åŠ¨ç‰©å’Œå°ç‹—çš„ç±»å›¾å…³ç³»ï¼Œåœ¨å®¢æˆ·ç«¯è°ƒç”¨çš„æ—¶å€™æœ‰ä¸‰ç§æ–¹å¼ï¼š 123456789//å­ç±»(æ–¹å¼1)HSQDog hsqdog=new HSQDog();hsqdog.eatFood(&quot;é¥¼å¹²&quot;);//çˆ¶ç±»ï¼ˆæ–¹å¼2ï¼‰Dog dog = new HSQDog();dog.eatFood(&quot;é¥¼å¹²&quot;);//é¡¶å±‚çˆ¶ç±»ï¼ˆæ–¹å¼3ï¼‰Animal animal = new HSQDog();animal.eatFood(&quot;é¥¼å¹²&quot;); å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå“ˆå£«å¥‡ï¼ˆHSQDogï¼‰çš„è¯ï¼Œæˆ‘ä»¬ä¸åº”å½“ä½¿ç”¨æ–¹å¼1ï¼Œè€Œæ˜¯åº”å½“ä½¿ç”¨æ–¹å¼2æˆ–è€…æ–¹å¼3ã€‚ æ¥å£éš”ç¦»åŸåˆ™æ¥å£éš”ç¦»åŸåˆ™ï¼šä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£æ¯”ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£è¦å¥½ã€‚æ¢å¥è¯è¯´ï¼Œä»ä¸€ä¸ªå®¢æˆ·ç±»çš„è§’åº¦æ¥è®²ï¼šä¸€ä¸ªç±»å¯¹å¦å¤–ä¸€ä¸ªç±»çš„ä¾èµ–æ€§åº”å½“æ˜¯å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šçš„ã€‚è¿™ä¸ªå…¶å®åœ¨æˆ‘ä»¬å®é™…çš„å¼€å‘ä¸­æ˜¯ç»å¸¸é‡åˆ°çš„ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªå®Œæˆä¸€ä¸ªäº§å“çš„ä¸€äº›æ“ä½œæ¥å£ã€‚12345678910111213141516package com.glmapper.framework.model.isp;/** * ä¸€ä¸ªäº§å“æœåŠ¡æ¥å£ * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸‹åˆ12:01:31 */public interface ProductService &#123; //å¢åŠ äº§å“ public int addProduct(Product p); //åˆ é™¤äº§äº§å“ public int deleteProduct(int pId); //ä¿®æ”¹äº§å“ public int updateProduct(Product p); //æŸ¥è¯¢ä¸€ä¸ªäº§å“ public Product queryProduct(int pId);&#125; OKï¼Œæˆ‘ä»¬åœ¨ProductServiceä¸­æä¾›äº†å¯¹äº§å“çš„å¢åˆ æ”¹æŸ¥ï¼›ä½†æ˜¯éšç€éœ€æ±‚å‡çº§ï¼Œæˆ‘ä»¬éœ€è¦å¯ä»¥å¢åŠ å¯¹äº§å“æ–°çš„æ‰¹é‡å¯¼å…¥å’Œå¯¼å‡ºã€‚OKï¼Œè¿™æ—¶åœ¨æ¥å£ä¸­ç»§ç»­æ–°å¢ä¸¤ä¸ªæ–¹æ³•ï¼š1234//ä»excelä¸­æ‰¹é‡å¯¼å…¥public void batchImportFromExcel();//ä»excelä¸­æ‰¹é‡å¯¼å¯¼å‡ºpublic void batchExportFromExcel(); ç„¶åéœ€æ±‚åˆéœ€è¦æ‰©å±•ï¼Œéœ€è¦å¢åŠ å¢åŠ è´­ä¹°äº§å“ã€äº§å“è®¢å•ç”Ÿäº§ã€æŸ¥è¯¢è®¢å•ã€è®¢å•è¯¦æƒ…â€¦.ï¼›è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬çš„ProductServiceå°±ä¼šæ…¢æ…¢çš„æ€¥é€Ÿè†¨èƒ€ã€‚ä¸æ­¤å¯¹åº”çš„å…·ä½“çš„å®ç°é€»è¾‘ProductServiceImplç±»ä¹Ÿä¼šå˜å¾—éå¸¸çš„åºå¤§ï¼Œå¯èƒ½å•ç±»ä¼šè¶…è¿‡æ•°åƒè¡Œä»£ç ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œæ¥å£éš”ç¦»ï¼Œå°†äº§å“çš„åŸºæœ¬æ“ä½œå¦‚å¢åˆ æ”¹æŸ¥æ”¾åœ¨ä¸€ä¸ªæ¥å£ï¼Œå°†äº§å“è®¢å•å¤„ç†æ”¾åœ¨ä¸€ä¸ªæ¥å£ï¼Œå°†äº§å“ç”³è´­æ”¾åœ¨ä¸€ä¸ªæ¥å£ï¼Œå°†æ‰¹é‡æ“ä½œæ”¾åœ¨ä¸€ä¸ªæ¥å£ç­‰ç­‰â€¦å¯¹äºæ¯ä¸€ä¸ªæ¥å£æˆ‘ä»¬åªå…³å¿ƒæŸä¸€ç±»ç‰¹å®šçš„èŒè´£ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯å’Œå•ä¸€èŒè´£åŸåˆ™æœ‰ç‚¹æŒ‚é’©äº†ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼Œé™ä½äº†å•ä¸ªæ¥å£çš„å¤æ‚åº¦ï¼Œä½¿å¾—æ¥å£çš„â€œå†…èšæ€§â€æ›´é«˜ï¼Œâ€œè€¦åˆæ€§â€æ›´ä½ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºæ¥å£éš”ç¦»åŸåˆ™çš„å¿…è¦æ€§ã€‚ è¿ªç‰¹ç±³æ³•åˆ™è¿ªç‰¹ç±³æ³•åˆ™ï¼šåˆç§°ä¸ºæœ€å°‘çŸ¥è¯†åŸåˆ™ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½å°‘çš„äº†è§£ï¼›çœ‹ä¸‹è¿ªç‰¹ç±³æ³•åˆ™çš„å‡ ç§è¡¨è¿°ï¼š1.åªä¸ä½ ç›´æ¥çš„æœ‹å‹ä»¬é€šä¿¡2.ä¸è·Ÿé™Œç”Ÿäººè¯´è¯3.æ¯ä¸€ä¸ªè½¯ä»¶å•ä½å¯¹å…¶ä»–çš„å•ä½éƒ½åªæœ‰æœ€å°‘çŸ¥è¯†ï¼Œè€Œä¸”å±€é™äºé‚£äº›ä¸æœ¬å•ä½å¯†åˆ‡ç›¸å…³çš„è½¯ä»¶å•ä½ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªé›·ä¸å¿…å½¼æ­¤ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’ä½œç”¨ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªç±»éœ€è¦ç”µæ³³å¦ä¸€ä¸ªç±»çš„æŸä¸€ä¸ªæ–¹æ³•çš„è¯ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰è€…è¿›è¡Œæ¶ˆæ¯çš„è½¬å‘ã€‚ä»£ç çœ‹ä¸‹ï¼š æŸä¸ªäºº 1234567891011121314package com.glmapper.framework.model.isp;/** * æŸä¸ªäºº * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸‹åˆ12:39:45 */public class SomeOne &#123; //å…·ä½“oprateionè¡Œä¸º public void oprateion(Friend friend)&#123; Stranger stranger =friend.provide(); stranger.oprateion3(); &#125;&#125;SomeOneå…·æœ‰ä¸€ä¸ªoprateionæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—Friendä¸ºå‚æ•°ï¼Œæ ¹æ®ä¸Šé¢çš„å®šä¹‰å¯ä»¥çŸ¥é“Friendæ˜¯SomeOneçš„â€œæœ‹å‹â€ï¼ˆç›´æ¥é€šä¿¡äº†ï¼‰ æœ‹å‹ 123456789101112131415package com.glmapper.framework.model.isp;/** * æœ‹å‹ * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸‹åˆ12:40:09 */public class Friend &#123; private Stranger stranger = new Stranger(); public Stranger provide()&#123; return stranger; &#125; public void opration2()&#123; &#125;&#125;å¾ˆæ˜æ˜¾SomeOneçš„oprationæ–¹æ³•ä¸æ»¡è¶³è¿ªç‰¹ç±³æ³•åˆ™ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¸­æ¶‰åŠåˆ°äº†é™Œç”ŸäººStranger,Strangerä¸æ˜¯SomeOneçš„æœ‹å‹ OKï¼Œæˆ‘ä»¬æ¥é€šè¿‡è¿ªç‰¹ç±³æ³•åˆ™è¿›è¡Œæ”¹é€ ã€‚ æ”¹é€ ä¹‹åçš„SomeOne 12345678910111213package com.glmapper.framework.model.isp;/** * æŸä¸ªäºº * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸‹åˆ12:39:45 * */public class SomeOne &#123; //å…·ä½“oprateionè¡Œä¸º public void oprateion(Friend friend)&#123; friend.forward(); &#125;&#125; æ”¹é€ ä¹‹åçš„æœ‹å‹ 1234567891011121314151617package com.glmapper.framework.model.isp;/** * æœ‹å‹ * @author glmapper * @date 2017å¹´12æœˆ10æ—¥ä¸‹åˆ12:40:09 * */public class Friend &#123; private Stranger stranger = new Stranger(); public void opration2()&#123; &#125; //è¿›è¡Œè½¬å‘ public void forward() &#123; stranger.oprateion3(); &#125;&#125; ç”±äºè°ƒç”¨äº†è½¬å‘ï¼Œå› æ­¤SomeOneä¸­å°±ä¸ä¼šå’Œé™Œç”ŸäººStrangerç›´æ¥çš„å…³ç³»å°±è¢«å¿½ç•¥äº†ã€‚æ»¡è¶³äº†ç›´æ¥å’Œæœ‹å‹é€šä¿¡ã€ä¸ä¸é™Œç”Ÿäººè¯´è¯çš„æ¡ä»¶ã€‚ä½†æ˜¯è¿ªç‰¹ç±³æ³•åˆ™å¸¦æ¥çš„é—®é¢˜ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼šå³ä¼šåœ¨ç³»ç»Ÿä¸­é€ å‡ºå¤§é‡çš„å°æ–¹æ³•æ•£è½åœ¨ç³»ç»Ÿçš„å„ä¸ªè§’è½ï¼Œè¿™äº›æ–¹æ³•ä»…ä»…æ˜¯ä¼ é€’æ¶ˆæ¯çš„è°ƒç”¨ï¼Œä¸ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ å•ä¸€èŒè´£ä¸Šé¢åœ¨æ¥å£éš”ç¦»ä¸­æœ‰æåˆ°è¿‡ï¼Œå•ä¸€èŒè´£å…¶å®å¾ˆå¥½ç†è§£ï¼Œè§£é‡Šå°½é‡çš„ä½¿å¾—æˆ‘ä»¬çš„æ¯ä¸€ä¸ªç±»æˆ–è€…æ¥å£åªå®Œæˆæœ¬èŒå·¥ä½œä»¥å†…çš„äº‹æƒ…ï¼Œä¸å‚ä¸å…¶ä»–ä»»ä½•é€»è¾‘ã€‚æ¯”å¦‚è¯´è‹¹æœæ¦¨æ±æœºæˆ‘å°±åªç”¨æ¥æ¦¨è‹¹æœæ±ï¼Œå¦‚æœä½ éœ€è¦æ¦¨é»„ç“œæ±çš„è¯ï¼Œä½ å°±å¾—ä¹°ä¸€ä¸ªé»„ç“œæ¦¨æ±æœºã€‚ æ€»ç»“OK ï¼Œè‡³æ­¤ï¼Œè®¾è®¡åŸåˆ™éƒ¨åˆ†å°±å¤ä¹ å®Œäº†ã€‚æ€»ç»“ä¸€ä¸‹ï¼š å•ä¸€èŒè´£åŸåˆ™è¦æ±‚å®ç°ç±»è¦èŒè´£å•ä¸€ï¼› é‡Œæ°æ›¿æ¢åŸåˆ™è¦æ±‚ä¸è¦å»ç ´åç»§æ‰¿ç³»ç»Ÿï¼› ä¾èµ–å€’ç½®åŸåˆ™è¦æ±‚é¢å‘æ¥å£ç¼–ç¨‹ï¼› æ¥å£éš”ç¦»åŸåˆ™è¦æ±‚åœ¨è®¾è®¡æ¥å£çš„æ—¶å€™è¦ç²¾ç®€å•ä¸€ï¼› è¿ªç±³ç‰¹æ³•åˆ™è¦æ±‚è¦é™ä½è€¦åˆï¼› å¼€é—­åŸåˆ™æ˜¯æ€»çº²ï¼Œè¦æ±‚å¯¹æ‰©å±•å¼€å‘ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ å¤§å®¶å‘¨æœ«æ„‰å¿«ï¼ï¼ˆå¦‚æœæœ‰ä¸å½“ä¹‹å¤„ï¼Œå¸Œæœ›å¤§å®¶åŠæ—¶æŒ‡å‡ºï¼Œå¤šè°¢ï¼ï¼‰]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»æºç æ¥èŠä¸€èŠhashmap]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-base-hashmap%2F</url>
    <content type="text"><![CDATA[HashMapä¸ºä»€ä¹ˆä¼šæ˜¯é¢è¯•ä¸­çš„å¸¸å®¢å‘¢ï¼Ÿæˆ‘è§‰å¾—æœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š* è€ƒå¯Ÿä½ é˜…è¯»æºç çš„èƒ½åŠ›* æ˜¯å¦äº†è§£å†…éƒ¨æ•°æ®ç»“æ„* æ˜¯å¦äº†è§£å…¶å­˜å‚¨å’ŒæŸ¥è¯¢é€»è¾‘* å¯¹éçº¿ç¨‹å®‰å…¨æƒ…å†µä¸‹çš„ä½¿ç”¨è€ƒè™‘å‰æ®µæ—¶é—´ä¸€åŒäº‹é¢è¯•èš‚èšé‡‘æœï¼Œå°±è¢«é—®åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼›å…¶å®å¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯ä»hashMap,hashTable,ConcurrentHahMapä¸‰è€…ä¹‹é—´çš„å…³ç³»è¡ç”Ÿè€Œå‡ºï¼Œå½“ç„¶ä¹Ÿæœ‰ç›´æ¥å°±é’ˆå¯¹hashMapåŸç†ç›´æ¥è¿›è¡Œè€ƒå¯Ÿçš„ã€‚å®é™…ä¸Šæœ¬è´¨éƒ½ä¸€æ ·ï¼Œå°±æ˜¯ä¸ºäº†è€ƒå¯Ÿä½ æ˜¯å¦å¯¹é›†åˆä¸­è¿™äº›å¸¸ç”¨é›†åˆçš„åŸç†ã€å®ç°å’Œä½¿ç”¨åœºæ™¯æ˜¯å¦æ¸…æ¥šã€‚ä¸€æ–¹é¢æ˜¯æˆ‘ä»¬å¼€å‘ä¸­ç”¨çš„å¤šï¼Œå½“ç„¶ç”¨çš„äººä¹Ÿå°±å¤šï¼Œä½†æ˜¯ç”¨çš„å¥½çš„äººå´ä¸å¤šï¼ˆæˆ‘ä¹Ÿç”¨çš„å¤šï¼Œç”¨çš„ä¹Ÿä¸å¥½ï¼‰ã€‚æ‰€ä»¥å°±å€Ÿæ­¤æœºä¼šï¼ˆå¼ºè¡Œè¹­ä¸€æ³¢ï¼‰å†æ¥æ‹ä¸€æ‹è¿™ä¸ªHashMapã€‚æœ¬æ–‡åŸºäºjdk1.7.0_80ï¼›jdk 1.8ä¹‹åç•¥æœ‰æ”¹åŠ¨ï¼Œè¿™ä¸ªåé¢ç»†è¯´ã€‚ ç»§æ‰¿å…³ç³»123public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable hashMapå®ç°äº†Mapã€Cloneableã€Serializableä¸‰ä¸ªæ¥å£ï¼Œå¹¶ä¸”ç»§æ‰¿äº†AbstractMapè¿™ä¸ªæŠ½è±¡ç±»ã€‚hashTableç»§æ‰¿çš„æ˜¯Dictionaryè¿™ä¸ªç±»ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†Mapã€Cloneableã€Serializableä¸‰ä¸ªæ¥å£ã€‚ ä¸»è¦å±æ€§ DEFAULT_INITIAL_CAPACITY é»˜è®¤åˆå§‹å®¹é‡ 16 ï¼ˆhashtable æ˜¯11ï¼‰ å¸¸é‡ 12345/** * The default initial capacity - MUST be a power of two. * é»˜è®¤åˆå§‹å®¹é‡-å¿…é¡»æ˜¯2çš„å¹‚ã€‚ */ static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16 MAXIMUM_CAPACITY é»˜è®¤æœ€å¤§å®¹é‡ å¸¸é‡ 1234567/** * The maximum capacity, used if a higher value is implicitly specified * by either of the constructors with arguments. * MUST be a power of two &lt;= 1&lt;&lt;30. *å¦‚æœæœ‰ä¸€ä¸ªæ›´å¤§çš„å€¼è¢«ç”¨äºæ„é€ HashMap,åˆ™ä½¿ç”¨æœ€å¤§å€¼ */ static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; DEFAULT_LOAD_FACTOR è´Ÿè½½å› å­(é»˜è®¤0.75) å¸¸é‡ 12345/** * The load factor used when none specified in constructor. * åŠ è½½å› å­ï¼Œå¦‚æœæ„é€ å‡½æ•°ä¸­æ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ */ static final float DEFAULT_LOAD_FACTOR = 0.75f; EMPTY_TABLE é»˜è®¤çš„ç©ºè¡¨ 12345/** * An empty table instance to share when the table is not inflated. * å½“è¡¨ä¸è†¨èƒ€æ—¶å…±äº«çš„ç©ºè¡¨å®ä¾‹ã€‚ */ static final Entry&lt;?,?&gt;[] EMPTY_TABLE = &#123;&#125;; table è¡¨ï¼Œå¿…è¦æ—¶è°ƒæ•´å¤§å°ã€‚é•¿åº¦å¿…é¡»æ˜¯ä¸¤ä¸ªå¹‚ã€‚è¿™ä¸ªä¹Ÿæ˜¯hashmapä¸­çš„æ ¸å¿ƒçš„å­˜å‚¨ç»“æ„ 1234/** * The table, resized as necessary. Length MUST Always be a power of two. */ transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE; size è¡¨ç¤ºHashMapä¸­å­˜æ”¾KVçš„æ•°é‡ï¼ˆä¸ºé“¾è¡¨/æ ‘ä¸­çš„KVçš„æ€»å’Œï¼‰ 1234/** * The number of key-value mappings contained in this map. */ transient int size; threshold æ‰©å®¹å˜é‡ï¼Œè¡¨ç¤ºå½“HashMapçš„sizeå¤§äºthresholdæ—¶ä¼šæ‰§è¡Œresizeæ“ä½œã€‚threshold=capacity*loadFactor 1234567/** * The next size value at which to resize (capacity * load factor). * @serial */ // If table == EMPTY_TABLE then this is the initial capacity at which the // table will be created when inflated. int threshold; loadFactor è´Ÿè½½å› å­ è´Ÿè½½å› å­ç”¨æ¥è¡¡é‡HashMapæ»¡çš„ç¨‹åº¦ã€‚loadFactorçš„é»˜è®¤å€¼ä¸º0.75fã€‚è®¡ç®—HashMapçš„å®æ—¶è£…è½½å› å­çš„æ–¹æ³•ä¸ºï¼šsize/capacityï¼Œè€Œä¸æ˜¯å ç”¨æ¡¶çš„æ•°é‡å»é™¤ä»¥capacityã€‚ï¼ˆæ¡¶çš„æ¦‚å¿µåç»­ä»‹ç»ï¼‰ 123456/** * The load factor for the hash table. * * @serial */final float loadFactor; modCountè¿™ä¸ªHashMapçš„ç»“æ„ä¿®æ”¹çš„æ¬¡æ•°æ˜¯é‚£äº›æ”¹å˜HashMapä¸­çš„æ˜ å°„æ•°é‡æˆ–ä¿®æ”¹å…¶å†…éƒ¨ç»“æ„(ä¾‹å¦‚rehash)çš„é‚£äº›ã€‚è¿™ä¸ªå­—æ®µç”¨äºä½¿è¿­ä»£å™¨å¯¹HashMapå¤±è´¥å¿«é€Ÿçš„é›†åˆè§†å›¾ã€‚(è§ConcurrentModificationException)ã€‚ 12345678/** * The number of times this HashMap has been structurally modified * Structural modifications are those that change the number of mappings in * the HashMap or otherwise modify its internal structure (e.g., * rehash). This field is used to make iterators on Collection-views of * the HashMap fail-fast. (See ConcurrentModificationException). */ transient int modCount; hashSeed ä¸æ­¤å®ä¾‹ç›¸å…³è”çš„éšæœºå€¼ï¼Œç”¨äºå“ˆå¸Œé”®çš„æ•£åˆ—ä»£ç ï¼Œä½¿æ•£åˆ—å†²çªæ›´éš¾æ‰¾åˆ°ã€‚å¦‚æœ0ï¼Œé‚£ä¹ˆæ›¿ä»£å“ˆå¸Œæ˜¯ç¦ç”¨çš„ã€‚ 123456/** * A randomizing value associated with this instance that is applied to * hash code of keys to make hash collisions harder to find. If 0 then * alternative hashing is disabled. */ transient int hashSeed = 0; ç»“æ„åˆ†æ1static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; hashmapä¸­æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªç»§æ‰¿è‡ªMapä¸­å†…éƒ¨ç±»Entryçš„Entryé™æ€å†…éƒ¨ç±»æ¥å­˜å‚¨æ¯ä¸€ä¸ªK-Vå€¼çš„ã€‚çœ‹ä¸‹å…·ä½“ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key; //é”®å¯¹è±¡ V value; //å€¼å¯¹è±¡ Entry&lt;K,V&gt; next; //æŒ‡å‘é“¾è¡¨ä¸­ä¸‹ä¸€ä¸ªEntryå¯¹è±¡ï¼Œå¯ä¸ºnullï¼Œè¡¨ç¤ºå½“å‰Entryå¯¹è±¡åœ¨é“¾è¡¨å°¾éƒ¨ int hash; //é”®å¯¹è±¡çš„hashå€¼ /** * æ„é€ å¯¹è±¡ */ Entry(int h, K k, V v, Entry&lt;K,V&gt; n) &#123; value = v; next = n; key = k; hash = h; &#125; /** * è·å–key */ public final K getKey() &#123; return key; &#125; /** * è·å–value */ public final V getValue() &#123; return value; &#125; /** * è®¾ç½®valueï¼Œè¿™é‡Œè¿”å›çš„æ˜¯oldValue(è¿™ä¸ªä¸å¤ªæ˜ç™½ï¼Œå“ªä½å¤§ä½¬æ¸…æ¥šçš„å¯ä»¥ç•™è¨€è§£é‡Šä¸‹ï¼Œéå¸¸æ„Ÿè°¢) */ public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; /** * é‡å†™equalsæ–¹æ³• */ public final boolean equals(Object o) &#123; if (!(o instanceof Map.Entry)) return false; Map.Entry e = (Map.Entry)o; Object k1 = getKey(); Object k2 = e.getKey(); if (k1 == k2 || (k1 != null &amp;&amp; k1.equals(k2))) &#123; Object v1 = getValue(); Object v2 = e.getValue(); if (v1 == v2 || (v1 != null &amp;&amp; v1.equals(v2))) return true; &#125; return false; &#125; /** * é‡å†™hashCodeæ–¹æ³• */ public final int hashCode() &#123; return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue()); &#125; public final String toString() &#123; return getKey() + &quot;=&quot; + getValue(); &#125; /** * This method is invoked whenever the value in an entry is * overwritten by an invocation of put(k,v) for a key k that&apos;s already * in the HashMap. */ void recordAccess(HashMap&lt;K,V&gt; m) &#123; &#125; /** * This method is invoked whenever the entry is * removed from the table. */ void recordRemoval(HashMap&lt;K,V&gt; m) &#123; &#125; &#125; HashMapæ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨Key-Valueé”®å€¼å¯¹çš„é›†åˆï¼Œæ¯ä¸€ä¸ªé”®å€¼å¯¹ä¹Ÿå«åšEntryã€‚è¿™äº›ä¸ªé”®å€¼å¯¹ï¼ˆEntryï¼‰åˆ†æ•£å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„å½“ä¸­ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯HashMapçš„ä¸»å¹²ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢çš„tableâ€“æ¡¶ï¼‰ã€‚çœ‹ä¸€å¼ å›¾ï¼š hashmapåˆå§‹åŒ–æ—¶å„ä¸ªç©ºé—´çš„é»˜è®¤å€¼ä¸ºnullï¼Œå½“æ’å…¥å…ƒç´ æ—¶ï¼ˆå…·ä½“æ’å…¥ä¸‹é¢åˆ†æï¼‰ï¼Œæ ¹æ®keyå€¼æ¥è®¡ç®—å‡ºå…·ä½“çš„ç´¢å¼•ä½ç½®ï¼Œå¦‚æœé‡å¤ï¼Œåˆ™ä½¿ç”¨å°¾æ’å…¥æ³•è¿›è¡Œæ’å…¥åé¢é“¾è¡¨ä¸­ã€‚ å°¾æ’æ³•ä¹‹å‰æˆ‘æ˜¯é€šè¿‡æ’å…¥17æ¡æ•°æ®æ¥è¯•éªŒçš„ï¼ˆå…·ä½“æ•°æ®æ•°ç›®éšæ„ï¼Œè¶Šå¤§é‡å¤çš„å‡ ç‡è¶Šé«˜ï¼‰1234567public static void main(String[] args) throws Exception &#123; HashMap&lt;String, Object&gt; map=new HashMap&lt;&gt;(); for (int i = 0; i &lt; 170; i++) &#123; map.put(&quot;key&quot;+i, i); &#125; System.out.println(map); &#125; é€šè¿‡æ–­ç‚¹æŸ¥çœ‹nextï¼Œå¯ä»¥å¾—å‡ºæˆ‘ä»¬ä¸Šé¢çš„ç»“è®ºï¼š1.ç´¢å¼•å†²çªæ—¶ä¼šä½¿ç”¨é“¾è¡¨æ¥å­˜å‚¨ï¼›2.æ’å…¥é“¾è¡¨çš„æ–¹å¼æ˜¯ä»å°¾éƒ¨å¼€å§‹æ’å…¥çš„ï¼ˆå®˜æ–¹çš„è§£é‡Šæ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåæ¥æ’å…¥çš„æ•°æ®è¢«ä½¿ç”¨çš„é¢‘æ¬¡è¾ƒé«˜ï¼‰ï¼Œè¿™æ ·çš„è¯æœ‰åˆ©äºæŸ¥æ‰¾ã€‚ ä¸»è¦æ–¹æ³•æˆ‘ä»¬å¹³æ—¶åœ¨å¼€å‘æ˜¯æœ€å¸¸ç”¨çš„hashMapä¸­çš„æ–¹æ³•æ— éå°±æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªHashMapå¯¹è±¡ï¼Œç„¶åå­˜ï¼Œæ¥ç€å–ï¼›å¯¹åº”çš„æ–¹æ³•å°±æ˜¯ï¼š æ„é€ å‡½æ•° putå‡½æ•° getå‡½æ•° æ„é€ å‡½æ•° 12345678910111213141516171819202122232425262728/** * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the specified initial * capacity and load factor. * * @param initialCapacity the initial capacity æŒ‡å®šçš„åˆå§‹åŒ–å®¹é‡å¤§å° * @param loadFactor the load factor æŒ‡å®šçš„è´Ÿè½½å› å­ * @throws IllegalArgumentException if the initial capacity is negative * or the load factor is nonpositive */ public HashMap(int initialCapacity, float loadFactor) &#123; //å¦‚æœåˆå§‹åŒ–å®¹é‡å°äº0ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ if (initialCapacity &lt; 0) throw new IllegalArgumentException(&quot;Illegal initial capacity: &quot; + initialCapacity); //å¦‚æœåˆå§‹åŒ–å®¹é‡å¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™ä½¿ç”¨é»˜è®¤æœ€å¤§å®¹é‡ if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; //å¦‚æœè´Ÿè½½å› å­å°äº0æˆ–è€…éæ•°å€¼ç±»å‹ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(&quot;Illegal load factor: &quot; + loadFactor); //åˆå§‹åŒ–è´Ÿè½½å› å­ this.loadFactor = loadFactor; //åˆå§‹åŒ–threshold threshold = initialCapacity; //è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œåº”è¯¥æ˜¯æ„åœ¨HashMapçš„å­ç±»ä¸­ç”±ä½¿ç”¨è€…è‡ªè¡Œé‡å†™è¯¥æ–¹æ³•çš„å…·ä½“å®ç° init(); &#125; å¦å¤–ä¸¤ä¸ªæ„é€ æ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯å¯¹ä¸Šé¢è¿™ä¸ªæ„é€ æ–¹æ³•çš„è°ƒç”¨ï¼š 12345678//åªåˆ¶å®šé»˜è®¤å®¹é‡ public HashMap(int initialCapacity) &#123; this(initialCapacity, DEFAULT_LOAD_FACTOR); &#125; //ä½¿ç”¨HashMapé»˜è®¤çš„å®¹é‡å¤§å°å’Œè´Ÿè½½å› å­ public HashMap() &#123; this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR); &#125; è¿˜æœ‰ä¸€ä¸ªæ˜¯ï¼š1234567public HashMap(Map&lt;? extends K, ? extends V&gt; m) &#123; this(Math.max((int) (m.size() / DEFAULT_LOAD_FACTOR) + 1, DEFAULT_INITIAL_CAPACITY), DEFAULT_LOAD_FACTOR); inflateTable(threshold); putAllForCreate(m); &#125; æ„é€ ä¸€ä¸ªæ˜ å°„å…³ç³»ä¸æŒ‡å®š Map ç›¸åŒçš„æ–° HashMapã€‚æ‰€åˆ›å»ºçš„ HashMap å…·æœ‰é»˜è®¤åŠ è½½å› å­ (0.75) å’Œè¶³ä»¥å®¹çº³æŒ‡å®š Map ä¸­æ˜ å°„å…³ç³»çš„åˆå§‹å®¹é‡ã€‚ putæ–¹æ³•é¦–å…ˆï¼Œæˆ‘ä»¬éƒ½çŸ¥é“hashmapä¸­çš„keyæ˜¯å…è®¸ä¸ºnullçš„ï¼Œè¿™ä¸€ç‚¹ä¹Ÿæ˜¯é¢è¯•ä¸­æœ€å¸¸é—®åˆ°çš„ç‚¹ã€‚é‚£æˆ‘å…ˆçœ‹ä¸‹ä¸ºä»€ä¹ˆå¯ä»¥å­˜nullä½œä¸ºkeyå€¼ã€‚ 123456789101112131415161718192021222324252627282930public V put(K key, V value) &#123; //å¦‚æœtableæ˜¯ç©ºçš„ if (table == EMPTY_TABLE) &#123; //inflateï¼šæ‰©å®¹/è†¨èƒ€çš„æ„æ€ inflateTable(threshold); &#125; //å¦‚æœkeyä¸ºnull æ­¤å¤„æ•²ä¸‹æ¡Œå­ï¼Œä¸ºä»€ä¹ˆå¯ä»¥å­˜nullï¼Ÿ if (key == null) //æ‰§è¡ŒputForNullKeyæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å¦‚æœkeyä¸ºnullï¼Œå°±å°†å½“å‰çš„k-vå­˜æ”¾åˆ°table[0],å³ç¬¬ä¸€ä¸ªæ¡¶ã€‚ return putForNullKey(value); //å¯¹keyè¿›è¡Œä¸€æ¬¡hashè¿ç®—ï¼Œè·å–hashå€¼ int hash = hash(key); //æ ¹æ®keyå€¼å¾—hashå€¼å’Œè¡¨çš„é•¿åº¦æ¥è®¡ç®—ç´¢å¼•ä½ç½® int i = indexFor(hash, table.length); //ç§»åŠ¨æ•°æ®ï¼Œæ’å…¥æ•°æ® for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); //ä¸Šé¢Entryä¸­çš„setValueä¸­ä¹Ÿæœ‰æåˆ°ï¼Œè¿”å›çš„éƒ½æ˜¯æ—§çš„æ•°æ® return oldValue; &#125; &#125; modCount++; addEntry(hash, key, value, i); return null; &#125; hashæ–¹æ³•ï¼šæ£€ç´¢å¯¹è±¡å“ˆå¸Œä»£ç ï¼Œå¹¶å°†é™„åŠ å“ˆå¸Œå‡½æ•°åº”ç”¨äºç»“æœå“ˆå¸Œï¼Œè¯¥å“ˆå¸Œå‡½æ•°é˜²æ­¢è´¨é‡å·®çš„å“ˆå¸Œå‡½æ•°ã€‚ è¿™æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºHashMapä½¿ç”¨ä¸¤ä¸ªé•¿åº¦çš„å“ˆå¸Œè¡¨ï¼Œå¦åˆ™ä¼šç¢°åˆ°hashCodeçš„å†²çªï¼Œè¿™äº›hashCodesåœ¨ä½ä½ä¸Šæ²¡æœ‰åŒºåˆ«ã€‚ æ³¨æ„ï¼šç©ºé”®æ€»æ˜¯æ˜ å°„åˆ°æ•£åˆ—0ï¼Œå› æ­¤ç´¢å¼•ä¸º0ã€‚1234567891011121314/** final int hash(Object k) &#123; int h = hashSeed; if (0 != h &amp;&amp; k instanceof String) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); //è¿™ä¸ªå‡½æ•°ç¡®ä¿åœ¨æ¯ä¸ªæ¯”ç‰¹ä½ç½®ä¸Šä»…ä»¥æ’å®šå€æ•°ä¸åŒ //çš„æ•£åˆ—ç å…·æœ‰æœ‰é™æ•°é‡çš„å†²çªï¼ˆåœ¨é»˜è®¤åŠ è½½å› å­ä¸‹å¤§çº¦ä¸º8ï¼‰ã€‚ h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4); &#125; å†²çªå…·ä½“è¿‡ç¨‹æè¿°ï¼š ä¸€ä¸ªç©ºçš„hashmapè¡¨ æ’å…¥å…ƒç´ ï¼Œé€šè¿‡hashè®¡ç®—å¾—å‡ºç´¢å¼•ä¸º3ï¼Œå› ä¸ºå½“å‰3çš„ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œå› æ­¤ç›´æ¥æ’å…¥è¿›å»å³å¯ å†æ¬¡æ’å…¥å…ƒç´ ï¼Œé€šè¿‡hashè®¡ç®—å¾—å‡ºç´¢å¼•è¿˜æ˜¯3ï¼Œå‘ç”Ÿå†²çªï¼Œåˆ™å°†å½“å‰æ–°æ’å…¥çš„å…ƒç´ æ”¾åœ¨åŸæ¥çš„å·²æœ‰çš„å…ƒç´ ä½ç½®ï¼Œå¹¶å°†å…¶nextæŒ‡å‘åŸæ¥å·²ç»å­˜åœ¨çš„å…ƒç´ ã€‚getæ–¹æ³•è¿”å›æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼;å¦‚æœæ­¤æ˜ å°„ä¸åŒ…å«é”®æ˜ å°„ï¼Œåˆ™è¿”å›nullã€‚123456789public V get(Object key) &#123; //å’Œå­˜null keyä¸€æ ·ï¼Œå–çš„æ—¶å€™ä¹Ÿæ˜¯ä»table[0]å– if (key == null) return getForNullKey(); //è·å–entry Entry&lt;K,V&gt; entry = getEntry(key); return null == entry ? null : entry.getValue(); &#125; getEntryæ–¹æ³• 12345678910111213141516171819final Entry&lt;K,V&gt; getEntry(Object key) &#123; //sizeç­‰äº0ï¼Œè¯´æ˜å½“å‰hashMapä¸­æ²¡æœ‰å…ƒç´ ï¼Œç›´æ¥è¿”å›nullï¼ˆæ¯ä¸ªentryé»˜è®¤å€¼ä¸ºnullï¼‰ if (size == 0) &#123; return null; &#125; //æ ¹æ®keyå€¼è®¡ç®—hashå€¼ int hash = (key == null) ? 0 : hash(key); //é€šè¿‡hashå€¼è·å–åˆ°ç´¢å¼•ä½ç½®ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ¡¶é“¾è¿›è¡Œéå†æŸ¥æ‰¾ for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) &#123; Object k; //å¦‚æœæ‰¾åˆ°åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰é“¾è¡¨æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç»§ç»­æŸ¥æ‰¾ã€‚ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; return null; &#125; æ‰©å®¹æœºåˆ¶åœ¨å‰é¢æåˆ°è¿‡thresholdï¼Œæ‰©å®¹å˜é‡ï¼Œè¡¨ç¤ºå½“HashMapçš„sizeå¤§äºthresholdæ—¶ä¼šæ‰§è¡Œresizeæ“ä½œã€‚å…¶è®¡ç®—æ–¹å¼æ˜¯ï¼šthreshold=capacity*loadFactorã€‚ä»ä¸Šé¢çš„å¼å­ä¸­æˆ‘ä»¬å¯ä»¥å¾—çŸ¥hashmapçš„æ‰©å®¹æ—¶æœºæ˜¯å½“å‰å½“å‰sizeçš„å€¼è¶…è¿‡å®¹é‡ä¹˜ä»¥è´Ÿè½½å› å­æ—¶å°±ä¼šè§¦å‘æ‰©å®¹ã€‚æ¥çœ‹ä¸‹æºç ï¼š 123456789101112131415161718192021void addEntry(int hash, K key, V value, int bucketIndex) &#123; //å¦‚æœå½“å‰sizeè¶…è¿‡threshold å¹¶ä¸”æ»¡è¶³æ¡¶ç´¢å¼•ä½ç½®ä¸ä¸ºnullçš„æƒ…å†µä¸‹ï¼Œæ‰©å®¹ if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; //æ‰©å®¹ä¹‹åä¸ºåŸæ¥çš„ä¸¤å€ resize(2 * table.length); //é‡æ–°è®¡ç®—hashå€¼ hash = (null != key) ? hash(key) : 0; //é‡å†™è®¡ç®—ç´¢å¼• bucketIndex = indexFor(hash, table.length); &#125; //æ‰§è¡Œå…·ä½“çš„æ’å…¥æ“ä½œ createEntry(hash, key, value, bucketIndex); &#125;void createEntry(int hash, K key, V value, int bucketIndex) &#123; //å…ˆå–åˆ°å½“å‰æ¡¶çš„entry Entry&lt;K,V&gt; e = table[bucketIndex]; //å°†æ–°çš„æ•°æ®æ’å…¥åˆ°table[bucketIndex]ï¼Œå†å°†ä¹‹å‰çš„entryé€šè¿‡é“¾è¡¨ç®€ä»‹åˆ°table[bucketIndex]çš„nextæŒ‡å‘ï¼›å‰é¢çš„å›¾å·²ç»è¿›è¡Œäº†æè¿°ã€‚ table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++; &#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰©å®¹å¹¶ä¸æ˜¯åœ¨hashmapæ»¡äº†ä¹‹åæ‰è¿›è¡Œçš„ï¼Œçœ‹ä¸‹é¢æ–­ç‚¹ï¼š é€šè¿‡é»˜è®¤æ„é€ å‡½æ•°newäº†ä¸€ä¸ªmapå¯¹è±¡å‡ºæ¥ï¼Œé€šè¿‡forå¾ªç¯æ’å…¥12æ¡æ•°æ®ï¼Œæ–­ç‚¹åˆ°æ‰§è¡Œç»“æŸï¼Œæˆ‘ä»¬çœ‹åˆ°å½“å‰tableçš„å®¹é‡æ˜¯16ï¼Œæ‰©å®¹å˜é‡thresholdä¸º12ï¼ˆ16x0.75ï¼‰ï¼Œç°åœ¨æˆ‘ä»¬å°†12æ”¹ä¸º13.æ­¤æ—¶13è¿˜æ˜¯å°äº16çš„ï¼Œä½†æ˜¯è¿˜æ˜¯è§¦å‘äº†hashmap çš„æ‰©å®¹ã€‚å½“å‰tableå®¹é‡ä¸º32ï¼ˆæ‰©å®¹ä¸ºäº†ä¹‹å‰çš„ä¸¤å€ï¼‰ï¼Œthresholdä¸º24ï¼ˆ32x0.75ï¼‰ï¼Œé€šè¿‡è¿™ä¸¤ç§å›¾æˆ‘ä»¬å¾—çŸ¥ï¼š æ¯æ¬¡æ‰©å®¹ä¹‹åçš„å®¹é‡ä¸ºåŸæœ‰å®¹é‡çš„ä¸¤å€ï¼ˆ2nï¼‰ è§¦å‘æ‰©å®¹å¹¶ä¸æ˜¯å› ä¸ºå½“å‰hashmapå¯¹è±¡å·²ç»æ»¡äº†ï¼Œè€Œæ˜¯é€šè¿‡threholdæ‰©å®¹å˜é‡æ¥æ§åˆ¶è§¦å‘æ—¶æœºçš„ã€‚ å°ç»“æœ¬æ–‡å°±å•çº¯çš„æ‰’äº†ä¸€æ³¢æºç ï¼Œå¹¶å¯¹æºç ä¸­çš„æ³¨é‡Šå¹¶ç»“åˆè‡ªå·±çš„ç†è§£è¿›è¡Œäº†ç¿»è¯‘ï¼Œé€šè¿‡æ–­ç‚¹è°ƒè¯•ç®€å•çš„ä»‹ç»äº†å°¾æ’æ³•åœ¨hashmapçš„åº”ç”¨ã€‚æœ€åé€šè¿‡å‡ å¼ å›¾æè¿°äº†ä¸‹hashmapå‘ç”Ÿç´¢å¼•å†²çªæ—¶çš„è§£å†³æ–¹æ¡ˆã€‚hashmapåœ¨é¢è¯•æ—¶çœŸçš„æ˜¯å¯æ·±å¯æµ…ï¼Œä½†æ˜¯æºç çš„é˜…è¯»è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œä¸‹é¢æ¨èä¸¤ç¯‡åšå®¢ç»™å¤§å®¶ã€‚ 1.å…³äºhashmapä¸hashtableçš„å…·ä½“å¯¹æ¯”å¯ä»¥å‚è€ƒè¿™ä¸ªåšå®¢ï¼šHashMapå’ŒHashTableåˆ°åº•å“ªä¸åŒï¼Ÿ 2.å…³äºä¸ºä»€ä¹ˆhashmapä¸­çš„å®¹é‡å¿…é¡»æ˜¯2çš„å¹‚ï¼Œè¿™ç¯‡åšå®¢å¤§å®¶å¯ä»¥çœ‹ä¸‹ï¼šä»€ä¹ˆæ˜¯hashmapï¼Ÿ 3.å…³äºhashmapéçº¿ç¨‹å®‰å…¨çš„è§£é‡Šå¹¶å‘å®‰å…¨é—®é¢˜ä¹‹HashMap]]></content>
      <categories>
        <category>java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>hash</tag>
        <tag>map</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ä¸ªæœ‹å‹åœˆæ³›å‹é—®é¢˜å¼•å‘çš„â€œæ¡ˆå­â€]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-base-one%2F</url>
    <content type="text"><![CDATA[æ˜¨å¤©æœ‹å‹åœˆé—®äº†ä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºä¸‹é¢çš„listï¼Œä½•å¦‚åœ¨listæ·»åŠ ä¸€ä¸ªIntegerå‹æ•´æ•°ï¼Ÿ1ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;(); æœ‰è¿™æ ·å‡ ç§å›ç­”ï¼š 1.ä¸çŸ¥é“ï¼ˆéä¸“ä¸šå›ç­”ï¼‰ 2.ç¡¬å¡ï¼ˆéä¸“ä¸šå›ç­”ï¼‰ 3.æŠŠString æ”¹æˆIntegerå†æ·»åŠ ï¼ˆè¿èƒŒäº†é—®é¢˜åˆè¡·ï¼‰ 4.æŠŠStringæ”¹æˆObjectï¼Œå¯ä»¥åŠ ä»»æ„ç±»å‹ï¼ˆè¿èƒŒäº†é—®é¢˜åˆè¡·ï¼‰ 5.Stringæ¢æˆé€šé…ç¬¦ 6.åå°„ å¯¹äº1ã€2å°±ä¸è¯´äº†ï¼Œå±äºæäº‹æƒ…çš„ï¼3ã€4ã€5ä¸‰ç§æ–¹å¼è¿èƒŒäº†é—®é¢˜çš„åˆè¡·ï¼Œå¦‚æœå¯ä»¥æ”¹ï¼Œé‚£æˆ‘ä»¬ç›´æ¥newä¸‰ä¸ªArrayListå°±å¯ä»¥äº†ã€‚6åå°„ï¼Œè¿™ä¸ªæ˜¯æ— é™æ¥è¿‘çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå’Œåå°„æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸‹æ¥çœ‹ä¸‹ä¸‹é¢å‡ ä¸ªä¾‹å­ï¼š 12345678910111213141516171819public static void main(String[] args) &#123; ArrayList list=new ArrayList(); ArrayList&lt;String&gt; str_list=new ArrayList&lt;String&gt;(); ArrayList&lt;Integer&gt; int_list=new ArrayList&lt;Integer&gt;(); ArrayList&lt;Object&gt; obj_list=new ArrayList&lt;Object&gt;(); //å¯¹è±¡æ¯”è¾ƒ System.out.println(list == str_list); System.out.println(list == int_list); System.out.println(list == obj_list); //å¯¹è±¡çš„è¿è¡Œæ—¶classæ¯”è¾ƒ System.out.println(list.getClass() == str_list.getClass()); System.out.println(list.getClass() == int_list.getClass()); System.out.println(list.getClass() == obj_list.getClass()); &#125; ç»“æœï¼š123456falsefalsefalsetruetruetrue å…¶å®ä¸Šé¢ä¸‰ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸åŒå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€è‚¯å®šæ˜¯ä¸åŒçš„ï¼Œå› æ­¤å‡ä¸ºfalse;ä¸‹é¢ä¸‰ä¸ªå‡ä¸ºtrue?æ˜¯çš„ï¼Œç¡®å®ä¸ºtrue,è¿™å°±å¼•å‡ºäº†æœ‹å‹åœˆçš„é‚£ä¸ªé—®é¢˜ã€‚ä¸ºä»€ä¹ˆä¸åŒçš„ä¸‰ä¸ªå¯¹è±¡ï¼Œä»–ä»¬çš„getClassæ˜¯ä¸€æ ·çš„ï¼Œä¸åº”è¯¥æ˜¯æœ‰ä¸‰ä¸ªä¸åŒçš„hashCodeå—ï¼Ÿè¿™ä¸ªå…¶å®å°±æ˜¯æ³›å‹ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„é—®é¢˜ã€‚å¯¹äºæ³›å‹æ¥è¯´ï¼Œæ³›å‹åªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆï¼Œç¼–è¯‘ä¹‹åï¼Œé›†åˆçš„æ³›å‹æ˜¯å»æ³›å‹åŒ–çš„ï¼›åŸå› ï¼šç”±äºJVMæ³›å‹çš„æ“¦é™¤æœºåˆ¶ï¼Œåœ¨è¿è¡Œæ—¶JVMæ˜¯ä¸çŸ¥é“æ³›å‹ä¿¡æ¯çš„ã€‚å› æ­¤ï¼šjavaé›†åˆä¸­çš„æ³›å‹ï¼Œæ˜¯æ¥çº¦æŸç”¨æˆ·çš„é”™è¯¯è¾“å…¥çš„ï¼Œåªåœ¨ç¼–è¯‘æ—¶æœ‰æ•ˆï¼›åœ¨å›åˆ°é—®é¢˜æœ€åˆï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½å°†ä¸€ä¸ªIntegerå¯¹åƒæ”¾å…¥ä¸Šé¢å®šä¹‰çš„listä¸­å‘¢ï¼Ÿæ—¢ç„¶é›†åˆä¸­çš„æ³›å‹æ˜¯ç¼–è¯‘æ—¶æœ‰æ•ˆçš„ï¼Œé‚£æˆ‘æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»•è¿‡ç¼–è¯‘çš„æ–¹å¼è¿›è¡Œæ’å…¥ã€‚é‚£ä¹ˆå¦‚ä½•ç»•è¿‡ç¼–è¯‘æ—¶çš„æ ¡éªŒå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç”¨åå°„ï¼›æˆ‘ä»¬çŸ¥é“JAVAåå°„æœºåˆ¶æ˜¯æŒ‡ï¼šâ€œåœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚OKï¼Œå†æ¥çœ‹ç¨‹åºï¼š 123456789 ArrayList&lt;String&gt; str_list=new ArrayList&lt;String&gt;();//è·å–ç±»ä¿¡æ¯Class c=str_list.getClass();//è·å–addæ–¹æ³•Method m=c.getMethod(&quot;add&quot;, Object.class);//è¿è¡Œæ—¶è°ƒç”¨addæ–¹æ³•m.invoke(str_list, 20);//è¾“å‡ºå½“å‰str_listSystem.out.println(str_list); ç»“æœï¼š1[20] ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å®Œæˆäº†åœ¨listä¸­æ·»åŠ Integerçš„ä»»åŠ¡ã€‚ã€æ³›å‹ã€åå°„ã€ç¼–è¯‘æ—¶ã€è¿è¡Œæ—¶ã€‘]]></content>
      <categories>
        <category>java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>æ³›å‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®—æ³•-æ’åºç®—æ³•æ€æƒ³åŠå®ç°]]></title>
    <url>%2F2018%2F11%2F10%2Falg-one%2F</url>
    <content type="text"><![CDATA[æ’åºç®—æ³•ä¸»è¦æœ‰ï¼šæ’å…¥æ’åºï¼Œé€‰æ‹©æ’åºï¼Œå†’æ³¡æ’åºï¼Œå¸Œå°”æ’åºï¼Œå½’å¹¶æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œå †æ’åºã€‚è¿™é‡Œçš„æ’åºæŒ‡çš„æ˜¯å†…éƒ¨æ’åºï¼Œä¹Ÿå°±æ˜¯åŸºäºå†…å­˜çš„æ’åºï¼ŒåŸºäºå†…å­˜çš„æ’åºæ˜¯åŸºäºå¤§Oæ¨¡å‹çš„ï¼Œå¯ä»¥ä½¿ç”¨å¤§Oæ¨¡å‹æ¥è¡¡é‡ç®—æ³•çš„æ€§èƒ½æ‘˜è‡ªæˆ‘è‡ªå·±çš„åšå®¢å›­ï¼šhttp://www.cnblogs.com/myadmin/p/5821158.html ä¸­çš„éƒ¨åˆ†æ’åºç®—æ³•ã€‚ æ’å…¥æ’åºåŸºæœ¬æ€æƒ³ï¼šæ¯ä¸€æ­¥éƒ½å°†ä¸€ä¸ªå¾…æ’æ•°æ®æŒ‰å…¶å¤§å°æ’å…¥åˆ°å·²ç»æ’åºçš„æ•°æ®ä¸­çš„é€‚å½“ä½ç½®ï¼Œç›´åˆ°å…¨éƒ¨æ’å…¥å®Œæ¯•ã€‚ 1234åŸå§‹ï¼š4 3 1 21) 3 4 1 22) 1 3 4 23) 1 2 3 4 æ ¸å¿ƒä»£ç ï¼š 12345678910111213141516/** * æ’å…¥æ’åº */ public static int[] insertSort(int[] arr) &#123; for (int i = 1; i &lt; arr.length; i++) &#123; int index = i;// indexå½“å‰æ‰«æåˆ°çš„å…ƒç´ ä¸‹æ ‡ int temp = arr[i]; // å¯»æ‰¾æ’å…¥çš„ä½ç½® while (index &gt; 0 &amp;&amp; temp &lt; arr[index - 1]) &#123; arr[index] = arr[index - 1]; index--; &#125; arr[index] = temp; &#125; return arr; &#125; é€‰æ‹©æ’åºåŸºæœ¬æ€æƒ³ï¼šä»æ‰€æœ‰åºåˆ—ä¸­å…ˆæ‰¾åˆ°æœ€å°çš„ï¼Œç„¶åæ”¾åˆ°ç¬¬ä¸€ä¸ªä½ç½®ã€‚ä¹‹åå†çœ‹å‰©ä½™å…ƒç´ ä¸­æœ€å°çš„ï¼Œæ”¾åˆ°ç¬¬äºŒä¸ªä½ç½®â€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œå°±å¯ä»¥å®Œæˆæ•´ä¸ªçš„æ’åºå·¥ä½œäº†ã€‚å¯ä»¥å¾ˆæ¸…æ¥šçš„å‘ç°ï¼Œé€‰æ‹©æ’åºæ˜¯å›ºå®šä½ç½®ï¼Œæ‰¾å…ƒç´ ã€‚ç›¸æ¯”äºæ’å…¥æ’åºçš„å›ºå®šå…ƒç´ æ‰¾ä½ç½®ï¼Œæ˜¯ä¸¤ç§æ€ç»´æ–¹å¼ã€‚ 1234567893 2 1 4 6 5åˆå§‹åŒ–ç´¢å¼•ä½ç½®ä¸º0 å¯»æ‰¾æœ€å°å€¼æ‰€åœ¨ä½ç½®äº¤æ¢ï¼š1 2 3 4 6 5åˆå§‹åŒ–ç´¢å¼•ä½ç½®ä¸º1å¯»æ‰¾æœ€å°å€¼æ‰€åœ¨ä½ç½®äº¤æ¢ï¼š1 2 3 4 6 5ä¾æ¬¡ç±»æ¨ï¼ æ ¸å¿ƒä»£ç ï¼š 123456789101112131415161718/** * é€‰æ‹©æ’åº */ public static int[] selectSort(int[] arr) &#123; for (int i = 0; i &lt; arr.length; i++) &#123; int minVal = arr[i]; int index = i; for (int j = i + 1; j &lt; arr.length; j++) &#123;// æ‰¾åˆ°æœ€å°å…ƒç´  if (arr[j] &lt; minVal) &#123; minVal = arr[j]; index = j; &#125; &#125; arr[index] = arr[i]; arr[i] = minVal; &#125; return arr; &#125; å†’æ³¡æ’åºåŸºæœ¬æ€æƒ³ï¼šåŸç†æ˜¯ä¸´è¿‘çš„æ•°å­—ä¸¤ä¸¤è¿›è¡Œæ¯”è¾ƒ,æŒ‰ç…§ä»å°åˆ°å¤§æˆ–è€…ä»å¤§åˆ°å°çš„é¡ºåºè¿›è¡Œäº¤æ¢ã€‚æ ¸å¿ƒä»£ç ï¼š12345678910111213141516171819/** * å†’æ³¡æ’åº * * @param arr * è¾“å…¥çš„å¾…æ’æ•°ç»„ * @return è¿”å›æ’åºå·çš„æ•°ç»„ */ public static int[] bubbleSort(int[] arr) &#123; for (int i = 0; i &lt; arr.length; i++) &#123; for (int j = 1; j &lt; arr.length; j++) &#123; if (arr[j - 1] &gt; arr[j]) &#123; int temp = arr[j - 1]; arr[j - 1] = arr[j]; arr[j] = temp; &#125; &#125; &#125; return arr; &#125; å¸Œå°”æ’åºåŸºæœ¬æ€æƒ³ï¼šå…ˆå–ä¸€ä¸ªå°äºnçš„æ•´æ•°d1ä½œä¸ºç¬¬ä¸€ä¸ªå¢é‡ï¼ŒæŠŠæ–‡ä»¶çš„å…¨éƒ¨è®°å½•åˆ†ç»„ã€‚æ‰€æœ‰è·ç¦»ä¸ºd1çš„å€æ•°çš„è®°å½•æ”¾åœ¨åŒä¸€ä¸ªç»„ä¸­ã€‚å…ˆåœ¨å„ç»„å†…è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼›ç„¶åï¼Œå–ç¬¬äºŒä¸ªå¢é‡d2&lt;d1é‡å¤ä¸Šè¿°çš„åˆ†ç»„å’Œæ’åºï¼Œç›´è‡³æ‰€å–çš„å¢é‡ =1( &lt; â€¦&lt;d2&lt;d1)ï¼Œå³æ‰€æœ‰è®°å½•æ”¾åœ¨åŒä¸€ç»„ä¸­è¿›è¡Œç›´æ¥æ’å…¥æ’åºä¸ºæ­¢ã€‚ï¼ˆä¸‹å›¾æ¥è‡ªç™¾åº¦å›¾ç‰‡ï¼‰ æ ¸å¿ƒä»£ç ï¼š 12345678910111213141516171819202122232425262728/** * å¸Œå°”æ’åº * * @author sgl * */public class ShellSort &#123; public static int[] shellSort(int[] arr) &#123; int step = arr.length / 2;// åˆå§‹æ­¥é•¿ while (1 &lt;= step) &#123; for (int i = step; i &lt; arr.length; i++) &#123; if (arr[i] &lt; arr[i - step]) &#123; int temp = arr[i]; arr[i] = arr[i - step]; arr[i - step] = temp; &#125; &#125; step = step / 2; for (int i = 0; i &lt; arr.length; i++) &#123; System.out.print(arr[i]+&quot;,&quot;); &#125; System.out.println(); &#125; return arr; &#125; å½’å¹¶æ’åºåŸºæœ¬æ€æƒ³ï¼šå°†å¾…æ’åºåºåˆ—R[0â€¦n-1]çœ‹æˆæ˜¯nä¸ªé•¿åº¦ä¸º1çš„æœ‰åºåºåˆ—ï¼Œå°†ç›¸é‚»çš„æœ‰åºè¡¨æˆå¯¹å½’å¹¶ï¼Œå¾—åˆ°n/2ä¸ªé•¿åº¦ä¸º2çš„æœ‰åºè¡¨ï¼›å°†è¿™äº›æœ‰åºåºåˆ—å†æ¬¡å½’å¹¶ï¼Œå¾—åˆ°n/4ä¸ªé•¿åº¦ä¸º4çš„æœ‰åºåºåˆ—ï¼›å¦‚æ­¤åå¤è¿›è¡Œä¸‹å»ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æœ‰åºåºåˆ—ã€‚å½’å¹¶æ’åºå…¶å®è¦åšä¸¤ä»¶äº‹ï¼šï¼ˆ1ï¼‰â€œåˆ†è§£â€â€”â€”å°†åºåˆ—æ¯æ¬¡æŠ˜åŠåˆ’åˆ†ã€‚ï¼ˆ2ï¼‰â€œåˆå¹¶â€â€”â€”å°†åˆ’åˆ†åçš„åºåˆ—æ®µä¸¤ä¸¤åˆå¹¶åæ’åºã€‚ æ ¸å¿ƒä»£ç ï¼š12345678910111213141516171819202122232425262728293031323334353637public static int[] sort(int[] nums, int low, int high) &#123; int mid = (low + high) / 2; if (low &lt; high) &#123; sort(nums, low, mid);// å·¦è¾¹ sort(nums, mid + 1, high);// å³è¾¹ merge(nums, low, mid, high);// å·¦å³å½’å¹¶ &#125; return nums; &#125; public static void merge(int[] nums, int low, int mid, int high) &#123; int[] temp = new int[high - low + 1]; int i = low;// å·¦æŒ‡é’ˆ int j = mid + 1;// å³æŒ‡é’ˆ int k = 0; // æŠŠè¾ƒå°çš„æ•°å…ˆç§»åˆ°æ–°æ•°ç»„ä¸­ while (i &lt;= mid &amp;&amp; j &lt;= high) &#123; if (nums[i] &lt; nums[j]) &#123; temp[k++] = nums[i++]; &#125; else &#123; temp[k++] = nums[j++]; &#125; &#125; // æŠŠå·¦è¾¹å‰©ä½™çš„æ•°ç§»å…¥æ•°ç»„ while (i &lt;= mid) &#123; temp[k++] = nums[i++]; &#125; // æŠŠå³è¾¹è¾¹å‰©ä½™çš„æ•°ç§»å…¥æ•°ç»„ while (j &lt;= high) &#123; temp[k++] = nums[j++]; &#125; // æŠŠæ–°æ•°ç»„ä¸­çš„æ•°è¦†ç›–numsæ•°ç»„ for (int k2 = 0; k2 &lt; temp.length; k2++) &#123; nums[k2 + low] = temp[k2]; &#125; &#125;&#125; å¿«é€Ÿæ’åºåŸºæœ¬æ€æƒ³ï¼šå¿«é€Ÿæ’åºé‡‡ç”¨çš„æ€æƒ³æ˜¯åˆ†æ²»æ€æƒ³ã€‚å¿«é€Ÿæ’åºæ˜¯æ‰¾å‡ºä¸€ä¸ªå…ƒç´ ï¼ˆç†è®ºä¸Šå¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªï¼‰ä½œä¸ºåŸºå‡†,ç„¶åå¯¹æ•°ç»„è¿›è¡Œåˆ†åŒºæ“ä½œ,ä½¿åŸºå‡†å·¦è¾¹å…ƒç´ çš„å€¼éƒ½ä¸å¤§äºåŸºå‡†å€¼,åŸºå‡†å³è¾¹çš„å…ƒç´ å€¼ éƒ½ä¸å°äºåŸºå‡†å€¼ï¼Œå¦‚æ­¤ä½œä¸ºåŸºå‡†çš„å…ƒç´ è°ƒæ•´åˆ°æ’åºåçš„æ­£ç¡®ä½ç½®ã€‚é€’å½’å¿«é€Ÿæ’åºï¼Œå°†å…¶ä»–n-1ä¸ªå…ƒç´ ä¹Ÿè°ƒæ•´åˆ°æ’åºåçš„æ­£ç¡®ä½ç½®ã€‚æœ€åæ¯ä¸ªå…ƒç´ éƒ½æ˜¯åœ¨æ’åºåçš„æ­£ ç¡®ä½ç½®ï¼Œæ’åºå®Œæˆã€‚æ‰€ä»¥å¿«é€Ÿæ’åºç®—æ³•çš„æ ¸å¿ƒç®—æ³•æ˜¯åˆ†åŒºæ“ä½œï¼Œå³å¦‚ä½•è°ƒæ•´åŸºå‡†çš„ä½ç½®ä»¥åŠè°ƒæ•´è¿”å›åŸºå‡†çš„æœ€ç»ˆä½ç½®ä»¥ä¾¿åˆ†æ²»é€’å½’ã€‚ æ ¸å¿ƒä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233/** * å¿«é€Ÿæ’åº * * @author sgl * */public class QuickSort &#123; static void quicksort(int n[], int left, int right) &#123; int dp; if (left &lt; right) &#123; dp = partition(n, left, right); quicksort(n, left, dp - 1); quicksort(n, dp + 1, right); &#125; &#125; static int partition(int n[], int left, int right) &#123; int pivot = n[left]; while (left &lt; right) &#123; while (left &lt; right &amp;&amp; n[right] &gt;= pivot) right--; if (left &lt; right) n[left++] = n[right]; while (left &lt; right &amp;&amp; n[left] &lt;= pivot) left++; if (left &lt; right) n[right--] = n[left]; &#125; n[left] = pivot; return left; &#125;&#125;]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŸºäºmavenæ„å»ºå¤šæ¨¡å—åŒ–çš„SSMæ¡†æ¶]]></title>
    <url>%2F2018%2F11%2F10%2Fproject-frame-maven-ssm%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰å†™è¿‡ä¸€ç¯‡SSMçš„æ¡†æ¶æ•´åˆï¼›é¡¹ç›®å¼€å‘æ¡†æ¶-SSMï¼›å¯¹SSMä¸­çš„ä¸€äº›ç‚¹è¿›è¡Œäº†å­¦ä¹ è®°å½•,é‚£ç¯‡æ–‡ç« ä¹Ÿæ˜¯åŸºäºmavenæ¥åˆ›å»ºçš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆåˆè¦æä¸€ç¯‡å‘¢ï¼Ÿä»¥æˆ‘å½“å‰å…¬å¸é¡¹ç›®Aæ¥è¯´ï¼ŒAé¡¹ç›®åŒ…æ‹¬å‰å°ã€åå°å­é¡¹ç›®ã€å‰å°ç”¨äºå¯¹å¤–ï¼Œåå°ç”¨äºç®¡ç†ã€‘ï¼Œå¦‚æœæŒ‰ç…§å‰ä¸€ç¯‡æ–‡ç« çš„é‚£ç§æ–¹å¼æ¥è¿›è¡Œï¼Œæˆ‘ä»¬å°±éœ€è¦å»ºç«‹ä¸¤ä¸ªå•ç‹¬çš„æ¡†æ¶æ¥è¿›è¡Œå¼€å‘ï¼Œä¸€æ ·çš„æ‹¥æœ‰ä¸€å¥—ä»dmoå®ä½“ç±»åŒ…ï¼ŒutilåŒ…ï¼ŒdaoåŒ…ï¼ŒserviceåŒ…ä»¥åŠcontrolleråŒ…ï¼Œè¿™ç§ç»“æ„éå¸¸çš„ç´§å‡‘å’Œç‹¬ç«‹ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬å‰åå°ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªåº“ï¼Œdmoã€utilã€daoä»¥åŠserviceä¸­éƒ½ä¼šå­˜åœ¨å¤§é‡é‡å¤çš„ä»£ç ï¼Œå¾ˆå¤šåŸºç¡€æ–¹æ³•æ— æ³•å…¬ç”¨ï¼›å¦å¤–ä¸€ä¸ªåŸå› æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŒ…è£…ä¸€äº›æ¥å£å‘å¤–æä¾›æœåŠ¡ã€ä¸å±€é™äºæˆ‘ä»¬è‡ªå·±çš„è¿™ä¸¤ä¸ªç³»ç»Ÿã€‘ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬åˆéœ€è¦å†å»æŠ½ç¦»ä¸€æ¬¡serviceï¼Œéå¸¸ä¸æ–¹ä¾¿ã€‚å› æ­¤å°±ä½¿ç”¨mavenæ¥æ„å»ºå¤šæ¨¡å—é¡¹ç›®ï¼Œå¯¹äºutilã€daoã€rpcæœåŠ¡æ¥å£ä»¥åŠserviceè¿›è¡Œæ¨¡å—åŒ–åˆ†ç¦»ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè¿™äº›æ¨¡å—å°±å¯ä»¥å¯¹æˆ‘ä»¬è‡ªå·±çš„å‰åå°ä»¥åŠå¤–éƒ¨æä¾›ä¸€äº›å…¬å…³çš„æœåŠ¡ï¼Œé¿å…äº†å¤§é‡çš„ä»£ç é‡å¤ï¼Œä¹Ÿæ–¹ä¾¿ç®¡ç†ã€‚ Mavenå¤šæ¨¡å—é¡¹ç›®ï¼Œé€šè¿‡åˆç†çš„æ¨¡å—æ‹†åˆ†ï¼Œå®ç°ä»£ç çš„å¤ç”¨ï¼Œä¾¿äºç»´æŠ¤å’Œç®¡ç†ã€‚å°¤å…¶æ˜¯ä¸€äº›å¼€æºæ¡†æ¶ï¼Œä¹Ÿæ˜¯é‡‡ç”¨å¤šæ¨¡å—çš„æ–¹å¼ï¼Œæä¾›æ’ä»¶é›†æˆï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é…ç½®æŒ‡å®šçš„æ¨¡å—ã€‚ æ„å»ºå¤šæ¨¡å—åŒ–é¡¹ç›®åŸºäºmavenæ„å»ºå¤šæ¨¡å—åŒ–é¡¹ç›®ä¸»è¦ä¾èµ–äºmavenå¯ä»¥å®ç°çˆ¶å­é¡¹ç›®çš„å…³ç³»ï¼Œå­é¡¹ç›®å¯ä»¥çˆ¶é¡¹ç›®çš„ä¾èµ–JaråŒ…ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬å»å…±åŒç®¡ç†jarä¾èµ–ï¼Œä½†æ˜¯ç”±äºä¸€ä¸ªé¡¹ç›®ä¸­æ¯•ç«Ÿä¼šæœ‰å¾ˆå¤šäººè¿›è¡ŒååŒå¼€å‘ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰å¾ˆå¥½çš„çº¦æŸï¼Œå¯¹äºè¿™ç§å¤šæ¨¡å—åŒ–æ¥è¯´ï¼Œè§£å†³jaråŒ…çš„å†²çªä¹Ÿå¾ˆç¹çã€‚ æ–°å»ºä¸€ä¸ªçˆ¶å·¥ç¨‹1.åˆ›å»ºmavené¡¹ç›® step1:(æ–°å»ºmavené¡¹ç›®) step2:(å‹¾é€‰åˆ›å»ºä¸€ä¸ªç®€å•å·¥ç¨‹) step3:(å¡«å†™å·¥ç¨‹é…ç½®ï¼šä¸»è¦æ˜¯æ‰“åŒ…æ–¹å¼è¦é€‰æ‹©pomæ–¹å¼)ç‚¹å‡»finishï¼Œçˆ¶é¡¹ç›®å°±åˆ›å»ºæˆåŠŸäº†ï¼2.åˆ›å»ºå­é¡¹ç›® step1:(å³å‡»çˆ¶é¡¹ç›®-&gt;maven-&gt;New Maven Model Project) step2: step3:(ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­çš„utilã€daoã€serviceéƒ½æ˜¯å¯ä»¥ç›´æ¥åˆ†å‡ºæ¥çš„ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©quickstartæ¥æ„å»º,ç”¨äºç”Ÿäº§åé¢çš„jaråŒ…æä¾›æœåŠ¡ã€‚æˆ‘ä»¬çš„webå­é¡¹ç›®é€‰æ‹©webappæ¥æ„å»ºï¼Œç”¨äºé…ç½®æ–‡ä»¶ã€jspæ–‡ä»¶/ftl/html/js/cssç­‰ç•Œé¢èµ„æºæ–‡ä»¶ç»´æŠ¤)ç‚¹å‡»finishï¼Œå®Œæˆå­æ¨¡å—çš„æ„å»ºï¼æ„å»ºä¹‹åçš„é¡¹ç›®ç»“æ„ä¸ºï¼šæ­¤æ—¶ï¼Œæˆ‘ä»¬çš„çˆ¶æ¨¡å—ä¸­å·²ç»æœ‰äº†å­æ¨¡å—çš„é¡¹ç›®æ ‡è¯†ï¼Œæ–°å»ºçš„daoæ¨¡å—ä¸­ä¸åŒ…æ‹¬webappæ­¤ç±»çš„æ–‡ä»¶å¤¹ã€‚é‚£ä¹ˆè¿™æ—¶å°±å¯ä»¥å°†æˆ‘ä»¬çš„æ•°æ®è®¿é—®ç›¸å…³çš„ç±»å’Œæ¥å£éƒ½æ”¾åœ¨è¿™ä¸ªå­æ¨¡å—ä¸­ï¼Œå¦‚æœå…¶ä»–é¡¹ç›®éœ€è¦ä½¿ç”¨ï¼Œæˆ‘ä»¬ç›´æ¥å¼•å…¥å°±è¡Œï¼Œå¼•å…¥æ–¹å¼å¦‚ä¸‹ï¼ˆä¸‹é¢æˆªå›¾æ˜¯ä»serviceæ¨¡å—å¼•å…¥daoæ¨¡å—çš„ï¼Œè¿™é‡Œçš„groupIdï¼ŒartifactIdï¼Œversionæˆ‘ä»¬å¯ä»¥åœ¨daoçš„pomæ–‡ä»¶ä¸­ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰ï¼šï¼ˆä¸Šé¢æ–°å»ºçš„è¿‡ç¨‹åªä½œä¸ºæ¼”ç¤ºè€Œç”¨ï¼Œä¸‹é¢çš„å¼•å…¥å’Œä¸Šé¢çš„æ–°å»ºé¡¹ç›®å¹¶éä¸€ä¸ªé¡¹ç›®ï¼‰å…¶ä»–çš„æ¨¡å—æ„å»ºå’Œdaoçš„æ„å»ºè¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€æ„å»ºäº†ã€‚æºç åœ°å€åœ¨ä¸‹é¢ï¼Œè§£å‹ä¹‹åï¼Œä»¥mavené¡¹ç›®æ–¹å¼å¯¼å…¥ï¼Œä¿®æ”¹ä¸‹æ•°æ®åº“é…ç½®æ–‡ä»¶åº”è¯¥å°±å¯ä»¥ç›´æ¥è¿è¡Œäº†ï¼ˆå½“å‰é¡¹ç›®åŸºäºjdk1.7å†™çš„ï¼Œæœ‰çš„å°ä¼™ä¼´å¦‚æœç”¨1.8çš„è¯ï¼Œåº”è¯¥ä¼šå‡ºç°jspæ— æ³•ç¼–è¯‘çš„ä¸€ä¸ªé”™è¯¯ï¼‰ï¼›æºç é™„ä»¶ä¸­è¿˜æœ‰ä¸€ä¸ªsettingæ–‡ä»¶,é˜¿é‡Œçš„ï¼Œä¸ªäººè§‰å¾—ç”¨èµ·æ¥å¾ˆä¸é”™ï¼Œä¹Ÿæ¨èç»™å¤§å®¶! æºç åœ°å€ï¼šhttp://download.csdn.net/download/sinat_25518349/10124726ã€è¿™ä¸ªæ˜¯csdnçš„åœ°å€ï¼Œç°åœ¨èµ„æºä¸Šä¼ è¿˜å¿…éœ€è¦é€‰æ‹©Cå¸ï¼Œå°ä¼™ä¼´å¦‚æœæ²¡æœ‰csdnè´¦æˆ·æˆ–è€…Cå¸ä¸è¶³ï¼Œå¯ä»¥åœ¨æ–‡ç« ç•™è¨€åŒºç•™è¨€ï¼Œç•™ä¸‹é‚®ç®±ï¼Œæˆ‘å‘ç»™ä½ ä»¬ã€‘]]></content>
      <categories>
        <category>æ¶æ„</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
        <tag>ssm</tag>
        <tag>spring</tag>
        <tag>web</tag>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šæ€ã€æ¥å£å’ŒæŠ½è±¡ç±»]]></title>
    <url>%2F2018%2F11%2F10%2Fglmapper-bird-two%2F</url>
    <content type="text"><![CDATA[é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚ä»ä¸€å®šè§’åº¦æ¥çœ‹ï¼Œå°è£…å’Œç»§æ‰¿å‡ ä¹éƒ½æ˜¯ä¸ºå¤šæ€è€Œå‡†å¤‡çš„ã€‚è¿™æ˜¯æˆ‘ä»¬æœ€åä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„çŸ¥è¯†ç‚¹ã€‚ å¤šæ€çš„å®šä¹‰ï¼šæŒ‡å…è®¸ä¸åŒç±»çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯åšå‡ºå“åº”ã€‚å³åŒä¸€æ¶ˆæ¯å¯ä»¥æ ¹æ®å‘é€å¯¹è±¡çš„ä¸åŒè€Œé‡‡ç”¨å¤šç§ä¸åŒçš„è¡Œä¸ºæ–¹å¼ã€‚ï¼ˆå‘é€æ¶ˆæ¯å°±æ˜¯å‡½æ•°è°ƒç”¨ï¼‰ åŠ¨æ€ç»‘å®š é™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®šè¿™é‡Œæ‰€è°“çš„ç»‘å®šï¼Œå³ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¸æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼ˆæ–¹æ³•ä¸»ä½“ï¼‰å…³è”èµ·æ¥ã€‚ é™æ€ç»‘å®šï¼ˆå‰æœŸç»‘å®šï¼‰ï¼šå³åœ¨ç¨‹åºæ‰§è¡Œå‰ï¼Œå³ç¼–è¯‘çš„æ—¶å€™å·²ç»å®ç°äº†è¯¥æ–¹æ³•ä¸æ‰€åœ¨ç±»çš„ç»‘å®šï¼ŒåƒCå°±æ˜¯é™æ€ç»‘å®šã€‚ javaä¸­åªæœ‰staticï¼Œfinalï¼Œprivateå’Œæ„é€ æ–¹æ³•æ˜¯é™æ€ç»‘å®šï¼Œå…¶ä»–çš„éƒ½å±äºåŠ¨æ€ç»‘å®šï¼Œè€Œprivateçš„æ–¹æ³•å…¶å®ä¹Ÿæ˜¯finalæ–¹æ³•ï¼ˆéšå¼ï¼‰ï¼Œè€Œæ„é€  æ–¹æ³•å…¶å®æ˜¯ä¸€ä¸ªstaticæ–¹æ³•ï¼ˆéšå¼ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥çœ‹å‡ºæŠŠæ–¹æ³•å£°æ˜ä¸ºfinalï¼Œç¬¬ä¸€å¯ä»¥è®©ä»–ä¸è¢«é‡å†™ï¼Œç¬¬äºŒä¹Ÿå¯ä»¥å…³é—­å®ƒçš„åŠ¨æ€ç»‘å®šã€‚ åŠ¨æ€ç»‘å®šï¼ˆåæœŸç»‘å®šï¼‰ï¼šè¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„ç±»å‹è¿›è¡Œç»‘å®šï¼Œjavaä¸­çš„å¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯å±äºåŠ¨æ€ç»‘å®šï¼Œä¹Ÿå°±æ˜¯å®ç°å¤šæ€çš„åŸºç¡€ã€‚ javaå®ç°äº†åæœŸç»‘å®šï¼Œåˆ™å¿…é¡»æä¾›ä¸€äº›æœºåˆ¶ï¼Œå¯åœ¨è¿è¡ŒæœŸé—´åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ï¼Œå¹¶åˆ†åˆ«è°ƒç”¨é€‚å½“çš„æ–¹æ³•ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘çš„æ—¶å€™è¯¥æ–¹æ³•ä¸ä¸æ‰€åœ¨ç±»ç»‘å®šï¼Œç¼–è¯‘å™¨æ­¤æ—¶ä¾ç„¶ä¸çŸ¥é“å¯¹è±¡çš„ç±»å‹ï¼Œä½†æ–¹æ³•è°ƒç”¨æœºåˆ¶èƒ½è‡ªå·±å»è°ƒæŸ¥ï¼Œæ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•ä¸»ä½“ã€‚javaé‡Œå®ç°åŠ¨æ€ç»‘å®šçš„æ˜¯JVM. åŠ¨æ€ç»‘å®šæ˜¯å®ç°å¤šæ€çš„æŠ€æœ¯ï¼Œæ˜¯æŒ‡åœ¨æ‰§è¡ŒæœŸé—´åˆ¤æ–­æ‰€å¼•ç”¨å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œæ ¹æ®å…¶å®é™…çš„ç±»å‹è°ƒç”¨å…¶ç›¸åº”çš„æ–¹æ³•ã€‚ å¤šæ€çš„ä½œç”¨æ¶ˆé™¤ç±»å‹ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å³ï¼šæŠŠä¸åŒçš„å­ç±»å¯¹è±¡éƒ½å½“ä½œçˆ¶ç±»æ¥çœ‹ï¼Œå¯ä»¥å±è”½ä¸åŒå­ç±»å¯¹è±¡ä¹‹é—´çš„å·®å¼‚ï¼Œå†™å‡ºé€šç”¨çš„ä»£ç ï¼Œåšå‡ºé€šç”¨çš„ç¼–ç¨‹ï¼Œä»¥é€‚åº”éœ€æ±‚çš„ä¸æ–­å˜åŒ–ã€‚ å¤šæ€å­˜åœ¨çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶ä¸€ã€è¦æœ‰ç»§æ‰¿ï¼›äºŒã€è¦æœ‰é‡å†™ï¼›ä¸‰ã€çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ã€‚ å¤šæ€çš„ä¼˜ç‚¹1.å¯æ›¿æ¢æ€§ï¼ˆsubstitutabilityï¼‰ã€‚å¤šæ€å¯¹å·²å­˜åœ¨ä»£ç å…·æœ‰å¯æ›¿æ¢æ€§ã€‚2.å¯æ‰©å……æ€§ï¼ˆextensibilityï¼‰ã€‚å¤šæ€å¯¹ä»£ç å…·æœ‰å¯æ‰©å……æ€§ã€‚å¢åŠ æ–°çš„å­ç±»ä¸å½±å“å·²å­˜åœ¨ç±»çš„å¤šæ€æ€§ã€ç»§æ‰¿æ€§ï¼Œä»¥åŠå…¶ä»–ç‰¹æ€§çš„è¿è¡Œå’Œæ“ä½œã€‚å®é™…ä¸Šæ–°åŠ å­ç±»æ›´å®¹æ˜“è·å¾—å¤šæ€åŠŸèƒ½ã€‚3.æ¥å£æ€§ï¼ˆinterface-abilityï¼‰ã€‚å¤šæ€æ˜¯è¶…ç±»é€šè¿‡æ–¹æ³•ç­¾åï¼Œå‘å­ç±»æä¾›äº†ä¸€ä¸ªå…±åŒæ¥å£ï¼Œç”±å­ç±»æ¥å®Œå–„æˆ–è€…è¦†ç›–å®ƒè€Œå®ç°çš„ã€‚4.çµæ´»æ€§ï¼ˆflexibilityï¼‰ã€‚å®ƒåœ¨åº”ç”¨ä¸­ä½“ç°äº†çµæ´»å¤šæ ·çš„æ“ä½œï¼Œæé«˜äº†ä½¿ç”¨æ•ˆç‡ã€‚5.ç®€åŒ–æ€§ï¼ˆsimplicityï¼‰ã€‚å¤šæ€ç®€åŒ–å¯¹åº”ç”¨è½¯ä»¶çš„ä»£ç ç¼–å†™å’Œä¿®æ”¹è¿‡ç¨‹ï¼Œå°¤å…¶åœ¨å¤„ç†å¤§é‡å¯¹è±¡çš„è¿ç®—å’Œæ“ä½œæ—¶ï¼Œè¿™ä¸ªç‰¹ç‚¹å°¤ä¸ºçªå‡ºå’Œé‡è¦ã€‚ å¤šæ€çš„å®ç°æ–¹å¼Javaä¸­å¤šæ€çš„å®ç°æ–¹å¼ï¼š æ¥å£å®ç° ç»§æ‰¿çˆ¶ç±»è¿›è¡Œæ–¹æ³•é‡å†™ åŒä¸€ä¸ªç±»ä¸­è¿›è¡Œæ–¹æ³•é‡è½½ã€‚ä¾‹å­æ— è®ºå·¥ä½œè¿˜æ˜¯å­¦ä¹ ä¸­ï¼Œç¬”éƒ½æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„å·¥å…·ã€‚ä½†æ˜¯ç¬”çš„ç§ç±»åˆéå¸¸çš„ç¹å¤šï¼Œé“…ç¬”ã€ç­¾å­—ç¬”ã€æ°´ç¬”ã€æ¯›ç¬”ã€é’¢ç¬”â€¦ã€‚ç°åœ¨æˆ‘ä»¬è¦å¯¹â€œç¬”â€è¿›è¡ŒæŠ½è±¡ï¼ŒæŠ½è±¡æˆä¸€ä¸ªæŠ½è±¡çˆ¶ç±»â€œPenâ€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.glmapper.demo.base;/** * æŠ½è±¡çˆ¶ç±»ï¼šç¬” * @author glmapper */public abstract class Pen &#123; //ç¬”çš„é•¿åº¦ private int length; //é¢œè‰² private String color; //ç±»å‹ private String type; //ä»·æ ¼ private double price; //å†™å­— public abstract void write(String cnt); public int getLength() &#123; return length; &#125; public void setLength(int length) &#123; this.length = length; &#125; public String getColor() &#123; return color; &#125; public void setColor(String color) &#123; this.color = color; &#125; public String getType() &#123; return type; &#125; public void setType(String type) &#123; this.type = type; &#125; public double getPrice() &#123; return price; &#125; public void setPrice(double price) &#123; this.price = price; &#125; &#125; ç°åœ¨æœ‰ä¸¤ä¸ªå­ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼šé“…ç¬”å’Œé’¢ç¬”ã€‚ é“…ç¬”ç±»ï¼Œç»§æ‰¿çˆ¶ç±»Penï¼Œå¹¶é‡å†™writeæ–¹æ³•1234567891011121314151617package com.glmapper.demo.base;/** * é“…ç¬”ç±» ç»§æ‰¿çˆ¶ç±» ç¬”ï¼ˆæ»¡è¶³å¿…è¦æ¡ä»¶ä¸€ï¼šæœ‰ç»§æ‰¿ã€å…¶å®å¦‚æœæ˜¯æ¥å£çš„è¯ï¼Œimplementå®ç°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‘ï¼‰ * @author glmapper * */public class Pencil extends Pen&#123; /** * çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•å§”æ‰˜å­ç±»å…·ä½“å®ç°ï¼šè¦†ç›– */ //æ»¡è¶³å¿…è¦æ¡ä»¶äºŒï¼šè¦æœ‰é‡å†™ã€å½“ç„¶ï¼Œå¦‚æœæ˜¯å¯¹äºwriteæœ‰é‡è½½ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸åŒçš„æ¦‚å¿µè€Œå·²ã€‘ @Override public void write(String cnt) &#123; System.out.println(&quot;è¿™æ˜¯ä¸€åªé“…ç¬”å†™çš„å†…å®¹ï¼Œå†…å®¹æ˜¯ï¼š&quot;+cnt); &#125;&#125; é’¢ç¬”ç±»ï¼Œç»§æ‰¿çˆ¶ç±»Penï¼Œå¹¶é‡å†™writeæ–¹æ³• 1234567891011121314package com.glmapper.demo.base;/** * é’¢ç¬”ç±» ç»§æ‰¿çˆ¶ç±» ç¬” * @author 17070738 * */public class Fountainpen extends Pen&#123; @Override public void write(String cnt) &#123; System.out.println(&quot;è¿™æ˜¯ä¸€æ”¯é’¢ç¬”å†™çš„å†…å®¹ï¼Œå†…å®¹æ˜¯ï¼š&quot;+cnt); &#125;&#125; æµ‹è¯•ï¼š 12345678910111213package com.glmapper.demo.base;public class MainTest &#123; public static void main(String[] args) &#123; /* Pen pen= new Pencil();*/ //å¿…è¦æ¡ä»¶ä¸‰ï¼šçˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ã€‚ Pen pen= new Fountainpen(); pen.write(&quot;æˆ‘æ˜¯ä¸€æ”¯ç¬”&quot;); &#125;&#125; è¾“å‡ºç»“æœï¼šè¿™æ˜¯ä¸€æ”¯é’¢ç¬”å†™çš„å†…å®¹ï¼Œå†…å®¹æ˜¯ï¼šæˆ‘æ˜¯ä¸€æ”¯ç¬” è¯´æ˜å¯æ›¿æ¢æ€§ï¼šå¤šæ€å¯¹ç¬”Penç±»å·¥ä½œï¼Œå¯¹å…¶ä»–ä»»ä½•å­ç±»ï¼Œå¦‚é“…ç¬”ã€é’¢ç¬”ï¼Œä¹ŸåŒæ ·å·¥ä½œã€‚å¯æ‰©å……æ€§ï¼šåœ¨å®ç°äº†é“…ç¬”ã€é’¢ç¬”çš„å¤šæ€åŸºç¡€ä¸Šï¼Œå¾ˆå®¹æ˜“å¢æ·»â€œç¬”â€ç±»çš„å¤šæ€æ€§ã€‚ æ¥å£ä¸€ä¸ªJavaæ¥å£ï¼Œå°±æ˜¯ä¸€äº›æ–¹æ³•ç‰¹å¾çš„é›†åˆã€‚ã€æœ¬æ–‡è§’åº¦å¹¶éæ˜¯javaåŸºç¡€è§’åº¦æ¥è¯´ï¼Œä¸»è¦æ˜¯ä»¥è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨ä¸ºèƒŒæ™¯ï¼Œå› æ­¤å¯¹äºç›¸å…³å®šä¹‰åŠç”¨æ³•è¯·è‡ªè¡Œå­¦ä¹ ã€‚http://www.runoob.com/java/java-interfaces.htmlã€‘æˆ‘ä»¬åœ¨å¹³æ—¶çš„å·¥ä½œä¸­ï¼Œæåˆ°æ¥å£ï¼Œä¸€èˆ¬ä¼šå«æœ‰ä¸¤ç§ä¸åŒçš„å«ä¹‰ï¼Œ æŒ‡çš„æ˜¯javaæ¥å£ï¼Œè¿™æ˜¯ä¸€ç§javaè¯­è¨€ä¸­å­˜åœ¨çš„ç»“æ„ï¼Œæœ‰ç‰¹å®šçš„è¯­æ³•å’Œç»“æ„ æŒ‡ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æ–¹æ³•ç‰¹å¾çš„é›†åˆï¼Œæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„æŠ½è±¡ã€‚ å‰è€…å«åšâ€œjavaæ¥å£â€ï¼Œåè€…å«ç€â€œæ¥å£â€ã€‚ä¾‹å¦‚ï¼šjava.lang.Runnableå°±æ˜¯ä¸€ä¸ªjavaæ¥å£ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨æ¥å£æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ï¼Œå‡å¦‚æ²¡æœ‰æ¥å£ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿä¸€ä¸ªç±»æ€»å½’æ˜¯å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥è¿›è¡Œæ‰©å±•çš„ï¼Œè¿™éš¾é“ä¸è¶³ä»¥æˆ‘ä»¬çš„å®é™…åº”ç”¨å—ï¼Ÿä¸€ä¸ªå¯¹è±¡éœ€è¦çŸ¥é“å…¶ä»–çš„ä¸€äº›å¯¹è±¡ï¼Œå¹¶ä¸”ä¸å…¶ä»–çš„å¯¹è±¡å‘ç”Ÿç›¸äº’çš„ä½œç”¨ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›å¯¹è±¡éœ€è¦å€Ÿä½äºå…¶ä»–å¯¹è±¡çš„è¡Œä¸ºä»¥ä¾¿äºå®Œæˆä¸€é¡¹å·¥ä½œã€‚è¿™äº›å…³äºå…¶ä»–å¯¹è±¡çš„çŸ¥è¯†ï¼Œä»¥åŠå¯¹å…¶ä»–å¯¹è±¡è¡Œä¸ºçš„è°ƒç”¨ï¼Œéƒ½æ˜¯ä½¿ç”¨ç¡¬ä»£ç å†™åœ¨ç±»é‡Œé¢çš„ï¼Œå¯æ’å…¥æ€§å‡ ä¹ä¸º0ã€‚å¦‚ï¼šé’¢ç¬”ä¸­éœ€è¦é’¢ç¬”æ°´ï¼Œé’¢ç¬”æ°´æœ‰ä¸åŒçš„é¢œè‰²ï¼šé’¢ç¬”æ°´ç±»ï¼š1234567891011121314151617181920212223package com.glmapper.demo.base;/** * é’¢ç¬”å¢¨æ°´ * @author glmapper */public class PenInk &#123; //å¢¨æ°´é¢œè‰² private String inkColor; public String getInkColor() &#123; return inkColor; &#125; public void setInkColor(String inkColor) &#123; this.inkColor = inkColor; &#125; public PenInk(String inkColor) &#123; super(); this.inkColor = inkColor; &#125; &#125; é’¢ç¬”ä¸­æŒæœ‰ä¸€ä¸ªå¢¨æ°´ç±»çš„å¯¹è±¡å¼•ç”¨ï¼š 123456789101112131415package com.glmapper.demo.base;/** * é’¢ç¬”ç±» ç»§æ‰¿çˆ¶ç±» ç¬” * @author 17070738 * */public class Fountainpen extends Pen&#123; //å¼•ç”¨æŒæœ‰ PenInk ink =new PenInk(&quot;black&quot;); @Override public void write(String cnt) &#123; System.out.println(&quot;é’¢ç¬”å¢¨æ°´é¢œè‰²æ˜¯ï¼š&quot;+ink.getInkColor()); System.out.println(&quot;è¿™æ˜¯ä¸€æ”¯é’¢ç¬”å†™çš„å†…å®¹ï¼Œå†…å®¹æ˜¯ï¼š&quot;+cnt); &#125;&#125; ä½†æ˜¯è¿™ç§æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ¢ä¸€ç§é¢œè‰²æ€ä¹ˆåŠå‘¢ï¼Ÿå°±å¿…é¡»è¦å¯¹Fountainpenä¸­çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå°†åˆ›å»ºPenInkå¯¹è±¡æ—¶çš„inkColorå±æ€§è¿›è¡Œæ›´æ”¹ï¼›ç°åœ¨å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œæä¾›æŸç§ä½¿ç”¨ç¡¬ä»£ç å†™åœ¨ç±»ä¸­çš„è¡Œä¸ºï¼›ç°åœ¨ï¼Œè¦æä¾›ä¸€äº›ç±»ä¼¼çš„è¡Œä¸ºï¼Œå¹¶ä¸”å¯ä»¥å®ç°åŠ¨æ€çš„å¯æ’å…¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦èƒ½å¤ŸåŠ¨æ€çš„å†³å®šä½¿ç”¨å“ªä¸€ç§å®ç°ã€‚ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ä¸ºè¿™ä¸ªç±»æä¾›ä¸€ä¸ªæŠ½è±¡çˆ¶ç±»ï¼Œä¸”å£°æ˜å‡ºå­ç±»è¦æä¾›çš„è¡Œä¸ºï¼Œç„¶åè®©è¿™ä¸ªå…·ä½“ç±»ç»§æ‰¿è‡ªè¿™ä¸ªæŠ½è±¡çˆ¶ç±»ã€‚åŒæ—¶ï¼Œä¸ºè¿™ä¸ªæŠ½è±¡çˆ¶ç±»æä¾›å¦å¤–ä¸€ä¸ªå…·ä½“çš„å­ç±»ï¼Œè¿™ä¸ªå­ç±»ä»¥ä¸åŒçš„æ–¹æ³•å®ç°äº†çˆ¶ç±»æ‰€å£°æ˜çš„è¡Œä¸ºã€‚å®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€çš„å†³å®šä½¿ç”¨å“ªä¸€ä¸ªå…·ä½“çš„å­ç±»ï¼Œè¿™æ˜¯å¦å¯ä»¥æä¾›å¯æ’å…¥æ€§å‘¢ï¼Ÿæ”¹è¿›ä¹‹åçš„ä»£ç ï¼šå­ç±»1ï¼šé»‘è‰²å¢¨æ°´1234567891011package com.glmapper.demo.base;/** * é»‘è‰²å¢¨æ°´ * @author glmapper */public class BlackInk extends PenInk&#123; public BlackInk() &#123; super(&quot;black&quot;); &#125;&#125; å­ç±»2ï¼šè“è‰²å¢¨æ°´ 1234567891011package com.glmapper.demo.base;/** * è“è‰²å¢¨æ°´ * @author glmapper */public class BlueInk extends PenInk&#123; public BlueInk() &#123; super(&quot;blue&quot;); &#125;&#125; é’¢ç¬”ç±»å¼•ç”¨ï¼š 123456789101112131415161718package com.glmapper.demo.base;/** * é’¢ç¬”ç±» ç»§æ‰¿çˆ¶ç±» ç¬” * @author 17070738 * */public class Fountainpen extends Pen&#123; PenInk ink ; //é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–PenInk ï¼ŒPenInkç”±å…·ä½“å­ç±»æ¥å®ç° public Fountainpen(PenInk ink) &#123; this.ink = ink; &#125; @Override public void write(String cnt) &#123; System.out.println(&quot;é’¢ç¬”å¢¨æ°´é¢œè‰²æ˜¯ï¼š&quot;+ink.getInkColor()); System.out.println(&quot;è¿™æ˜¯ä¸€æ”¯é’¢ç¬”å†™çš„å†…å®¹ï¼Œå†…å®¹æ˜¯ï¼š&quot;+cnt); &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ï¼š 12345678public static void main(String[] args) &#123; /** * ä½¿ç”¨é»‘è‰²å¢¨æ°´å­ç±» */ Pen pen= new Fountainpen(new BlackInk()); pen.write(&quot;æˆ‘æ˜¯ä¸€æ”¯ç¬”&quot;); &#125; ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œç¡®å®å¯ä»¥åœ¨ç®€å•çš„æƒ…å†µä¸‹æä¾›äº†åŠ¨æ€å¯æ’å…¥æ€§ã€‚ ä½†æ˜¯ç”±äºjavaè¯­è¨€æ˜¯ä¸€ä¸ªå•ç»§æ‰¿çš„è¯­è¨€ï¼Œæ¢è¨€ä¹‹ï¼Œä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªè¶…ç±»ï¼Œå› æ­¤ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¿™ä¸ªå…·ä½“ç±»å¯èƒ½å·²ç»æœ‰äº†ä¸€ä¸ªè¶…ç±»ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¦ç»™ä»–åŠ ä¸Šä¸€ä¸ªæ–°çš„è¶…ç±»æ˜¯ä¸å¯èƒ½çš„ã€‚å¦‚æœç¡¬è¦åšçš„è¯ï¼Œå°±åªå¥½æŠŠè¿™ä¸ªæ–°çš„è¶…ç±»åŠ åˆ°å·²æœ‰çš„è¶…ç±»ä¸Šé¢ï¼Œå½¢æˆè¶…è¶…ç±»çš„æƒ…å†µï¼Œå¦‚æœè¿™ä¸ªè¶…è¶…ç±»çš„ä½ç½®ä¹Ÿå·²ç»è¢«å ç”¨äº†ï¼Œå°±åªå¥½ç»§ç»­å‘ä¸Šç§»åŠ¨ï¼Œç›´åˆ°ç§»åŠ¨åˆ°ç±»ç­‰çº§ç»“æ„çš„æœ€é¡¶ç«¯ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯¹ä¸€ä¸ªå…·ä½“ç±»çš„å¯æ’å…¥æ€§è®¾è®¡ï¼Œå°±å˜æˆäº†å¯¹æ•´ä¸ªç­‰çº§ç»“æ„ä¸­æ‰€æœ‰ç±»çš„ä¿®æ”¹ã€‚è¿™ç§è¿˜æ˜¯å‡è®¾è¿™äº›è¶…ç±»æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œå¦‚æœæŸäº›è¶…ç±»æ˜¯ç”±ä¸€äº›è½¯ä»¶å•†æä¾›çš„ï¼Œæˆ‘ä»¬æ— æ³•ä¿®æ”¹ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå› æ­¤ï¼Œå‡è®¾æ²¡æœ‰æ¥å£ï¼Œå¯æ’å…¥æ€§å°±æ²¡æœ‰äº†ä¿è¯ã€‚ ç±»å‹javaæ¥å£ï¼ˆä»¥åŠjavaæŠ½è±¡ç±»ï¼‰ç”¨æ¥å£°æ˜ä¸€ä¸ªæ–°çš„ç±»å‹ã€‚javaè®¾è®¡å¸ˆåº”å½“ä¸»è¦ä½¿ç”¨javaæ¥å£å’ŒæŠ½è±¡ç±»è€Œä¸æ˜¯å…·ä½“ç±»è¿›è¡Œå˜é‡çš„ç±»å‹å£°æ˜ã€å‚æ•°çš„ç±»å‹å£°æ˜ã€æ–¹æ³•çš„è¿”è¿˜ç±»å‹å£°æ˜ï¼Œä»¥åŠæ•°æ®ç±»å‹çš„è½¬æ¢ç­‰ã€‚å½“ç„¶ï¼Œä¸€ä¸ªæ›´å¥½çš„åšæ³•æ˜¯ä»…ä»…ä½¿ç”¨javaæ¥å£ï¼Œè€Œä¸è¦ä½¿ç”¨æŠ½è±¡javaç±»æ¥åšåˆ°ä¸Šé¢è¿™äº›ã€‚åœ¨ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå…·ä½“javaç±»åº”å½“åªå®ç°javaæ¥å£å’ŒæŠ½è±¡ç±»ä¸­å£°æ˜è¿‡çš„æ–¹æ³•ï¼Œè€Œä¸åº”è¯¥ç»™å‡ºå¤šä½™çš„æ–¹æ³•ã€‚ ç±»å‹ç­‰çº§ç»“æ„javaæ¥å£ï¼ˆä»¥åŠæŠ½è±¡ç±»ï¼‰ä¸€èˆ¬ç”¨æ¥ä½œä¸ºä¸€ä¸ªç±»å‹çš„ç­‰çº§ç»“æ„çš„èµ·ç‚¹javaçš„ç±»å‹æ˜¯ä»¥ç±»å‹ç­‰çº§ç»“æ„çš„æ–¹å¼ç»„ç»‡èµ·æ¥çš„ï¼Œåœ¨ä¸€ä¸ªç±»å‹ç­‰çº§ç»“æ„é‡Œé¢ï¼Œä¸€ä¸ªç±»å‹å¯ä»¥æœ‰ä¸€ç³»åˆ—çš„è¶…ç±»å‹ï¼Œè¿™æ—¶è¿™ä¸ªç±»å‹å«åšå…¶è¶…ç±»å‹çš„å­ç±»å‹ã€‚å­ç±»å‹çš„å…³ç³»æ˜¯ä¼ é€’æ€§ï¼šç±»å‹ç”²æ˜¯ç±»å‹ä¹™çš„å­ç±»å‹ï¼Œç±»å‹ä¹™æ˜¯ç±»å‹ä¸™çš„å­ç±»å‹ï¼Œé‚£ä¹ˆç±»å‹ç”²å°±æ˜¯ç±»å‹ä¸™çš„å­ç±»å‹ã€‚ æ··åˆç±»å‹å¦‚æœä¸€ä¸ªç±»å·²ç»æœ‰ä¸€ä¸ªä¸»è¦çš„è¶…ç±»å‹ï¼Œé‚£ä¹ˆé€šè¿‡å®ç°ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªç±»å¯ä»¥æ‹¥æœ‰å¦ä¸€ä¸ªæ¬¡è¦çš„è¶…ç±»å‹ã€‚è¿™ç§æ¬¡è¦çš„è¶…ç±»å‹å°±å«åšæ··åˆç±»å‹ã€‚ä¾‹å¦‚ï¼šåœ¨javaä¸­ï¼Œ TreeMapç±»æœ‰å¤šä¸ªç±»å‹ï¼Œå®ƒçš„ä¸»è¦ç±»å‹æ˜¯AbstractMap,è¿™æ˜¯ä¸€ç§javaçš„èšé›†ï¼›è€ŒCloneableæ¥å£åˆ™ç»™å‡ºäº†ä¸€ä¸ªæ¬¡è¦ç±»å‹ï¼Œè¿™ä¸ªç±»å‹è¯´æ˜å½“å‰ç±»çš„å¯¹è±¡æ˜¯å¯ä»¥è¢«å…‹éš†ï¼›åŒæ—¶Serializableä¹Ÿæ˜¯ä¸€ä¸ªæ¬¡è¦ç±»å‹ï¼Œå®ƒè¡¨æ˜å½“å‰ç±»çš„å¯¹è±¡æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ã€‚è€ŒNavigableMapç»§æ‰¿äº†SortedMap,å› ä¸ºä¹‹å‰è¯´åˆ°è¿‡ï¼Œå­ç±»å‹æ˜¯å¯ä»¥ä¼ é€’çš„ï¼Œå› æ­¤å¯¹äºTreeMapæ¥è¯´ï¼ŒSortedMapï¼ˆæˆ–è€…è¯´NavigableMapï¼‰è¡¨æ˜è¿™ä¸ªèšé›†ç±»æ˜¯å¯ä»¥æ’åºçš„ã€‚ æ¥å£çš„ä¸€äº›ç”¨æ³• å•æ¥å£æ–¹æ³•ï¼šæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼›javaè¯­è¨€ä¸­æœ‰å¾ˆå¤šä½†æ–¹æ³•æ¥å£çš„ä½¿ç”¨ï¼ŒRunnalbleæ¥å£ä¸­çš„runï¼ˆï¼‰æ–¹æ³•ã€‚ 1234567891011121314public interface Runnable &#123; /** * When an object implementing interface &lt;code&gt;Runnable&lt;/code&gt; is used * to create a thread, starting the thread causes the object&apos;s * &lt;code&gt;run&lt;/code&gt; method to be called in that separately executing * thread. * &lt;p&gt; * The general contract of the method &lt;code&gt;run&lt;/code&gt; is that it may * take any action whatsoever. * * @see java.lang.Thread#run() */ public abstract void run();&#125; æ ‡è¯†æ¥å£ï¼šæ²¡æœ‰ä»»ä½•æ–¹æ³•å’Œå±æ€§çš„æ¥å£ï¼›æ ‡è¯†æ¥å£ä¸å¯¹å®ç°å®ƒçš„ç±»æœ‰ä»»ä½•è¯­ä¹‰ä¸Šçš„è¦æ±‚ï¼Œä»…ä»…æ˜¯è¡¨æ˜å®ç°è¯¥æ¥å£çš„ç±»å±äºä¸€ä¸ªç‰¹å®šçš„ç±»å‹ã€‚ä¸Šé¢è¯´åˆ°çš„Serializableæ¥å£å°±æ˜¯ä¸€ç§æ ‡è¯†æ¥å£ã€‚ 12public interface Serializable &#123;&#125; å¸¸é‡æ¥å£ï¼šç”¨javaæ¥å£æ¥å£°æ˜ä¸€äº›å¸¸é‡ 12345package com.glmapper.demo.base;public interface MyConstants &#123; public static final String USER_NAME=&quot;admin&quot;;&#125;; è¿™æ ·ä¸€æ¥ï¼Œå‡¡æ˜¯å®ç°è¿™ä¸ªæ¥å£çš„ç±»éƒ½ä¼šè‡ªåŠ¨ç»§æ‰¿è¿™äº›å¸¸é‡ï¼Œå¹¶ä¸”éƒ½å¯ä»¥åƒä½¿ç”¨è‡ªå·±çš„å¸¸é‡ä¸€æ ·ï¼Œä¸éœ€è¦å†ç”¨MyConstants.USER_NAMEæ¥ä½¿ç”¨ã€‚ æŠ½è±¡ç±»åœ¨javaè¯­è¨€é‡Œé¢ï¼Œç±»æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å…·ä½“ç±»ï¼Œä¸€ç§æ˜¯æŠ½è±¡ç±»ã€‚åœ¨ä¸Šé¢ç»™å‡ºçš„ä»£ç ä¸­ï¼Œä½¿ç”¨absractä¿®é¥°çš„ç±»ä¸ºæŠ½è±¡ç±»ã€‚æ²¡æœ‰è¢«abstractä¿®é¥°çš„ç±»æ˜¯å…·ä½“ç±»ã€‚æŠ½è±¡ç±»é€šå¸¸ä»£è¡¨ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒæä¾›ä¸€ä¸ªç»§æ‰¿çš„å‡ºå‘ç‚¹ã€‚è€Œå…·ä½“ç±»åˆ™ä¸åŒï¼Œå…·ä½“ç±»å¯ä»¥è¢«å®ä¾‹åŒ–ï¼Œåº”å½“ç»™å‡ºä¸€ä¸ªæœ‰é€»è¾‘å®ç°çš„å¯¹è±¡æ¨¡æ¿ã€‚ç”±äºæŠ½è±¡ç±»ä¸å¯ä»¥è¢«å®ä¾‹åŒ–ï¼Œå› æ­¤ä¸€ä¸ªç¨‹åºå‘˜è®¾è®¡ä¸€ä¸ªæ–°çš„æŠ½è±¡ç±»ï¼Œä¸€å®šæ˜¯ç”¨æ¥è¢«ç»§æ‰¿çš„ã€‚ï¼ˆä¸å»ºè®®ä½¿ç”¨å…·ä½“ç±»æ¥è¿›è¡Œç›¸å…³çš„ç»§æ‰¿ï¼‰ã€‚ å…³äºä»£ç é‡æ„å‡è®¾æœ‰ä¸¤ä¸ªå…·ä½“ç±»ï¼Œç±»Aå’Œç±»Bï¼Œç±»Bæ˜¯ç±»Açš„å­ç±»ï¼Œé‚£ä¹ˆä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ–¹æ¡ˆåº”è¯¥æ˜¯å»ºç«‹ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆæˆ–è€…javaæ¥å£ï¼‰ï¼Œæš‚å®šä¸ºCï¼Œç„¶åè®©ç±»Aå’Œç±»Bæˆä¸ºæŠ½è±¡ç±»Cçš„å­ç±»ã€æ²¡æœ‰ä½¿ç”¨UMLçš„æ–¹å¼æ¥ç»˜åˆ¶ï¼Œè¯·è§è°…å“ˆã€‘ã€‚ ä¸Šé¢å…¶å®å°±æ˜¯é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œåé¢ä¼šå…·ä½“ä»‹ç»åˆ°çš„ã€‚è¿™ç§é‡æ„ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¦‚ä½•å¤„ç†ç±»Aå’Œç±»Bçš„å…±åŒä»£ç å’Œå…±åŒæ•°æ®ã€‚ä¸‹é¢ç»™å‡ºç›¸å…³å‡†åˆ™ã€‚ æŠ½è±¡ç±»åº”å½“æ‹¥æœ‰å°½å¯èƒ½å¤šçš„å…±åŒä»£ç  åœ¨ä¸€ä¸ªç»§æ‰¿ç­‰çº§ç»“æ„ä¸­ï¼Œå…±åŒçš„ä»£ç åº”å½“å°½é‡å‘ç»“æ„çš„é¡¶å±‚ç§»åŠ¨ï¼Œå°†é‡å¤çš„ä»£ç ä»å­ç±»ä¸­æŠ½ç¦»ï¼Œæ”¾åœ¨æŠ½è±¡çˆ¶ç±»ä¸­ï¼Œæé«˜ä»£ç çš„å¤ç”¨ç‡ã€‚è¿™æ ·åšçš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œåœ¨ä»£ç å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹ã€å› ä¸ºå…±åŒä»£ç å‡åœ¨çˆ¶ç±»ä¸­ã€‘ã€‚ æŠ½è±¡ç±»åº”å½“æ‹¥æœ‰å°½å¯èƒ½å°‘çš„æ•°æ®æ•°æ®çš„ç§»åŠ¨æ–¹å‘æ˜¯ä»æŠ½è±¡ç±»åˆ°å…·ä½“ç±»ï¼Œä¹Ÿå°±æ˜¯ä»ç»§æ‰¿ç­‰çº§çš„é¡¶å±‚åˆ°åº•å±‚çš„ç§»åŠ¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå¯¹è±¡çš„æ•°æ®ä¸è®ºæ˜¯å¦ä½¿ç”¨éƒ½ä¼šå ç”¨èµ„æºï¼Œå› æ­¤æ•°æ®åº”å½“å°½é‡æ”¾åˆ°å…·ä½“ç±»æˆ–è€…ç»§æ‰¿ç­‰çº§ç»“æ„çš„ä½ç«¯ã€‚ Has - A ä¸Is -Aå½“ä¸€ä¸ªç±»æ˜¯å¦å¤–ä¸€ä¸ªç±»çš„è§’è‰²æ—¶ã€æˆ‘ æœ‰ä¸€ä¸ª ç©å…·ã€‘ï¼Œè¿™ç§å…³ç³»å°±ä¸åº”å½“ä½¿ç”¨ç»§æ‰¿æ¥æè¿°äº†ï¼Œè¿™ä¸ªå°†ä¼šåœ¨åé¢è¯´åˆ°çš„â€œåˆæˆ/èšåˆå¤ç”¨åŸåˆ™â€æ¥æè¿°ã€‚Has - A: æˆ‘æœ‰ä¸€åªç¬”ï¼ˆèšåˆï¼‰Is - A:é’¢ç¬”æ˜¯ä¸€ç§ç¬”ï¼ˆç»§æ‰¿ï¼‰ å…³äºå­ç±»æ‰©å±•çˆ¶ç±»çš„è´£ä»»å­ç±»åº”å½“æ‰©å±•çˆ¶ç±»çš„èŒè´£ï¼Œè€Œä¸æ˜¯ç½®æ¢æ‰æˆ–è€…è¦†ç›–æ‰è¶…ç±»çš„èŒè´£ã€‚å¦‚æœä¸€ä¸ªå­ç±»éœ€è¦å°†ç»§æ‰¿è‡ªçˆ¶ç±»çš„è´£ä»»å–æ¶ˆæˆ–è€…ç½®æ¢åæ‰èƒ½ä½¿ç”¨çš„è¯ï¼Œå°±å¾ˆæœ‰å¯èƒ½è¯´æ˜è¿™ä¸ªå­ç±»æ ¹æœ¬ä¸å±äºå½“å‰çˆ¶ç±»çš„å­ç±»ï¼Œå­˜åœ¨è®¾è®¡ä¸Šçš„ç¼ºé™·ã€‚ æœ€åï¼Œè¯´æ˜ä¸‹ï¼Œæˆ‘ä»¬åœ¨å¹³æ—¶çš„å·¥ä½œä¸­ä¼šç»å¸¸ä½¿ç”¨çš„å·¥å…·ç±»ï¼Œå†æ¬¡ç‰¹åœ°ç”³æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå°½å¯èƒ½å°‘çš„å»ä»å·¥å…·ç±»è¿›è¡Œç»§æ‰¿æ‰©å±•ã€‚ å‚è€ƒï¼š ã€ŠJavaä¸æ¨¡å¼ã€‹ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆï¼Œä½œè€…ï¼šé˜å®ã€‚ http://www.runoob.com/java/java-interfaces.html]]></content>
      <categories>
        <category>java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¢å‘å¯¹è±¡çš„å››å¤§åŸºç¡€ç‰¹æ€§]]></title>
    <url>%2F2018%2F11%2F10%2Fglmapper-bird-one%2F</url>
    <content type="text"><![CDATA[æŒ‰ç…§ä¹‹å‰çš„å­¦ä¹ è§„åˆ’ï¼Œå¼€å§‹è¿›è¡Œç¬¬ä¸€éƒ¨åˆ†çš„å­¦ä¹ ã€‚é‚£ä¹ˆä»Šå¤©å°±é‡æ–°è®¤è¯†ä¸€ä¸‹JAVAä¸­çš„å››å¤§ç‰¹æ€§ï¼šæŠ½è±¡ã€å°è£…ã€ç»§æ‰¿ã€å¤šæ€ æŠ½è±¡å­¦ä¹ é¢å‘å¯¹è±¡ï¼ŒæŠ½è±¡è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚é¢å‘å¯¹è±¡æœ€æ¥è¿‘æˆ‘ä»¬äººç±»çš„æ€ç»´ï¼Œä½ çš„æŠ½è±¡èƒ½åŠ›å°±æ˜¯ä½ å¯¹ä¸‡ç‰©ä¸‡äº‹æ€»ç»“å’Œå½’çº³çš„èƒ½åŠ›ã€‚å…³äºæŠ½è±¡ï¼Œå°±æ˜¯ä»å…·ä½“äº‹ç‰©æŠ½å‡ºã€æ¦‚æ‹¬å‡ºå®ƒä»¬å…±åŒçš„æ–¹é¢ã€æœ¬è´¨å±æ€§ä¸å…³ç³»ç­‰ï¼Œè€Œå°†ä¸ªåˆ«çš„ã€éæœ¬è´¨çš„æ–¹é¢ã€å±æ€§ä¸å…³ç³»èˆå¼ƒï¼Œè¿™ç§æ€ç»´è¿‡ç¨‹ï¼Œç§°ä¸ºæŠ½è±¡ã€‚åœ¨JAVAä¸­è¡¨ç°å°±æ˜¯ä½¿ç”¨abstractæ¥ä¿®é¥°ç±»ï¼Œè¢«abstractä¿®é¥°çš„ç±»æˆä¸ºæŠ½è±¡ç±»ï¼Œä¸€èˆ¬æ˜¯ä¸ºäº†ä¸ºå­ç±»æä¾›ä¸€äº›å…±æœ‰çš„å±æ€§å’Œè¡Œä¸ºï¼Œä¸åŒçš„å­ç±»æ ¹æ®è‡ªèº«çš„ç‰¹æ€§å†è¿›è¡Œå…·ä½“çš„è¡Œä¸ºå®ç°ã€‚ å°è£…å°è£…æ˜¯é¢å‘å¯¹è±¡çš„é‡è¦åŸåˆ™ï¼Œå°±æ˜¯æŠŠå¯¹è±¡çš„å±æ€§å’Œè¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ç»“åˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ•´ä½“ï¼Œå¹¶å°½å¯èƒ½éšè—å¯¹è±¡çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼›åœ¨javaä¸­ï¼Œå¯¹äºå¯¹è±¡çš„å†…éƒ¨å±æ€§ä¸€èˆ¬ç”¨privateæ¥å®ç°éšè—ï¼Œå¹¶é€šè¿‡setå’Œgetæ–¹æ³•å¯¹å¤–æä¾›è®¿é—®æ¥å£ã€‚å°è£…å®é™…ä¸Šæ˜¯ä¸€ç§ä¿¡æ¯éšè—æŠ€æœ¯çš„å®ç°æ–¹å¼ã€‚ å¯¹è±¡çš„æ•°æ®å°è£…ç‰¹æ€§å½»åº•æ¶ˆé™¤äº†ä¼ ç»Ÿç»“æ„æ–¹æ³•ä¸­æ•°æ®ä¸æ“ä½œåˆ†ç¦»æ‰€å¸¦æ¥çš„ç§ç§é—®é¢˜ï¼Œæé«˜äº†ç¨‹åºçš„å¯å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œé™ä½äº†ç¨‹åºå‘˜ä¿æŒæ•°æ®ä¸æ“ä½œå†…å®¹çš„è´Ÿæ‹…ã€‚ å¯¹è±¡çš„æ•°æ®å°è£…ç‰¹æ€§è¿˜å¯ä»¥æŠŠå¯¹è±¡çš„ç§æœ‰æ•°æ®å’Œå…¬å…±æ•°æ®åˆ†ç¦»å¼€ï¼Œä¿æŠ¤äº†ç§æœ‰æ•°æ®ï¼Œå‡å°‘äº†å¯èƒ½çš„æ¨¡å—é—´å¹²æ‰°ï¼Œè¾¾åˆ°é™ä½ç¨‹åºå¤æ‚æ€§ã€æé«˜å¯æ§æ€§çš„ç›®çš„ã€‚ ä¾‹å¦‚ï¼šå¯¹äºå®¢è§‚å­˜åœ¨çš„äººè¿™ä¸ªå¯¹è±¡è¿›è¡Œå±æ€§å’Œè¡Œä¸ºæŠ½è±¡ã€æ­¤å¤„ä»…ä»…æ˜¯éƒ¨åˆ†æŠ½è±¡ã€‘ï¼›ä½¿ç”¨privateå…³é”®å­—æ¥ä¿®é¥°äººçš„å±æ€§ï¼Œå¹¶é€šè¿‡å¯¹åº”çš„setå’Œgetæ–¹æ³•å¯¹å¤–ç•Œæä¾›è®¿é—®å…¥å£ï¼›åœ¨è¡Œä¸ºæ–¹é¢ï¼Œé€šè¿‡publicå…³é”®å­—æ¥ä¿®é¥°ï¼Œå¯¹å¤–æä¾›å…·ä½“çš„è¡Œä¸ºæè¿°ã€‚å¤–ç•Œå¯¹è±¡å¹¶ä¸çŸ¥é“â€œäººâ€è¿™ä¸ªå¯¹è±¡åœ¨å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»…ä»…æ˜¯é€šè¿‡æä¾›çš„æ–¹æ³•æ¥è·å¾—å…·ä½“çš„æè¿°ä¿¡æ¯ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * äºº * @author glmapper * */public class Person &#123; //å§“å private String name; //å¹´é¾„ private int age; //æ€§åˆ« private String sex; //èº«é«˜ private float high; //ä½“é‡ private float weight; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public String getSex() &#123; return sex; &#125; public void setSex(String sex) &#123; this.sex = sex; &#125; public float getHigh() &#123; return high; &#125; public void setHigh(float high) &#123; this.high = high; &#125; public float getWeight() &#123; return weight; &#125; public void setWeight(float weight) &#123; this.weight = weight; &#125; public void eat()&#123; System.out.println(&quot;åƒä¸œè¥¿&quot;); &#125; public void walk()&#123; System.out.println(&quot;èµ°è·¯&quot;); &#125; public void study()&#123; System.out.println(&quot;å­¦ä¹ &quot;); &#125;&#125; ç»§æ‰¿ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡æœ€æ˜¾è‘—çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæ˜¯ä»å·²æœ‰çš„ç±»ä¸­æ´¾ç”Ÿå‡ºæ–°çš„ç±»ï¼Œæˆ‘ä»¬æŠŠå®ƒç§°ä¹‹ä¸ºå­ç±»ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸ºï¼Œå¹¶èƒ½æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ‰©å±•å‡ºæ–°çš„å±æ€§å’Œè¡Œä¸ºï¼Œæé«˜äº†ä»£ç çš„å¯å¤ç”¨æ€§ã€‚ æé«˜äº†ä»£ç çš„å¤ç”¨æ€§ã€‚ è®©ç±»ä¸ç±»ä¹‹é—´äº§ç”Ÿäº†å…³ç³»ï¼Œç»™ç¬¬ä¸‰ä¸ªç‰¹å¾å¤šæ€æä¾›äº†å‰æã€‚ Javaçš„ç»§æ‰¿é€šè¿‡extendså…³é”®å­—æ¥å®ç°ï¼Œå®ç°ç»§æ‰¿çš„ç±»è¢«ç§°ä¸ºå­ç±»ï¼Œè¢«ç»§æ‰¿çš„ç±»ç§°ä¸ºçˆ¶ç±»(æœ‰çš„ä¹Ÿç§°å…¶ä¸ºåŸºç±»ã€è¶…ç±»)ï¼Œçˆ¶ç±»å’Œå­ç±»çš„å…³ç³»ï¼Œæ˜¯ä¸€ç§ä¸€èˆ¬å’Œç‰¹æ®Šçš„å…³ç³»ï¼›å­ç±»æ‰©å±•çˆ¶ç±»ï¼Œå°†å¯ä»¥è·å¾—çˆ¶ç±»çš„å…¨éƒ¨å±æ€§å’Œæ–¹æ³•ã€‚ ç”·äººæ˜¯äººçš„ä¸€ç§ï¼Œç”·äººçš„ç‰¹å¾æ˜¯æœ‰èƒ¡å­ï¼Œå› æ­¤ä¹Ÿæœ‰å‰ªèƒ¡å­çš„è¡Œä¸ºã€æœ‰èƒ¡å­å’Œå‰ªèƒ¡å­å¹¶éä¾èµ–å…³ç³»ï¼›ä¸€ä¸ªæ˜¯å±æ€§ï¼Œä¸€ä¸ªæ˜¯è¡Œä¸ºã€‘ï¼›ä½†æ˜¯ç”·äººç»§æ‰¿äº†äººè¿™ä¸ªçˆ¶ç±»ï¼Œå› æ­¤ï¼Œç”·äººä¹Ÿå…·æœ‰ä¾‹å¦‚å§“åã€æ€§åˆ«ã€èº«é«˜ã€ä½“é‡ç­‰å±æ€§ï¼ŒåŒæ—¶ä¹Ÿå…·æœ‰çˆ¶ç±»äººå…·æœ‰çš„åƒé¥­ã€èµ°è·¯å’Œå­¦ä¹ çš„è¡Œä¸ºã€‚123456789101112131415161718192021/** * ç”·äºº * @author glmapper * */public class Man extends Person&#123; //èƒ¡å­ private String goatee; public String getGoatee() &#123; return goatee; &#125; public void setGoatee(String goatee) &#123; this.goatee = goatee; &#125; public void shaved()&#123; System.out.println(&quot;å‰ªèƒ¡å­&quot;); &#125;&#125; é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼šå¤§éƒ¨åˆ†çš„æ—¶å€™ï¼Œå­ç±»æ€»æ˜¯ä»¥çˆ¶ç±»ä¸ºåŸºç¡€ï¼Œé¢å¤–æ·»åŠ æ–°çš„å±æ€§å’Œæ–¹æ³•ã€‚ä½†æœ‰ä¸€ç§æƒ…å†µä¾‹å¤–ï¼šå­ç±»éœ€è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚ä¾‹å¦‚ç”·äººåƒä¸œè¥¿æ¯”è¾ƒå¿«ï¼Œå¥³äººåƒä¸œè¥¿æ¯”è¾ƒæ…¢ï¼Œå› æ­¤å¯¹äºeatæ–¹æ³•æ¥è¯´ï¼ŒManå¯ä»¥è¦†ç›–çˆ¶ç±»çš„eatæ–¹æ³•ï¼Œæ¥æè¿°Manæœ¬èº«çš„ç‰¹ç‚¹ã€‚ 1234@Overridepublic void eat()&#123; System.out.println(&quot;å¿«é€Ÿçš„åƒä¸œè¥¿&quot;);&#125; å½“å­çˆ¶ç±»ä¸­å‡ºç°ç›¸åŒæ–¹æ³•æ—¶ï¼Œä¼šå…ˆè¿è¡Œå­ç±»ä¸­çš„æ–¹æ³•ã€‚é‡å†™çš„ç‰¹ç‚¹ï¼šæ–¹æ³•åä¸€æ ·ï¼Œè®¿é—®ä¿®é¥°ç¬¦æƒé™ä¸å°äºçˆ¶ç±»ï¼Œè¿”å›ç±»å‹ä¸€è‡´ï¼Œå‚æ•°åˆ—è¡¨ä¸€è‡´ã€‚ å¤šæ€å®šä¹‰ï¼šæŒ‡å…è®¸ä¸åŒç±»çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯åšå‡ºå“åº”ã€‚å³åŒä¸€æ¶ˆæ¯å¯ä»¥æ ¹æ®å‘é€å¯¹è±¡çš„ä¸åŒè€Œé‡‡ç”¨å¤šç§ä¸åŒçš„è¡Œä¸ºæ–¹å¼ã€‚ï¼ˆå‘é€æ¶ˆæ¯å°±æ˜¯å‡½æ•°è°ƒç”¨ï¼‰å®ç°å¤šæ€çš„æŠ€æœ¯ç§°ä¸ºï¼šåŠ¨æ€ç»‘å®šï¼ˆdynamic bindingï¼‰ï¼Œæ˜¯æŒ‡åœ¨æ‰§è¡ŒæœŸé—´åˆ¤æ–­æ‰€å¼•ç”¨å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œæ ¹æ®å…¶å®é™…çš„ç±»å‹è°ƒç”¨å…¶ç›¸åº”çš„æ–¹æ³•ã€‚ä»è¯­è¨€ç‰¹ç‚¹ä¸Šæ¥è¯´ï¼ŒJavaå¼•ç”¨å˜é‡æœ‰ä¸¤ä¸ªç±»å‹ï¼šä¸€ä¸ªæ˜¯ç¼–è¯‘æ—¶ç±»å‹ï¼Œä¸€ä¸ªæ˜¯è¿è¡Œæ—¶ç±»å‹ã€‚ç¼–è¯‘æ—¶çš„ç±»å‹ç”±å£°æ˜è¯¥å˜é‡æ—¶ä½¿ç”¨çš„ç±»å‹å†³å®šï¼Œè¿è¡Œæ—¶çš„ç±»å‹ç”±å®é™…èµ‹ç»™è¯¥å˜é‡çš„å¯¹è±¡å†³å®šã€‚å¦‚æœç¼–è¯‘æ—¶ç±»å‹å’Œè¿è¡Œæ—¶ç±»å‹ä¸ä¸€è‡´ï¼Œå°±ä¼šå‡ºç°æ‰€è°“çš„å¤šæ€ï¼ˆPolymorphismï¼‰ã€‚å°è£…å’Œç»§æ‰¿éƒ½æ˜¯ä¸ºJavaè¯­è¨€çš„å¤šæ€æä¾›äº†æ”¯æ’‘ï¼›å¤šæ€å­˜åœ¨çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶ï¼š è¦æœ‰ç»§æ‰¿ï¼› è¦æœ‰é‡å†™ï¼› çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ã€‚ å…·ä½“çš„å®ç°æ–¹å¼å°±æ˜¯ï¼šæ¥å£å®ç°ï¼Œç»§æ‰¿çˆ¶ç±»è¿›è¡Œæ–¹æ³•é‡å†™ï¼ŒåŒä¸€ä¸ªç±»ä¸­è¿›è¡Œæ–¹æ³•é‡è½½ã€‚ ä¸‹ä¸€ç¯‡åœ¨è¯´ç±»å’Œæ¥å£çš„æ—¶å€™å†ç”¨å…·ä½“çš„ä¾‹å­æ¥æè¿°è¦†ç›–ã€é‡è½½ã€‚]]></content>
      <categories>
        <category>java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœé¸Ÿæˆé•¿ç³»åˆ—-æ¦‚è¿°]]></title>
    <url>%2F2018%2F11%2F10%2Fglmapper-bird-overall%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä½œä¸ºæ¸£ç¡•ä¸€æšï¼Œæ¯•ä¸šæ—¶ä¸€çº¿äº’è”ç½‘å…¬å¸æ‹›è˜åŸºæœ¬æ²¡æœ‰å‚ä¸è¿‡ï¼Œç­‰å›è¿‡ç¥å‡†å¤‡å‚åŠ ï¼Œæ˜¥æ‹›éƒ½å¿«ç»“æŸäº†ã€17å¹´æ¯•ä¸šã€‘ï¼›è·Œè·Œæ’æ’é¢äº†å‡ å®¶å…¬å¸ï¼Œè™½ç„¶è¢«è™ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½ç»™äº†Offerï¼Œå‡ ç•ªæ¯”è¾ƒä¹‹ååˆ°äº†è‹å®ï¼Œé€‰æ‹©åšä¸€æšé‡‘èç å†œã€‚è™½ç„¶ç½‘ä¸Šå…³äºåœ¨è‹å®åšITæœ‰ç€ä¸åŒçš„çœ‹æ³•ï¼Œæœ‰å¥½æœ‰åï¼Œè¤’è´¬ä¸ä¸€ï¼Œä½†å°±æˆ‘è€Œè¨€ï¼Œä½œä¸ºæ–°äººï¼Œè‹å®è¿˜æ˜¯ç»™æˆ‘æä¾›äº†ä¸é”™çš„å·¥ä½œå’Œå­¦ä¹ ç¯å¢ƒã€å…¥èŒå¿«4ä¸ªæœˆäº†ã€‘ã€‚è¨€å½’æ­£ä¼ ï¼Œä½œä¸ºä¸€ä¸ªåˆå…¥èŒåœºçš„æ–°äººï¼Œé¢å¯¹å¾ˆå¤šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸åŒçš„å¼€æºæŠ€æœ¯çš„ä½¿ç”¨ï¼Œä¸€å¼€å§‹ç¡®å®æœ‰ç‚¹â€œæ…Œâ€ï¼Œä½†æ˜¯éšç€æ…¢æ…¢çš„æ¸—å…¥ï¼Œä»èƒ½å¤Ÿå°†ä¸€ä¸ªé¡¹ç›®æˆåŠŸè·‘èµ·æ¥ï¼Œåˆ°å¯¹ç€è¯¦è®¾ç»™ä»£ç åŠ æ³¨é‡Šï¼Œåˆ°è‡ªå·±å»ç”»æŸä¸€æ¡ä¸šåŠ¡çº¿çš„æµç¨‹å›¾ï¼Œåˆ°ç¬¬ä¸€æ¬¡ç‹¬ç«‹å®Œæˆä¸€ä¸ªéœ€æ±‚ï¼Œå†åˆ°ä¸æ–­çš„å»å‘ç°ç°æœ‰æ¡†æ¶æˆ–è€…ä¸šåŠ¡é€»è¾‘ä¸­çš„é—®é¢˜å¹¶å»å°è¯•ä¼˜åŒ–ï¼›è¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆâ€œåƒé¸¡â€çš„ã€‚æŠ€æœ¯å§‹ç»ˆæ˜¯æ¥æ”¯æ’‘ä¸šåŠ¡çš„ï¼Œç†Ÿæ‚‰äº§å“å¾ˆé‡è¦ï¼Œåªæœ‰æ·±å…¥äº†è§£äº†æŸä¸€ä¸ªä¸šåŠ¡ï¼Œç„¶åæ‹“å±•å‡ºä¸å…¶ä»–ä¸šåŠ¡çš„å…³ç³»ï¼Œè¿™æ ·æ‰å¯ä»¥å‘ç°é—®é¢˜ï¼Œæ‰¾åˆ°åˆ‡å…¥ç‚¹å»åšå…·ä½“çš„ä»£ç ä¼˜åŒ–å’Œä¸šåŠ¡ä¼˜åŒ–ã€‚æ‰€ä»¥äººäººéƒ½æ˜¯äº§å“ç»ç†è¿™å¥è¯å¾ˆä¸­è‚¯ï¼Œç‰¹åˆ«æ˜¯ç¨‹åºå‘˜ï¼Œè¦å­¦ä¼šå’Œäº§å“ç»ç†â€œè®¨ä»·è¿˜ä»·â€ã€‚ ä¸ºä»€ä¹ˆè¦å†™ä¸ºä»€ä¹ˆè¦å†™ï¼Œæœ€å¼€å§‹çš„æƒ³æ³•å°±æ˜¯æŠŠè‡ªå·±å·¥ä½œä¸­çš„é—®é¢˜å’Œå‘è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿äºè‡ªå·±ä¸ä¼šå†è°ƒåˆ°å‘é‡Œé¢å»ã€‚ä½†æ˜¯åæ¥å‘ç°è·‘åäº†ï¼Œåœ¨æ²¡æœ‰å…·ä½“æ·±å…¥äº†è§£çš„æƒ…å†µä¸‹å¼€å§‹â€œå€Ÿé‰´â€+â€œæ€»ç»“â€ã€‚åæ¥å†å»çœ‹ï¼Œè¯¥ä¸ä¼šçš„è¿˜æ˜¯ä¸ä¼šï¼Œè¿™å°±å¾ˆæ— å¥ˆã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šä»€ä¹ˆâ€œJAVAå­¦ä¹ è·¯çº¿ä¸€è§ˆâ€ã€â€œæ•°æ®åº“å­¦ä¹ è·¯çº¿ä¸€è§ˆâ€ï¼Œâ€œSpringå­¦ä¹ è·¯çº¿ä¸€è§ˆâ€ã€‚ã€‚ã€‚ï¼Œå®è¯å®è¯´ï¼Œå°è¯•è¿‡ï¼Œä½†æ˜¯éƒ½å¤±è´¥äº†ï¼Œèµ°ä¸ä¸‹å»ã€‚æ¯”å¦‚è¯´æˆ‘æƒ³å­¦ä¹ javaé›†åˆï¼Œç„¶åå°±å»çœ‹ï¼Œå»æ€»ç»“ï¼Œç„¶åå°±ä¼šå‘ç°ï¼Œçº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨åœ¨é›†åˆé‡Œé¢çš„æ¯”è¾ƒå¾ˆå¤šï¼Œç„¶åå°±å»çœ‹çº¿ç¨‹å®‰å…¨ç›¸å…³ï¼Œç„¶åå†èµ°ï¼Œå°±ä¼šå‘ç°ä»è¿™ä¸ªå‘è·³åˆ°äº†å¦å¤–ä¸€ä¸ªå‘ï¼Œä¸€æ–¹é¢æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å»ç ”ç©¶ï¼Œå¦ä¸€æ–¹é¢æ²¡æœ‰æŠŠè‡ªå·±çš„æ€ç»´æ”¾è¿›å»ï¼Œç»“æœå°±æ˜¯å­¦åˆ°çš„è¿˜æ˜¯å¾ˆç¢çš„ä¸œè¥¿ã€‚å› æ­¤æ”¾å¼ƒåˆ«äººçš„æˆåŠŸä¹‹è·¯ï¼Œå›æ¥èµ°è‡ªå·±çš„ç‹¬æœ¨æ¡¥ã€‚ç»“åˆè‡ªå·±ä¹‹å‰çš„ä¸€äº›æŠ€æœ¯ç§¯ç´¯å’Œå®é™…å·¥ä½œçš„éœ€æ±‚ï¼Œæ¥æ•´åˆã€‚çœ‹äº†å¾ˆå¤šï¼Œå´å‘ç°æ·±å…¥çš„ä¸å¤šã€‚ä¸€å¼€å§‹æƒ³çš„æ˜¯ä»javaçš„Objectå¼€å§‹å†™ï¼Œä½†æ˜¯å½“æˆ‘å»å°è¯•ä¸€æ¬¡ä¹‹åå°±æ”¾å¼ƒäº†ã€å…¶å®ä»javaåŸºç¡€ç±»åº“å­¦è¿˜æ˜¯å¾ˆä¸é”™çš„ã€‘ï¼›æˆ‘è§‰å¾—ä¸é€‚åˆæˆ‘è¿™ç§ä¸æŒ‰å¥—è·¯å‡ºç‰Œçš„äººï¼Œå› æ­¤å°±ç»™è‡ªå·±å®šäº†ä¸€ä¸ªæ¡†ï¼Œåœ¨æ¡†é‡Œå­¦ã€‚è¿™ä¸ªæ¡†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯è®¾è®¡æ¨¡å¼ã€‚æ— è®ºæ˜¯javaåŸºç¡€ç±»åº“çš„è®¾è®¡è¿˜æ˜¯Springä½“ç³»çš„è®¾è®¡åŸºæœ¬éƒ½ç¦»ä¸å¼€è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼Œä¸ºä»€ä¹ˆè¯´ä¸ä»Objectå¼€å§‹ï¼Œä¸ä»Springçš„å¯åŠ¨å¼€å§‹å°±æ˜¯å› ä¸ºå½“æˆ‘é¡ºç€ä¸€æ¡çº¿å¼€å§‹èµ°çš„æ—¶å€™ï¼Œå°±ä¼šç‰µæ‰¯å‡ºæ— æ•°æ¡çº¿ï¼Œç›´åˆ°ä¸çŸ¥é“å»å¾€å“ªä¸€æ¡å¼€å§‹ã€‚åªæœ‰å½“å‰ç«™åœ¨é¡¶å±‚å»çœ‹æ•´ä½“çš„æ—¶å€™ï¼Œæ‰ä¼šå¯¹å…¨å±€æœ‰ä¸€ä¸ªæŠŠæ¡ï¼Œæ‰èƒ½ç›´åˆ°ä¸åŒåˆ†æ”¯çš„å…³ç³»ï¼Œæ‰èƒ½æ›´å¥½çš„å­¦æŠ“ç»†èŠ‚ã€‚ å†™ä»€ä¹ˆæˆ‘çš„æƒ³æ³•æ˜¯ä»¥è®¾è®¡æ¨¡å¼ä¸ºä¸»çº¿æ¥è´¯ç©¿ï¼Œå¼€å§‹é‡æ–°å­¦ä¹ ã€‚ã€ä»javaè¯­è¨€çš„è§’åº¦ã€‘è®¾è®¡æ¨¡å¼ä¸­åŸºæœ¬ä¸Šéƒ½æ˜¯å›´ç»•å…­ç§è®¾è®¡åŸåˆ™æ¥çº¦æŸçš„ï¼Œå†åˆ©ç”¨JAVAä¸­æä¾›æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€æä¾›çš„æœºåˆ¶æ¥è¿›è¡Œå…·ä½“çš„å®ç°ã€‚é¡ºç€è¿™ä¸ªæ€è·¯ç®€å•ç½—åˆ—ä¸‹æˆ‘è‡ªå·±çš„å­¦ä¹ è·¯çº¿ï¼šå› ä¸ºéœ€è¦ä½¿ç”¨JAVAï¼Œé‚£ä¹ˆå°±å¿…é¡»å…ˆè¦å¯¹æŠ½è±¡ã€ç»§æ‰¿å’Œå¤šæ€æœ‰ä¸€ä¸ªæ¯”è¾ƒæ¸…æ¥šçš„ç†è§£ï¼Œå› æ­¤ç¬¬ä¸€éƒ¨åˆ†å°†ä¼šä»javaè¯­è¨€æœ¬èº«çš„ç‰¹è‰²æ¥å­¦ä¹ ï¼Œä¸»è¦åŒ…æ‹¬ï¼š 1.æŠ½è±¡ï¼Œç»§æ‰¿ï¼Œå¤šæ€çš„ç†è§£ 2.ç±»å’Œæ¥å£ 3.é¢å‘æ¥å£ç¼–ç¨‹çš„ç†è§£OKï¼Œåˆ°æ­¤å°±æ”¶ï¼Œç¬¬ä¸€éƒ¨åˆ†å°±æŠŠåé¢è®¾è®¡æ¨¡å¼ä¸­æˆ‘ä»¬éœ€è¦ç”¨çš„æ–¹å¼çš„åŸºç¡€å®šäº†ä¸ªåŸºè°ƒã€‚ç¬¬äºŒéƒ¨åˆ†å°±ç›´æ¥è¿›å…¥è®¾è®¡æ¨¡å¼èŒƒç•´ä¹‹å†…ï¼š 1.è®¾è®¡åŸåˆ™ 2.åˆ›å»ºå‹ 3.ç»“æ„å‹ 4.è¡Œä¸ºå‹åœ¨å­¦ä¹ æŸä¸ªå…·ä½“çš„è®¾è®¡æ¨¡å¼çš„æ—¶å€™ä¼šç»“åˆjavaè¯­è¨€ä¸­æŸäº›ç±»åº“æ¥è®¨è®ºï¼Œç©¿æ’å­¦ä¹ ï¼›ç¬¬äºŒéƒ¨åˆ†ä¹‹åï¼Œå¯¹äºè®¾è®¡æ¨¡å¼ã€è®¾è®¡æ¨¡å¼åœ¨javaä¸­çš„åº”ç”¨ã€Springçš„é¡¶å±‚è®¾è®¡ä»¥åŠjavaä¸­çš„ä¸€äº›ç±»åº“ä¼šæœ‰ä¸€ä¸ªå¤§ä½“çš„æŒæ¡ã€‚è¿™ä¸ªéƒ¨åˆ†ä¼šéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œä¼šæ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ä¼šå¾ˆå¤šï¼Œæœ‰ç‚¹æ…Œã€‚ç¬¬ä¸‰éƒ¨åˆ†å¼€å§‹æ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆæ˜¯æ•°æ®ç»“æ„è€Œä¸æ˜¯å¹¶å‘æˆ–è€…æ•°æ®åº“å‘¢ã€‚ä¸€æ–¹é¢åœ¨javaä¸­å¾ˆå¤šå…³äºå¹¶å‘çš„é—®é¢˜éƒ½ä¼šæ¶‰åŠåˆ°é›†åˆçš„ä½¿ç”¨ï¼Œé›†åˆå†…éƒ¨å°±ä¾èµ–äºä¸åŒçš„æ•°æ®ç»“æ„ï¼›æ•°æ®åº“æ–¹é¢ï¼Œå¦‚æœéƒ½ä¸æ¸…æ¥šæ•°æ®åº“æ˜¯æ€ä¹ˆå­˜æ•°æ®çš„ï¼Œå°±ä¸å¯èƒ½çŸ¥é“æ€ä¹ˆå»ä¼˜åŒ–ï¼›å¦‚æœéƒ½ä¸çŸ¥é“æ•°æ®åº“ä¸­çš„æ•°æ®çš„å­˜å‚¨ç»“æ„æ˜¯ä»€ä¹ˆï¼Œåˆæ€ä¹ˆèƒ½çŸ¥é“æ•°æ®æ˜¯æ€ä¹ˆå­˜çš„å‘¢ï¼Ÿä¸Šé¢ä¸‰ä¸ªéƒ¨åˆ†ç»“æŸä¹‹åï¼Œå…³äºjavaå·®ä¸å¤šä¹Ÿå°±ç»“æŸäº†ã€‚é‚£ä¹ˆä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¯¹äºç½‘ç»œç†è§£å’Œå¼€æºæŠ€æœ¯çš„ä½¿ç”¨æ‰æ˜¯çœŸæ­£å¿«é€Ÿè§£å†³å®é™…é—®é¢˜å’Œåƒé¥­é—®é¢˜çš„æ ¹æœ¬ã€‚springã€mybatisã€redisï¼Œstruts2,hibernate,ä»¥åŠç›¸å…³rpcæ¡†æ¶ã€‚å…³äºjavaè™šæ‹Ÿæœºè¿™ä¸ªä¸œè¥¿ä¸ä¼šå•ç‹¬çš„å†™äº†ï¼Œæ„Ÿè§‰å†™ä¸å‡ºæ¥ï¼Œç­‰æœ‰äº†å®é™…çš„ç»éªŒç§¯ç´¯ä¹‹åå†å»è°ˆå§ã€‚ã€‚ã€‚ç»“æŸè¯­å…¶å®æˆ‘ä»¬æ¯ä¸ªäººæ¯å¤©éƒ½ä¼šæœ‰æƒ³æ³•ï¼Œå¥½åä¸è¯´ï¼Œè¦å»è¯•è¯•ï¼Œè¿™ç¯‡æ–‡ç« å†™å®Œä¹‹åæˆ‘ä¹Ÿä¸çŸ¥é“è‡ªå·±èƒ½èµ°åˆ°å“ªä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯è¿˜æ˜¯å›å»å°è¯•èµ°ä¸€èµ°ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ç§å­¦ä¹ çš„â€œé‡è·¯å­â€é€‚åˆä¸é€‚åˆï¼Œä½†æ˜¯å°±ç°åœ¨ã€2017.11.5 11:59ã€‘çœ‹ï¼Œæˆ‘è§‰å¾—å¯¹æˆ‘æ˜¯å¯ä»¥çš„ã€‚]]></content>
      <categories>
        <category>æ¶æ„ä¹‹è·¯</category>
      </categories>
      <tags>
        <tag>è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¡¹ç›®å¼€å‘æ¡†æ¶-SSM]]></title>
    <url>%2F2018%2F11%2F10%2Fproject-frame-ssm%2F</url>
    <content type="text"><![CDATA[1.Springæ— éœ€å¤šè¨€ï¼Œä½œä¸ºå¼€æºå±Šæ•°ä¸€æ•°äºŒçš„å…¸ä¾‹ï¼Œé¡¹ç›®å¼€å‘ä¸­æ— å¤„ä¸åœ¨ï¼›æ ¸å¿ƒIOCå®¹å™¨ï¼Œç”¨æ¥è£…è½½beanï¼ˆjavaä¸­çš„ç±»ï¼‰-ç”¨Springçš„IOCå®¹å™¨æ¥ç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸï¼Œæœ‰äº†è¿™æ ·ä¸€ç§æœºåˆ¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨åœ¨ä»£ç ä¸­å»é‡å¤çš„åšnewæ“ä½œã€‚aopï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œspringä¸­æœ€ä¸»è¦çš„æ˜¯ç”¨äºäº‹åŠ¡æ–¹é¢çš„ä½¿ç”¨ã€‚ 2.Spring MVCä½œç”¨äºwebå±‚ï¼Œç›¸å½“äºcontrollerï¼Œä¸strutsä¸­çš„actionä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚çš„ã€‚åŒæ—¶ï¼Œç›¸æ¯”äºstruts2æ¥è¯´ï¼Œæ›´åŠ ç»†ç²’åº¦ï¼Œå®ƒæ˜¯åŸºäºæ–¹æ³•å±‚é¢çš„ï¼Œè€Œstrutsæ˜¯åŸºäºç±»å±‚é¢çš„ã€‚ 3.MyBatisMyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°†æ¥å£å’Œ Java çš„ POJOs(Plain Old Java Objects,æ™®é€šçš„ Javaå¯¹è±¡)æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ã€‚[æ¥è‡ªï¼šhttp://www.mybatis.org/mybatis-3/zh/index.html] ä»–äººæ€»ç»“ HibernateåŠŸèƒ½å¼ºå¤§ï¼Œæ•°æ®åº“æ— å…³æ€§å¥½ï¼ŒO/Ræ˜ å°„èƒ½åŠ›å¼ºï¼Œå¦‚æœä½ å¯¹Hibernateç›¸å½“ç²¾é€šï¼Œè€Œä¸”å¯¹Hibernateè¿›è¡Œäº†é€‚å½“çš„å°è£…ï¼Œé‚£ä¹ˆä½ çš„é¡¹ç›®æ•´ä¸ªæŒä¹…å±‚ä»£ç ä¼šç›¸å½“ç®€å•ï¼Œéœ€è¦å†™çš„ä»£ç å¾ˆå°‘ï¼Œå¼€å‘é€Ÿåº¦å¾ˆå¿«ï¼Œéå¸¸çˆ½ã€‚ Hibernateçš„ç¼ºç‚¹å°±æ˜¯å­¦ä¹ é—¨æ§›ä¸ä½ï¼Œè¦ç²¾é€šé—¨æ§›æ›´é«˜ï¼Œè€Œä¸”æ€ä¹ˆè®¾è®¡O/Ræ˜ å°„ï¼Œåœ¨æ€§èƒ½å’Œå¯¹è±¡æ¨¡å‹ä¹‹é—´å¦‚ä½•æƒè¡¡å–å¾—å¹³è¡¡ï¼Œä»¥åŠæ€æ ·ç”¨å¥½Hibernateæ–¹é¢éœ€è¦ä½ çš„ç»éªŒå’Œèƒ½åŠ›éƒ½å¾ˆå¼ºæ‰è¡Œã€‚ MYBATISå…¥é—¨ç®€å•ï¼Œå³å­¦å³ç”¨ï¼Œæä¾›äº†æ•°æ®åº“æŸ¥è¯¢çš„è‡ªåŠ¨å¯¹è±¡ç»‘å®šåŠŸèƒ½ï¼Œè€Œä¸”å»¶ç»­äº†å¾ˆå¥½çš„SQLä½¿ç”¨ç»éªŒï¼Œå¯¹äºæ²¡æœ‰é‚£ä¹ˆé«˜çš„å¯¹è±¡æ¨¡å‹è¦æ±‚çš„é¡¹ç›®æ¥è¯´ï¼Œç›¸å½“å®Œç¾ã€‚ MYBATISçš„ç¼ºç‚¹å°±æ˜¯æ¡†æ¶è¿˜æ˜¯æ¯”è¾ƒç®€é™‹ï¼ŒåŠŸèƒ½å°šæœ‰ç¼ºå¤±ï¼Œè™½ç„¶ç®€åŒ–äº†æ•°æ®ç»‘å®šä»£ç ï¼Œä½†æ˜¯æ•´ä¸ªåº•å±‚æ•°æ®åº“æŸ¥è¯¢å®é™…è¿˜æ˜¯è¦è‡ªå·±å†™çš„ï¼Œå·¥ä½œé‡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œè€Œä¸”ä¸å¤ªå®¹æ˜“é€‚åº”å¿«é€Ÿæ•°æ®åº“ä¿®æ”¹ã€‚4.SSMæ¡†æ¶æ•´åˆæœ¬é¡¹ç›®å°†ä»¥è´­ç‰©ä¸ºèƒŒæ™¯ï¼Œä¸»è¦åŒ…æ‹¬å•†å“ä¿¡æ¯åŠåº“å­˜ã€å› ä¸ºæƒ³é¡ºä¾¿å­¦ä¹ ä¸€ä¸‹äº‹åŠ¡çš„å¤„ç†ã€‘ã€è®¢å•ä¿¡æ¯ã€‚ä¸‹é¢å°†ä»æ•°æ®åº“åˆ›å»ºã€é¡¹ç›®ç»“æ„è¯´æ˜ã€é…ç½®æ–‡ä»¶ã€ä¸šåŠ¡ä»£ç ç­‰æ–¹é¢è¿›è¡Œä¸€æ­¥æ­¥è¯´æ˜ã€‚4.1 æ•°æ®åº“åˆ›å»º1.å•†å“è¡¨123456CREATE TABLE `goods` ( `goods_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;å•†å“ID&apos;, `goodsname` varchar(100) NOT NULL COMMENT &apos;å•†å“åç§°&apos;, `number` int(11) NOT NULL COMMENT &apos;å•†å“åº“å­˜&apos;, PRIMARY KEY (`goods_id`)) ENGINE=InnoDB AUTO_INCREMENT=1000 DEFAULT CHARSET=utf8 COMMENT=&apos;å•†å“è¡¨&apos; åˆå§‹åŒ–è¡¨æ•°æ®12INSERT INTO `goods` (`goods_id`, `goodsname`, `number`)VALUES (1001, &apos;SNå«è¡£&apos;, 15) 2.è®¢å•è¡¨12345678CREATE TABLE `orderinfo` ( `order_id` varchar(20) NOT NULL COMMENT &apos;è®¢å•ç¼–å·&apos;, `goods_id` bigint(18) NOT NULL COMMENT &apos;å•†å“ID&apos;, `user_id` bigint(10) NOT NULL COMMENT &apos;ç”¨æˆ·ID&apos;, `order_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &apos;ä¸‹å•æ—¶é—´&apos; , PRIMARY KEY (`order_id`), INDEX `idx_order_id` (`order_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;è®¢å•è¡¨&apos; OKï¼Œè‡³æ­¤è¡¨ç»“æ„åŠåˆå§‹åŒ–æ•°æ®æ„å»ºå®Œæˆï¼Œä¸‹é¢è¯´ä¸‹åŸºäºMavançš„é¡¹ç›®ç»“æ„ã€‚ é¡¹ç›®ç»“æ„è¯´æ˜å› ä¸ºé¡¹ç›®æ˜¯ä½¿ç”¨mavenæ¥ç®¡ç†jaråŒ…çš„ï¼Œå…ˆæ¥è´´ä¸€ä¸‹ï¼Œpom.xmlçš„é…ç½® pom.xmlä¸ºäº†é¿å…å­¦ä¹ å°ä¼™ä¼´å´‡å°šæ‹¿æ¥ä¸»ä¹‰ã€ä¹Ÿå°±æ˜¯å»é™¤äº†xmlnsä¹‹ç±»çš„ä¸œè¥¿ã€‘ï¼Œè¿™é‡Œåªæ”¾é¡¹ç›®ä¾èµ–çš„jaråŒ…çš„dependenciesï¼›æœ¬æ¡ˆä¾‹å°†æœ¬ç€â€œéœ€åˆ™ç”¨â€çš„åŸåˆ™ï¼Œé¿å…åœ¨ç½‘ä¸Šçœ‹åˆ°çš„å„ç§ä¹±ä¸ƒå…«ç³Ÿçš„ä¾èµ–éƒ½ä¸¢è¿›æ¥çš„æƒ…å†µï¼Œé€ æˆèµ„æºæµªè´¹å’Œå¹²æ‰°é˜…è¯»ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134&lt;dependencies&gt; &lt;!-- å•å…ƒæµ‹è¯• --&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.11&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 1.æ—¥å¿— slf4j--&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 2.æ•°æ®åº“è¿æ¥é©±åŠ¨ --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.37&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- 2.æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;dependency&gt; &lt;groupId&gt;c3p0&lt;/groupId&gt; &lt;artifactId&gt;c3p0&lt;/artifactId&gt; &lt;version&gt;0.9.1.2&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 3.MyBatis ä»¥åŠ spring-mybatis --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt; &lt;version&gt;1.2.3&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 4.Servlet ç›¸å…³ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;taglibs&lt;/groupId&gt; &lt;artifactId&gt;standard&lt;/artifactId&gt; &lt;version&gt;1.1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;jstl&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.5.4&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 5.Spring --&gt; &lt;!-- 5.1 Springæ ¸å¿ƒ ï¼šcore bean context --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-beans&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 5.2 Spring jdbcä¾èµ–ï¼Œäº‹åŠ¡ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-tx&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 5.3 Spring webä¾èµ–&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-web&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 5.4 Spring test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;4.1.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 6.rediså®¢æˆ·ç«¯:Jedisã€ä¸ä½¿ç”¨çš„è¯å¯ä»¥ç›´æ¥å»é™¤ã€‘ --&gt; &lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.7.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.dyuproject.protostuff&lt;/groupId&gt; &lt;artifactId&gt;protostuff-core&lt;/artifactId&gt; &lt;version&gt;1.0.8&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.dyuproject.protostuff&lt;/groupId&gt; &lt;artifactId&gt;protostuff-runtime&lt;/artifactId&gt; &lt;version&gt;1.0.8&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 7.å·¥å…·ç±» --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.2&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; *é¡¹ç›®ç»“æ„å›¾ src/test/javaï¼šç”¨äºjunitçš„æµ‹è¯•ç±» src/main/java: dao:æ•°æ®åº“å¤„ç† service:ä¸šåŠ¡å¤„ç† enums:é¡¹ç›®æšä¸¾ mapper:daoä¸­æ–¹æ³•å¯¹åº”mybatisæ˜ å°„æ–‡ä»¶ï¼ŒSqlå°±åœ¨è¿™é‡Œé¢ webï¼šæ§åˆ¶å™¨ï¼Œcontroller entity:é¡¹ç›®ä¸­çš„å®ä½“ç±»ï¼Œå¦‚ï¼šå•†å“ç±»å’Œè®¢å•ç±» é…ç½®æ–‡ä»¶ jdbc.properties1234jdbc.driver=com.mysql.jdbc.Driverjdbc.url=jdbc:mysql://serverName:port/dbname?useUnicode=true&amp;characterEncoding=utf8jdbc.username=[å¡«å†™è‡ªå·±çš„æ•°æ®åº“ç”¨æˆ·å]jdbc.password=[å¡«å†™è‡ªå·±çš„æ•°æ®åº“ç™»å½•å¯†ç ] logback.xmlè¿™é‡Œç›´æ¥ç”¨çš„æ˜¯æ§åˆ¶å°è¾“å‡ºï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚è¿›è¡Œé…ç½®ã€‚ 123456789101112&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration debug=&quot;true&quot;&gt; &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; ch.qos.logback.classic.encoder.PatternLayoutEncoder --&gt; &lt;encoder&gt; &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;root level=&quot;debug&quot;&gt; &lt;appender-ref ref=&quot;STDOUT&quot; /&gt; &lt;/root&gt;&lt;/configuration&gt; mybatis-configè¿™é‡Œä¸»è¦æ˜¯MyBatieså…¨å±€é…ç½®æ–‡ä»¶çš„é…ç½®ï¼Œå¯ä»¥å°†ä¸€äº›ç±»çš„åˆ«åã€ä¸»é”®è‡ªå¢é…ç½®ã€é©¼å³°å‘½åè§„åˆ™é…ç½®ç­‰ã€‚ 12345678910111213&lt;configuration&gt; &lt;!-- é…ç½®å…¨å±€å±æ€§ --&gt; &lt;settings&gt; &lt;!-- ä½¿ç”¨jdbcçš„getGeneratedKeysè·å–æ•°æ®åº“è‡ªå¢ä¸»é”®å€¼ --&gt; &lt;setting name=&quot;useGeneratedKeys&quot; value=&quot;true&quot; /&gt; &lt;!-- ä½¿ç”¨åˆ—åˆ«åæ›¿æ¢åˆ—å é»˜è®¤:true --&gt; &lt;setting name=&quot;useColumnLabel&quot; value=&quot;true&quot; /&gt; &lt;!-- å¼€å¯é©¼å³°å‘½åè½¬æ¢:Table&#123;create_time&#125; -&gt; Entity&#123;createTime&#125; --&gt; &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot; /&gt; &lt;/settings&gt;&lt;/configuration&gt; spring ç›¸å…³é…ç½®æ–‡ä»¶ä¸ºäº†æ›´åŠ æ¸…æ™°çš„äº†è§£springå„ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œè¿™é‡Œå°†æ•°æ®æºçš„é…ç½®ã€äº‹åŠ¡é…ç½®å’Œè§†å›¾è§£æå™¨çš„é…ç½®åˆ†å¼€æ¥ã€‚spring-dao.xmlè¿™é‡Œé¢ä¸»è¦å°±æ˜¯springé…ç½®æ•´åˆmybatisçš„å…·ä½“è¿‡ç¨‹ï¼Œå…·ä½“åŒ…æ‹¬ï¼š1.å¼•å…¥æ•°æ®åº“é…ç½®æ–‡ä»¶2.é…ç½®æ•°æ®æºã€æ•°æ®åº“è¿æ¥æ± ã€‘3.é…ç½®SqlSessionFactoryå¯¹è±¡4.é…ç½®æ‰«æDaoæ¥å£åŒ…ï¼ŒåŠ¨æ€å®ç°Daoæ¥å£ï¼Œæ³¨å…¥åˆ°springå®¹å™¨ä¸­ 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;!-- 1.é…ç½®æ•°æ®åº“ç›¸å…³å‚æ•°propertiesçš„å±æ€§ï¼š$&#123;url&#125; --&gt;&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot; /&gt;&lt;!-- 2.æ•°æ®åº“è¿æ¥æ±  --&gt;&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt; &lt;!-- é…ç½®è¿æ¥æ± å±æ€§ --&gt; &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driver&#125;&quot; /&gt; &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt; &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt; &lt;!-- c3p0è¿æ¥æ± çš„ç§æœ‰å±æ€§ --&gt; &lt;property name=&quot;maxPoolSize&quot; value=&quot;30&quot; /&gt; &lt;property name=&quot;minPoolSize&quot; value=&quot;10&quot; /&gt; &lt;!-- å…³é—­è¿æ¥åä¸è‡ªåŠ¨commit --&gt; &lt;property name=&quot;autoCommitOnClose&quot; value=&quot;false&quot; /&gt; &lt;!-- è·å–è¿æ¥è¶…æ—¶æ—¶é—´ --&gt; &lt;property name=&quot;checkoutTimeout&quot; value=&quot;10000&quot; /&gt; &lt;!-- å½“è·å–è¿æ¥å¤±è´¥é‡è¯•æ¬¡æ•° --&gt; &lt;property name=&quot;acquireRetryAttempts&quot; value=&quot;2&quot; /&gt;&lt;/bean&gt;&lt;!-- 3.é…ç½®SqlSessionFactoryå¯¹è±¡ --&gt;&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt; &lt;!-- æ³¨å…¥æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt; &lt;!-- é…ç½®MyBatieså…¨å±€é…ç½®æ–‡ä»¶:mybatis-config.xml --&gt; &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot; /&gt; &lt;!-- æ‰«æentityåŒ… ä½¿ç”¨åˆ«å --&gt; &lt;property name=&quot;typeAliasesPackage&quot; value=&quot;com.glmapper.framerwork.entity&quot; /&gt; &lt;!-- æ‰«æsqlé…ç½®æ–‡ä»¶:mapperéœ€è¦çš„xmlæ–‡ä»¶ --&gt; &lt;property name=&quot;mapperLocations&quot; value=&quot;com.glmapper.framerwork.mapper/*.xml&quot; /&gt;&lt;/bean&gt;&lt;!-- 4.é…ç½®æ‰«æDaoæ¥å£åŒ…ï¼ŒåŠ¨æ€å®ç°Daoæ¥å£ï¼Œæ³¨å…¥åˆ°springå®¹å™¨ä¸­ --&gt;&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt; &lt;!-- æ³¨å…¥sqlSessionFactory --&gt; &lt;property name=&quot;sqlSessionFactoryBeanName&quot; value=&quot;sqlSessionFactory&quot; /&gt; &lt;!-- ç»™å‡ºéœ€è¦æ‰«æDaoæ¥å£åŒ… --&gt; &lt;property name=&quot;basePackage&quot; value=&quot;com.glmapper.framerwork.dao&quot; /&gt;&lt;/bean&gt; spring-serviceå®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­äº‹åŠ¡ä¸€èˆ¬éƒ½æ˜¯åœ¨serviceå±‚è¿›è¡Œæ“ä½œã€‚å› æ­¤ç”¨ä¸€ä¸ªå•ç‹¬çš„spring-service.xmlæ¥è¿›è¡Œäº‹åŠ¡çš„ç›¸å…³çš„é…ç½® 12345678910 &lt;!-- æ‰«æserviceåŒ…ä¸‹æ‰€æœ‰ä½¿ç”¨æ³¨è§£çš„ç±»å‹ --&gt;&lt;context:component-scan base-package=&quot;com.glmapper.framerwork.service&quot; /&gt;&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt;&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt; &lt;!-- æ³¨å…¥æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;&lt;/bean&gt;&lt;!-- é…ç½®åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡ --&gt;&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; /&gt; spring-web.xmlé…ç½®SpringMVCï¼›éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šé…ç½®json2mapè§£æã€‚è¿™é‡Œæ²¡æœ‰ç”¨åˆ°å°±ä¸è´´å‡ºæ¥ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œç½‘ä¸Šæœç´¢ä¸€æ³¢ã€‚ 1234567891011121314151617&lt;!-- 1.å¼€å¯SpringMVCæ³¨è§£æ¨¡å¼ --&gt;&lt;mvc:annotation-driven /&gt;&lt;!-- 2.é™æ€èµ„æºé»˜è®¤servleté…ç½® (1)åŠ å…¥å¯¹é™æ€èµ„æºçš„å¤„ç†ï¼šjs,css,å›¾ç‰‡ç­‰ (2)å…è®¸ä½¿ç”¨&quot;/&quot;åšæ•´ä½“æ˜ å°„ --&gt; &lt;mvc:default-servlet-handler/&gt; &lt;!-- 3.é…ç½®è§†å›¾è§£æå™¨ViewResolver --&gt; &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt; &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot; /&gt; &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot; /&gt; &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt; &lt;/bean&gt; &lt;!-- 4.æ‰«æwebç›¸å…³çš„bean --&gt; &lt;context:component-scan base-package=&quot;com.glmapper.framerwork.web&quot; /&gt; web.xml 12345678910111213141516171819202122232425262728293031323334353637383940&lt;!-- ç¼–ç è¿‡æ»¤å™¨ --&gt; &lt;filter&gt; &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;async-supported&gt;true&lt;/async-supported&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;UTF-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;!-- Springç›‘å¬å™¨ --&gt; &lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;!-- é˜²æ­¢Springå†…å­˜æº¢å‡ºç›‘å¬å™¨ --&gt; &lt;listener&gt; &lt;listener-class&gt;org.springframework.web.util.IntrospectorCleanupListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;!-- é…ç½®DispatcherServlet --&gt; &lt;servlet&gt; &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!-- é…ç½®springMVCéœ€è¦åŠ è½½çš„é…ç½®æ–‡ä»¶ spring-dao.xml,spring-service.xml,spring-web.xml Mybatis - &gt; spring -&gt; springmvc --&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring/spring-*.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt; &lt;!-- é»˜è®¤åŒ¹é…æ‰€æœ‰çš„è¯·æ±‚ --&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; è‡³æ­¤ï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶ç»“æŸï¼Œä¸‹é¢å°†è¿›è¡Œå…·ä½“çš„ä»£ç ç¯èŠ‚ ä¸šåŠ¡ä»£ç è¿™é‡Œmapperä¸­çš„xmlæ–‡ä»¶å°±ä¸è´´äº†ï¼Œè‡ªè¡Œè„‘è¡¥ã€‚ã€‚ã€‚ã€‚ å®ä½“ç±»ï¼šåŒ…æ‹¬å•†å“å’Œè®¢å• å•†å“ç±»1234567891011121314151617181920212223242526272829/** * å•†å“ä¿¡æ¯ç±» * @author glmapper * */public class Goods &#123; private long goodsId;// å•†å“ID private String goodsName;// å•†å“åç§° private int number;// å•†å“åº“å­˜ public long getGoodsId() &#123; return goodsId; &#125; public void setGoodsId(long goodsId) &#123; this.goodsId = goodsId; &#125; public String getGoodsName() &#123; return goodsName; &#125; public void setGoodsName(String goodsName) &#123; this.goodsName = goodsName; &#125; public int getNumber() &#123; return number; &#125; public void setNumber(int number) &#123; this.number = number; &#125;&#125; è®¢å•ç±» 1234567891011121314151617181920212223242526272829303132333435/** * è®¢å•ä¿¡æ¯ç±» * @author glmapper * */public class OrderInfo &#123; private String orderId;//è®¢å•ID private long goodsId;//å•†å“ID private long userId;//ç”¨æˆ·ID private Date orderTime;//ä¸‹å•æ—¶é—´ public String getOrderId() &#123; return orderId; &#125; public void setOrderId(String orderId) &#123; this.orderId = orderId; &#125; public long getGoodsId() &#123; return goodsId; &#125; public void setGoodsId(long goodsId) &#123; this.goodsId = goodsId; &#125; public long getUserId() &#123; return userId; &#125; public void setUserId(long userId) &#123; this.userId = userId; &#125; public Date getOrderTime() &#123; return orderTime; &#125; public void setOrderTime(Date orderTime) &#123; this.orderTime = orderTime; &#125;&#125; å•†å“dao 12345678910111213141516171819202122232425262728public interface GoodsDao &#123; /** * é€šè¿‡IDæŸ¥è¯¢å•ä»¶å•†å“ä¿¡æ¯ * * @param id * @return */ Goods queryById(long id); /** * æŸ¥è¯¢æ‰€æœ‰å•†å“ä¿¡æ¯ * * @param offset æŸ¥è¯¢èµ·å§‹ä½ç½® * @param limit æŸ¥è¯¢æ¡æ•° * @return */ List&lt;Goods&gt; queryAll(@Param(&quot;offset&quot;) int offset, @Param(&quot;limit&quot;) int limit); /** * å‡å°‘å•†å“åº“å­˜ * * @param bookId * @return å¦‚æœå½±å“è¡Œæ•°ç­‰äº&gt;1ï¼Œè¡¨ç¤ºæ›´æ–°çš„è®°å½•è¡Œæ•° */ int reduceNumber(long goodsId);&#125; è®¢å•dao 1234567891011121314151617public interface OrderInfoDao &#123; /** * æ’å…¥è®¢å•è®°å½• * * @param OrderInfo orderInfo * @return æ’å…¥çš„è¡Œæ•° */ int insertOrderInfo(OrderInfo orderInfo); /** * é€šè¿‡ä¸»é”®æŸ¥è¯¢è®¢å•è®°å½•ï¼Œè¿”å›è®¢å•å®ä½“ * @param orderId * @return */ OrderInfo queryByOrderId(String orderId);&#125; ä¸‹å•æœåŠ¡æ¥å£orderService 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566@Service(&quot;orderService&quot;)public class OrderServiceImpl implements OrderService &#123; //logç”Ÿæˆå™¨ private Logger logger = LoggerFactory.getLogger(OrderServiceImpl.class); // æ³¨å…¥daoä¾èµ–ã€å•†å“daoï¼Œè®¢å•daoã€‘ @Autowired private GoodsDao goodsDao; @Autowired private OrderInfoDao orderInfoDao; @Override public Goods getById(long goodsId) &#123; // TODO Auto-generated method stub return goodsDao.queryById(goodsId); &#125; @Override public List&lt;Goods&gt; getList(int offset,int limit) &#123; // TODO Auto-generated method stub return goodsDao.queryAll(offset, limit); &#125; @Override @Transactional public OrderInfo buyGoods(long goodsId, long userId) &#123; //æ‰£å‡åº“å­˜ï¼Œæ’å…¥è®¢å• =ä¸€ä¸ªäº‹åŠ¡ å¦‚æœå¤±è´¥åˆ™æ‰§è¡Œå›æ»š try &#123; // å‡åº“å­˜ int update = goodsDao.reduceNumber(goodsId); if (update &lt;= 0) &#123;// åº“å­˜ä¸è¶³ throw new NoNumberException(&quot;no number&quot;); &#125; else &#123; // æ‰§è¡Œé¢„çº¦æ“ä½œ OrderInfo orderInfo=new OrderInfo(); orderInfo.setGoodsId(goodsId); orderInfo.setUserId(userId); orderInfo.setOrderTime(new Date()); String orderId=getRandomOrderId(goodsId); orderInfo.setOrderId(orderId); int insert = orderInfoDao.insertOrderInfo(orderInfo); if (insert &lt;= 0) &#123;// é‡å¤é¢„çº¦ throw new RepeatAppointException(&quot;repeat appoint&quot;); &#125; else &#123;// é¢„çº¦æˆåŠŸ return orderInfo; &#125; &#125; &#125; catch (Exception e) &#123; //è¿™é‡Œå¯ä»¥ä¸°å¯Œä¸‹å…·ä½“çš„è¿”å›ä¿¡æ¯ logger.error(&quot;ä¸‹å•å¤±è´¥&quot;); &#125; return null; &#125; private String getRandomOrderId(long goodsId) &#123; SimpleDateFormat dateFormater = new SimpleDateFormat(&quot;yyyyMMddhhmmss&quot;); String prefix=dateFormater.format(new Date()); String goodsIdStr=goodsId+&quot;&quot;; String temp=&quot;&quot;; for (int i = 0; i &lt; 6; i++) &#123; Random random=new Random(goodsIdStr.length()-1); temp+=goodsIdStr.charAt(random.nextInt()); &#125; return prefix+temp; &#125;&#125; OKï¼Œè‡³æ­¤æ‰€æœ‰æ ¸å¿ƒä»£ç åŠé…ç½®æ–‡ä»¶ç½—åˆ—å®Œæ¯•ï¼›ã€mapperä¸­çš„xmlå’Œå…·ä½“çš„controllerå°±ä¸è´´äº†ï¼Œç›¸ä¿¡å¤§å®¶å¯¹è¿™ä¸ªä¹Ÿä¸é™Œç”Ÿã€‚æœ¬æ–‡ä¸»è¦æ„å›¾åœ¨äºæ¢³ç†ä¸‹è‡ªå·±å­¦ä¹ ä¸­çš„ä¸€äº›ç‚¹ï¼ŒSSMæ¡†æ¶åœ¨å®é™…çš„åº”ç”¨å¼€å‘ä¸­è¿˜ä¼šæœ‰å¾ˆå¤šå…¶ä»–çš„å¼€æºæŠ€æœ¯ç»“åˆè¿›æ¥ï¼Œå¦‚ï¼šquartz,redisç­‰ã€‚å½“å‰æœ¬æ–‡çš„åˆ—å­å°±æ˜¯ä¸€ä¸ªç©ºå£³å­ï¼Œä»¥å¤‡å‚è€ƒå§ã€‘]]></content>
      <categories>
        <category>æ¶æ„</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
        <tag>ssm</tag>
        <tag>spring</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAåŸºç¡€çŸ¥è¯†ç³»åˆ—---è¿›ç¨‹ã€çº¿ç¨‹å®‰å…¨]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-thread-base%2F</url>
    <content type="text"><![CDATA[1.1 ä¸´ç•ŒåŒºä¿è¯åœ¨æŸä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®æ•°æ®çš„ç®€ä¾¿æ–¹æ³•ï¼Œåœ¨ä»»æ„æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å¯¹èµ„æºè¿›è¡Œè®¿é—®ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¯•å›¾åŒæ—¶è®¿é—®ä¸´ç•ŒåŒºï¼Œé‚£ä¹ˆåœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åï¼Œå…¶ä»–æ‰€æœ‰è¯•å›¾è®¿é—®ä¸´ç•ŒåŒºçš„çº¿ç¨‹å°†è¢«æŒ‚èµ·ï¼Œå¹¶ä¸€ç›´æŒç»­åˆ°è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹ç¦»å¼€ã€‚ä¸´ç•ŒåŒºåœ¨è¢«é‡Šæ”¾åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­æŠ¢å ï¼Œå¹¶ä»¥æ­¤è¾¾åˆ°ç”¨åŸå­æ–¹å¼æ“ä½œå…±äº«èµ„æºçš„ç›®çš„ 1.2 äº’æ–¥é‡äº’æ–¥é‡å’Œä¸´ç•ŒåŒºå¾ˆç›¸ä¼¼ï¼Œåªèƒ½æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰èƒ½å…·æœ‰è®¿é—®èµ„æºçš„æƒé™ï¼Œç”±äºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œå› æ­¤å°±å†³å®šäº†ä»»ä½•æƒ…å†µä¸‹æ¬¡å…±äº«èµ„æºéƒ½ä¸ä¼šåŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æ‰€è®¿é—®ã€‚å½“å‰å æ®èµ„æºçš„çº¿ç¨‹åœ¨ä»»åŠ¡å¤„ç†å®Œååº”å°†æ‹¥æœ‰çš„äº’æ–¥å¯¹è±¡äº¤å‡ºï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹åœ¨è·å¾—åå¯ä»¥è®¿é—®èµ„æºã€‚äº’æ–¥é‡æ¯”ä¸´ç•ŒåŒºå¤æ‚ï¼Œå› ä¸ºä½¿ç”¨äº’æ–¥ä¸ä»…ä»…èƒ½å¤Ÿåœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸åŒçº¿ç¨‹ä¸­å®ç°èµ„æºçš„å®‰å…¨å…±äº«ï¼Œè€Œä¸”å¯ä»¥åœ¨ä¸åŒåº”ç”¨ç¨‹åºçš„çº¿ç¨‹ä¹‹é—´å®ç°å¯¹èµ„æºçš„å®‰å…¨å…±äº«ã€‚ 1.3 ç®¡ç¨‹/ä¿¡å·é‡ç®¡ç¨‹å’Œä¿¡å·é‡æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚æŒ‡ä¸€ä¸ªäº’æ–¥ç‹¬å é”å®šçš„å¯¹è±¡æˆ–ç§°ä¸ºäº’æ–¥ä½“ã€‚åœ¨ç»™å®šçš„æ—¶é—´ï¼Œä»…æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å¾—ç®¡ç¨‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦é”å®šï¼Œä»–å¿…é¡»è¿›å…¥ç®¡ç¨‹ã€‚æ‰€æœ‰å…¶ä»–çš„è¯•å›¾è¿›å…¥å·²ç»é”å®šçš„ç®¡ç¨‹çš„çº¿ç¨‹å¿…é¡»æŒ‚èµ·ç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹é€€å‡ºç®¡ç¨‹ã€‚è¿™äº›å…¶ä»–çš„çº¿ç¨‹è¢«ç§°ä¸ºç­‰å¾…çº¿ç¨‹ã€‚ä¸€ä¸ªæ‹¥æœ‰ç®¡ç¨‹çš„çº¿ç¨‹å¦‚æœæ„¿æ„çš„è¯å¯ä»¥å†æ¬¡è¿›å…¥ç›¸åŒçš„ç®¡ç¨‹ï¼ˆå¯é‡å…¥æ€§ï¼‰ 1.4 CASæ“ä½œCASæ“ä½œï¼ˆcompare and swapï¼‰CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™è¿”å›Vã€‚è¿™æ˜¯ä¸€ç§ä¹è§‚é”çš„æ€è·¯ï¼Œå®ƒç›¸ä¿¡åœ¨å®ƒä¿®æ”¹ä¹‹å‰ï¼Œæ²¡æœ‰å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹å®ƒï¼›è€ŒSynchronizedæ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œå®ƒè®¤ä¸ºåœ¨å®ƒä¿®æ”¹ä¹‹å‰ï¼Œä¸€å®šä¼šæœ‰å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹å®ƒï¼Œæ‚²è§‚é”æ•ˆç‡å¾ˆä½ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸‹AtomicIntegeræ˜¯å¦‚ä½•åˆ©ç”¨CASå®ç°åŸå­æ€§æ“ä½œçš„ã€‚ 1.5 é‡æ’åºç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜æ€§èƒ½ï¼Œè€Œåœ¨ç¨‹åºæ‰§è¡Œæ—¶ä¼šå¯¹ç¨‹åºè¿›è¡Œé‡æ’åºã€‚ä»–çš„å‡ºç°æ˜¯ä¸ºäº†æé«˜ç¨‹åºçš„å¹¶å‘åº¦ã€‚ä»è€Œæé«˜æ€§èƒ½ï¼›ä½†æ˜¯å¯¹äºå¤šçº¿ç¨‹ç¨‹åºï¼Œé‡æ’åºå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºæ‰§è¡Œçš„ç»“æœä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ç»“æœï¼Œé‡æ’åºåˆ†ä¸ºç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¿©ä¸ªæ–¹é¢ã€‚è€Œå¤„ç†å™¨é‡æ’åºåŒ…æ‹¬æŒ‡ä»¤çº§é‡æ’åºå’Œå†…å­˜é‡æ’åºã€‚ å°èŠ‚åœ¨javaä¸­ï¼Œæ‰€æœ‰çš„å˜é‡ï¼ˆå®ä¾‹å­—æ®µï¼Œé™æ€å­—æ®µï¼Œæ„æˆæ•°ç»„çš„å…ƒç´ ï¼Œä¸åŒ…æ‹¬å±€éƒ¨å˜é‡å’Œæ–¹æ³•å‚æ•°ï¼‰éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œå†…ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¿å­˜è¢«çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ã€‚çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œä¸ºä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿä¸æ©èƒ½å¤Ÿç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´æ¯”å˜é‡å€¼çš„ä¼ é€’é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ JAVAä¸­çº¿ç¨‹å®‰å…¨ç›¸å…³å…³é”®å­—åŠç±»ä¸»è¦åŒ…æ‹¬ï¼šsynchronizedï¼ŒVolitileï¼ŒThreadLocalï¼ŒLockï¼ŒCondition 2.1 Volitileä½œç”¨ï¼š 1ï¼‰ä¿è¯äº†å¿ƒæ™ºèƒ½ç«‹å³å­˜å‚¨åˆ°ä¸»å†…å­˜æ‰ï¼Œæ¯æ¬¡ä½¿ç”¨å‰ç«‹å³ä»ä¸»å†…å­˜ä¸­åˆ·æ–° 2ï¼‰ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ– Volitileå…³é”®å­—ä¸èƒ½ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹å…±äº«æ•°æ®çš„æ“ä½œçš„æ­£ç¡®æ€§ï¼Œå¯ä»¥ä½¿ç”¨åœ¨è‡ªå·±çŠ¶æ€æ”¹å˜ä¹‹åéœ€è¦ç«‹å³é€šçŸ¥æ‰€æœ‰çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œåªä¿è¯å¯è§æ€§ï¼Œä¸ä¿è¯åŸå­æ€§ã€‚å³é€šè¿‡åˆ·æ–°å˜é‡å€¼ç¡®ä¿å¯è§æ€§ã€‚ Javaä¸­synchronizedå’Œfinalä¹Ÿèƒ½ä¿è¯å¯è§æ€§ synchronizedï¼šåŒæ­¥å¿«é€šè¿‡å˜é‡é”å®šå‰å¿…é¡»æ¸…ç©ºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡å€¼ï¼Œé‡æ–°ä»ä¸»å†…å­˜ä¸­è¯»å–å˜é‡å€¼ï¼Œè§£é”å‰å¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜æ¥ç¡®ä¿å¯è§æ€§ã€‚ final:è¢«finalä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦è¢«åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ„é€ å™¨æ²¡æœ‰æŠŠthiså¼•ç”¨ä¼ é€’è¿›å»ï¼Œé‚£ä¹ˆåœ¨å…¶ä»–çº¿ç¨‹ä¸­å°±èƒ½çœ‹è§finalå­—æ®µçš„å€¼ï¼Œæ— éœ€åŒæ­¥å°±å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹æ­£ç¡®è®¿é—®ã€‚ 2.2 synchronizedæŠŠä»£ç å—å£°æ˜ä¸ºsynchronizedï¼Œæœ‰ä¿©ä¸ªä½œç”¨ï¼Œé€šå¸¸æ˜¯æŒ‡æ”¹ä»£ç å…·æœ‰åŸå­æ€§å’Œå¯è§æ€§ã€‚å¦‚æœæ²¡æœ‰åŒæ­¥æœºåˆ¶æä¾›çš„è¿™ç§å¯è§æ€§ï¼Œçº¿ç¨‹çœ‹åˆ°çš„å…±äº«æ¯”é‚£é‡Œå¯èƒ½æ˜¯ä¿®æ”¹å‰çš„å€¼æˆ–ä¸ä¸€è‡´çš„å€¼ï¼Œè¿™å°†å¼•å‘è®¸å¤šä¸¥é‡é—®é¢˜ã€‚ åŸç†ï¼šå½“å¯¹è±¡è·å–é”æ˜¯ï¼Œä»–é¦–å…ˆæ˜¯è‡ªå·±çš„é«˜é€Ÿç¼“å­˜æ— æ•ˆï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ç›´æ¥ä»ä¸»å†…å­˜ä¸­è£…å…¥å˜é‡ï¼ŒåŒæ ·åœ¨å¯¹è±¡é‡Šæ”¾é”ä¹‹å‰ï¼Œä»–ä¼šåˆ·æ–°å…¶é«˜é€Ÿç¼“å­˜ï¼Œå¼ºåˆ¶ä½¿å·²åšçš„ä»»ä½•æ›´æ”¹éƒ½å‡ºç°åœ¨ä¸»å†…å­˜ä¸­ï¼Œè¿™æ ·ä¼šä¿è¯åœ¨åŒä¸€ä¸ªé”ä¸ŠåŒæ­¥çš„ä¿©ä¸ªçº¿ç¨‹çœ‹åˆ°åœ¨synchronizedå—å†…ä¿®æ”¹çš„å˜é‡çš„ç›¸åŒå€¼ã€‚ synchronizedé‡Šæ”¾ç”±JVMè‡ªå·±ç®¡ç†ã€‚ å­˜åœ¨çš„é—®é¢˜ï¼š 1ï¼‰æ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è·å¾—é”çš„çº¿ç¨‹ 2ï¼‰æ— æ³•é€šè¿‡æŠ•ç¥¨å¾—åˆ°é”ï¼Œå¦‚æœä¸æƒ³ç­‰å¾…ä¸‹å»ï¼Œä¹Ÿå°±æ²¡æ³•å¾—åˆ°é” 3ï¼‰åŒæ­¥è¿˜éœ€è¦é”çš„é‡Šæ”¾åªèƒ½åœ¨ä¸è·å¾—é”æ‰€åœ¨çš„å †æ ˆå¸§ç›¸åŒçš„å †æ ˆä¸­è¿›è¡Œï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ²¡é—®é¢˜ï¼ˆè€Œä¸”ä¸ä¸€åœºå¤„ç†äº¤äº’çš„å¾ˆå¥½ï¼‰ï¼Œä½†æ˜¯ï¼Œç¡®å®å­˜åœ¨ä¸€äº›éå—ç»“æ„çš„é”å®šæ›´é€‚åˆæƒ…å†µã€‚ 2.3 LockLockæ˜¯æœ‰JAVAç¼–å†™è€Œæˆçš„ï¼Œåœ¨javaè¿™ä¸ªå±‚é¢æ˜¯æ— å…³JVMå®ç°çš„ã€‚åŒ…æ‹¬ï¼šReentrantLockï¼ŒReadWriteLockã€‚å…¶æœ¬è´¨éƒ½ä¾èµ–äºAbstractQueueSynchronizedç±»ã€‚Lockæä¾›äº†å¾ˆå¤šé”çš„æ–¹å¼ï¼Œå°è¯•é”ï¼Œä¸­æ–­é”ç­‰ã€‚é‡Šæ”¾é”çš„è¿‡ç¨‹ç”±JAVAå¼€å‘äººå‘˜è‡ªå·±ç®¡ç†ã€‚ å°±æ€§èƒ½è€Œè¨€ï¼Œå¯¹äºèµ„æºå†²çªä¸å¤šçš„æƒ…å†µä¸‹synchronizedæ›´åŠ åˆç†ï¼Œä½†å¦‚æœèµ„æºè®¿é—®å†²çªå¤šçš„æƒ…å†µä¸‹ï¼Œsynchronizedçš„æ€§èƒ½ä¼šå¿«é€Ÿä¸‹é™ï¼Œè€ŒLockå¯ä»¥ä¿æŒå¹³è¡¡ã€‚ 2.4 conditionConditionå°†Objectç›‘è§†å™¨æ–¹æ³•ï¼ˆwaitï¼Œnotify,notifyallï¼‰åˆ†è§£æˆæˆªç„¶ä¸åŒçš„å¯¹è±¡ï¼Œä»¥ä¾¿é€šè¿‡è¿™äº›å¯¹è±¡ä¸ä»»æ„Lockå®ç°ç»„åˆä½¿ç”¨ï¼Œä¸ºæ¯ä¸ªå¯¹è±¡æä¾›å¤šä¸ªç­‰å¾…set(wait-set),ï¼Œå…¶ä¸­Lockæ›¿ä»£äº†synchronizedæ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼Œconditionæ›¿ä»£äº†Objectç›‘è§†å™¨æ–¹æ³•çš„ä½¿ç”¨ã€‚Conditionå®ä¾‹å®è´¨ä¸Šè¢«ä½ ç»‘å®šåˆ°ä¸€ä¸ªé”ä¸Šã€‚è¦ä¸ºç‰¹å®šLockå®ä¾‹è·å¾—Conditionå®ä¾‹ï¼Œè¯·ä½¿ç”¨å…¶newConditionï¼ˆï¼‰æ–¹æ³•ã€‚ 2.5 ThreadLockçº¿ç¨‹å±€éƒ¨å˜é‡ã€‚ å˜é‡æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½ä½¿ç”¨åŒä¸€ä¸ªåˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨åŒä¸€ä¸ªå˜é‡çš„ä¸€ä¸ªæ–°çš„å‰¯æœ¬ï¼Œè¿™ç§æƒ…å†µä¸‹TreadLocalå°±éå¸¸æœ‰ç”¨ã€‚ åº”ç”¨åœºæ™¯ï¼šå½“å¾ˆå¤šçº¿ç¨‹éœ€è¦å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦è¯¥å¯¹è±¡å…·æœ‰ç›¸åŒåˆå§‹å€¼çš„æ—¶å€™ï¼Œæœ€é€‚åˆä½¿ç”¨TreadLocalã€‚ äº‹å®ä¸Šï¼Œä»æœ¬è´¨ä¸Šè®²ï¼Œå°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŒä¸€ä¸ªMAPï¼Œè€Œè¿™ä¸ªmapçš„keyå°±æ˜¯TreadLocal,è€Œå€¼å°±æ˜¯æˆ‘ä»¬setçš„é‚£ä¸ªå€¼ï¼Œæ¯æ¬¡çº¿ç¨‹åœ¨getçš„æ—¶å€™ï¼Œéƒ½ä»è‡ªå·±çš„å˜é‡ä¸­å–å€¼ï¼Œæ—¢ç„¶ä»è‡ªå·±çš„å˜é‡ä¸­å–å€¼ï¼Œé‚£å°±è‚¯å®šä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚æ€»ä½“æ¥è®²ï¼ŒTreadLocalè¿™ä¸ªå˜é‡çš„çŠ¶æ€æ ¹æœ¬æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚å®ƒä»…ä»…æ˜¯å……å½“äº†ä¸€ä¸ªkeyçš„è§’è‰²ï¼Œå¦å¤–æä¾›ç»™æ¯ä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªåˆå§‹å€¼ã€‚å¦‚æœå…è®¸çš„è¯ï¼Œæˆ‘ä»¬è‡ªå·±å°±èƒ½å®ç°ä¸€ä¸ªè¿™æ ·çš„åŠŸèƒ½ï¼Œåªä¸è¿‡æ°å¥½JDKå°±å·²ç»å¸®åŠ©æˆ‘ä»¬åšäº†è¿™ä¸ªäº‹æƒ…ã€‚ ä½¿ç”¨TreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒTreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹åœ°å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šè‹±è¯­å…¶ä»–çº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ä»çº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œç›®æ ‡å˜é‡å¯¹è±¡æ˜¯çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œè¿™ä¹Ÿæ˜¯ç±»åä¸­Localæ‰€éœ€è¦è¡¨è¾¾çš„æ„æ€ã€‚ TreadLocalçš„å››ä¸ªæ–¹æ³•ï¼š void set(Object val),è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ Object getï¼ˆï¼‰è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹ç”¨çš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚ void remove() å°†å½“å‰çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼åˆ é™¤ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘å†…å­˜çš„å ç”¨ï¼Œçº¿ç¨‹ç»“æŸåï¼Œå±€éƒ¨å˜é‡è‡ªåŠ¨è¢«GC Object initValue() è¿”å›è¯¥çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œä½¿ç”¨protectedä¿®é¥°ï¼Œæ˜¾ç„¶æ˜¯ä¸ºäº†è®©å­ç±»è¦†ç›–è€Œè®¾è®¡çš„ã€‚ çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹å¼3.1 äº’æ–¥åŒæ­¥åœ¨å¤šçº¿ç¨‹è®¿é—®çš„æ—¶å€™ï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€æ¡çº¿ç¨‹ä½¿ç”¨ã€‚ ä¸´ç•ŒåŒºï¼Œäº’æ–¥é‡ï¼Œç®¡ç¨‹éƒ½æ˜¯åŒæ­¥çš„ä¸€ç§æ‰‹æ®µã€‚ javaä¸­æœ€åŸºæœ¬çš„äº’æ–¥åŒæ­¥æ‰‹æ®µæ˜¯synchronizedï¼Œç¼–è¯‘ä¹‹åä¼šå½¢æˆmonitorenterå’Œmonitorexitè¿™ä¿©ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œè¿™ä¿©ä¸ªå­—èŠ‚ç éƒ½éœ€è¦ä¸€ä¸ªreferenceç±»å‹çš„å‚æ•°æ¥æŒ‡æ˜è¦é”å®šå’Œè§£é”çš„å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ªé”çš„è®¡æ•°å™¨ï¼Œæ¥è®°å½•åŠ é”çš„æ¬¡æ•°ï¼ŒåŠ é”å‡ æ¬¡å°±è¦åŒæ ·è§£é”å‡ æ¬¡æ‰èƒ½æ¢å¤åˆ°æ— é”çŠ¶æ€ã€‚ javaçš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ï¼Œä¸ç®¡é˜»å¡è¿˜æ˜¯å”¤é†’éƒ½éœ€è¦æ“ä½œç³»ç»Ÿçš„å¸®åŠ©å®Œæˆï¼Œéƒ½éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œè¿™æ˜¯å¾ˆè€—è´¹æ—¶é—´çš„ï¼Œæ˜¯javaè¯­è¨€ä¸­çš„ä¸€ä¸ªé‡é‡çº§çš„æ“ä½œï¼Œè™½ç„¶è™šæ‹Ÿæœºæœ¬èº«ä¼šåšä¸€ç‚¹ä¼˜åŒ–çš„æ“ä½œï¼Œæ¯”å¦‚é€šçŸ¥æ“ä½œç³»ç»Ÿé˜»å¡ä¹‹å‰ä¼šåŠ ä¸€æ®µè‡ªæ—‹ç­‰å¾…çš„è¿‡ç¨‹ï¼Œé¿å…é¢‘ç¹åˆ‡æ¢åˆ°æ ¸å¿ƒæ€ã€‚ 3.2 éé˜»å¡åŒæ­¥äº’æ–¥å’ŒåŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™é€šå¸¸å«é˜»å¡åŒæ­¥ï¼ˆæ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼‰.éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬æœ‰å¦å¤–çš„é€‰æ‹©ï¼šåŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼Œé€šä¿—è®²å°±æ˜¯å…ˆæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹äº‰ç”¨å…±äº«çš„æ•°æ®ï¼Œæ“ä½œå°±æˆåŠŸï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›è¡Œå…¶ä»–çš„è¡¥å¿ï¼ˆæœ€å¸¸è§çš„å°±æ˜¯ä¸æ–­çš„é‡è¯•ï¼‰ã€‚è¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥è®¸å¤šå®ç°éƒ½ä¸éœ€è¦æŠŠçº¿ç¨‹å…ˆæŒ‚èµ·ï¼Œè¿™ç§åŒæ­¥æ“ä½œè¢«ç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚ 3.3 æ— åŒæ­¥éƒ¨åˆ†ä»£ç å¤©ç”Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸éœ€è¦åŒæ­¥ã€‚ 1ï¼‰å¯é‡å…¥ä»£ç ï¼šçº¯ä»£ç ï¼Œå…·æœ‰ä¸ä¾èµ–å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®å’Œå…¬ç”¨çš„ç³»ç»Ÿèµ„æºï¼Œç”¨åˆ°çš„çŠ¶æ€é‡éƒ½ç”±å‚æ•°ä¸­ä¼ å…¥ï¼Œä¸è°ƒç”¨éå¯é‡å…¥çš„æ–¹æ³•ç­‰ç‰¹å¾ï¼Œå®ƒçš„è¿”å›ç»“æœæ˜¯å¯ä»¥é¢„æµ‹çš„ã€‚ 2ï¼‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼šæŠŠå…±äº«æ•°æ®çš„å¯è§æ€§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œè¿™æ ·å°±æ— éœ€åŒæ­¥ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹ä¹‹é—´ä¸å‡ºç°æ•°æ®äº‰ç”¨é—®é¢˜ã€‚å¯ä»¥é€šè¿‡java.lang.TreadLocalç±»æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨çš„åŠŸèƒ½ã€‚]]></content>
      <categories>
        <category>java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>çº¿ç¨‹</tag>
        <tag>thread</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Webæ ¸å¿ƒ-Servlet]]></title>
    <url>%2F2018%2F11%2F10%2Fservletbase1%2F</url>
    <content type="text"><![CDATA[Servletå®é™…ä¸Šæ˜¯ServerAppletâ€“å°æœåŠ¡ç¨‹åºæˆ–æœåŠ¡è¿æ¥å™¨ï¼Œç”¨Javaç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºï¼Œä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€Webå†…å®¹ã€‚ä¸å¸¸ç”¨çš„åè®®ï¼Œå¦‚DNSï¼ŒTCP/IPï¼ŒHTTPç±»ä¼¼ï¼ŒServletæ˜¯ä½œä¸ºä¸€æ•´å¥—è§„èŒƒå­˜åœ¨çš„ï¼›åŒæ—¶ä½œä¸ºJ2EEæ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œå®šä¹‰äº†javawebå¼€å‘çš„æ ‡å‡†ã€‚Servletåˆ¶å®šäº†javaå¤„ç†WEBè¯·æ±‚çš„ä¸€ç³»åˆ—æ ‡å‡†ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§æ ‡å‡†è§„å®šçš„å»åšå°±å¯ä»¥äº†ã€‚å®é™…ä¸Šï¼Œæ— è®ºæ˜¯Struts2çš„FilterDispatcherè¿˜æ˜¯SpringMvcçš„DispatcherServlet,å…¶åº•å±‚éƒ½æ˜¯é€šè¿‡å®ç°Sevletæˆ–è€…Servletç±»å‹çš„æ‰©å±•ã€å¦‚ï¼šGenericServletã€‘æ¥å®ç°çš„ã€‚ 1.Servletæ¥å£ä¸‹å›¾ä¸ºServlet3.1ä¸­çš„ç»“æ„å›¾ï¼šå› ä¸ºServletæ˜¯ä»¥è§„èŒƒçš„æ–¹å¼å­˜åœ¨çš„ï¼Œå®é™…ä¸Šå°±æ˜¯å®šä¹‰ä¸€ç³»åˆ—è§„èŒƒæ¥å£ã€‚åœ¨Servletæ¥å£ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ¥å£ï¼š 1)initæ–¹æ³•æ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶è¢«å®¹å™¨è°ƒç”¨ï¼Œä¸”åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼› 2)getServletConfigæ–¹æ³•ç”¨äºè·å–ServletConfigï¼› 3)serviceæ–¹æ³•ç”¨äºå¤„ç†ä¸€ä¸ªå…·ä½“çš„è¯·æ±‚ 4)getServletInfoæ–¹æ³•ç”¨äºè·å–Servletç›¸å…³çš„ä¿¡æ¯ï¼šç‰ˆæƒç­‰ã€‚ 5)destroyæ–¹æ³•ç”¨æ¥é”€æ¯ä¸€ä¸ªServletï¼Œå’Œinitä¸€æ ·ï¼Œåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¸€èˆ¬åœ¨æœåŠ¡å™¨å…³é—­æ—¶ç”¨äºé‡Šæ”¾ä¸€äº›èµ„æºã€‚ initæ–¹æ³•è°ƒç”¨æ—¶ä¼šæ¥å—ä¸€ä¸ªServletConfigç±»å‹çš„å‚æ•°ï¼Œç”¨äºåˆå§‹åŒ–Servletï¼Œç”±å®¹å™¨ä¼ å…¥ã€‚ServletConfigï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶åŒ…å«äº†Serlvetçš„é…ç½®ä¿¡æ¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨web.xmlæ–‡ä»¶ä¸­å®šä¹‰Serlvetæ—¶ï¼Œä¼šé€šè¿‡init-paramæ ‡ç­¾æ¥è¿›è¡Œå‚æ•°é…ç½®ã€‚åœ¨Springmvcçš„é…ç½®ä¸­ï¼Œé€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥é…ç½®å‚æ•°ï¼š 2.ServletConfigæ¥å£1)getServletNameç”¨äºè·å–Servletçš„åå­—ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨web.xmlä¸­å®šä¹‰çš„servlet-name2)getServletContextè¿”å›ServletContextï¼Œä»£è¡¨æˆ‘ä»¬å½“å‰åº”ç”¨æœ¬èº«3)getInitParameterç”¨äºè·å–init-paramé…ç½®çš„å‚æ•°4)getInitParameterNamesç”¨äºè·å–æ‰€æœ‰init-paramé…ç½®åå­—çš„é›†åˆServletContextå’ŒServletConfigæœ€å¸¸è§çš„ä½¿ç”¨å°±æ˜¯ä¼ é€’åˆå§‹åŒ–å‚æ•°ã€‚æ¥çœ‹ä¸‹springä¸­çš„contextConfigServletçš„å‚æ•°é…ç½®é€šè¿‡context-paramé…ç½®çš„contextConfigLocationé…ç½®åˆ°äº†ServletContextä¸­ï¼Œå†é€šè¿‡Servletä¸‹çš„init-paramé…ç½®çš„contextConfigLocationé…ç½®åˆ°ServletConfigä¸­,åœ¨Servletä¸­å¯ä»¥é€šè¿‡getInitParameteræ–¹æ³•è·å–å…·ä½“çš„ä¿¡æ¯ã€‚ 3.GenericServletGenericServletæ˜¯Servletçš„é»˜è®¤å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package javax.servlet;import java.io.IOException;import java.io.Serializable;import java.util.Enumeration;import java.util.ResourceBundle;public abstract class GenericServlet implements Servlet, ServletConfig, Serializable&#123; private static final String LSTRING_FILE = &quot;javax.servlet.LocalStrings&quot;; private static ResourceBundle lStrings = ResourceBundle.getBundle(&quot;javax.servlet.LocalStrings&quot;); private transient ServletConfig config; public void destroy() &#123; &#125; public String getInitParameter(String name) &#123; ServletConfig sc = getServletConfig(); if (sc == null) &#123; throw new IllegalStateException(lStrings.getString(&quot;err.servlet_config_not_initialized&quot;)); &#125; return sc.getInitParameter(name); &#125; public Enumeration getInitParameterNames() &#123; ServletConfig sc = getServletConfig(); if (sc == null) &#123; throw new IllegalStateException(lStrings.getString(&quot;err.servlet_config_not_initialized&quot;)); &#125; return sc.getInitParameterNames(); &#125; public ServletConfig getServletConfig() &#123; return this.config; &#125; public ServletContext getServletContext() &#123; ServletConfig sc = getServletConfig(); if (sc == null) &#123; throw new IllegalStateException(lStrings.getString(&quot;err.servlet_config_not_initialized&quot;)); &#125; return sc.getServletContext(); &#125; public String getServletInfo() &#123; return &quot;&quot;; &#125; public void init(ServletConfig config) throws ServletException &#123; this.config = config; init(); &#125; public void init() throws ServletException &#123; &#125; public void log(String msg) &#123; getServletContext().log(getServletName() + &quot;: &quot; + msg); &#125; public void log(String message, Throwable t) &#123; getServletContext().log(getServletName() + &quot;: &quot; + message, t); &#125; public abstract void service(ServletRequest paramServletRequest, ServletResponse paramServletResponse) throws ServletException, IOException; public String getServletName() &#123; ServletConfig sc = getServletConfig(); if (sc == null) &#123; throw new IllegalStateException(lStrings.getString(&quot;err.servlet_config_not_initialized&quot;)); &#125; return sc.getServletName(); &#125;&#125; ä»å…¶ç»§æ‰¿å’Œå®ç°å…³ç³»æ¥çœ‹ï¼ŒGenericServletä¸»è¦åšäº†3ä»¶äº‹ï¼š1.å®ç°äº†ServletConfigæ¥å£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è°ƒç”¨ServletConfigé‡Œé¢çš„æ–¹æ³•ï¼› GenericServletå®ç°äº†ServletConfigï¼Œå¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™ç›´æ¥è°ƒç”¨ServletConfigä¸­çš„æ–¹æ³•ï¼Œä¸éœ€è¦å†å…ˆè·å–ServletConfigå¯¹è±¡ï¼›æ¯”å¦‚ï¼Œè·å–ServletContextçš„æ—¶å€™å¯ä»¥ç›´æ¥è°ƒç”¨getServletContext,è€Œæ— éœ€è°ƒç”¨getServletConfig().getServletContext(),ä½†æ˜¯å®é™…ä¸Šï¼Œå…¶åº•å±‚çš„å†…éƒ¨å®ç°è¿˜æ˜¯åœ¨å†…éƒ¨è¿˜æ˜¯è¿›è¡Œäº†getServletConfig().getServletContext()çš„è°ƒç”¨ã€‚2.æä¾›äº†æ— å‚çš„initæ–¹æ³• GenericServletå®ç°äº†Servletçš„initï¼ˆServletConfig configï¼‰æ–¹æ³•ï¼Œåœ¨é‡Œé¢å°†configè®¾ç½®ç»™äº†å…¶å†…éƒ¨å˜é‡configï¼Œç„¶åè°ƒç”¨äº†æ— å‚çš„initæ–¹æ³•ï¼›æ­¤æ–¹æ³•å¯ä»¥åœ¨å­ç±»ä¸­é€šè¿‡è¦†ç›–å®ƒæ¥å®Œæˆåˆå§‹åŒ–å·¥ä½œã€‚è¿™ç§æ–¹å¼å…·æœ‰çš„æœ‰ç‚¹åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š a.configè®¾ç½®ä¸ºå†…éƒ¨å±æ€§ï¼Œè¿™æ ·å¯ä»¥åœ¨ServletConfigçš„æ¥å£æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨Configçš„ç›¸åº”æ–¹æ³•æ¥æ‰§è¡Œï¼› b.æˆ‘ä»¬åœ¨å†™Serlvetçš„æ—¶å€™å¯ä»¥ä¸ç”¨å†å…³å¿ƒConfigï¼Œåªéœ€è¦æ‰§è¡Œè‡ªå·±çš„åˆå§‹åŒ–é€»è¾‘å³å¯ c.åœ¨é‡å†™initæ–¹æ³•æ—¶ï¼Œä¸éœ€è¦å†è°ƒç”¨super.init(config)ã€‚3.æä¾›äº†Logæ–¹æ³• GenericServletæä¾›äº†2ä¸ªlogæ–¹æ³•ï¼Œä¸€ä¸ªç”¨äºè®°å½•æ—¥å¿—ï¼Œä¸€ä¸ªç”¨äºè®°å½•å¼‚å¸¸ã€‚å…¶å…·ä½“çš„å®ç°æ˜¯é€šè¿‡ä¼ ç»™ServletConfigçš„æ—¥å¿—å®ç°çš„ã€‚ GenericServletæ˜¯ä¸å…·ä½“åè®®æ— å…³çš„ã€‚ 4.HttpServletHttpServletæ˜¯åŸºäºHttpåè®®å®ç°çš„Servletçš„åŸºç±»ï¼Œå†™Servletæ—¶ç›´æ¥ç»§æ‰¿HttpServletå³å¯,ä¸éœ€è¦å†é‡å¤´å®ç°Servletæ¥å£ï¼ŒSpringMvcä¸­çš„dispatcherServletå°±æ˜¯HttpServletçš„å­ç±»ã€‚ HttpServletæ˜¯ä¸Httpåè®®ç›¸å…³çš„ï¼ŒHttpServletå¤„ç†è¯·æ±‚ä¸»è¦æ˜¯é€šè¿‡é‡å†™çˆ¶ç±»çš„serviceæ–¹æ³•æ¥å®Œæˆå…·ä½“çš„è¯·æ±‚å¤„ç†çš„ã€‚åœ¨serviceæ–¹æ³•ä¸­é¦–å…ˆæ˜¯å°†ServletRequestå’ŒServletResponseè½¬æ¢æˆHttpServletRequestå’ŒHttpServletResponseï¼Œç„¶åæ ¹æ®è¯·æ±‚çš„ä¸åŒè·¯ç”±åˆ°ä¸åŒçš„å¤„ç†è¿‡ç¨‹ä¸­å»ã€å¤„ç†æ–¹æ³•å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„doXXXçš„æ–¹æ³•ã€‚æœ€å¸¸è§çš„å°±æ˜¯doGetå’ŒdoPostã€‘]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>servlet</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springæºç ç³»åˆ—ï¼šSpringçš„å¯åŠ¨è¿‡ç¨‹]]></title>
    <url>%2F2018%2F11%2F10%2Fspringbase1%2F</url>
    <content type="text"><![CDATA[Springå¯¹äºç¨‹åºå‘˜è¯´æ¥è¯´éƒ½ä¸é™Œç”Ÿï¼›ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å¼€æºæŠ€æœ¯ï¼Œå¸®åŠ©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½çš„è¿›è¡Œé¡¹ç›®çš„å¼€å‘ä¸ç»´æŠ¤ã€‚ç›´æ¥è¿›å…¥ä¸»é¢˜å§ã€‚Springçš„å¯åŠ¨è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯Iocå®¹å™¨åˆå§‹åŒ–ä»¥åŠè½½å…¥Beançš„è¿‡ç¨‹ï¼›æœ¬æ–‡ä¸»è¦æ˜¯å­¦ä¹ è®°å½•ä¸‹å‰åŠéƒ¨åˆ†ï¼ˆIocå®¹å™¨çš„åˆå§‹åŒ–ï¼‰ï¼Œæ–°æ‰‹ä¸Šè·¯ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·æŒ‡æ­£ï¼1.ä»é…ç½®æ–‡ä»¶è¯´èµ· 12345678&lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener &lt;/listener-class&gt; &lt;/listener&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt; &lt;/context-param&gt; åœ¨ä¸€èˆ¬çš„WEBé¡¹ç›®ä¸­ï¼Œé¡¹ç›®çš„å¯åŠ¨ä¸€èˆ¬æ˜¯ä»web.xmlæ–‡ä»¶çš„è½½å…¥å¼€å§‹çš„ã€‚å¦‚æœæˆ‘ä»¬çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†Springï¼Œé‚£ä¹ˆä½ è‚¯å®šä¼šåœ¨ä½ çš„web.xmlæ–‡ä»¶ä¸­çœ‹åˆ°ä¸Šé¢çš„é…ç½®ã€‚Springæ­£æ˜¯é€šè¿‡ContextLoaderListenerç›‘å¬å™¨æ¥è¿›è¡Œå®¹å™¨åˆå§‹åŒ–çš„ã€‚ä¸‹é¢é€šè¿‡ä»£ç è¿›è¡Œåˆ†æã€‚ 2.Springå®¹å™¨åŠ è½½çš„ä¸‰æ­¥èµ° step1:åˆ›å»ºä¸€ä¸ªWebApplicationContext step2:é…ç½®å¹¶ä¸”åˆ·æ–°Bean step3ï¼šå°†å®¹å™¨åˆå§‹åŒ–åˆ°servletä¸Šä¸‹æ–‡ä¸­ 3.WebApplicationContextçš„åˆ›å»ºè¿‡ç¨‹1public class ContextLoaderListener extends ContextLoader implements ServletContextListener ä»ContextLoaderListenerçš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œè¯¥ç›‘å¬å™¨ç»§æ‰¿äº†ContextLoaderï¼Œå¹¶ä¸”é‡å†™äº†ServletContextListenerä¸­çš„contextInitializedå’ŒcontextDestroyedæ–¹æ³•ã€‚ åœ¨contextInitializedä¸­ï¼Œé€šè¿‡è°ƒç”¨çˆ¶ç±»ï¼ˆContextLoaderï¼‰çš„initWebApplicationContextæ–¹æ³•è¿›è¡Œå®¹å™¨åˆ›å»ºï¼š1234@Overridepublic void contextInitialized(ServletContextEvent event) &#123; initWebApplicationContext(event.getServletContext());&#125; ä¸‹é¢æ¥çœ‹initWebApplicationContextçš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public WebApplicationContext initWebApplicationContext(ServletContext servletContext) &#123; //1ï¼šåˆ¤æ–­å½“å‰å®¹å™¨æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æŠ¥å®¹å™¨å·²ç»å­˜åœ¨çš„å¼‚å¸¸ä¿¡æ¯ if (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != null) &#123; throw new IllegalStateException( "Cannot initialize context because there is already a root application context present - " + "check whether you have multiple ContextLoader* definitions in your web.xml!"); &#125; Log logger = LogFactory.getLog(ContextLoader.class); //ä¸‹é¢è¿™ä¸ªæ—¥å¿—å°±æ˜¯æˆ‘ä»¬ç»å¸¸åœ¨å¯åŠ¨Springé¡¹ç›®æ—¶çœ‹åˆ°çš„æ—¥å¿—ä¿¡æ¯: //Initializing Spring root WebApplicationContext //Root WebApplicationContext: initialization started servletContext.log("Initializing Spring root WebApplicationContext"); if (logger.isInfoEnabled()) &#123; logger.info("Root WebApplicationContext: initialization started"); &#125; long startTime = System.currentTimeMillis(); try &#123; // Store context in local instance variable, to guarantee that // it is available on ServletContext shutdown. //å¦‚æœå½“å‰å®¹å™¨ä¸ºnull,åˆ™åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å°†servletContextä¸Šä¸‹æ–‡ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œ if (this.context == null) &#123; this.context = createWebApplicationContext(servletContext); &#125; //åˆ¤æ–­å½“å‰å®¹å™¨æ˜¯å¦ä¸ºå¯é…ç½®çš„ï¼Œåªæœ‰æ˜¯Configurableçš„å®¹å™¨ï¼Œæ‰èƒ½è¿›è¡Œåç»­çš„é…ç½® if (this.context instanceof ConfigurableWebApplicationContext) &#123; ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) this.context; if (!cwac.isActive()) &#123; // The context has not yet been refreshed -&gt; provide services such as // setting the parent context, setting the application context id, etc if (cwac.getParent() == null) &#123; // The context instance was injected without an explicit parent -&gt; // determine parent for root web application context, if any. ApplicationContext parent = loadParentContext(servletContext); cwac.setParent(parent); &#125; //ä¸‰æ­¥èµ°ä¸­çš„ç¬¬äºŒæ­¥ï¼šé…ç½®å¹¶ä¸”åˆ·æ–°å½“å‰å®¹å™¨ configureAndRefreshWebApplicationContext(cwac, servletContext); &#125; &#125; //å°†é…ç½®å¹¶ä¸”åˆ·æ–°è¿‡çš„å®¹å™¨å­˜å…¥servletä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶ä»¥WebApplicationContextçš„ç±»åä½œä¸ºkeyå€¼ servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, this.context); ClassLoader ccl = Thread.currentThread().getContextClassLoader(); if (ccl == ContextLoader.class.getClassLoader()) &#123; currentContext = this.context; &#125; else if (ccl != null) &#123; currentContextPerThread.put(ccl, this.context); &#125; if (logger.isDebugEnabled()) &#123; logger.debug("Published root WebApplicationContext as ServletContext attribute with name [" + WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE + "]"); &#125; if (logger.isInfoEnabled()) &#123; long elapsedTime = System.currentTimeMillis() - startTime; logger.info("Root WebApplicationContext: initialization completed in " + elapsedTime + " ms"); &#125; //è¿”å›åˆ›å»ºå¥½çš„å®¹å™¨ return this.context; &#125; catch (RuntimeException ex) &#123; logger.error("Context initialization failed", ex); servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, ex); throw ex; &#125; catch (Error err) &#123; logger.error("Context initialization failed", err); servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, err); throw err; &#125; &#125; ä¸‹é¢æˆ‘ä»¬åœ¨çœ‹ä¸‹æ˜¯å¦‚ä½•åˆ›å»ºWebApplicationContextçš„ 12345678910protected WebApplicationContext createWebApplicationContext(ServletContext sc) &#123; //é¦–å…ˆæ¥ç¡®å®šcontextæ˜¯ç”±ä»€ä¹ˆç±»å®šä¹‰çš„ï¼Œå¹¶ä¸”åˆ¤æ–­å½“å‰å®¹å™¨æ˜¯å¦ä¸ºå¯é…ç½®çš„ Class&lt;?&gt; contextClass = determineContextClass(sc); if (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) &#123; throw new ApplicationContextException("Custom context class [" + contextClass.getName() + "] is not of type [" + ConfigurableWebApplicationContext.class.getName() + "]"); &#125; //åˆ›å»ºå¯é…ç½®çš„ä¸Šä¸‹æ–‡å®¹å™¨ return (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass); &#125; æœ€åæ¥çœ‹ä¸‹determineContextClassè¿™ä¸ªæ–¹æ³• 12345678910111213141516171819202122232425protected Class&lt;?&gt; determineContextClass(ServletContext servletContext) &#123; //é¦–å…ˆä»web.xmlä¸­æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦è‡ªå·±å®šä¹‰äº†context String contextClassName = servletContext.getInitParameter(CONTEXT_CLASS_PARAM); //å¦‚æœæœ‰ï¼Œåˆ™é€šè¿‡åå°„åˆ›å»ºå®ä¾‹ if (contextClassName != null) &#123; try &#123; return ClassUtils.forName(contextClassName, ClassUtils.getDefaultClassLoader()); &#125; catch (ClassNotFoundException ex) &#123; throw new ApplicationContextException( "Failed to load custom context class [" + contextClassName + "]", ex); &#125; &#125; /*å¦‚æœæ²¡æœ‰ï¼Œåˆ™å»defaultStrategiesé‡Œé¢å–ã€defaultStrategiesæ˜¯Propertitesç±»çš„/å¯¹è±¡ï¼Œåœ¨ContextLoaderä¸­çš„é™æ€ä»£ç å—ä¸­åˆå§‹åŒ–çš„ï¼›å…·ä½“å¯çœ‹ä¸‹ä¸‹é¢çš„å›¾åƒã€‘ï¼›é»˜è®¤å®¹å™¨æ˜¯XmlWebApplicationContext*/ else &#123; contextClassName = defaultStrategies.getProperty(WebApplicationContext.class.getName()); try &#123; return ClassUtils.forName(contextClassName, ContextLoader.class.getClassLoader()); &#125; catch (ClassNotFoundException ex) &#123; throw new ApplicationContextException( "Failed to load default context class [" + contextClassName + "]", ex); &#125; &#125; &#125; æ€»çš„æ¥è¯´å°±æ˜¯ï¼šSpringçš„webå·¥ç¨‹é¦–å…ˆå›å»æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è‡ªå·±å®šä¹‰äº†contextï¼Œå¦‚æœæœ‰å°±é‡‡ç”¨ï¼›å¦‚æœæ²¡æœ‰å°±ä½¿ç”¨Springé»˜è®¤çš„ã€‚defaultStrategiesåˆå§‹åŒ–ï¼š è‡³æ­¤ï¼Œå®¹å™¨åˆ›å»ºå®Œæˆã€‚ä¸‹é¢æ˜¯æ•´ä¸ªè¿‡ç¨‹çš„ä¸€ä¸ªæµç¨‹å›¾ï¼ˆæœ‰ç–æ¼ï¼Œå›å¤´è¡¥ä¸€ä¸ªæ—¶åºå›¾ï¼‰ï¼š]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAä¸­çš„å…³é”®å­—]]></title>
    <url>%2F2018%2F11%2F10%2Fjava-key-word%2F</url>
    <content type="text"><![CDATA[Javaä¸­å…³é”®å­—æœ‰51ä¸ªï¼Œå¦å¤–è¿˜æœ‰ä¿©ä¸ªä¿ç•™å­—ï¼›å› æ­¤æ€»å…±æœ‰53ä¸ªã€‚æœ¬æ–‡åªå°†javaä¸­çš„å…³é”®å­—è¿›è¡Œç½—åˆ—å’Œç®€å•ä»‹ç»ï¼Œå¯¹äºéƒ¨åˆ†å…³é”®å­—çš„ç†è§£å¦‚sychronizedå°†åœ¨å…¶ä»–æ–‡ç« ä¸­å•ç‹¬åˆ†æã€‚ ä¿ç•™å­—ä¿ç•™å­—æ˜¯æŒ‡é¢„ç•™çš„å…³é”®å­—ï¼› constç”¨äºä¿®é¥°å­—æ®µæˆ–å±€éƒ¨å˜é‡çš„å£°æ˜ï¼›è¢«constä¿®é¥°çš„å­—æ®µæˆ–å±€éƒ¨å˜é‡çš„å€¼æ˜¯å¸¸æ•°ï¼Œä¸èƒ½è¢«ä¿®æ”¹ gotoæŒ‡å®šè·³è½¬åˆ°æ ‡ç­¾ï¼Œæ‰¾åˆ°æ ‡ç­¾åï¼Œç¨‹åºå°†å¤„ç†ä»ä¸‹ä¸€è¡Œå¼€å§‹çš„å‘½ä»¤ã€‚ å…³é”®å­— æ•°æ®ç±»å‹ è®¿é—®ä¿®é¥°ç¬¦ ç±»ã€æ¥å£å®šä¹‰ç›¸å…³ æµç¨‹æ§åˆ¶ä¸åˆ¤æ–­ç›¸å…³ åŒ… å˜é‡\ç±»\æ¥å£\æ–¹æ³•ä¿®é¥°ç¬¦ å¼‚å¸¸å¤„ç† æšä¸¾å’Œæ–­è¨€]]></content>
      <categories>
        <category>java åŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¯å¤©ä¸€é“ç®—æ³•é¢˜ï¼šæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²]]></title>
    <url>%2F2018%2F11%2F10%2Fleetcode5%2F</url>
    <content type="text"><![CDATA[é¢˜ç›®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚ ç¤ºä¾‹ï¼š ç»™å®š â€œabcabcbbâ€ ï¼Œæ²¡æœ‰é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œabcâ€ ï¼Œé‚£ä¹ˆé•¿åº¦å°±æ˜¯3ã€‚ ç»™å®š â€œbbbbbâ€ ï¼Œæœ€é•¿çš„å­ä¸²å°±æ˜¯ â€œbâ€ ï¼Œé•¿åº¦æ˜¯1ã€‚ ç»™å®š â€œpwwkewâ€ ï¼Œæœ€é•¿å­ä¸²æ˜¯ â€œwkeâ€ ï¼Œé•¿åº¦æ˜¯3ã€‚è¯·æ³¨æ„ç­”æ¡ˆå¿…é¡»æ˜¯ä¸€ä¸ªå­ä¸²ï¼Œâ€pwkeâ€ æ˜¯ å­åºåˆ— è€Œä¸æ˜¯å­ä¸²ã€‚ æ–¹æ¡ˆ1æ€è·¯ï¼š å­—ç¬¦å¯¹åº”çš„æ•°å­—ä½œä¸ºä¸‹æ ‡ åˆå§‹åŒ–ä¸€ä¸ª255çš„booleanä½œä¸ºæ‰€æœ‰å¯èƒ½å‡ºç°çš„å­—ç¬¦å¯¹åº”çš„å­˜åœ¨å¯èƒ½æ€§ï¼Œä¸å­˜åœ¨é‡å¤çš„å‡ä¸ºfalseï¼Œå­˜åœ¨é‡å¤çš„ï¼Œåˆ™å¯¹åº”çš„ä¸‹æ ‡ç½®ä¸ºtrueã€‚ ä¸¤ä¸ªæŒ‡é’ˆè¿›è¡Œç§»åŠ¨ï¼Œå‰æŒ‡é’ˆå…ˆä¸åŠ¨ï¼ŒåæŒ‡é’ˆç§»åŠ¨å¹¶æ ¹æ®å½“å‰å­—ç¬¦å¯¹åº”æ•´æ•°ä¸‹æ ‡æ˜¯å¦ä¸ºfalseæˆ–è€…trueè¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœæ˜¯falseï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰é‡å¤ï¼Œåˆ™æŒ‡é’ˆå‘åç§»åŠ¨ä¸€ä½ï¼›å¦‚æœä¸ºtrueï¼Œè¡¨ç¤ºå­˜åœ¨é‡å¤ï¼Œåˆ™åæŒ‡é’ˆåœæ­¢ç§»åŠ¨ï¼Œå¹¶è®¡ç®—å½“å‰å­—ä¸²é•¿åº¦ï¼Œä¸”å°†booleanæ•°ç»„é‡ç½®ï¼Œç¬¬ä¸€ä¸ªæŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä½ï¼ŒåæŒ‡é’ˆæŒ‡å‘å½“å‰å‰æŒ‡é’ˆã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445class Solution &#123; public int lengthOfLongestSubstring(String s) &#123; int len = 0 ; if (s==null || s.length()== 0 ) &#123; return 0; &#125; if (s.length() == 1)&#123; return 1; &#125; int firstPoint = 0; int nextPoint = 0; boolean[] exist=new boolean[255]; while (nextPoint &lt; s.length()&amp;&amp;firstPoint &lt;s.length())&#123; int currMax = 0; int index = s.charAt(nextPoint)-0; while (exist[index] == false&amp;&amp;nextPoint&lt;s.length())&#123; exist[s.charAt(nextPoint)-0] = true; nextPoint++; if (nextPoint &lt; s.length())&#123; index = s.charAt(nextPoint)-0; &#125; &#125; currMax = Math.max(currMax,nextPoint-firstPoint); firstPoint++; nextPoint=firstPoint; len = Math.max(len,currMax); for (int i = 0 ; i &lt; 255 ; i++) &#123; exist[i] = false; &#125; &#125; return len; &#125;&#125; æ–¹æ¡ˆ2æ€è·¯ï¼š ä»¥ä¸€ä¸ªhashmapä½œä¸ºè¾…åŠ©ï¼Œmapçš„keyå­˜å‚¨çš„æ˜¯å­—ç¬¦ï¼Œvalueå­˜å‚¨çš„æ˜¯è¯¥å­—ç¬¦å½“å‰çš„ä½ç½®ï¼Œé¦–å…ˆè®¾ç½®ä¸€ä¸ªå¤´æŒ‡é’ˆï¼ŒæŒ‡å‘å­—ç¬¦ä¸²å¼€å¤´ï¼Œé‚£ä¹ˆä»å¼€å§‹éå†å­—ç¬¦ä¸²ï¼Œå¦‚æœmapå½“ä¸­ä¸åŒ…å«è¿™ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆç”¨è¿™ä¸ªå­—ç¬¦å½“å‰æ‰€åœ¨çš„ä½ç½®å‡å»å¤´æŒ‡é’ˆçš„ä½ç½®ï¼Œç„¶åä¸æœ€å¤§é•¿åº¦åšæ¯”è¾ƒï¼Œé€‰æ‰“çš„æˆä¸ºæœ€å¤§é•¿åº¦ï¼Œç„¶åæŠŠå½“å‰å­—ç¬¦çš„ä»¥åŠä½ç½®æ”¾å…¥mapï¼Œä»¥abbaä¸ºä¾‹ï¼Œå¤´æŒ‡é’ˆæŒ‡å‘aï¼Œå½“å‰ä¸ºaï¼Œé‚£ä¹ˆé•¿åº¦ä¸º1ï¼Œmapã€‚putï¼ˆâ€˜aâ€™,0ï¼‰,å½“å‰ä¸ºbï¼Œé‚£ä¹ˆé•¿åº¦ä¸º2ï¼Œmap.put(â€˜bâ€™,1)ï¼Œå¦‚æœè¯´mapä¸­å­˜åœ¨å½“å‰å­—ç¬¦ï¼Œé‚£ä¹ˆæŠŠå¤´æŒ‡é’ˆæŒ‡å‘ï¼Œå¤´æŒ‡é’ˆå½“å‰çš„ä½ç½®ä¸mapä¸­å­˜å‚¨è¯¥å­—ç¬¦ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½®å½“ä¸­çš„è¾ƒå¤§è€…ï¼Œæˆä¸ºæ–°çš„å¤´æŒ‡é’ˆä½ç½®ï¼Œæ¯”å¦‚å½“èµ°åˆ°ç¬¬äºŒä¸ªbçš„æ—¶å€™ï¼Œé‚£ä¹ˆå¤´æŒ‡é’ˆåŸæ¥æ˜¯0ï¼Œå½“å‰mapä¸­å­˜æ”¾bçš„ä½ç½®æ˜¯1ï¼Œé‚£ä¹ˆå¤´æŒ‡é’ˆæŒ‡å‘2ï¼Œæ‰€ä»¥é•¿åº¦ä¸º1ï¼Œæ¯”æœ€å¤§é•¿åº¦å°ä¸è¿›è¡Œæ›¿æ¢ï¼Œæœ€åå°†å½“å‰çš„å­—ç¬¦åŠä½ç½®æ”¾å…¥mapï¼Œç°åœ¨æ˜¯map.put(â€˜bâ€™,2)ï¼Œç„¶åèµ°åˆ°äº†aï¼Œé‚£ä¹ˆå½“å‰mapä¸­açš„ä½ç½®æ˜¯0ï¼Œé‚£ä¹ˆå®ƒçš„ä¸‹ä¸€ä¸ªä½ç½®æ˜¯1ï¼Œä¸å½“å‰å¤´æŒ‡é’ˆä½ç½®2ç›¸æ¯”ï¼Œå°äºå½“å‰å¤´æŒ‡é’ˆçš„ä½ç½®ï¼Œé‚£ä¹ˆå¤´æŒ‡é’ˆä¸è·Ÿæ–°ï¼Œæ‰€ä»¥é•¿åº¦ä¸º2ï¼Œä¸æœ€å¤§é•¿åº¦ç›¸ç­‰ï¼Œæ‰€ä»¥ä¸æ›¿æ¢ï¼Œæœ€åæ±‚å‡ºæœ€å¤§é•¿åº¦ä¸º2. 12345678910111213141516171819public static int lengthOfLongestSubstring(String s) &#123; Map&lt;Character,Integer&gt; map=new HashMap&lt;Character,Integer&gt;(); int maxLength=0; int now=0; for(int i=0;i&lt;s.length();i++)&#123; if(map.containsKey(s.charAt(i)))&#123; now=Math.max(map.get(s.charAt(i))+1,now); if((i-now+1)&gt;maxLength)&#123; maxLength=i-now+1; &#125; &#125;else&#123; if((i-now+1)&gt;maxLength)&#123; maxLength=i-now+1; &#125; &#125; map.put(s.charAt(i), i); &#125; return maxLength; &#125;]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¯å¤©ä¸€é“ç®—æ³•é¢˜ï¼šæ±‚ä¸¤ä¸ªæ’åºæ•°ç»„çš„ä¸­ä½æ•°]]></title>
    <url>%2F2018%2F11%2F10%2Fleetcode4%2F</url>
    <content type="text"><![CDATA[é¢˜ç›®æœ‰ä¸¤ä¸ªå¤§å°ä¸º m å’Œ n çš„æ’åºæ•°ç»„ nums1 å’Œ nums2 ã€‚ è¯·æ‰¾å‡ºä¸¤ä¸ªæ’åºæ•°ç»„çš„ä¸­ä½æ•°å¹¶ä¸”æ€»çš„è¿è¡Œæ—¶é—´å¤æ‚åº¦ä¸º O(log (m+n)) ã€‚ ç¤ºä¾‹1: 1234nums1 = [1, 3]nums2 = [2]ä¸­ä½æ•°æ˜¯ 2.0 ç¤ºä¾‹2: 12345nums1 = [1, 2]nums2 = [3, 4]ä¸­ä½æ•°æ˜¯ (2 + 3)/2 = 2.5 å½’å¹¶&amp;topKé—®é¢˜ æ–¹æ¡ˆ1è¿™ä¸ªæ€è·¯å°±æ˜¯å¯¹äºä¸¤ä¸ªæœ‰åºæ•°ç»„è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶åˆ°ä¸€ä¸ªå¤§çš„æœ‰åºçš„æ•°ç»„ä¸­å»ï¼Œç„¶åæ±‚åˆå¹¶åæ•°ç»„çš„ä¸­ä½æ•°ã€‚ä¸‹é¢ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯å½’å¹¶æ’åºçš„æ–¹å¼ï¼Œå¯¹äºä¸¤ä¸ªæœ‰åºæ•°ç»„è¿›è¡Œå½’å¹¶æ’åºçš„ã€‚ä»å¤æ‚åº¦çš„è§’åº¦æ¥è¯´å¯ä»¥æ»¡è¶³é¢˜ç›®çš„è¦æ±‚ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä¸»è¦æ˜¯æ€ä¹ˆèƒ½å¤Ÿä½¿å¾—æ—¶é—´å¤æ‚åº¦å˜æˆO{MIN(nums1.length,nums2.leng)}ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960class Solution &#123; public double findMedianSortedArrays(int[] nums1, int[] nums2) &#123; double result = 0.0d; int[] nums = new int[nums1.length+nums2.length]; int num1index = 0; int num2index = 0; int index = 0; if (nums1.length == 0 &amp;&amp; nums2.length == 0)&#123; return result; &#125; if (nums1.length == 0)&#123; return getResult(nums2); &#125; if (nums2.length == 0)&#123; return getResult(nums1); &#125; while(num1index &lt; nums1.length &amp;&amp; num2index &lt; nums2.length)&#123; if (nums1[num1index] &lt; nums2[num2index])&#123; nums[index]= nums1[num1index]; num1index++; &#125;else&#123; nums[index]= nums2[num2index]; num2index++; &#125; index++; &#125; while (num1index &lt; nums1.length)&#123; nums[index] = nums1[num1index++]; index++; &#125; while (num2index &lt; nums2.length)&#123; nums[index] = nums2[num2index++]; index++; &#125; if (nums.length%2==0) &#123; result = (nums[nums.length/2]+nums[nums.length/2-1])/2.0; &#125; else&#123; result = nums[nums.length/2]; &#125; return result; &#125; private double getResult(int[] nums)&#123; double result = 0.0D; if (nums.length%2==0) &#123; result = (nums[nums.length/2]+nums[nums.length/2-1])/2.0; &#125; else&#123; result = nums[nums.length/2]; &#125; return result; &#125;&#125; æ–¹æ¡ˆ2æ±‚ä¸¤ä¸ªæ’åºæ•°ç»„çš„ä¸­ä½æ•° å‡è®¾nums1.length = m, nums2.length = n; m &lt; n; è‹¥(m + n) % 2 == 0, è¡¨ç¤ºä¸¤æ•°ç»„ä¹‹å’Œä¸ºå¶æ•°ï¼Œåº”è¯¥æ˜¯æœ‰ä¸¤ä¸ªä¸­ä½æ•°ï¼Œå› æ­¤æœ€ç»ˆç»“æœä¸ºç¬¬9è¡Œçš„ä»£ç æ‰€ç¤ºã€‚å¦åˆ™ï¼Œç»“æœä¸ºç¬¬7è¡Œçš„ä»£ç æ‰€ç¤ºã€‚ ä¸ºäº†ä½¿å¾—æ–¹æ³•çš„ç»Ÿä¸€ï¼Œåœ¨æœ€åˆæ—¶ï¼Œå¯¹æ•°ç»„è¿›è¡Œå¤„ç†ï¼Œç»Ÿä¸€ä½¿å¾—ä¼ è¿›æ–¹æ³•çš„çŸ­æ•°ç»„ä¸ºnums1ï¼Œå³ç¬¬14è¡Œä»£ç æ‰€ç¤ºã€‚ å¦‚æœlen1-start1 == 0,åˆ™è¡¨ç¤ºnums1å·²ç»å…¨éƒ¨åŠ å…¥å‰kä¸ªäº†ï¼Œåˆ™ç¬¬kä¸ªä¸ºnums2[k -1]; åœ¨æ–¹æ³•findKthï¼ˆï¼‰ä¸­çš„kæ˜¯ä¸€ç›´å˜åŒ–çš„ï¼Œåˆå§‹æ—¶ï¼Œkä¸ºä¸¤ä¸ªæ•°ç»„ä¸­æ’åºä¹‹åçš„ç¬¬kä¸ªæ•°çš„ä½ç½®ï¼›kåœ¨æ–¹æ³•ä¸­çš„çœŸæ­£å«ä¹‰ä¸ºâ€œè¿˜éœ€è¦æ‰¾åˆ°å¤šå°‘ä¸ªæ•°æ‰èƒ½è¾¾åˆ°kä¸ªâ€ï¼›å› æ­¤å‡è®¾nums1.length ==0;,æ­¤æ—¶len1-start1 == 0, åˆ™ä¸­ä½æ•°å°±æ˜¯nums2[k - 1],å³åœ¨nums1ä¸­æ‰¾åˆ°äº†0ä¸ªæ•°ï¼Œè¿˜éœ€è¦æ‰¾kä¸ªæ•°ï¼Œç¬¬kä¸ªæ•°å°±æ˜¯nums[k - 1]; å¦‚æœk == 1,åˆ™è¡¨ç¤ºå‰k-1å°çš„æ•°å·²ç»æ‰¾è¿‡äº†ï¼Œåˆ™ç¬¬kä¸ªæ•°è‚¯å®šæ˜¯nums1[start1]å’Œnums2[start2]ä¸­è¾ƒå°çš„é‚£ä¸ªæ•°ã€‚ ä¸‹é¢æ¥ç€å°±æ˜¯å¸¸è§„çš„æƒ…å†µï¼šå³nums1ä¸­åŒ…å«ä¸€éƒ¨åˆ†k,nums2ä¸­ä¹ŸåŒ…å«ä¸€éƒ¨åˆ†çš„k,å› æ­¤å°±ä»æ¯ä¸ªæ•°ç»„çš„k/2é‚£é‡Œå¼€å§‹æ¯”è¾ƒï¼ˆä¹Ÿç›¸å½“äºæ¯æ¬¡éƒ½ä¼šæœ‰ä¸€åŠçš„æ•°è¢«åŠ å…¥å‰kä¸ªï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆlog(m + n)ï¼‰ï¼‰ï¼šé‡‡ç”¨p1å’Œp2åˆ†åˆ«è®°å½•å½“å‰nums1å’Œnums2éœ€è¦æ¯”è¾ƒçš„é‚£ä¸ªä½ï¼Œç”±äºnums1æ¯”è¾ƒçŸ­ï¼Œå› æ­¤æœ‰å¯èƒ½2/kçš„ä½ç½®å·²ç»è¶…å‡ºäº†nums1çš„é•¿åº¦ï¼Œå› æ­¤nums1è¿˜éœ€è¦åšç‰¹æ®Šå¤„ç†ï¼Œå³ç¬¬19è¡Œä»£ç æ‰€ç¤ºï¼›ç”±äºp1åšäº†ç‰¹æ®Šå¤„ç†ï¼Œé‚£p2ä¹Ÿå°±è¦åšç‰¹æ®Šå¤„ç†ã€‚æ€»ä¹‹ï¼Œstart1~p1å’Œstart2~p2çš„å’Œä¸€å®šä¸ºkã€‚1ï¼‰è‹¥nums1[p1 - 1] &lt; nums[p2 - 1],åˆ™è¡¨æ˜ã€start1, p1)ä¹‹é—´çš„å€¼åœ¨å‰kä¸ªæ•°ä¸­ï¼›2ï¼‰è‹¥nums[p1 - 1] &gt; nums2[p2- 1],åˆ™è¡¨æ˜ã€start2, p2)ä¹‹é—´çš„å€¼åœ¨å‰kä¸ªæ•°ä¸­ï¼›3ï¼‰è‹¥ä¸¤å€¼ç›¸ç­‰ï¼Œåˆ™è¡¨æ˜ã€start1, p1)+ã€start2ï¼Œ p2ï¼‰çš„ä¸ªæ•°ä¸ºk,åˆ™ç»“æœç›´æ¥è¿”å›å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚ä¸ºä»€ä¹ˆæ¯”è¾ƒçš„p1å’Œp2çš„å‰ä¸€ä¸ªä½çš„æ•°ï¼Œè€Œä¸æ˜¯p1å’Œp2ä½ç½®çš„æ•°å‘¢ï¼Ÿ ä¸¾ä¾‹è¯´æ˜ï¼šå‡è®¾start1== start2 == 0, åˆ™p1 = Math.min(len1, k / 2); p2 = k - p1,å³p1 + p2 == k;ï¼›å‡è®¾p1 = 5, p2 = 7;, åˆ™k = 12; åœ¨æ•°ç»„ä¸­nums[5]å…¶å®æ˜¯ç¬¬6ä¸ªæ•°ï¼Œnums[7]å…¶å®æ˜¯ç¬¬8ä¸ªæ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯”è¾ƒçš„æ˜¯nums1[p1 - 1]ä¸nums2[p2 - 1]çš„å€¼ï¼› 1234567891011121314151617181920212223242526272829public class Solution &#123; public double findMedianSortedArrays(int[] nums1, int[] nums2) &#123; int len1 = nums1.length; int len2 = nums2.length; int size = len1 + len2; if(size % 2 == 1) return findKth(nums1, 0, len1, nums2, 0, len2, size / 2 + 1); else return (findKth(nums1, 0, len1, nums2, 0, len2, size / 2) + findKth(nums1, 0, len1, nums2, 0, len2, size / 2 + 1)) /2; &#125; public double findKth(int[] nums1, int start1, int len1, int[] nums2, int start2, int len2, int k) &#123; if(len1 - start1 &gt; len2 -start2) // ä¼ è¿›æ¥çš„æ—¶å€™ç»Ÿä¸€è®©çŸ­çš„æ•°ç»„ä¸ºnums1 return findKth(nums2, start2, len2, nums1, start1, len1, k); if(len1 - start1 == 0) // è¡¨ç¤ºnums1å·²ç»å…¨éƒ¨åŠ å…¥å‰Kä¸ªäº†ï¼Œç¬¬kä¸ªä¸ºnums2[k - 1]; return nums2[k - 1]; if(k == 1) return Math.min(nums1[start1], nums2[start2]); // k==1è¡¨ç¤ºå·²ç»æ‰¾åˆ°ç¬¬k-1å°çš„æ•°ï¼Œä¸‹ä¸€ä¸ªæ•°ä¸ºä¸¤ä¸ªæ•°ç»„startå¼€å§‹çš„æœ€å°å€¼ int p1 = start1 + Math.min(len1 - start1, k / 2); // p1å’Œp2è®°å½•å½“å‰éœ€è¦æ¯”è¾ƒçš„é‚£ä¸ªä½ int p2 = start2 + k - p1 + start1; if(nums1[p1 - 1] &lt; nums2[p2 - 1]) return findKth(nums1, p1, len1, nums2, start2, len2, k - p1 + start1); else if(nums1[p1 - 1] &gt; nums2[p2 -1]) return findKth(nums1, start1, len1, nums2, p2, len2, k - p2 + start2); else return nums1[p1 - 1]; &#125;&#125;]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¯å¤©ä¸€é“ç®—æ³•é¢˜ï¼šæœ€é•¿å›æ–‡å­ä¸²]]></title>
    <url>%2F2018%2F11%2F10%2Fleetcode3%2F</url>
    <content type="text"><![CDATA[##é¢˜ç›®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s é•¿åº¦æœ€é•¿ä¸º1000ã€‚ ç¤ºä¾‹: 12345è¾“å…¥: &quot;babad&quot;è¾“å‡º: &quot;bab&quot;æ³¨æ„: &quot;aba&quot;ä¹Ÿæ˜¯æœ‰æ•ˆç­”æ¡ˆ ç¤ºä¾‹: 123è¾“å…¥: &quot;cbbd&quot;è¾“å‡º: &quot;bb&quot; æ€è·¯ä¸€å¼€å§‹æ˜¯æƒ³ç”¨æœ€ç¬¨çš„æ–¹æ³•æ¥è§£çš„ï¼Œä¹Ÿå°±æ˜¯æ‰¾å‡ºæ‰€æœ‰çš„å­—ä¸²ï¼Œç„¶åå†å¯¹æ‰€æœ‰çš„å­ä¸²è¿›è¡Œå›æ–‡æ£€æµ‹ï¼Œå¹¶è®°å½•é•¿åº¦ã€‚è¿™ç§æ–¹å¼æ—¶é—´å¤æ‚åº¦å¯æƒ³è€ŒçŸ¥ï¼ŒO(n)O(n)O(n)=O(n^3)ã€‚æ‰€ä»¥è¿™ç§è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³æˆ‘ä»¬è¦æ±‚çš„ã€‚ okï¼Œé‚£æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œå…ˆæŠŠè¿™ä¸ªé—®é¢˜ç‰¹æ®ŠåŒ–ï¼› å‡å¦‚è¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦å°±æ˜¯1 é‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å›æ–‡ä¸²å°±æ˜¯å®ƒè‡ªå·±ï¼Œé•¿åº¦å°±æ˜¯1 å‡å¦‚å­—ç¬¦ä¸²é•¿åº¦ä¸º2ï¼Œå®ƒè¦æ˜¯å›æ–‡ä¸²çš„åŒ–ï¼Œå°±éœ€è¦ä¸¤ä¸ªå­—ç¬¦æ˜¯ç›¸ç­‰çš„ã€‚ å³ï¼šs[i] == s[j] ä¸”i-j=1(æ­¤å¤„å‡å®šiæ˜¯è¾ƒå¤§ç´¢å¼•ä½ç½®) é‚£ä¹ˆå¯¹äºiï¼j&gt;1çš„æƒ…å†µä¸‹å‘¢ï¼Ÿæ˜¯ä¸æ˜¯åªè¦æ»¡è¶³ä¸‹é¢çš„æ¡ä»¶å°±å¯ä»¥äº†ï¼š å³:s[i] == s[j]&amp;&amp;s[i-1] == s[j+1] å…¶å®è¿™ç§æ€è·¯å°±æ˜¯åŠ¨æ€è§„åˆ’ã€‚å…³äºåŠ¨æ€è§„åˆ’çš„ç†è®ºæ€§æ–‡å­—å°±ä¸ç äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´é˜”ä»¥è‡ªè¡Œå­¦ä¹ ã€‚ä¸‹é¢å°±é’ˆå¯¹è¿™ä¸ªé—®é¢˜ç ä¸€ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637public String longestPalindrome(String s) &#123; // é•¿åº¦ä¸º1ï¼Œè¿”å›å½“å‰ä¸² if (s.length()==1)&#123; return s; &#125; //é•¿åº¦ä¸º2å¹¶ä¸”ä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰åˆ™è¿”å› if (s.length()==2&amp;&amp;s.charAt(0)==s.charAt(1))&#123; return s; &#125; //ç”¨äºæ ‡è®°isLongestPalindrome[j][i]å³ä»jåˆ°iæ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼› //å¦‚isLongestPalindrome[1][5]ï¼ï¼trueåˆ™è¡¨ç¤ºå­—ç¬¦ä¸²ç´¢å¼•ä½ç½®ä»1åˆ°5çš„å­ä¸²æ˜¯å›æ–‡ä¸²ã€‚ boolean[][] isLongestPalindrome = new boolean[s.length()][s.length()]; //æœ€é•¿å›æ–‡ä¸²åˆå§‹æœ€å¤§ä¸º0 int maxlen = 0; //å¯¹åº”çš„maxlençš„å¼€å§‹ç´¢å¼•ä½ç½® int beginIndex = 0; //å¯¹åº”çš„maxlençš„ç»“æŸç´¢å¼•ä½ç½® int lastIndex = 0; for (int i=0;i&lt;s.length();i++)&#123; int j=i; while(j&gt;=0)&#123; //æ»¡è¶³ä¸Šè¿°çš„ç¬¬ä¸‰ä¸ªæ¡ä»¶ï¼Œå³å½“å‰s.charAt(i)==s.charAt(j)å¹¶ //ä¸”s[jï¼‹1åˆ°iï¼1]ä¹Ÿæ˜¯å›æ–‡ä¸² if (s.charAt(i)==s.charAt(j)&amp;&amp;(i-j&lt;2||isLongestPalindrome[j+1][i-1]))&#123; isLongestPalindrome[j][i]=true; if (maxlen &lt; i-j+1) &#123; beginIndex = j; lastIndex = i+1; maxlen = i-j+1; &#125; &#125; j--; &#125; &#125; return s.substring(beginIndex,lastIndex);&#125;]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¯å¤©ä¸€é“ç®—æ³•é¢˜ï¼šZå­—å½¢è½¬æ¢]]></title>
    <url>%2F2018%2F11%2F10%2Fleetcodetwo%2F</url>
    <content type="text"><![CDATA[é¢˜ç›®å°†å­—ç¬¦ä¸² â€œPAYPALISHIRINGâ€ ä»¥Zå­—å½¢æ’åˆ—æˆç»™å®šçš„è¡Œæ•°ï¼šï¼ˆä¸‹é¢è¿™æ ·çš„å½¢çŠ¶ï¼‰ 123P A H NA P L S I I GY I R ä¹‹åæŒ‰é€è¡Œé¡ºåºä¾æ¬¡æ’åˆ—ï¼šâ€PAHNAPLSIIGYIRâ€ å®ç°ä¸€ä¸ªå°†å­—ç¬¦ä¸²è¿›è¡ŒæŒ‡å®šè¡Œæ•°çš„è½¬æ¢çš„å‡½æ•°: 1string convert(string text, int nRows); convert(â€œPAYPALISHIRINGâ€, 3) åº”å½“è¿”å› â€œPAHNAPLSIIGYIRâ€ ã€‚ æ–¹æ¡ˆ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public String convert(String s, int numRows) &#123; //è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ int len = s.length(); //ä¸¤ä¸ªå‘¨æœŸä¹‹é—´çš„åˆ—æ•°ï¼Œ int slash = numRows - 2; //è®¡ç®—è¡Œçš„é•¿åº¦ int rowLength = 0; while(len &gt; 0)&#123; //ç«–åˆ— len = len - numRows; rowLength++; //æ–œç€çš„ä¸€åˆ— for(int i = 0; i &lt; slash &amp;&amp; len &gt; 0; i++)&#123; len--; rowLength++; &#125; &#125; //å»ºç«‹ä¸€ä¸ªå¤šä¸€åˆ—çš„æ•°ç»„ç”¨äºä¿å­˜æˆ‘ä»¬çš„å­—ç¬¦ä¸²,å¹¶ä¸”å…¨éƒ¨åˆå§‹åŒ–ä¸ºç©ºæ ¼äº† char result[] = new char[numRows* rowLength]; // åˆå§‹åŒ–ä¸ºç©ºæ ¼ for (int i = 0; i &lt; result.length; i++) &#123; result[i] = ' '; &#125; // å½“å‰å¤„ç†çš„è¡Œæ•° int curColumn = 0; int index = 0; // ä¸‹é¢å°†å­—ç¬¦ä¸²å†™å…¥æ‰€è°“çš„çŸ©é˜µä¸­ while(index &lt; s.length())&#123; //å†™å…¥åˆ— for(int i = 0; i &lt; numRows &amp;&amp; index &lt; s.length(); i++)&#123; result[rowLength * i + curColumn] = s.charAt(index); index++; &#125; curColumn++; //å†™å…¥æ–œçº¿ for(int i = numRows - 2; i &gt; 0 &amp;&amp; index &lt; s.length(); i--)&#123; result[rowLength * i + curColumn] = s.charAt(index); curColumn++; index++; &#125; &#125; // å»ç©ºæ ¼ï¼Œå®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆå¾ªç¯è¿›è¡Œæ“ä½œ index = 0; // æ‰¾ç¬¬ä¸€ä¸ªæ˜¯ç©ºæ ¼çš„å­—ç¬¦ä½ç½® while (index &lt; s.length() &amp;&amp; result[index] != ' ') &#123; index++; &#125; int next = index + 1; while (index &lt; s.length()) &#123; // æ‰¾ä¸æ˜¯ç©ºæ ¼çš„å…ƒç´  while (next &lt; result.length &amp;&amp; result[next] == ' ') &#123; next++; &#125; result[index] = result[next]; index++; next++; &#125; return new String(result, 0, index);&#125; è¿™ä¸ªé¢˜ç›®æƒ³äº†ä¸¤å¤©ï¼Œä¹‹å‰çš„æ€è·¯æ˜¯å»ºç«‹ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œç„¶åå¡«å……ï¼Œæœ€åéå†æ•°ç»„æ‹¿åˆ°ç»“æœï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šè¾¹ç•Œé—®é¢˜ä¸å¤ªå¥½è€ƒè™‘ï¼Œæ”¾å¼ƒã€‚è¿™ä¸¤ç§æ–¹æ¡ˆçš„é¦–è¦æ ¸å¿ƒéƒ½æ˜¯è®¡ç®—åˆ—æ•°å’Œå¯¹æ–œåˆ—çš„å¤„ç†ï¼Œæ²¡æœ‰æ•°å­¦åŠŸåº•å’ŒæŠ½è±¡æ€ç»´çš„ç¨‹åºå‘˜çœŸçš„ä¼¤ä¸èµ·ã€‚]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¯å¤©ä¸€é“ç®—æ³•é¢˜ï¼šé¢ å€’æ•´æ•°]]></title>
    <url>%2F2018%2F11%2F10%2Fleetcodeone%2F</url>
    <content type="text"><![CDATA[é¢˜ç›®ç»™å®šä¸€ä¸ªèŒƒå›´ä¸º 32 ä½ int çš„æ•´æ•°ï¼Œå°†å…¶é¢ å€’ã€‚ ä¾‹ 1: 12è¾“å…¥: 123è¾“å‡º: 321 ä¾‹ 2: 12è¾“å…¥: -123è¾“å‡º: -321 ä¾‹ 3: 12è¾“å…¥: 120è¾“å‡º: 21 æ³¨æ„:å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å¤„ç† 32 ä½ intèŒƒå›´å†…çš„æ•´æ•°ã€‚æ ¹æ®è¿™ä¸ªå‡è®¾ï¼Œå¦‚æœé¢ å€’åçš„ç»“æœè¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œåˆ™è¿”å› 0ã€‚ æ–¹æ¡ˆè¿™ä¸ªé¢˜ç›®å…¶å®æŒºç®€å•çš„ï¼›æ€è·¯å¦‚ä¸‹ï¼š åˆ¤æ–­è¾“å…¥çš„æ•°å­—æ˜¯å¦å¤§äºæœ€å¤§æ•´æ•°ï¼Œå…¶å®è¿™é‡Œæ²¡æœ‰å¿…è¦åˆ¤æ–­ï¼Œå› ä¸ºå¦‚æœå‚æ•°è¾“å…¥å¤§äºæœ€å¤§æ•´æ•°çš„è¯ä¼šç›´æ¥æŠ¥é”™ã€‚ å°†æ•´æ•°è½¬æ¢æˆå­—ç¬¦ä¸² åˆ¤æ–­æ˜¯å¦æ˜¯è´Ÿæ•°ï¼Œè¿™ä¸ªä¾æ®å°±æ˜¯åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦å­˜åœ¨â€˜ï¼â€™ ä»åå‘å‰å¼€å§‹éå†ï¼Œæ³¨æ„çš„æ˜¯å¿…é¡»åå‘éå†ä¸”åˆå§‹ä¸º0çš„æƒ…å†µä¸‹ä¿æŒç»§ç»­å‘å‰è¿­ä»£ã€‚ å¦‚æœè½¬æ¢ä¹‹åçš„å€¼å¤§äºæœ€å¤§æ•´æ•°ï¼Œåˆ™ä¼šå¯¼è‡´stringè½¬intå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥åœ¨è¿™æŠŠå¼‚å¸¸æ•è·ï¼Œå¹¶ä¸”è¿”å›0ï¼ˆå·æ‡’ä¸€æ³¢ï¼Œä¸·ï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041424344 public int reverse(int x) &#123; int result = 0; if (x &gt;Integer.MAX_VALUE)&#123; return 0 ; &#125; String s =String.valueOf(x); int len = 0; if (s!=null&amp;&amp;s.length()!=0&amp;&amp;s.charAt(0)=='-')&#123; len = 1; &#125;else if(s.length() == 1)&#123; return x; &#125; int lastp = s.length()-1; boolean isStart = true; String ints = ""; while( lastp &gt;= len)&#123; if (isStart &amp;&amp; s.charAt(lastp)=='0')&#123; while (s.charAt(lastp)=='0')&#123; lastp--; &#125; isStart = false; &#125; if (isStart)&#123; isStart = false; &#125; ints = ints+s.charAt(lastp); lastp--; &#125; try&#123; result = Integer.parseInt(ints); &#125;catch (NumberFormatException e)&#123; return 0; &#125; return len==0?result:result*(-1);&#125;]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºrpcçš„æ•´ç†å’Œç†è§£]]></title>
    <url>%2F2018%2F11%2F10%2Frpcone%2F</url>
    <content type="text"><![CDATA[æ¶æ„æ¼”å˜ æ‰€æœ‰çš„ç•Œé¢å’ŒæœåŠ¡å‡åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸‹ åŸºäºmvcçš„è§†å›¾ä¸æœåŠ¡åˆ†ç¦»ï¼Œä½†æ˜¯å®é™…ä¸Šè¿˜æ˜¯åœ¨ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œåªä¸è¿‡åœ¨åŠŸèƒ½å±‚æ¬¡ä¸Šåˆ’åˆ†çš„æ›´åŠ ç»†è‡´ ç²’åº¦æ›´ç»†ï¼Œå¯¹äºä¸åŒçš„åŠŸèƒ½æœåŠ¡è¿›è¡Œåˆ‡åˆ†ï¼Œå¹¶è¿›è¡Œå•ç‹¬çš„éƒ¨ç½² é¢å‘æœåŠ¡çš„æ¶æ„ï¼Œå°†åº”ç”¨ç¨‹åºçš„ä¸åŒåŠŸèƒ½å•å…ƒï¼ˆç§°ä¸ºæœåŠ¡ï¼‰é€šè¿‡è¿™äº›æœåŠ¡ä¹‹é—´å®šä¹‰è‰¯å¥½çš„æ¥å£å’Œå¥‘çº¦è”ç³»èµ·æ¥ å¾®æœåŠ¡ æ­¤å¤„ä¸æ”¯æŒå›¾ç‰‡å±•ç¤ºï¼Œè‡ªè¡Œè„‘è¡¥ï¼ï¼ï¼ éšç€ä¸šåŠ¡é‡å’Œç”¨æˆ·é‡çš„å¢åŠ ï¼Œæ¶æ„ä¹Ÿæ˜¯ä»å•ä¸€ç³»ç»Ÿèµ°å‘åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæˆ‘èƒ½æƒ³åˆ°çš„æ˜¯ï¼Œè¿™ç§æ¶æ„çš„æ¼”å˜ä¸»è¦è§£å†³çš„é—®é¢˜åœ¨äºï¼š é€šè¿‡ä¸šåŠ¡æ¨¡å—çš„æ‹†åˆ†ï¼Œä½¿å¾—æ¯ä¸ªæ¨¡å—çš„èŒè´£æ›´åŠ æ¸…æ™°ï¼Œä½†æ˜¯æ¨¡å—çš„èŒè´£è¾¹ç•Œçš„åˆ’åˆ†å¾€å¾€ä¹Ÿæ˜¯å¾ˆç–¼å¤´çš„äº‹æƒ…ã€‚ ç»†è‡´çš„åˆ’åˆ†ä½¿å¾—é¡¹ç›®åœ¨ç®¡ç†ä¸Šé¢ä¼šæ›´åŠ æ–¹é¢ï¼Œä»ä»£ç çš„è§’åº¦æ¥è¯´ï¼Œå¼€å‘å’Œç»´æŠ¤çš„æˆæœ¬ä¹Ÿä¼šé™ä½ï¼Œä¸ä¼šå› ä¸ºä¸€ä¸ªbugå»è·‘æ•´ä¸ªé¡¹ç›®äº†ã€‚ æé«˜äº†ç³»ç»Ÿçš„å®¹é”™ç‡ï¼Œå•ä¸€ç³»ç»Ÿå¦‚æœå®•æœºé‚£å°±çœŸçš„ggäº†ï¼Œå¦å¤–å°±æ˜¯ï¼Œå•ä¸ªç¯èŠ‚å‡ºç°é—®é¢˜ä¹Ÿä¼šå¯¼è‡´é¡¹ç›®æ— æ³•æ­£å¸¸è¿è¡Œï¼ˆæ¯”å¦‚æ•°æ®åº“å‡ºé—®é¢˜äº†ï¼‰ã€‚å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å†—ä½™çš„æ–¹å¼æ¥æé«˜å¯ç”¨æ€§ï¼Œä¸ªäººç†è§£å°±æ˜¯å¯ä»¥æä¾›å¤šä¸ªä¸€æ ·çš„æœåŠ¡ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥è¿›è¡Œåˆ‡æ¢ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥çš„é—®é¢˜ä¸€ä¸ªæ˜¯æˆæœ¬ï¼Œç¡¬ä»¶æˆæœ¬ï¼Œè¿ç»´æˆæœ¬éƒ½ä¼šå¢åŠ ã€‚ rpcç®€ä»‹åŠå¸¸ç”¨çš„rpcæ¡†æ¶éšç€é›†ä¸­å¼æ¶æ„å‘åˆ†å¸ƒå¼æ¶æ„çš„è½¬å˜ï¼Œåº”ç”¨ç³»ç»Ÿä¹‹é—´çš„æœåŠ¡è°ƒç”¨ä¸é€šè®¯é—®é¢˜æˆä¸ºäº†é¦–è¦è§£å†³çš„éœ€æ±‚ã€‚ è€ŒRPC çš„ä¸»è¦ç›®æ ‡å°±æ˜¯ä¸ºäº†è®©æ„å»ºåˆ†å¸ƒå¼è®¡ç®—ï¼ˆåº”ç”¨ï¼‰å˜å¾—æ›´åŠ ç®€å•ï¼Œåœ¨æä¾›å¼ºå¤§çš„è¿œç¨‹è°ƒç”¨èƒ½åŠ›æ—¶ä¸æŸå¤±æœ¬åœ°è°ƒç”¨çš„è¯­ä¹‰ç®€æ´æ€§ã€‚ ä¸ºå®ç°è¯¥ç›®æ ‡ï¼ŒRPC æ¡†æ¶éœ€æä¾›ä¸€ç§é€æ˜è°ƒç”¨æœºåˆ¶è®©ä½¿ç”¨è€…ä¸å¿…æ˜¾å¼çš„åŒºåˆ†æœ¬åœ°è°ƒç”¨å’Œè¿œç¨‹è°ƒç”¨ã€‚ å¦‚ä¸‹ä»£ç ï¼š 123456789101112131415 @Autowiredprivate GlRpcAgent glRpcAgent; //rpcä»£ç†/** * @param param æ­¤å¤„çº¦å®šå‚æ•°ä»¥Mapé”®å€¼å¯¹çš„å½¢å¼ä¼ é€’ */@Overridepublic List&lt;OrderInfo&gt; queryOrdersByUserId(Map&lt;String, Object&gt; param) &#123; //åˆ›å»ºè¿œç¨‹è°ƒç”¨ä»£ç†ï¼ˆè¿œç¨‹æœåŠ¡çš„ç±»çš„å…¨é™å®šåï¼‰ OrderConsumeAgent orderConsumer=glRpcAgent.getAgent(&quot;com.glmapper.rpc.interface.OrderConsumeInterface&quot;); //é€šè¿‡ä»£ç†è·å–è¿”å›ç»“æœ æ­¤å¤„getOrdersä¸ºè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„com.glmapper.rpc.interface.OrderConsumeInterfaceæ¥å£ä¸­çš„æ–¹æ³•ï¼Œparamä¸ºå‚æ•° Map&lt;String,Object&gt; resultMap=(Map)orderConsumer.call(&quot;getOrders&quot;,param); //è§£æè¿”å›ç»“æœï¼ˆè¿œç¨‹æ–¹æ³•åŒæ ·ä»¥Mapé›†åˆçš„æ–¹å¼æ”¾å›ï¼‰ List&lt;OrderInfo&gt; orders = parseResultMap(resultMap); return orders;&#125; ä¸ºä»€ä¹ˆè¦ä»¥å…¨é™å®šåæ¥è·å–å‘¢ï¼Œè¿™ä¸ªæˆ‘ä»¬å°†ä¼šåœ¨åé¢æ¥è¯´ã€‚ ä»€ä¹ˆæ˜¯RPCIn distributed computing a remote procedure call (RPC) is when a computer program causes a procedure (subroutine) to execute in another address space(commonly on another computer on a shared network), which is coded as if it were a normal (local) procedure call, without the programmer explicitly coding the details for the remote interaction.RPC çš„å…¨ç§°æ˜¯ Remote Procedure Call æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚ å®ƒå…è®¸ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šï¼ˆé€šå¸¸æ˜¯å…±äº«ç½‘ç»œçš„å¦ä¸€å°æœºå™¨ä¸Šï¼‰çš„è¿‡ç¨‹æˆ–å‡½æ•°ï¼Œè€Œä¸ç”¨ç¨‹åºå‘˜æ˜¾å¼ç¼–ç è¿™ä¸ªè¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚ã€‚å³ç¨‹åºå‘˜æ— è®ºæ˜¯è°ƒç”¨æœ¬åœ°çš„è¿˜æ˜¯è¿œç¨‹çš„å‡½æ•°ï¼Œæœ¬è´¨ä¸Šç¼–å†™çš„è°ƒç”¨ä»£ç åŸºæœ¬ç›¸åŒã€‚ ä»å®šä¹‰ä¸­å¯ä»¥å¾—çŸ¥ï¼ŒRPCä¸»è¦æ¥è§£å†³ä¸‰ä»¶äº‹æƒ…ï¼š è¿›ç¨‹é—´é€šè®¯ æä¾›å’Œæœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·çš„è°ƒç”¨æœºåˆ¶ å±è”½ç¨‹åºå‘˜å¯¹è¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚å®ç° é¦–å…ˆæ˜¯è¿›ç¨‹é—´çš„é€šä¿¡é—®é¢˜ï¼Œå¯¹äºåˆ†å¸ƒå¼ç¯å¢ƒï¼Œrpcèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£å†³ä¸åŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åŠæ•°æ®ä¼ è¾“é—®é¢˜ï¼Œå³åšå¥½æ–¹æ³•è°ƒç”¨åˆ°æ•°æ®çš„è½¬æ¢ï¼Œç„¶åå€ŸåŠ©ç½‘ç»œè¿›è¡Œæ•°æ®ä¼ é€’ï¼›rpcå®¢æˆ·ç«¯å‘rpcæœåŠ¡ç«¯å‘èµ·è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œé€šè¿‡è¯·æ±‚çš„å°è£…ï¼Œå‚æ•°çš„å°è£…ï¼Œåºåˆ—åŒ–ã€ç¼–ç ã€çº¦å®šåè®®ä¼ è¾“ã€è§£æè¯·æ±‚ã€å¤„ç†è¯·æ±‚ã€å°è£…è¿”å›æ¶ˆæ¯æ•°æ®ã€åœ¨è¿›è¡Œè¿”å›æ•°æ®çš„åºåˆ—åŒ–ã€ç¼–ç ã€åœ¨é€šè¿‡ç½‘ç»œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å†è€…æ˜¯æä¾›å’Œæœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·çš„è°ƒç”¨æœºåˆ¶ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå¯¹äºä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œæˆ‘ä»¬æ›´å¤šçš„å…³æ³¨ç‚¹åœ¨äºå¦‚ä½•è§£å†³å®é™…çš„ä¸šåŠ¡éœ€æ±‚é—®é¢˜ï¼Œè€Œä¸æƒ³èŠ±æ›´å¤šçš„æ—¶é—´å’Œå¿ƒæ€åœ¨è¯¸å¦‚ä¸Šè¿°è¿‡ç¨‹ä¸­å…³äºç½‘ç»œä¼ è¾“åŠç¼–è§£ç è¿‡ç¨‹ï¼Œå› æ­¤å¯¹äºrpcæ¥è¯´ï¼Œéœ€è¦å°†è¿™äº›ç¼–è§£ç ã€åè®®çº¦å®šã€ç½‘ç»œä¼ è¾“ç­‰è¿›è¡Œä¸€ä¸ªæ•´ä½“çš„å°è£…ï¼Œç„¶ååªå‘ä¸šåŠ¡ç³»ç»Ÿæä¾›æœ€ç®€å•çš„è°ƒç”¨æ–¹å¼ã€‚æœ€åä¸€ä¸ªå±è”½ç¨‹åºå‘˜å¯¹è¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚å®ç°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ç¬¬äºŒç‚¹ä¸­æåˆ°çš„é‚£äº›åŠŸèƒ½çš„å°è£…ï¼Œæˆ‘ä»¬ä¸ç”¨å»å…³ç³»rpcåˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä¹Ÿä¸ç”¨å…³å¿ƒå®ƒæ˜¯å¦‚ä½•è¿ä½œçš„ï¼Œå¯¹äºä¸šåŠ¡å¼€å‘äººå‘˜æ¥è¯´ï¼Œé€šè¿‡çº¦å®šçš„æ–¹å¼è¿›è¡Œç±»ä¼¼äºæœ¬åœ°æ–¹æ³•è°ƒç”¨çš„å½¢å¼æ¥è°ƒç”¨è¿œç¨‹æœåŠ¡æ¥å£å°±å¯ä»¥äº†ã€‚é‚£ä¹ˆå¦‚ä½•å®ç°é€æ˜åŒ–çš„è¿œç¨‹è°ƒç”¨å‘¢ï¼Ÿä»€ä¹ˆæ ·çš„å†…éƒ¨å°è£…æ‰èƒ½è®©æˆ‘ä»¬è§‰å¾—åƒä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨è¿œç¨‹æœåŠ¡å‘¢ï¼Ÿå¯¹äºjavaæ¥è¯´å°±æ˜¯ä½¿ç”¨ä»£ç†ã€‚javaä»£ç†æœ‰ä¸¤ç§æ–¹å¼ï¼š1ï¼‰ jdk åŠ¨æ€ä»£ç†ï¼ˆæ¥å£ä»£ç†ï¼‰ï¼›2ï¼‰cglibä»£ç†ï¼ˆå­ç±»ä»£ç†ï¼‰ã€‚å°½ç®¡å­—èŠ‚ç ç”Ÿæˆæ–¹å¼å®ç°çš„ä»£ç†æ›´ä¸ºå¼ºå¤§å’Œé«˜æ•ˆï¼Œä½†ä»£ç ä¸æ˜“ç»´æŠ¤ï¼Œå¤§éƒ¨åˆ†å…¬å¸å®ç°RPCæ¡†æ¶æ—¶è¿˜æ˜¯é€‰æ‹©åŠ¨æ€ä»£ç†æ–¹å¼ã€‚è¿™éƒ¨åˆ†ä¹Ÿå°†ä¼šåœ¨åç»­çš„ç« èŠ‚ä¸­å±•å¼€æ¥è¯´ã€‚ RPCåŸºæœ¬åŸç†ä¸Šé¢è¯´åˆ°ï¼Œrpcéœ€è¦å¯¹ä¸€äº›è¿œç¨‹è°ƒç”¨çš„å†…éƒ¨å®ç°è¿›è¡Œå°è£…ã€‚æˆ‘ä»¬è¯´åˆ°æœ‰ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š åºåˆ—åŒ– ç¼–è§£ç  åè®® ç½‘ç»œ ä»å‘èµ·è¿œç¨‹è°ƒç”¨åˆ°æ¥æ”¶åˆ°æ•°æ®è¿”å›ç»“æœï¼Œå¤§è‡´è¿‡ç¨‹æ˜¯ï¼š 1ï¼‰æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆclientï¼‰è°ƒç”¨ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡ï¼›2ï¼‰client stubæ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼›3ï¼‰client stubæ‰¾åˆ°æœåŠ¡åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ï¼›4ï¼‰server stubæ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç ï¼›5ï¼‰server stubæ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡ï¼›6ï¼‰æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™server stubï¼›7ï¼‰server stubå°†è¿”å›ç»“æœæ‰“åŒ…æˆæ¶ˆæ¯å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹ï¼›8ï¼‰client stubæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œè§£ç ï¼›9ï¼‰æœåŠ¡æ¶ˆè´¹æ–¹å¾—åˆ°æœ€ç»ˆç»“æœã€‚ é‚£ä¹ˆrpcå°±ç›¸å½“äºå°†step2-step8çš„æ­¥éª¤è¿›è¡Œäº†å°è£…ã€‚ä¸‹é¢å€Ÿç”¨ä¸€å¼ ç½‘ä¸Šçš„å›¾ç‰‡æ¥å¸®åŠ©æˆ‘ä»¬ç†è§£è¿™ä¸ªè¿‡ç¨‹ã€‚ RPCæ¨¡å‹å¯¹äºä¸Šå›¾ï¼Œæˆ‘ä»¬è¿›è¡Œè¿›ä¸€æ­¥çš„æ‹†è§£å¾—åˆ°ï¼ˆæ¥è‡ªç½‘ç»œï¼‰ï¼š RPC æœåŠ¡ç«¯é€šè¿‡ RpcServer å»æš´éœ²æœåŠ¡æ¥å£ï¼Œè€Œå®¢æˆ·ç«¯é€šè¿‡ RpcClient å»è·å–æœåŠ¡æ¥å£ã€‚å®¢æˆ·ç«¯åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·å»è°ƒç”¨è¿œç¨‹æ¥å£æ–¹æ³•ï¼ŒRPC æ¡†æ¶æä¾›æ¥å£çš„ä»£ç†å®ç°ï¼Œå®é™…çš„è°ƒç”¨å°†å§”æ‰˜ç»™ä»£ç† RpcProxyã€‚ä»£ç†å°è£…è°ƒç”¨ä¿¡æ¯å¹¶å°†è°ƒç”¨è½¬äº¤ç»™ RpcInvoker å»å®é™…æ‰§è¡Œã€‚åœ¨å®¢æˆ·ç«¯çš„ RpcInvoker é€šè¿‡è¿æ¥å™¨ RpcConnector å»ç»´æŒä¸æœåŠ¡ç«¯çš„é€šé“ RpcChannelï¼Œå¹¶ä½¿ç”¨ RpcProtocol æ‰§è¡Œåè®®ç¼–ç ï¼ˆencodeï¼‰å¹¶å°†ç¼–ç åçš„è¯·æ±‚æ¶ˆæ¯é€šè¿‡é€šé“å‘é€ç»™æœåŠ¡ç«¯ã€‚RPC æœåŠ¡ç«¯æ¥æ”¶å™¨ RpcAcceptoræ¥æ”¶å®¢æˆ·ç«¯çš„è°ƒç”¨è¯·æ±‚ï¼ŒåŒæ ·ä½¿ç”¨ RpcProtocol æ‰§è¡Œåè®®è§£ç ï¼ˆdecodeï¼‰ã€‚è§£ç åçš„è°ƒç”¨ä¿¡æ¯ä¼ é€’ç»™ RpcProcessor å»æ§åˆ¶å¤„ç†è°ƒç”¨è¿‡ç¨‹ï¼Œæœ€åå†å§”æ‰˜è°ƒç”¨ç»™ RpcInvoker å»å®é™…æ‰§è¡Œå¹¶è¿”å›è°ƒç”¨ç»“æœã€‚ é€šè¿‡ä¸Šè¿°åˆ†æå¯çŸ¥ï¼Œè¿™é‡Œé¢åŒ…æ‹¬ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š ç”¨äºæš´éœ²æœåŠ¡æ¥å£çš„RpcServer ç”¨äºå‘ç°æœåŠ¡æ¥å£çš„RpcClient è¿œç¨‹æ¥å£çš„ä»£ç†å®ç°RpcProxy è´Ÿè´£åè®®ç¼–è§£ç çš„RpcProtocolï¼ˆå®é™…çš„rpcæ¡†æ¶ä¸­ä¸€èˆ¬ä¼šæä¾›å¤šç§ä¸åŒçš„å®ç°ï¼‰ ç½‘ç»œè¿æ¥å™¨ï¼ˆä¹‹å‰çœ‹è¿‡ä¸€ç¯‡æ–‡ç« è¯´9ä¸ªç»„ä»¶ï¼Œå¯¹äºå’±ä»¬è¿™ä¸ªæ¥è¯´ï¼Œéƒ¨åˆ†æ¨¡å—å¯ä»¥é›†æˆåœ¨clientå’Œserverä¸­ï¼‰ å¸¸è§çš„RPCæ¡†æ¶ç›®å‰å¸¸è§çš„åˆ†å¸ƒå¼RPCæ¡†æ¶æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š dubboé˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€ä¸ªJavaé«˜æ€§èƒ½ä¼˜ç§€çš„æœåŠ¡æ¡†æ¶ï¼Œä½¿å¾—åº”ç”¨å¯é€šè¿‡é«˜æ€§èƒ½çš„ RPC å®ç°æœåŠ¡çš„è¾“å‡ºå’Œè¾“å…¥åŠŸèƒ½ï¼Œå¯ä»¥å’Œ Springæ¡†æ¶æ— ç¼é›†æˆ motanæ–°æµªå¾®åšå¼€æºçš„ä¸€ä¸ªJava æ¡†æ¶ã€‚å®ƒè¯ç”Ÿçš„æ¯”è¾ƒæ™šï¼Œèµ·äº2013å¹´ï¼Œ2016å¹´5æœˆå¼€æºã€‚Motan åœ¨å¾®åšå¹³å°ä¸­å·²ç»å¹¿æ³›åº”ç”¨ï¼Œæ¯å¤©ä¸ºæ•°ç™¾ä¸ªæœåŠ¡å®Œæˆè¿‘åƒäº¿æ¬¡çš„è°ƒç”¨ã€‚ rpcxGoè¯­è¨€ç”Ÿæ€åœˆçš„Dubboï¼Œ æ¯”Dubboæ›´è½»é‡ï¼Œå®ç°äº†Dubboçš„è®¸å¤šç‰¹æ€§ï¼Œå€ŸåŠ©äºGoè¯­è¨€ä¼˜ç§€çš„å¹¶å‘ç‰¹æ€§å’Œç®€æ´è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨è¾ƒå°‘çš„ä»£ç å®ç°åˆ†å¸ƒå¼çš„RPCæœåŠ¡ã€‚ gRPCGoogleå¼€å‘çš„é«˜æ€§èƒ½ã€é€šç”¨çš„å¼€æºRPCæ¡†æ¶ï¼Œä¸»è¦é¢å‘ç§»åŠ¨åº”ç”¨å¼€å‘å¹¶åŸºäºHTTP/2åè®®æ ‡å‡†è€Œè®¾è®¡ï¼ŒåŸºäºProtoBuf(Protocol Buffers)åºåˆ—åŒ–åè®®å¼€å‘ï¼Œä¸”æ”¯æŒä¼—å¤šå¼€å‘è¯­è¨€ã€‚æœ¬èº«å®ƒä¸æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥è¦å®ç°ä¸Šé¢çš„æ¡†æ¶çš„åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥çš„å¼€å‘ã€‚ thriftApacheçš„ä¸€ä¸ªè·¨è¯­è¨€çš„é«˜æ€§èƒ½çš„æœåŠ¡æ¡†æ¶ RPCä¸MQMQ(message queue)æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼ŒåŒæ ·å¯ä»¥å®ç°RPCçš„åŠŸèƒ½ã€‚ä»åŠŸèƒ½ç‰¹ç‚¹ä¸Šæ¥è¯´ï¼ŒMQå¯ä»¥æŠŠæ¶ˆæ¯å­˜å‚¨ï¼Œè€ŒRPCä¸è¡Œã€‚å…³äºMQå’ŒRPCåšäº†ä»¥ä¸‹ç®€å•çš„å¯¹æ¯”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ€»ç»“æœ¬æ–‡å¯¹RPCçš„åŸºæœ¬åŸç†ã€ç‰¹ç‚¹ä»¥åŠåŸºæœ¬ç»„ä»¶è¿›è¡Œäº†ç®€å•çš„è¯´æ˜ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¯¹RPCæœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚å…³äºå¸¸è§çš„RPCæ¡†æ¶ä¹Ÿåšäº†åŸºæœ¬è®¤è¯†ï¼Œå¯¹äºè¿™äº›ä¼˜ç§€çš„æ¡†æ¶ï¼Œæˆ‘ä»¬åœ¨å®ç°æˆ‘ä»¬è‡ªå·±RPCæ—¶å¯ä»¥å€Ÿé‰´ä¸€ä¸‹è¿™äº›æ¶æ„é‡Œçš„ä¸€äº›æ¨¡å¼ä»¥åŠæŠ€æœ¯ã€‚æœ€åè¯´æ˜äº†ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šåœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­è¦ä½¿ç”¨RPCè€Œä¸æ˜¯MQï¼Œå¯¹äºMQæ¥è¯´ï¼Œåœ¨å¤„ç†åŒæ­¥è°ƒç”¨æ— æ³•æ»¡è¶³å®é™…çš„ç”Ÿäº§éœ€æ±‚ï¼Œè€ŒRPCæ‰æ›´åŠ é€‚åˆåˆ†å¸ƒå¼åº”ç”¨çš„å®é™…éœ€è¦ã€‚]]></content>
      <categories>
        <category>rpc</category>
      </categories>
      <tags>
        <tag>rpc</tag>
        <tag>dubbo</tag>
        <tag>å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºMybatisä¸­SQLè¯­å¥çš„æ•´ç†]]></title>
    <url>%2F2018%2F11%2F10%2Fmybatisone%2F</url>
    <content type="text"><![CDATA[éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨ç³»ç»Ÿéƒ½ä»ä¸€ä¸ªå¤§çš„ç³»ç»Ÿåˆ†æ‹†æˆå¤šä¸ªå°çš„ç³»ç»Ÿï¼Œå„ä¸ªç³»ç»Ÿä¹‹é—´é€šè¿‡ä¸€å®šçš„é€šä¿¡åè®®è¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ä¸€äº›å°çš„åº”ç”¨ç³»ç»Ÿè‡ªå·±ä¸ç”¨å»è¿›è¡Œæ•°æ®åº“çš„æ“ä½œï¼Œåªéœ€è¦è¿›è¡Œä¸€äº›rpcè°ƒç”¨æˆ–è€…ç¼“å­˜å°±å¯ä»¥æ‹¿åˆ°æ•°æ®è¿›è¡Œå±•ç¤ºã€‚æˆ‘ä¹‹å‰å‚ä¸çš„ä¸€ä¸ªé¡¹ç›®å°±æ˜¯è¿™æ ·çš„æƒ…å†µï¼Œè€Œæˆ‘ä¹Ÿæ˜¯å°†è¿‘7ä¸ªå¤šæœˆçš„æ—¶é—´æ²¡æœ‰å†™è¿‡ä¸€è¡ŒSQLã€‚ è¿‘æœŸå‚ä¸çš„ä¸€ä¸ªé¡¹ç›®çš„æ•°æ®å¤§å¤šéƒ½å¸‚åŸºäºæ•°æ®åº“æ¥è¿›è¡Œæ•°æ®äº¤äº’çš„ï¼Œæ‰€ä»¥å…ä¸äº†çš„è¦å†™å¤§é‡çš„SQLï¼Œæ‰€ä»¥æœ¬ç¯‡å°±æ€»ç»“ä¸€ä¸‹ä¸€äº›SQLçš„åŸºæœ¬å†™æ³•ï¼Œä»¥å¤‡åç”¨ã€‚ å»ºè¡¨12345CREATE TABLE IF NOT EXISTS `user_test` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢é•¿id', `user_name` varchar(128) NOT NULL COMMENT 'ç”¨æˆ·å', PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨'; æŸ¥è¯¢ ç®€å•çš„æŸ¥è¯¢ 123&lt;select id="queryUserByName" resultMap="userMap" parameterType="java.lang.String"&gt; SELECT * FROM user_test WHERE user_name = #&#123;userName&#125; &lt;/select&gt; éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœè¿™é‡Œä¸æŒ‡å®šparameterTypeï¼Œåˆ™é»˜è®¤ä¼šè¯†åˆ«å¤„ç†ï¼›å¦‚æœæŒ‡å®šäº†ç±»å‹ï¼Œåˆ™ä¼ å…¥çš„å€¼å°±éœ€è¦å’Œå½“å‰æŒ‡å®šçš„ç±»å‹ä¿æŒä¸€è‡´ï¼Œä¸ç„¶å°±ä¼šå‡ºç°æ•°æ®ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚ ç®€å•åˆ†é¡µæŸ¥è¯¢ 1234567&lt;select id="queryUsersList" resultMap="userMap"&gt; SELECT * FROM user_test WHERE 1=1 &lt;if test="keyword != null and keyword != ''" &gt; AND user_name LIKE concat('%',#&#123;keyword&#125;,'%') &lt;/if&gt; LIMIT #&#123;currentPage&#125;,#&#123;pageSize&#125;&lt;/select&gt; left join app_infoè¡¨å’Œapp_verionè¡¨åˆ†åˆ«å­˜å‚¨çš„æ˜¯åº”ç”¨ä¿¡æ¯å’Œåº”ç”¨ç‰ˆæœ¬ä¿¡æ¯ã€‚ç°åœ¨è¦æ ¹æ®appIdå’ŒversionIdæŸ¥å‡ºä¸€ä¸ªåº”ç”¨çš„å…·ä½“ä¿¡æ¯ã€åŒ…æ‹¬ä¿¡æ¯ä¿¡æ¯å’Œç‰ˆæœ¬ä¿¡æ¯ã€‘ 12345678&lt;select id=&quot;getAppDetail&quot; resultMap=&quot;appDeatilMap&quot;&gt; select m.id id, m.app_name appName, n.version version, from app_info m LEFT JOIN app_version n ON m.id = n.app_id where m.id = #&#123;appId&#125; and n.id = #&#123;versionId&#125; &lt;/select&gt; æŸ¥è¯¢æ¡ä»¶æ˜¯list 123456789101112131415&lt;select id=&quot;queryAppByAppNames&quot; resultMap=&quot;AppMap&quot; parameterType=&quot;java.util.List&quot;&gt; select a.app_name appName, b.version version from starter_info a,starter_version b where a.id = b.app_id and a.id in ( select id from app_info where app_name in &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt; #&#123;item&#125; &lt;/foreach&gt; )&lt;/select&gt; æ›´æ–° ç®€å•çš„æ›´æ–° 1234567&lt;update id="updateApp" parameterType="java.util.List"&gt; UPDATE app_info SET app_name = #&#123;appName&#125; WHERE app_id = #&#123;appId&#125;&lt;/update&gt; æ‰¹é‡æ›´æ–° æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼ŒæŠŠ app_infoè¡¨ä¸­id ä¸º1ï¼Œ2ï¼Œ3çš„appçš„app_nameæ”¹ä¸ºappName1ï¼ŒappName2ï¼ŒappName3; ä½¿ç”¨ case ..when ..then è¿™æ ·çš„è¯­æ³•ç»“æ„æ¥å®Œæˆï¼š case æ˜¯å½“å‰çš„æ¡ä»¶ï¼Œwhenè¡¨ç¤ºæ¡ä»¶å€¼ï¼Œthenåé¢æ˜¯å½“å‰ç›®å‰æ›´æ–°å­—æ®µçš„å€¼ï¼› ä¸‹é¢çš„è¯´æ˜ï¼šå½“å‰id=#{item.appId}æ—¶,app_name=#{item.appName} 1234567891011&lt;update id="updateApps" parameterType="java.util.List"&gt; UPDATE app_info set app_name = &lt;foreach collection="applList" item="item" index="index" separator=" " open="case ID" close="end"&gt; when #&#123;item.appId,jdbcType=INTEGER&#125; then #&#123;item.appName,jdbcType=INTEGER&#125; &lt;/foreach&gt; where id in &lt;foreach collection="appList" index="index" item="item" separator="," open="(" close=")"&gt; #&#123;item.appId,jdbcType=INTEGER&#125; &lt;/foreach&gt;&lt;/update&gt; OKï¼Œç°åœ¨äºè¿™æ ·çš„éœ€è¦ï¼š æ ¹æ®åº”ç”¨ç±»å‹çš„ä¸åŒï¼Œæ›´æ–°ä¸åŒçš„è¿è¡Œç¯å¢ƒé…ç½®ï¼› 123456789101112131415161718192021222324252627282930313233&#123; [ &#123; &quot;appType&quot;:&quot;applet&quot;, &quot;cpu&quot;:5, &quot;memory&quot;:4, &quot;card&quot;:3, &quot;nums&quot;:2, &quot;network&quot;:1, &quot;isInUse&quot;:1 &#125;, &#123; &quot;appType&quot;:&quot;bs&quot;, &quot;cpu&quot;:5, &quot;memory&quot;:4, &quot;card&quot;:3, &quot;nums&quot;:2, &quot;network&quot;:1, &quot;isInUse&quot;:1 &#125;, &#123; &quot;appType&quot;:&quot;cs&quot;, &quot;cpu&quot;:5, &quot;memory&quot;:4, &quot;card&quot;:3, &quot;nums&quot;:2, &quot;network&quot;:1, &quot;isInUse&quot;:1 &#125;, //æœ‰å‡ ä¸ªæ”¾å‡ ä¸ª ]&#125; trimå±æ€§è¯´æ˜ 1.prefix,suffix è¡¨ç¤ºåœ¨trimæ ‡ç­¾åŒ…è£¹çš„éƒ¨åˆ†çš„å‰é¢æˆ–è€…åé¢æ·»åŠ å†…å®¹ 2.å¦‚æœåŒæ—¶æœ‰prefixOverrides,suffixOverrides è¡¨ç¤ºä¼šç”¨prefix,suffixè¦†ç›–Overridesä¸­çš„å†…å®¹ã€‚ 3.å¦‚æœåªæœ‰prefixOverrides,suffixOverrides è¡¨ç¤ºåˆ é™¤å¼€å¤´çš„æˆ–ç»“å°¾çš„xxxOveridesæŒ‡å®šçš„å†…å®¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940&lt;update id=&quot;updateBatchApp&quot; parameterType=&quot;java.util.List&quot;&gt; UPDATE app_info &lt;trim prefix=&quot;set&quot; suffixOverrides=&quot;,&quot;&gt; &lt;trim prefix=&quot;cpu = case&quot; suffix=&quot;end,&quot;&gt; &lt;foreach collection=&quot;modelList&quot; item=&quot;item&quot; index=&quot;index&quot;&gt; &lt;if test=&quot;item != null&quot;&gt; when app_type =#&#123;item.appType&#125; then #&#123;item.cpu&#125; &lt;/if&gt; &lt;/foreach&gt; &lt;/trim&gt; &lt;trim prefix=&quot;memory = case&quot; suffix=&quot;end,&quot;&gt; &lt;foreach collection=&quot;modelList&quot; item=&quot;item&quot; index=&quot;index&quot;&gt; &lt;if test=&quot;item != null&quot;&gt; when app_type =#&#123;item.appType&#125; then #&#123;item.memory&#125; &lt;/if&gt; &lt;/foreach&gt; &lt;/trim&gt; &lt;trim prefix=&quot;card = case&quot; suffix=&quot;end,&quot;&gt; &lt;foreach collection=&quot;modelList&quot; item=&quot;item&quot; index=&quot;index&quot;&gt; when app_type =#&#123;item.appType&#125; then #&#123;item.card&#125; &lt;/foreach&gt; &lt;/trim&gt; &lt;trim prefix=&quot;nums = case&quot; suffix=&quot;end,&quot;&gt; &lt;foreach collection=&quot;modelList&quot; item=&quot;item&quot; index=&quot;index&quot;&gt; when app_type =#&#123;item.appType&#125; then #&#123;item.nums&#125; &lt;/foreach&gt; &lt;/trim&gt; &lt;trim prefix=&quot;network = case&quot; suffix=&quot;end,&quot;&gt; &lt;foreach collection=&quot;modelList&quot; item=&quot;item&quot; index=&quot;index&quot;&gt; when app_type =#&#123;item.appType&#125; then #&#123;item.network&#125; &lt;/foreach&gt; &lt;/trim&gt; &lt;trim prefix=&quot;is_in_use = case&quot; suffix=&quot;end,&quot;&gt; &lt;foreach collection=&quot;modelList&quot; item=&quot;item&quot; index=&quot;index&quot;&gt; when app_type =#&#123;item.appType&#125; then #&#123;item.isInUse&#125; &lt;/foreach&gt; &lt;/trim&gt; &lt;/trim&gt; where app_id = #&#123;appId&#125;&lt;/update&gt; å…³äºæ€§èƒ½é—®é¢˜æ²¡åšç ”ç©¶ï¼Œä¹‹å‰çœ‹è¿‡å…³äºä¸åŒæ›´æ–°è¯­å¥å†™æ³•çš„ä¸€ç¯‡æ€§èƒ½çš„åˆ†æï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹ï¼šæ‰¹é‡æ›´æ–°æ•°æ®ä¸¤ç§æ–¹æ³•æ•ˆç‡å¯¹æ¯” åˆ é™¤ ç®€å•åˆ é™¤ 1DELETE FROM app_info where id = #&#123;id&#125; æ‰¹é‡åˆ é™¤ 123456&lt;delete id=&quot;deleteApps&quot; parameterType=&quot;java.util.List&quot;&gt; DELETE FROM app_info where app_id in &lt;foreach item=&quot;item&quot; collection=&quot;appIds&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt; #&#123;item&#125; &lt;/foreach&gt;&lt;/delete&gt; æ—¶é—´å­—ç¬¦ä¸² order byä¸çŸ¥é“å„ä½æ˜¯å¦é‡åˆ°è¿‡ï¼Œä¹‹å‰çš„å‰è¾ˆä»¬åœ¨é¡¹ç›®ä¸­å°†æ—¶é—´ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼å­˜åœ¨DBä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨DATE,ç„¶åæœ‰ä¸€å¤©ä½ çš„å‰è¾ˆèµ°äº†ï¼Œä½ çš„ä¸»ç®¡è¯´æŸ¥å‡ºæ¥æŒ‰æ—¶é—´æ¥æ’åºâ€¦.ï¼›å‘µå‘µï¼Œå¥½ï¼ï¼ï¼ 1234567&lt;select id=&quot;querySysParamList&quot; resultMap=&quot;sysParamDO&quot;&gt; SELECT * FROM app_info WHERE 1=1 &lt;if test=&quot;keyword != null and keyword != &apos;&apos;&quot; &gt; AND app_name LIKE concat(&apos;%&apos;,#&#123;keyword&#125;,&apos;%&apos;) &lt;/if&gt; ORDER BY DATE_FORMAT(update_time,&apos;%H %k %I %r %T %S %w&apos;) DESC&lt;/select&gt; å­—ç¬¦ä¸²è½¬ä¸ºæ—¥æœŸæ ¼å¼SELECT DATE_FORMAT(â€˜2011-09-20 08:30:45â€™, â€˜%Y-%m-%d %H:%i:%Sâ€™); æŠŠæ—¥æœŸè½¬ä¸ºå­—ç¬¦ä¸²æ ¼å¼SELECT DATE_FORMAT(NOW(), â€˜%Y-%m-%d %H:%i:%Sâ€™); é™„ï¼š 123456789101112131415161718192021222324252627%M æœˆåå­—(Januaryâ€¦â€¦December) %W æ˜ŸæœŸåå­—(Sundayâ€¦â€¦Saturday) %D æœ‰è‹±è¯­å‰ç¼€çš„æœˆä»½çš„æ—¥æœŸ(1st, 2nd, 3rd, ç­‰ç­‰ã€‚ï¼‰ %Y å¹´, æ•°å­—, 4 ä½ %y å¹´, æ•°å­—, 2 ä½ %a ç¼©å†™çš„æ˜ŸæœŸåå­—(Sunâ€¦â€¦Sat) %d æœˆä»½ä¸­çš„å¤©æ•°, æ•°å­—(00â€¦â€¦31) %e æœˆä»½ä¸­çš„å¤©æ•°, æ•°å­—(0â€¦â€¦31) %m æœˆ, æ•°å­—(01â€¦â€¦12) %c æœˆ, æ•°å­—(1â€¦â€¦12) %b ç¼©å†™çš„æœˆä»½åå­—(Janâ€¦â€¦Dec) %j ä¸€å¹´ä¸­çš„å¤©æ•°(001â€¦â€¦366) %H å°æ—¶(00â€¦â€¦23) %k å°æ—¶(0â€¦â€¦23) %h å°æ—¶(01â€¦â€¦12) %I å°æ—¶(01â€¦â€¦12) %l å°æ—¶(1â€¦â€¦12) %i åˆ†é’Ÿ, æ•°å­—(00â€¦â€¦59) %r æ—¶é—´,12 å°æ—¶(hh:mm:ss [AP]M) %T æ—¶é—´,24 å°æ—¶(hh:mm:ss) %S ç§’(00â€¦â€¦59) %s ç§’(00â€¦â€¦59) %p AMæˆ–PM %w ä¸€ä¸ªæ˜ŸæœŸä¸­çš„å¤©æ•°(0=Sunday â€¦â€¦6=Saturday ï¼‰ %U æ˜ŸæœŸ(0â€¦â€¦52), è¿™é‡Œæ˜ŸæœŸå¤©æ˜¯æ˜ŸæœŸçš„ç¬¬ä¸€å¤© %u æ˜ŸæœŸ(0â€¦â€¦52), è¿™é‡Œæ˜ŸæœŸä¸€æ˜¯æ˜ŸæœŸçš„ç¬¬ä¸€å¤© %% ä¸€ä¸ªæ–‡å­—â€œ%â€ã€‚ å…ˆè®°å½•è¿™äº›ï¼Œæœ‰å‘å†è¡¥ï¼ å‚è€ƒï¼šhttp://www.runoob.com/sql/sql-tutorial.html]]></content>
      <categories>
        <category>mybatis</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
        <tag>sql</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nginxåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥å®æˆ˜æ¡ˆä¾‹]]></title>
    <url>%2F2018%2F11%2F10%2Fnginxone%2F</url>
    <content type="text"><![CDATA[æ¬¢è¿å…³æ³¨ï¼šglmapper_2018 å¼•è¨€å…ˆæ¥çœ‹ä¸‹nginxåœ¨webæœåŠ¡å™¨æ’åä¸Šçš„è¶‹åŠ¿ï¼š å­˜åœ¨å³åˆç†ï¼Œé‚£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨nginxå‘¢ï¼Ÿè¿™å¾—çœ‹çœ‹nginxèƒ½å¸®æˆ‘ä»¬åšäº›ä»€ä¹ˆã€‚ é¦–å…ˆï¼Œnginxèƒ½åšåå‘ä»£ç†ã€å…³äºåå‘ä»£ç†å’Œæ­£å‘ä»£ç†æ­¤å¤„ä¸åšè¯´æ˜äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´è‡ªè¡Œè°·æ­Œã€‘ï¼›æ¯”æ–¹è¯´ï¼Œæˆ‘æƒ³åœ¨æœ¬åœ°ä½¿ç”¨ www.glmapper1.com çš„åŸŸåå»è®¿é—®www.taobao.comã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡nginxå»å®ç°ã€‚ å†è€…ï¼Œnginxèƒ½å®ç°è´Ÿè½½å‡è¡¡ï¼Œä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡å‘¢ï¼Ÿå°±æ˜¯è¯´åº”ç”¨éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯é€šè¿‡ç»Ÿä¸€çš„åŸŸåè¿›å…¥ï¼Œnginxåˆ™å¯¹è¯·æ±‚è¿›è¡Œåˆ†å‘ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šå»å¤„ç†ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„å‡è½»äº†å•å°æœåŠ¡å™¨çš„å‹åŠ›ã€‚ åœ¨ä¸Šé¢è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒnginxæœåŠ¡å™¨çš„ä½œç”¨éƒ½åªæ˜¯ä½œä¸ºåˆ†å‘æœåŠ¡å™¨ï¼ŒçœŸæ­£çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾åœ¨å…¶ä»–çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ¥ï¼Œè¿˜èƒ½èµ·åˆ°ä¸€å±‚å®‰å…¨éš”å£çš„ä½œç”¨ï¼Œnginxä½œä¸ºéš”ç¦»å±‚ã€‚ è§£å†³è·¨åŸŸé—®é¢˜ åŒæºï¼šURLç”±åè®®ã€åŸŸåã€ç«¯å£å’Œè·¯å¾„ç»„æˆï¼Œå¦‚æœä¸¤ä¸ªURLçš„åè®®ã€åŸŸåå’Œç«¯å£ç›¸åŒï¼Œåˆ™è¡¨ç¤ºä»–ä»¬åŒæºã€‚ æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼šæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œé™åˆ¶äº†æ¥è‡ªä¸åŒæºçš„â€documentâ€æˆ–è„šæœ¬ï¼Œå¯¹å½“å‰â€documentâ€è¯»å–æˆ–è®¾ç½®æŸäº›å±æ€§ã€‚ä»ä¸€ä¸ªåŸŸä¸ŠåŠ è½½çš„è„šæœ¬ä¸å…è®¸è®¿é—®å¦å¤–ä¸€ä¸ªåŸŸçš„æ–‡æ¡£å±æ€§ã€‚ å› ä¸ºnginxå’Œtomcatä¸èƒ½å…±ç”¨åŒä¸€ç«¯å£,urlä¸€æ ·ï¼Œç«¯å£ä¸åŒï¼Œè¿™æ ·å°±ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚ PSï¼šç‚¹åˆ°ä¸ºæ­¢ï¼Œè¿™é‡Œæœ¬æ¬¡æµ‹è¯•æ²¡æœ‰æ¶‰åŠï¼Œå°±ä¸å¦„è‡ªè²è–„äº†ï¼ï¼! é…ç½®æ–‡ä»¶è§£æé…ç½®æ–‡ä»¶ä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š main(å…¨åŒºè®¾ç½®) server(ä¸»æœºé…ç½®) http(æ§åˆ¶ç€nginx httpå¤„ç†çš„æ‰€æœ‰æ ¸å¿ƒç‰¹æ€§) location(URLåŒ¹é…ç‰¹å®šä½ç½®è®¾ç½®)ã€‚ upstream(è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®) ä¸‹é¢ä»¥é»˜è®¤çš„é…ç½®æ–‡ä»¶æ¥è¯´æ˜ä¸‹å…·ä½“çš„é…ç½®æ–‡ä»¶å±æ€§å«ä¹‰ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151#Nginxçš„workerè¿›ç¨‹è¿è¡Œç”¨æˆ·ä»¥åŠç”¨æˆ·ç»„#user nobody;#Nginxå¼€å¯çš„è¿›ç¨‹æ•°worker_processes 1;#å®šä¹‰å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[debug|info|notice|warn|crit]#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#æŒ‡å®šè¿›ç¨‹IDå­˜å‚¨æ–‡ä»¶ä½ç½®#pid logs/nginx.pid;#äº‹ä»¶é…ç½®events &#123; #use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; #epollæ¨¡å‹æ˜¯Linuxå†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œå¦‚æœåœ¨macä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚ use kqueue; #æ¯ä¸ªè¿›ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§è¿æ¥æ•°ï¼Œç†è®ºä¸Šæ¯å°nginxæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸ºworker_processes*worker_connectionsã€‚ç†è®ºå€¼ï¼šworker_rlimit_nofile/worker_processes worker_connections 1024;&#125;#httpå‚æ•°http &#123; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ include mime.types; #é»˜è®¤æ–‡ä»¶ç±»å‹ default_type application/octet-stream; #æ—¥å¿—ç›¸å…³å®šä¹‰ #log_format main &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos; # &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos; # &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;; #è¿æ¥æ—¥å¿—çš„è·¯å¾„ï¼ŒæŒ‡å®šçš„æ—¥å¿—æ ¼å¼æ”¾åœ¨æœ€åã€‚ #access_log logs/access.log main; #å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼ sendfile on; #é˜²æ­¢ç½‘ç»œé˜»å¡ #tcp_nopush on; #å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ #keepalive_timeout 0; keepalive_timeout 65; #å¼€å¯gzipå‹ç¼©è¾“å‡º #gzip on; #è™šæ‹Ÿä¸»æœºåŸºæœ¬è®¾ç½® server &#123; #ç›‘å¬çš„ç«¯å£å· listen 80; #è®¿é—®åŸŸå server_name localhost; #ç¼–ç æ ¼å¼ï¼Œå¦‚æœç½‘é¡µæ ¼å¼ä¸å½“å‰é…ç½®çš„ä¸åŒçš„è¯å°†ä¼šè¢«è‡ªåŠ¨è½¬ç  #charset koi8-r; #è™šæ‹Ÿä¸»æœºè®¿é—®æ—¥å¿—å®šä¹‰ #access_log logs/host.access.log main; #å¯¹URLè¿›è¡ŒåŒ¹é… location / &#123; #è®¿é—®è·¯å¾„ï¼Œå¯ç›¸å¯¹ä¹Ÿå¯ç»å¯¹è·¯å¾„ root html; #é¦–é¡µæ–‡ä»¶ï¼ŒåŒ¹é…é¡ºåºæŒ‰ç…§é…ç½®é¡ºåºåŒ¹é… index index.html index.htm; &#125; #é”™è¯¯ä¿¡æ¯è¿”å›é¡µé¢ #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; #è®¿é—®URLä»¥.phpç»“å°¾åˆ™è‡ªåŠ¨è½¬äº¤ç»™127.0.0.1 # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \.php$ &#123; # proxy_pass http://127.0.0.1; #&#125; #phpè„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘ç»™FastCGIå¤„ç† # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \.php$ &#123; # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #&#125; #ç¦æ­¢è®¿é—®.hté¡µé¢ # deny access to .htaccess files, if Apache&apos;s document root # concurs with nginx&apos;s one # #location ~ /\.ht &#123; # deny all; #&#125; &#125; #ç¬¬äºŒä¸ªè™šæ‹Ÿä¸»æœºé…ç½® # another virtual host using mix of IP-, name-, and port-based configuration # #server &#123; # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; #HTTPSè™šæ‹Ÿä¸»æœºå®šä¹‰ # HTTPS server # #server &#123; # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; include servers/*;&#125; åå‘ä»£ç†å®ä¾‹å‡è®¾æˆ‘ç°åœ¨éœ€è¦æœ¬åœ°è®¿é—®www.baidu.com;é…ç½®å¦‚ä¸‹ï¼š 1234567891011server &#123; #ç›‘å¬80ç«¯å£ listen 80; server_name localhost; # individual nginx logs for this web vhost access_log /tmp/access.log; error_log /tmp/error.log ; location / &#123; proxy_pass http://www.baidu.com; &#125; éªŒè¯ç»“æœï¼š å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨localhostæ‰“å¼€äº†ç™¾åº¦çš„é¦–é¡µâ€¦ è´Ÿè½½å‡è¡¡å®ä¾‹ä¸‹é¢ä¸»è¦éªŒè¯æœ€å¸¸ç”¨çš„ä¸‰ç§è´Ÿè½½ç­–ç•¥ã€‚è™šæ‹Ÿä¸»æœºé…ç½®ï¼š123456789101112131415161718192021222324server &#123; #ç›‘å¬80ç«¯å£ listen 80; server_name localhost; # individual nginx logs for this web vhost access_log /tmp/access.log; error_log /tmp/error.log ; location / &#123; #è´Ÿè½½å‡è¡¡ #è½®è¯¢ #proxy_pass http://polling_strategy; #weightæƒé‡ #proxy_pass http://weight_strategy; #ip_hash # proxy_pass http://ip_hash_strategy; #fair # proxy_pass http://fair_strategy; #url_hash # proxy_pass http://url_hash_strategy; #é‡å®šå‘ #rewrite ^ http://localhost:8080; &#125; è½®è¯¢ç­–ç•¥123456# 1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰# æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ upstream polling_strategy &#123; server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1 server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2&#125; æµ‹è¯•ç»“æœï¼ˆé€šè¿‡ç«¯å£å·æ¥åŒºåˆ†å½“å‰è®¿é—®ï¼‰ï¼š 12348081ï¼šhello8080ï¼šhello8081ï¼šhello8080ï¼šhello æƒé‡ç­–ç•¥123456#2ã€æŒ‡å®šæƒé‡#æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ upstream weight_strategy &#123; server glmapper.net:8080 weight=1; # åº”ç”¨æœåŠ¡å™¨1 server glmapper.net:8081 weight=9; # åº”ç”¨æœåŠ¡å™¨2&#125; æµ‹è¯•ç»“æœï¼šæ€»è®¿é—®æ¬¡æ•°15æ¬¡ï¼Œæ ¹æ®ä¸Šé¢çš„æƒé‡é…ç½®ï¼Œä¸¤å°æœºå™¨çš„è®¿é—®æ¯”é‡ï¼š2ï¼š13ï¼›æ»¡è¶³é¢„æœŸï¼ ip hashç­–ç•¥123456789#3ã€IPç»‘å®š ip_hash#æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œ#å¯ä»¥è§£å†³sessionçš„é—®é¢˜;åœ¨ä¸è€ƒè™‘å¼•å…¥åˆ†å¸ƒå¼sessionçš„æƒ…å†µä¸‹ï¼Œ#åŸç”ŸHttpSessionåªå¯¹å½“å‰servletå®¹å™¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæœ‰æ•ˆupstream ip_hash_strategy &#123; ip_hash; server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1 server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2&#125; iphash ç®—æ³•:ipæ˜¯åŸºæœ¬çš„ç‚¹åˆ†åè¿›åˆ¶ï¼Œå°†ipçš„å‰ä¸‰ä¸ªç«¯ä½œä¸ºå‚æ•°åŠ å…¥hashå‡½æ•°ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¿è¯ipåœ°å€å‰ä¸‰ä½ç›¸åŒçš„ç”¨æˆ·ç»è¿‡hashè®¡ç®—å°†åˆ†é…åˆ°ç›¸åŒçš„åç«¯serverã€‚ä½œè€…çš„è¿™ä¸ªè€ƒè™‘æ˜¯æä¸ºå¯å–çš„ï¼Œå› æ­¤ipåœ°å€å‰ä¸‰ä½ç›¸åŒé€šå¸¸æ„å‘³ç€æ¥ç€åŒä¸€ä¸ªå±€åŸŸç½‘æˆ–è€…ç›¸é‚»åŒºåŸŸï¼Œä½¿ç”¨ç›¸åŒçš„åç«¯æœåŠ¡è®©nginxåœ¨ä¸€å®šç¨‹åº¦ä¸Šæ›´å…·æœ‰ä¸€è‡´æ€§ã€‚ ä¸ºä»€ä¹ˆè¯´è¦è§£é‡Šä¸‹iphash,å› ä¸ºé‡‡å‘äº†ï¼›å’ŒçŒªå¼Ÿåœ¨è¿›è¡Œè¿™ä¸ªç­–ç•¥æµ‹è¯•æ—¶ä½¿ç”¨äº†5å°æœºå™¨æ¥æµ‹è¯•çš„ï¼Œ5å°æœºå™¨å‡åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€192.168.3.Xã€‘;æµ‹è¯•æ—¶å‘ç°5å°æœºå™¨æ¯æ¬¡éƒ½è·¯ç”±åˆ°äº†åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯é…ç½®é—®é¢˜ï¼Œä½†æ˜¯æ’æŸ¥ä¹‹åä¹Ÿæ’é™¤äº†è¿™ä¸ªå¯èƒ½æ€§ã€‚æœ€åè€ƒè™‘åˆ°å¯èƒ½æ˜¯å¯¹äºåŒç½‘æ®µçš„ipåšäº†ç‰¹æ®Šå¤„ç†ï¼ŒéªŒè¯ä¹‹åç¡®è®¤äº†çŒœæµ‹ã€‚ å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥è¿™é‡Œå› ä¸ºéœ€è¦å®‰è£…ä¸‰æ–¹æ’ä»¶ï¼Œæ—¶é—´æœ‰é™å°±ä¸éªŒè¯äº†ï¼ŒçŸ¥æ‚‰å³å¯ï¼1234567891011121314151617#4ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰#æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ upstream fair_strategy &#123; server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1 server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2 fair; &#125; #5ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰#æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œ#åç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ upstream url_hash_strategy &#123; server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1 server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2 hash $request_uri; hash_method crc32; &#125; é‡å®šå‘rewrite1234location / &#123; #é‡å®šå‘ #rewrite ^ http://localhost:8080;&#125; éªŒè¯æ€è·¯ï¼šæœ¬åœ°ä½¿ç”¨localhost:80ç«¯å£è¿›è¡Œè®¿é—®ï¼Œæ ¹æ®nginxçš„é…ç½®ï¼Œå¦‚æœé‡å®šå‘æ²¡æœ‰ç”Ÿæ•ˆï¼Œåˆ™æœ€åä¼šåœç•™åœ¨å½“å‰localhost:80è¿™ä¸ªè·¯å¾„ï¼Œæµè§ˆå™¨ä¸­çš„åœ°å€æ åœ°å€ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼›å¦‚æœç”Ÿæ•ˆäº†åˆ™åœ°å€æ åœ°å€å˜ä¸ºlocalhost:8080ï¼› é€šè¿‡éªŒè¯ï¼Œæ»¡è¶³é¢„æœŸï¼ æ€»ç»“æœ¬æ–‡å…ˆå¯¹nginxçš„ä½œç”¨å’ŒåŸºæœ¬çš„é…ç½®åšäº†ç®€å•è¯´æ˜ï¼›ç„¶åé€šè¿‡è´Ÿè½½å‡è¡¡çš„å®ä¾‹æµ‹è¯•äº†ä¸åŒè´Ÿè½½å‡è¡¡ç®—æ³•çš„å…·ä½“åº”ç”¨åé¦ˆç»“æœã€‚å¸®åŠ©è‡ªå·±æ›´åŠ æ·±åˆ»çš„ç†è§£nginxæœåŠ¡å™¨ä¸­çš„ä¸€äº›é…ç½®ç»†èŠ‚ã€‚æ„Ÿè°¢åˆ˜ç§˜æä¾›çš„helloworldç¨‹åºã€åŸºäºspringbootçš„è„šæ‰‹æ¶ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è”ç³»ä»–è·å–ï¼›è¿˜æœ‰å°±æ˜¯åˆ˜ç§˜æ˜¯ä¸ªç”·çš„â€¦ğŸ˜œã€‘ å‚è€ƒ http://nginx.org/ https://www.nginx.com/ http://www.sohu.com/a/161411719_324809]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>ä»£ç†æ¨¡å¼</tag>
        <tag>è´Ÿè½½å‡è¡¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èŠä¸€èŠsessionå’Œcookie]]></title>
    <url>%2F2018%2F11%2F10%2Fsessionone%2F</url>
    <content type="text"><![CDATA[æœ¬æ¥æ˜¯æƒ³å†™aopè®¾è®¡æœºåˆ¶çš„ï¼Œä½†æ˜¯æœ€è¿‘è¢«sessionè¿™ä¸ªä¸œè¥¿æå¾—æœ‰ç‚¹å¤´å¤§ï¼Œæ‰€ä»¥å°±æŠ½ç‚¹æ—¶é—´æ¥æ•´ç†ä¸‹å…³äºsessionçš„ä¸€äº›ä¸œè¥¿ã€‚ ç›®å½• ä»httpåè®®çš„æ— çŠ¶æ€æ€§è¯´èµ· æ— è¿æ¥å’Œæ— çŠ¶æ€ æŒä¹…è¿æ¥ httpæ— çŠ¶æ€ å¦‚ä½•ä¿æŒçŠ¶æ€ä¿¡æ¯ Cookie Cookieæœºåˆ¶åŸç† Cookieåœ¨servlet-apiä¸­çš„å®šä¹‰ Cookieå±æ€§ åˆ›å»ºCookie Cookieæ›´æ–° Cookieåˆ é™¤ ä»è¯·æ±‚ä¸­è·å–Cookie CookieåŒæºä¸è·¨åŸŸ Cookieæ•°é‡&amp;å¤§å°é™åˆ¶åŠå¤„ç†ç­–ç•¥ Session sessionæœºåˆ¶åŸç† HttpSession åˆ›å»ºsession ç”Ÿå‘½å‘¨æœŸ sessionçš„æœ‰æ•ˆæœŸ åˆ†å¸ƒå¼sessionä»httpåè®®çš„æ— çŠ¶æ€æ€§è¯´èµ· HTTPæ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ã€‚å…³äºè¿™ä¸ªæ— çŠ¶æ€ä¹‹å‰æˆ‘ä¹Ÿä¸å¤ªç†è§£ï¼Œå› ä¸ºHTTPåº•å±‚æ˜¯TCPï¼Œæ—¢ç„¶æ˜¯TCPï¼Œå°±æ˜¯é•¿è¿æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¿æŒè¿æ¥çŠ¶æ€çš„ï¼Œåˆä¸ºä»€ä¹ˆè¯´httpæ˜¯æ— çŠ¶æ€çš„å‘¢ï¼Ÿå…ˆæ¥ææ¸…æ¥šè¿™ä¸¤ä¸ªæ¦‚å¿µï¼š æ— è¿æ¥å’Œæ— çŠ¶æ€ æ— è¿æ¥ æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å¤„ç†å®Œå®¢æˆ·ç«¯ä¸€æ¬¡è¯·æ±‚ï¼Œç­‰åˆ°å®¢æˆ·ç«¯ä½œå‡ºå›åº”ä¹‹åä¾¿æ–­å¼€è¿æ¥ï¼› æ— çŠ¶æ€ æ˜¯æŒ‡æœåŠ¡ç«¯å¯¹äºå®¢æˆ·ç«¯æ¯æ¬¡å‘é€çš„è¯·æ±‚éƒ½è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œä¸Šä¸€æ¬¡ä¼šè¯å’Œä¸‹ä¸€æ¬¡ä¼šè¯æ²¡æœ‰è”ç³»ï¼› æ— è¿æ¥çš„ç»´åº¦æ˜¯è¿æ¥ï¼Œæ— çŠ¶æ€çš„ç»´åº¦æ˜¯è¯·æ±‚ï¼›httpæ˜¯åŸºäºtcpçš„ï¼Œè€Œä»http1.1å¼€å§‹é»˜è®¤ä½¿ç”¨æŒä¹…è¿æ¥ï¼›åœ¨è¿™ä¸ªè¿æ¥è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘æœåŠ¡ç«¯å‘é€å¤šæ¬¡è¯·æ±‚ï¼Œä½†æ˜¯å„ä¸ªè¯·æ±‚ä¹‹é—´çš„å¹¶æ²¡æœ‰ä»€ä¹ˆè”ç³»ï¼›è¿™æ ·æ¥è€ƒè™‘ï¼Œå°±å¾ˆå¥½ç†è§£æ— çŠ¶æ€è¿™ä¸ªæ¦‚å¿µäº†ã€‚ æŒä¹…è¿æ¥æŒä¹…è¿æ¥ï¼Œæœ¬è´¨ä¸Šæ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡çš„æ—¶å€™ï¼Œå»ºç«‹ä¸€ä¸ªæŒä¹…åŒ–çš„TCPè¿æ¥ï¼Œè¿™ä¸ªè¿æ¥ä¸ä¼šéšç€è¯·æ±‚ç»“æŸè€Œå…³é—­ï¼Œé€šå¸¸ä¼šä¿æŒè¿æ¥ä¸€æ®µæ—¶é—´ã€‚ ç°æœ‰çš„æŒä¹…è¿æ¥ç±»å‹æœ‰ä¸¤ç§ï¼šHTTP/1.0+çš„keep-aliveå’ŒHTTP/1.1çš„persistentã€‚ HTTP/1.0+çš„keep-alive å…ˆæ¥å¼€ä¸€å¼ å›¾ï¼š è¿™å¼ å›¾æ˜¯è¯·æ±‚www.baidu.comæ—¶çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚è¿™é‡Œé¢æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼š 1connection: keep-alive æˆ‘ä»¬æ¯æ¬¡å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œä¼šé™„å¸¦ä¸€ä¸ªconnection:keep-aliveï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å£°æ˜ä¸€ä¸ªæŒä¹…è¿æ¥ã€‚ HTTP/1.1çš„persistent HTTP/1.1çš„æŒä¹…è¿æ¥é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œåªæœ‰é¦–éƒ¨ä¸­åŒ…å«connectionï¼šcloseï¼Œæ‰ä¼šäº‹åŠ¡ç»“æŸä¹‹åå…³é—­è¿æ¥ã€‚å½“ç„¶æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä»å¯ä»¥éšæ—¶å…³é—­æŒä¹…è¿æ¥ã€‚ å½“å‘é€äº†connectionï¼šcloseé¦–éƒ¨ä¹‹åå®¢æˆ·ç«¯å°±æ²¡æœ‰åŠæ³•åœ¨é‚£æ¡è¿æ¥ä¸Šå‘é€æ›´å¤šçš„è¯·æ±‚äº†ã€‚å½“ç„¶æ ¹æ®æŒä¹…è¿æ¥çš„ç‰¹æ€§ï¼Œä¸€å®šè¦ä¼ è¾“æ­£ç¡®çš„content-lengthã€‚ è¿˜æœ‰æ ¹æ®HTTP/1.1çš„ç‰¹æ€§ï¼Œæ˜¯ä¸åº”è¯¥å’ŒHTTP/1.0å®¢æˆ·ç«¯å»ºç«‹æŒä¹…è¿æ¥çš„ã€‚æœ€åï¼Œä¸€å®šè¦åšå¥½é‡å‘çš„å‡†å¤‡ã€‚ httpæ— çŠ¶æ€OKï¼Œé¦–å…ˆæ¥æ˜ç¡®ä¸‹ï¼Œè¿™ä¸ªçŠ¶æ€çš„ä¸»ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿåº”è¯¥æ˜¯ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ç”±æœåŠ¡ç«¯æ‰€ç»´æŠ¤çš„ä¸å®¢æˆ·ç«¯äº¤äº’çš„ä¿¡æ¯ï¼ˆä¹Ÿç§°ä¸ºçŠ¶æ€ä¿¡æ¯ï¼‰ï¼›å› ä¸ºHTTPæœ¬èº«æ˜¯ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯çš„ï¼Œæ‰€ä»¥HTTPæ˜¯æ— çŠ¶æ€çš„åè®®ã€‚ å¦‚ä½•ä¿æŒçŠ¶æ€ä¿¡æ¯åœ¨èŠè¿™ä¸ªè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥è€ƒè™‘ä¸‹ä¸ºä»€ä¹ˆhttpè‡ªå·±ä¸æ¥åšè¿™ä¸ªäº‹æƒ…ï¼šä¹Ÿå°±æ˜¯è®©httpå˜æˆæœ‰çŠ¶æ€çš„ã€‚ httpæœ¬èº«æ¥å®ç°çŠ¶æ€ç»´æŠ¤ ä»ä¸Šé¢å…³äºæ— çŠ¶æ€çš„ç†è§£ï¼Œå¦‚æœç°åœ¨éœ€è¦è®©httpè‡ªå·±å˜æˆæœ‰çŠ¶æ€çš„ï¼Œå°±æ„å‘³ç€httpåè®®éœ€è¦ä¿å­˜äº¤äº’çš„çŠ¶æ€ä¿¡æ¯ï¼›æš‚ä¸”ä¸è¯´è¿™ç§æ–¹å¼æ˜¯å¦åˆé€‚ï¼Œä½†ä»ç»´æŠ¤çŠ¶æ€ä¿¡æ¯è¿™ä¸€ç‚¹æ¥è¯´ï¼Œä»£ä»·å°±å¾ˆé«˜ï¼Œå› ä¸ºæ—¢ç„¶ä¿å­˜äº†çŠ¶æ€ä¿¡æ¯ï¼Œé‚£åç»­çš„ä¸€äº›è¡Œä¸ºå¿…å®šä¹Ÿä¼šå—åˆ°çŠ¶æ€ä¿¡æ¯çš„å½±å“ã€‚ ä»å†å²è§’åº¦æ¥è¯´ï¼Œæœ€åˆçš„httpåè®®åªæ˜¯ç”¨æ¥æµè§ˆé™æ€æ–‡ä»¶çš„ï¼Œæ— çŠ¶æ€åè®®å·²ç»è¶³å¤Ÿï¼Œè¿™æ ·å®ç°çš„è´Ÿæ‹…ä¹Ÿå¾ˆè½»ã€‚ä½†æ˜¯éšç€webæŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„åœºæ™¯éœ€è¦çŠ¶æ€ä¿¡æ¯èƒ½å¤Ÿå¾—ä»¥ä¿å­˜ï¼›ä¸€æ–¹é¢æ˜¯httpæœ¬èº«ä¸ä¼šå»æ”¹å˜å®ƒçš„è¿™ç§æ— çŠ¶æ€çš„ç‰¹æ€§ï¼ˆè‡³å°‘ç›®å‰æ˜¯è¿™æ ·çš„ï¼‰ï¼Œå¦ä¸€æ–¹é¢ä¸šåŠ¡åœºæ™¯åˆè¿«åˆ‡çš„éœ€è¦ä¿æŒçŠ¶æ€ï¼›é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ¥â€œè£…é¥°â€ä¸€ä¸‹httpï¼Œå¼•å…¥ä¸€äº›å…¶ä»–æœºåˆ¶æ¥å®ç°æœ‰çŠ¶æ€ã€‚ cookieå’Œsessionä½“ç³» é€šè¿‡å¼•å…¥cookieå’Œsessionä½“ç³»æœºåˆ¶æ¥ç»´æŠ¤çŠ¶æ€ä¿¡æ¯ã€‚å³ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å“åº”æŠ¥å¤´é€šå¸¸ä¼šå‡ºç°ä¸€ä¸ªSet-Cookieå“åº”å¤´ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åœ¨æœ¬åœ°è®¾ç½®ä¸€ä¸ªcookieï¼Œå½“ç”¨æˆ·å†æ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œhttpä¼šé™„å¸¦è¿™ä¸ªcookieè¿‡å»ï¼Œcookieä¸­å­˜æœ‰sessionIdè¿™æ ·çš„ä¿¡æ¯æ¥åˆ°æœåŠ¡å™¨è¿™è¾¹ç¡®è®¤æ˜¯å¦å±äºåŒä¸€æ¬¡ä¼šè¯ã€‚ Cookie cookieæ˜¯ç”±æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„å°é‡ä¿¡æ¯ï¼Œä»¥{keyï¼švalue}çš„å½¢å¼å­˜åœ¨ã€‚ Cookieæœºåˆ¶åŸç† å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦è®°å½•è¯¥ç”¨æˆ·çŠ¶æ€ï¼Œå°±ä½¿ç”¨responseå‘å®¢æˆ·ç«¯æµè§ˆå™¨é¢å‘ä¸€ä¸ªCookieã€‚è€Œå®¢æˆ·ç«¯æµè§ˆå™¨ä¼šæŠŠCookieä¿å­˜èµ·æ¥ã€‚å½“æµè§ˆå™¨å†è¯·æ±‚ æœåŠ¡å™¨æ—¶ï¼Œæµè§ˆå™¨æŠŠè¯·æ±‚çš„ç½‘å€è¿åŒè¯¥Cookieä¸€åŒæäº¤ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨é€šè¿‡æ£€æŸ¥è¯¥Cookieæ¥è·å–ç”¨æˆ·çŠ¶æ€ã€‚ æˆ‘ä»¬é€šè¿‡çœ‹ä¸‹servlet-apiä¸­Cookieç±»çš„å®šä¹‰åŠå±æ€§ï¼Œæ¥æ›´åŠ å…·ä½“çš„äº†è§£Cookieã€‚ Cookieåœ¨servlet-apiä¸­çš„å®šä¹‰123456789101112131415161718public class Cookie implements Cloneable, Serializable &#123; private static final long serialVersionUID = -6454587001725327448L; private static final String TSPECIALS; private static final String LSTRING_FILE = "javax.servlet.http.LocalStrings"; private static ResourceBundle lStrings = ResourceBundle.getBundle("javax.servlet.http.LocalStrings"); private String name; private String value; private String comment; private String domain; private int maxAge = -1; private String path; private boolean secure; private int version = 0; private boolean isHttpOnly = false; //....çœç•¥å…¶ä»–æ–¹æ³•&#125; Cookieå±æ€§ name cookieçš„åå­—ï¼ŒCookieä¸€æ—¦åˆ›å»ºï¼Œåç§°ä¾¿ä¸å¯æ›´æ”¹ value cookieå€¼ comment è¯¥Cookieçš„ç”¨å¤„è¯´æ˜ã€‚æµè§ˆå™¨æ˜¾ç¤ºCookieä¿¡æ¯çš„æ—¶å€™æ˜¾ç¤ºè¯¥è¯´æ˜ domain å¯ä»¥è®¿é—®è¯¥Cookieçš„åŸŸåã€‚å¦‚æœè®¾ç½®ä¸ºâ€œ.baidu.comâ€ï¼Œåˆ™æ‰€æœ‰ä»¥â€œbaidu.comâ€ç»“å°¾çš„åŸŸåéƒ½å¯ä»¥è®¿é—®è¯¥Cookieï¼›ç¬¬ä¸€ä¸ªå­—ç¬¦å¿…é¡»ä¸ºâ€œ.â€ maxAge Cookieå¤±æ•ˆçš„æ—¶é—´ï¼Œå•ä½ç§’ã€‚ æ­£æ•°ï¼Œåˆ™è¶…è¿‡maxAgeç§’ä¹‹åå¤±æ•ˆã€‚ è´Ÿæ•°ï¼Œè¯¥Cookieä¸ºä¸´æ—¶Cookieï¼Œå…³é—­æµè§ˆå™¨å³å¤±æ•ˆï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šä»¥ä»»ä½•å½¢å¼ä¿å­˜è¯¥Cookieã€‚ ä¸º0ï¼Œè¡¨ç¤ºåˆ é™¤è¯¥Cookieã€‚ path è¯¥Cookieçš„ä½¿ç”¨è·¯å¾„ã€‚ä¾‹å¦‚ï¼š path=/ï¼Œè¯´æ˜æœ¬åŸŸåä¸‹contextPathéƒ½å¯ä»¥è®¿é—®è¯¥Cookieã€‚ path=/app/ï¼Œåˆ™åªæœ‰contextPathä¸ºâ€œ/appâ€çš„ç¨‹åºå¯ä»¥è®¿é—®è¯¥Cookie pathè®¾ç½®æ—¶ï¼Œå…¶ä»¥â€œ/â€ç»“å°¾. secure è¯¥Cookieæ˜¯å¦ä»…è¢«ä½¿ç”¨å®‰å…¨åè®®ä¼ è¾“ã€‚è¿™é‡Œçš„å®‰å…¨åè®®åŒ…æ‹¬HTTPSï¼ŒSSLç­‰ã€‚é»˜è®¤ä¸ºfalseã€‚ version è¯¥Cookieä½¿ç”¨çš„ç‰ˆæœ¬å·ã€‚ 0 è¡¨ç¤ºéµå¾ªNetscapeçš„Cookieè§„èŒƒï¼Œç›®å‰å¤§å¤šæ•°ç”¨çš„éƒ½æ˜¯è¿™ç§è§„èŒƒï¼› 1 è¡¨ç¤ºéµå¾ªW3Cçš„RFC2109è§„èŒƒï¼›è§„èŒƒè¿‡äºä¸¥æ ¼ï¼Œå®æ–½èµ·æ¥å¾ˆéš¾ã€‚ åœ¨servletè§„èŒƒä¸­é»˜è®¤æ˜¯0ï¼› isHttpOnly HttpOnlyå±æ€§æ˜¯ç”¨æ¥é™åˆ¶éHTTPåè®®ç¨‹åºæ¥å£å¯¹å®¢æˆ·ç«¯Cookieè¿›è¡Œè®¿é—®ï¼›ä¹Ÿå°±æ˜¯è¯´å¦‚æœæƒ³è¦åœ¨å®¢æˆ·ç«¯å–åˆ°httponlyçš„Cookieçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯ä½¿ç”¨AJAXï¼Œå°†å–Cookieçš„æ“ä½œæ”¾åˆ°æœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„ajaxè¯·æ±‚åå°†å–å€¼ç»“æœé€šè¿‡HTTPè¿”å›å®¢æˆ·ç«¯ã€‚è¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»ã€‚ ä¸Šè¿°çš„è¿™äº›å±æ€§ï¼Œé™¤äº†nameä¸valueå±æ€§ä¼šè¢«æäº¤å¤–ï¼Œå…¶ä»–çš„å±æ€§å¯¹äºå®¢æˆ·ç«¯æ¥è¯´éƒ½æ˜¯ä¸å¯è¯»çš„ï¼Œä¹Ÿæ˜¯ä¸å¯è¢«æäº¤çš„ã€‚ åˆ›å»ºCookie12345Cookie cookie = new Cookie("cookieSessionId","qwertyuiop");cookie.setDomain(".baidu.com"); // è®¾ç½®åŸŸåcookie.setPath("/"); // è®¾ç½®è·¯å¾„cookie.setMaxAge(Integer.MAX_VALUE); // è®¾ç½®æœ‰æ•ˆæœŸä¸ºæ°¸ä¹…response.addCookie(cookie); // å›å†™åˆ°å®¢æˆ·ç«¯ åˆ›å»ºCookieåªèƒ½é€šè¿‡ä¸Šè¿°æ–¹å¼æ¥åˆ›å»ºï¼Œå› ä¸ºåœ¨Cookieç±»ä¸­åªæä¾›äº†è¿™æ ·ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚ 123456789101112131415161718192021222324252627//Cookieçš„æ„é€ å‡½æ•°public Cookie(String name, String value) &#123; if (name != null &amp;&amp; name.length() != 0) &#123; //åˆ¤æ–­ä¸‹æ˜¯ä¸æ˜¯token //åˆ¤æ–­æ˜¯ä¸æ˜¯å’ŒCookieçš„å±æ€§å­—æ®µé‡å¤ if (this.isToken(name) &amp;&amp; !name.equalsIgnoreCase("Comment") &amp;&amp; !name.equalsIgnoreCase("Discard") &amp;&amp; !name.equalsIgnoreCase("Domain") &amp;&amp; !name.equalsIgnoreCase("Expires") &amp;&amp; !name.equalsIgnoreCase("Max-Age") &amp;&amp; !name.equalsIgnoreCase("Path") &amp;&amp; !name.equalsIgnoreCase("Secure") &amp;&amp; !name.equalsIgnoreCase("Version") &amp;&amp; !name.startsWith("$")) &#123; this.name = name; this.value = value; &#125; else &#123; String errMsg = lStrings.getString("err.cookie_name_is_token"); Object[] errArgs = new Object[]&#123;name&#125;; errMsg = MessageFormat.format(errMsg, errArgs); throw new IllegalArgumentException(errMsg); &#125; &#125; else &#123; throw new IllegalArgumentException(lStrings.getString ("err.cookie_name_blank")); &#125;&#125; Cookieæ›´æ–°åœ¨æºç ä¸­å¯ä»¥çŸ¥é“ï¼ŒCookieæœ¬èº«å¹¶æ²¡æœ‰æä¾›ä¿®æ”¹çš„æ–¹æ³•ï¼›åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸€èˆ¬é€šè¿‡ä½¿ç”¨ç›¸åŒnameçš„Cookieæ¥è¦†ç›–åŸæ¥çš„Cookie,ä»¥è¾¾åˆ°æ›´æ–°çš„ç›®çš„ã€‚ ä½†æ˜¯è¿™ä¸ªä¿®æ”¹çš„å‰ææ˜¯éœ€è¦å…·æœ‰ç›¸åŒdomainï¼Œpathçš„ Set-Cookie æ¶ˆæ¯å¤´ 12Cookie cookie = new Cookie("cookieSessionId","new-qwertyuiop");response.addCookie(cookie); Cookieåˆ é™¤ä¸Cookieæ›´æ–°ä¸€æ ·ï¼ŒCookieæœ¬èº«ä¹Ÿæ²¡æœ‰æä¾›åˆ é™¤çš„æ–¹æ³•ï¼›ä½†æ˜¯ä»å‰é¢åˆ†æCookieå±æ€§æ—¶äº†è§£åˆ°ï¼Œåˆ é™¤Cookieå¯ä»¥é€šè¿‡å°†maxAgeè®¾ç½®ä¸º0å³å¯ã€‚ 123Cookie cookie = new Cookie("cookieSessionId","new-qwertyuiop");cookie.setMaxAge(0);response.addCookie(cookie); ä¸Šé¢çš„åˆ é™¤æ˜¯æˆ‘ä»¬è‡ªå·±å¯æ§çš„ï¼›ä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›æˆ‘ä»¬ä¸å¯æ§æˆ–è€…è¯´æ— æ„è¯†æƒ…å†µä¸‹çš„åˆ é™¤æ“ä½œï¼š å¦‚æœmaxAgeæ˜¯è´Ÿå€¼ï¼Œåˆ™cookieåœ¨æµè§ˆå™¨å…³é—­æ—¶è¢«åˆ é™¤ æŒä¹…åŒ–cookieåœ¨åˆ°è¾¾å¤±æ•ˆæ—¥æœŸæ—¶ä¼šè¢«åˆ é™¤ æµè§ˆå™¨ä¸­çš„ cookie æ•°é‡è¾¾åˆ°ä¸Šé™ï¼Œé‚£ä¹ˆ cookie ä¼šè¢«åˆ é™¤ä»¥ä¸ºæ–°å»ºçš„ cookie åˆ›å»ºç©ºé—´ã€‚ å…¶å®å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…³æ³¨çš„éƒ½æ˜¯åè€…ã€‚å…³äºæ•°é‡ä¸Šé™åé¢ä¼šè¯´åˆ°ã€‚ ä»è¯·æ±‚ä¸­è·å–Cookie1Cookie[] cookies = request.getCookies(); CookieåŒæºä¸è·¨åŸŸæˆ‘ä»¬çŸ¥é“æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼š URLç”±åè®®ã€åŸŸåã€ç«¯å£å’Œè·¯å¾„ç»„æˆï¼Œå¦‚æœä¸¤ä¸ªURLçš„åè®®ã€åŸŸåå’Œç«¯å£ç›¸åŒï¼Œåˆ™è¡¨ç¤ºä»–ä»¬åŒæºã€‚æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œé™åˆ¶äº†æ¥è‡ªä¸åŒæºçš„â€documentâ€æˆ–è„šæœ¬ï¼Œå¯¹å½“å‰â€documentâ€è¯»å–æˆ–è®¾ç½®æŸäº›å±æ€§ã€‚ å¯¹äºCookieæ¥è¯´ï¼ŒCookieçš„åŒæºåªå…³æ³¨åŸŸåï¼Œæ˜¯å¿½ç•¥åè®®å’Œç«¯å£çš„ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œhttps://localhost:80/å’Œhttp://localhost:8080/çš„Cookieæ˜¯å…±äº«çš„ã€‚ Cookieæ˜¯ä¸å¯è·¨åŸŸçš„ï¼›åœ¨æ²¡æœ‰ç»è¿‡ä»»ä½•å¤„ç†çš„æƒ…å†µä¸‹ï¼ŒäºŒçº§åŸŸåä¸åŒä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚(wenku.baidu.comå’Œbaike.baidu.com)ã€‚ Cookieæ•°é‡&amp;å¤§å°é™åˆ¶åŠå¤„ç†ç­–ç•¥ IE6.0 IE7.0/8.0 Opera FF Safari Chrome ä¸ªæ•°/ä¸ª 20/åŸŸ 50/åŸŸ 30/åŸŸ 50/åŸŸ æ— é™åˆ¶ 53/åŸŸ å¤§å°/Byte 4095 4095 4096 4097 4097 4097 æ³¨ï¼šæ•°æ®æ¥è‡ªç½‘ç»œï¼Œä»…ä¾›å‚è€ƒ å› ä¸ºæµè§ˆå™¨å¯¹äºCookieåœ¨æ•°é‡ä¸Šæ˜¯æœ‰é™åˆ¶çš„ï¼Œå¦‚æœè¶…è¿‡äº†è‡ªç„¶ä¼šæœ‰ä¸€äº›å‰”é™¤ç­–ç•¥ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­Browser cookie restrictionsæåˆ°çš„å‰”é™¤ç­–ç•¥å¦‚ä¸‹ï¼š The least recently used (LRU) approach automatically kicks out the oldest cookie when the cookie limit has been reached in order to allow the newest cookie some space. Internet Explorer and Opera use this approach. æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰æ–¹æ³•ï¼šåœ¨è¾¾åˆ°cookieé™åˆ¶æ—¶è‡ªåŠ¨åœ°å‰”é™¤æœ€è€çš„cookieï¼Œä»¥ä¾¿è…¾å‡ºç©ºé—´ç»™è®¸æœ€æ–°çš„cookieã€‚Internet Explorerå’ŒOperaä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚ Firefox does something strange: it seems to randomly decide which cookies to keep although the last cookie set is always kept. There doesnâ€™t seem to be any scheme itâ€™s following at all. The takeaway? Donâ€™t go above the cookie limit in Firefox. Firefoxå†³å®šéšæœºåˆ é™¤Cookieé›†ä¸­çš„ä¸€ä¸ªCookieï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç« æ³•ã€‚æ‰€ä»¥æœ€å¥½ä¸è¦è¶…è¿‡Firefoxä¸­çš„Cookieé™åˆ¶ã€‚ è¶…è¿‡å¤§å°é•¿åº¦çš„è¯å°±æ˜¯ç›´æ¥è¢«æˆªå–ä¸¢å¼ƒï¼› SessionCookieæœºåˆ¶å¼¥è¡¥äº†HTTPåè®®æ— çŠ¶æ€çš„ä¸è¶³ã€‚åœ¨Sessionå‡ºç°ä¹‹å‰ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„ç½‘ç«™éƒ½é‡‡ç”¨Cookieæ¥è·Ÿè¸ªä¼šè¯ã€‚ ä¸Cookieä¸åŒçš„æ˜¯ï¼Œsessionæ˜¯ä»¥æœåŠ¡ç«¯ä¿å­˜çŠ¶æ€çš„ã€‚ sessionæœºåˆ¶åŸç†å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ›å»ºä¸€ä¸ªsessionçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šå…ˆæ£€æŸ¥è¿™ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚é‡Œæ˜¯å¦å·²åŒ…å«äº†ä¸€ä¸ªsessionæ ‡è¯† - sessionIdï¼Œ å¦‚æœå·²åŒ…å«è¿™ä¸ªsessionIdï¼Œåˆ™è¯´æ˜ä»¥å‰å·²ç»ä¸ºæ­¤å®¢æˆ·ç«¯åˆ›å»ºè¿‡sessionï¼ŒæœåŠ¡å™¨å°±æŒ‰ç…§sessionIdæŠŠè¿™ä¸ªsessionæ£€ç´¢å‡ºæ¥ä½¿ç”¨ï¼ˆå¦‚æœæ£€ç´¢ä¸åˆ°ï¼Œå¯èƒ½ä¼šæ–°å»ºä¸€ä¸ªï¼‰ å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ä¸åŒ…å«sessionIdï¼Œåˆ™ä¸ºæ­¤å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªsessionå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªä¸æ­¤sessionç›¸å…³è”çš„sessionId sessionIdçš„å€¼ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ—¢ä¸ä¼šé‡å¤ï¼Œåˆä¸å®¹æ˜“è¢«ä»¿é€ çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªsessionIdå°†è¢«åœ¨æœ¬æ¬¡å“åº”ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ä¿å­˜ã€‚ä¿å­˜sessionIdçš„æ–¹å¼å¤§å¤šæƒ…å†µä¸‹ç”¨çš„æ˜¯cookieã€‚ HttpSessionHttpSessionå’ŒCookieä¸€æ ·ï¼Œéƒ½æ˜¯javax.servlet.httpä¸‹é¢çš„ï¼›Cookieæ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒæè¿°äº†Cookieçš„å¾ˆå¤šå†…éƒ¨ç»†èŠ‚ã€‚è€ŒHttpSessionæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒä¸ºsessionçš„å®ç°æä¾›äº†ä¸€äº›è¡Œä¸ºçº¦æŸã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public interface HttpSession &#123; /** * è¿”å›sessionçš„åˆ›å»ºæ—¶é—´ */ public long getCreationTime(); /** * è¿”å›ä¸€ä¸ªsessionId,å”¯ä¸€æ ‡è¯† */ public String getId(); /** *è¿”å›å®¢æˆ·ç«¯æœ€åä¸€æ¬¡å‘é€ä¸è¯¥ session ä¼šè¯ç›¸å…³çš„è¯·æ±‚çš„æ—¶é—´ *è‡ªæ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ 1970 å¹´ 1 æœˆ 1 æ—¥åˆå¤œç®—èµ·ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ */ public long getLastAccessedTime(); /** * è¿”å›å½“å‰sessionæ‰€åœ¨çš„ServletContext */ public ServletContext getServletContext(); public void setMaxInactiveInterval(int interval); /** * è¿”å› Servlet å®¹å™¨åœ¨å®¢æˆ·ç«¯è®¿é—®æ—¶ä¿æŒ session * ä¼šè¯æ‰“å¼€çš„æœ€å¤§æ—¶é—´é—´éš” */ public int getMaxInactiveInterval(); public HttpSessionContext getSessionContext(); /** * è¿”å›åœ¨è¯¥ sessionä¼šè¯ä¸­å…·æœ‰æŒ‡å®šåç§°çš„å¯¹è±¡ï¼Œ * å¦‚æœæ²¡æœ‰æŒ‡å®šåç§°çš„å¯¹è±¡ï¼Œåˆ™è¿”å› nullã€‚ */ public Object getAttribute(String name); public Object getValue(String name); /** * è¿”å› String å¯¹è±¡çš„æšä¸¾ï¼ŒString å¯¹è±¡åŒ…å«æ‰€æœ‰ç»‘å®šåˆ°è¯¥ session * ä¼šè¯çš„å¯¹è±¡çš„åç§°ã€‚ */ public Enumeration&lt;String&gt; getAttributeNames(); public String[] getValueNames(); public void setAttribute(String name, Object value); public void putValue(String name, Object value); public void removeAttribute(String name); public void removeValue(String name); /** * æŒ‡ç¤ºè¯¥ session ä¼šè¯æ— æ•ˆï¼Œå¹¶è§£é™¤ç»‘å®šåˆ°å®ƒä¸Šé¢çš„ä»»ä½•å¯¹è±¡ã€‚ */ public void invalidate(); /** * å¦‚æœå®¢æˆ·ç«¯ä¸çŸ¥é“è¯¥ session ä¼šè¯ï¼Œæˆ–è€…å¦‚æœå®¢æˆ·é€‰æ‹©ä¸å‚å…¥è¯¥ * session ä¼šè¯ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å› trueã€‚ */ public boolean isNew();&#125; åˆ›å»ºsessionåˆ›å»ºsessionçš„æ–¹å¼æ˜¯é€šè¿‡requestæ¥åˆ›å»ºï¼›1234// 1ã€åˆ›å»ºSessionå¯¹è±¡HttpSession session = request.getSession(); // 2ã€åˆ›å»ºSessionå¯¹è±¡HttpSession session = request.getSession(true); è¿™ä¸¤ç§æ˜¯ä¸€æ ·çš„ï¼›å¦‚æœsessionä¸å­˜åœ¨ï¼Œå°±æ–°å»ºä¸€ä¸ªï¼›å¦‚æœæ˜¯falseçš„è¯ï¼Œæ ‡è¯†å¦‚æœä¸å­˜åœ¨å°±è¿”å›nullï¼› ç”Ÿå‘½å‘¨æœŸsessionçš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯ä»Servletå®¹å™¨åˆ›å»ºsessionå¯¹è±¡åˆ°é”€æ¯çš„è¿‡ç¨‹ã€‚Servletå®¹å™¨ä¼šä¾æ®sessionå¯¹è±¡è®¾ç½®çš„å­˜æ´»æ—¶é—´ï¼Œåœ¨è¾¾åˆ°sessionæ—¶é—´åå°†sessionå¯¹è±¡é”€æ¯ã€‚sessionç”Ÿæˆåï¼Œåªè¦ç”¨æˆ·ç»§ç»­è®¿é—®ï¼ŒæœåŠ¡å™¨å°±ä¼šæ›´æ–°sessionçš„æœ€åè®¿é—®æ—¶é—´ï¼Œå¹¶ç»´æŠ¤è¯¥sessionã€‚ ä¹‹å‰åœ¨å•è¿›ç¨‹åº”ç”¨ä¸­ï¼Œsessionæˆ‘ä¸€èˆ¬æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œä¸ä¼šåšæŒä¹…åŒ–æ“ä½œæˆ–è€…è¯´ä½¿ç”¨ä¸‰æ–¹çš„æœåŠ¡æ¥å­˜sessionä¿¡æ¯ï¼Œå¦‚redisã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œè¿™ç§å­˜åœ¨æœ¬æœºå†…å­˜ä¸­çš„æ–¹å¼æ˜¾ç„¶æ˜¯ä¸é€‚ç”¨çš„ï¼Œå› ä¸ºsessionæ— æ³•å…±äº«ã€‚è¿™ä¸ªåé¢è¯´ã€‚ sessionçš„æœ‰æ•ˆæœŸsessionä¸€èˆ¬åœ¨å†…å­˜ä¸­å­˜æ”¾ï¼Œå†…å­˜ç©ºé—´æœ¬èº«å¤§å°å°±æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå› æ­¤sessionéœ€è¦é‡‡ç”¨ä¸€ç§è¿‡æœŸåˆ é™¤çš„æœºåˆ¶æ¥ç¡®ä¿sessionä¿¡æ¯ä¸ä¼šä¸€ç›´ç´¯ç§¯ï¼Œæ¥é˜²æ­¢å†…å­˜æº¢å‡ºçš„å‘ç”Ÿã€‚ sessionçš„è¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡maxInactiveIntervalå±æ€§æ¥è®¾ç½®ã€‚ å¦‚æœæˆ‘ä»¬æƒ³è®©sessionå¤±æ•ˆçš„è¯ï¼Œä¹Ÿå¯ä»¥å½“é€šè¿‡è°ƒç”¨sessionçš„invalidate()æ¥å®Œæˆã€‚ åˆ†å¸ƒå¼sessioné¦–å…ˆæ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„æ¦‚å¿µå‡ºç°ï¼Ÿ å…ˆè€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œç°åœ¨æˆ‘çš„åº”ç”¨éœ€è¦éƒ¨ç½²åœ¨3å°æœºå™¨ä¸Šã€‚æ˜¯ä¸æ˜¯å‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ç¬¬ä¸€æ¬¡ç™»é™†ï¼Œè¯·æ±‚å»äº†æœºå™¨1ï¼Œç„¶åå†æœºå™¨1ä¸Šåˆ›å»ºäº†ä¸€ä¸ªsessionï¼›ä½†æ˜¯æˆ‘ç¬¬äºŒæ¬¡è®¿é—®æ—¶ï¼Œè¯·æ±‚è¢«è·¯ç”±åˆ°æœºå™¨2äº†ï¼Œä½†æ˜¯æœºå™¨2ä¸Šå¹¶æ²¡æœ‰æˆ‘çš„sessionä¿¡æ¯ï¼Œæ‰€ä»¥å¾—é‡æ–°ç™»å½•ã€‚å½“ç„¶è¿™ç§å¯ä»¥é€šè¿‡nginxçš„IP HASHè´Ÿè½½ç­–ç•¥æ¥è§£å†³ã€‚å¯¹äºåŒä¸€ä¸ªIPè¯·æ±‚éƒ½ä¼šå»åŒä¸€ä¸ªæœºå™¨ã€‚ ä½†æ˜¯ä¸šåŠ¡å‘å±•çš„è¶Šæ¥è¶Šå¤§ï¼Œæ‹†åˆ†çš„è¶Šæ¥è¶Šå¤šï¼Œæœºå™¨æ•°ä¸æ–­å¢åŠ ï¼›å¾ˆæ˜¾ç„¶é‚£ç§æ–¹æ¡ˆå°±ä¸è¡Œäº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦è€ƒè™‘æ˜¯ä¸æ˜¯åº”è¯¥å°†sessionä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æœºå™¨ä¸Šï¼Œæ‰€ä»¥åˆ†å¸ƒå¼sessionè¦è§£å†³çš„é—®é¢˜å…¶å®å°±æ˜¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„sessionå…±äº«çš„é—®é¢˜ã€‚ ä¸Šå›¾ä¸­çš„å…³äºsessionç‹¬ç«‹éƒ¨ç½²çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç¼“å­˜æœåŠ¡(redisï¼Œç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œå³ä½¿ç”¨Redisæ¥ä½œä¸ºsessionç¼“å­˜æœåŠ¡å™¨)ã€‚ å‚è€ƒ https://www.cnblogs.com/icelin/p/3974935.html https://www.nczonline.net/blog/2008/05/17/browser-cookie-restrictions/ https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE]]></content>
      <categories>
        <category>session</category>
      </categories>
      <tags>
        <tag>èŠä¸€èŠ</tag>
        <tag>session</tag>
        <tag>cookie</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èŠä¸€èŠ AOPï¼šAdvice æºç è§£æ]]></title>
    <url>%2F2018%2F11%2F10%2Fspringaoptwo%2F</url>
    <content type="text"><![CDATA[åœ¨ç¬¬ä¸€ç¯‡ä¸­çš„ä¾‹å­å’Œæ¦‚å¿µä»‹ç»ä¸­æˆ‘ä»¬å¯¹ Advice æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤çŸ¥ã€‚åœ¨Spring AOPä¸­ï¼ŒAdviceçš„ä½œç”¨å°±æ˜¯ç”¨æ¥æè¿° Spring AOP å›´ç»•æ–¹æ³•è°ƒç”¨è€Œæ³¨å…¥çš„åˆ‡é¢è¡Œä¸ºã€‚ æœ¬ç¯‡æ–‡ç« å°†ä»æºç çš„è§’åº¦æ¥çœ‹ä¸€çœ‹ Advice åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿåˆæ˜¯æ€ä¹ˆå®Œæˆé€šçŸ¥çš„ï¼Ÿ Advice æ¥å£1234567891011package org.aopalliance.aop;/** * Tag interface for Advice. Implementations can be any type * of advice, such as Interceptors. * @author Rod Johnson * @version $Id: Advice.java,v 1.1 2004/03/19 17:02:16 johnsonr Exp $ */public interface Advice &#123;&#125; Advice æ¥å£çš„å®šä¹‰æ˜¯åœ¨ org.aopalliance.aop åŒ…ä¸‹é¢çš„ï¼›ä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒAdvice æ¥å£å¹¶æ²¡æœ‰æä¾›ä»»ä½•çš„æ–¹æ³•ï¼›ç±»ä¼¼çš„æ¥å£å®šä¹‰è¿˜æœ‰java ä¸­çš„å¦‚Serializableæ¥å£ï¼Œè¿™ç±»æ¥å£ä¸€èˆ¬ç§°ä¹‹ä¸ºæ ‡è¯†æ¥å£ï¼›æ ‡è¯†æ¥å£å¯¹å®ç°å®ƒçš„ç±»æ²¡æœ‰ä»»ä½•çš„è¯­ä¹‰è¦æ±‚,ä»…ä»…æ˜¯å……å½“ä¸€ä¸ªæ ‡ç¤ºçš„ä½œç”¨,ç”¨æ¥è¡¨æ˜å®ç°å®ƒçš„ç±»å±äºä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼ˆä»è¿™ç§æ ‡è¯†æ€§è§’åº¦æ¥è¯´ï¼Œå’Œæ³¨è§£å…¶å®æŒºåƒçš„ï¼‰ï¼› Spring AOPä¸­é€šè¿‡å®šä¹‰å’Œä½¿ç”¨è¿™æ ·ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œä¸ºçš„å°±æ˜¯èƒ½å¤Ÿä¸ºåˆ‡é¢å¢å¼ºçš„ç»‡å…¥åŠŸèƒ½åšæ›´å¤šçš„ç»†åŒ–å’Œæ‰©å±•ã€‚ä¸‹é¢å°±å¯¹å¸¸è§çš„ä¸‰ä¸ªAdviceè¿›è¡Œåˆ†æã€‚ BeforeAdvice12public interface BeforeAdvice extends Advice &#123;&#125; è¿™ä¸ªæ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªæ ‡è¯†æ¥å£ã€‚çœ‹ä¸‹ BeforeAdvice çš„ç»§æ‰¿å…³ç³»ï¼š MethodBeforeAdvice æ˜¯ BeforeAdvice ä¸ºå¾…å¢å¼ºçš„ç›®æ ‡æ–¹æ³•è®¾ç½®çš„å‰ç½®å¢å¼ºæ¥å£ã€‚ 1234public interface MethodBeforeAdvice extends BeforeAdvice &#123; void before(Method method, Object[] args, Object target) throws Throwable;&#125; MethodBeforeAdvice ä¸­æä¾›äº†ä¸€ä¸ªå›è°ƒå‡½æ•° before(â€¦) ï¼› ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œbefore æ–¹æ³•çš„å®ç°åœ¨ Advice ä¸­è¢«é…ç½®åˆ°ç›®æ ‡æ–¹æ³•åï¼Œä¼šåœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶è¢«å›è°ƒã€‚æ¥çœ‹ä¸‹beforeæ–¹æ³•çš„å‡ ä¸ªå‚æ•°ï¼š Method method ï¼šï¼ˆ method being invokedï¼‰è¿™ä¸ªå‚æ•°æ˜¯ç›®æ ‡æ–¹æ³•çš„åå°„å¯¹è±¡ï¼› Object[] args ï¼šï¼ˆarguments to the methodï¼‰ç›®æ ‡æ–¹æ³•çš„è¾“å…¥å‚æ•°ï¼› Object target ï¼šï¼ˆtarget of the method invocationï¼‰æ–¹æ³•è°ƒç”¨çš„ç›®æ ‡ AspectJMethodBeforeAdviceAspectJMethodBeforeAdvice ç»§æ‰¿äº† AbstractAspectJAdvice æŠ½è±¡ç±»ï¼Œå¹¶å®ç°äº† MethodBeforeAdvice æ¥å£ã€‚ä» AspectJMethodBeforeAdvice ç±»ä¸­ä»£ç å¯ä»¥å¾—çŸ¥ï¼ŒAspectJMethodBeforeAdvice é‡å†™ before æ–¹æ³•çš„å®ç°æ˜¯ é€šè¿‡è°ƒç”¨çˆ¶ç±»çš„ invokeAdviceMethod æ–¹æ³•å®Œæˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´Spring AOP çš„AdviceåŒ…è£…äº†AspectJçš„beforeæ–¹æ³•ã€‚ Spring AOPçš„å®ç°åé¢å†è¯´ï¼Œæˆ‘ä»¬å…ˆè‡ªå·±æ¥å®ç°ä¸€ä¸ªç®€å•çš„é€šçŸ¥ã€‚ è‡ªå®šä¹‰ Adviceå®ç° MethodBeforeAdviceå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ GlmapperBeforeMethodAdvice ï¼›è¿™é‡Œå®ç° MethodBeforeAdvice æ¥å£ï¼Œç„¶åé‡å†™ before è¿™ä¸ªæ–¹æ³•ã€‚ 1234567891011121314151617181920212223/** * @description: è‡ªå®šä¹‰çš„ GlmapperBeforeMethodAdvice * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: glmapper@leishu * @date: 18/6/23 */public class GlmapperBeforeMethodAdvice implementsMethodBeforeAdvice,MethodInterceptor &#123; private static final Logger LOGGER = LoggerFactory.getLogger(GlmapperBeforeMethodAdvice.class.getSimpleName()); @Override public void before(Method method, Object[] args, Object target) throws Throwable &#123; LOGGER.info("invoke BeforeAdvice successfully..."); &#125; @Override public Object invoke(MethodInvocation invocation) throws Throwable &#123; Object result=invocation.proceed(); return result; &#125;&#125; OKï¼Œæœ‰äº†è¿™ä¸ª GlmapperBeforeMethodAdvice ï¼Œå†æ¥çœ‹çœ‹æ€ä¹ˆç”¨å®ƒï¼›åŒæ ·æœ¬ç¯‡æ–‡ç« æ‰€ä½¿ç”¨çš„æ¡ˆä¾‹å‡ä½¿ç”¨å‰ä¸€ç¯‡åšå®¢ä¸­çš„é‚£ä¸ªè„šæ‰‹æ¶æ¥å®Œæˆã€‚ 12345678910111213141516171819202122232425262728293031&lt;!--æˆ‘ä»¬çš„ç›®æ ‡ç±»--&gt;&lt;bean id="goodsService" class="com.glmapper.framerwork.service.impl.GoodsServiceImpl"/&gt;&lt;!--æˆ‘ä»¬è‡ªå®šä¹‰çš„Advice--&gt;&lt;bean id="glmapperBeforeMethodAdvice" class="com.glmapper.framerwork.Advice.GlmapperBeforeMethodAdvice"&gt;&lt;/bean&gt;&lt;!-- å£°æ˜åˆ‡å…¥ç‚¹adviser --&gt;&lt;bean id="adviser" class="org.springframework.aop.support.RegexpMethodPointcutAdvisor"&gt; &lt;!--è¿™é‡Œä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„advice--&gt; &lt;property name="advice" ref="glmapperBeforeMethodAdvice"&gt;&lt;/property&gt; &lt;!-- patternæŒ‡å®šqueryAllæ–¹æ³•ä½œä¸ºåˆ‡å…¥ç‚¹ï¼› \. è¿™ä¸ªæ˜¯è½¬ä¹‰ä½¿ç”¨--&gt; &lt;property name="pattern" value="com\.glmapper\.framerwork\.service\.impl\.GoodsServiceImpl\.queryAll"&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!-- å®šä¹‰ä»£ç†å¯¹è±¡ è¿”å›å®ä¾‹æ˜¯ç›®æ ‡å¯¹è±¡ targetå±æ€§æŒ‡å®šçš„goodsServiceå¯¹è±¡--&gt;&lt;bean id="proxyService"class="org.springframework.aop.framework.ProxyFactoryBean"&gt; &lt;property name="target"&gt; &lt;ref bean="goodsService" /&gt; &lt;/property&gt; &lt;!--æºç å†…å›ºå®šçš„å±æ€§private String[] interceptorNames; --&gt; &lt;property name="interceptorNames"&gt; &lt;value&gt;adviser&lt;/value&gt; &lt;/property&gt;&lt;/bean&gt; å®¢æˆ·ç«¯éƒ¨åˆ†ï¼Œé€šè¿‡SpringContextUtilæ¥æ‹¿ä»£ç†å¯¹è±¡ï¼› 1234567891011@RequestMapping("/initPage")public ModelAndView initPage(HttpServletRequest request, HttpServletResponse response, ModelAndView view) &#123; //è·å–ä»£ç†bean GoodsService proxyService= (GoodsService) SpringContextUtil.getBean("proxyService"); //è°ƒç”¨ List&lt;Goods&gt; goods = proxyService.queryAll(10,10); view.addObject("goodsList", goods); view.setViewName("goodslist"); return view;&#125; æ—¥å¿—è¾“å‡ºæ»¡è¶³æˆ‘ä»¬çš„æœŸæœ›ï¼ˆå¦‚ä¸‹ï¼‰ï¼š åŒæ ·çš„ï¼Œåœ¨GlmapperBeforeMethodAdviceåŸºç¡€ä¸Šå†å®ç° AfterReturningAdvice æ¥å£ï¼Œé‡å†™afterReturningæ–¹æ³•ï¼Œå°±èƒ½å®ç°åç½®é€šçŸ¥ã€‚ 12345@Overridepublic void afterReturning(Object returnValue, Method method, Object[]args, Object target) throws Throwable &#123; LOGGER.info("invoke AfterAdvice successfully...");&#125; è¿™ä¸ªæ–¹å¼åœ¨èŠä¸€èŠ AOP ï¼šè¡¨ç°å½¢å¼ä¸åŸºç¡€æ¦‚å¿µä¸­æœ‰è¯´é“ã€‚ Advice åœ¨ Aop ä¸­çš„å®ç°åŸç†è¿™é‡Œæ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸Šé¢çš„æ¡ˆä¾‹å…¶å®å°±æ˜¯Springæä¾›ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ¥å£ã€‚å› ä¸ºMethodBeforeAdviceç­‰éƒ½æ˜¯ç»§æ‰¿è‡ª AbstractAspectJAdvice è¿™ä¸ªæŠ½è±¡ç±»ï¼›æˆ‘ä»¬å°±æ¥çœ‹ä¸‹è¿™ä¸ªæŠ½è±¡ç±»é‡Œé¢çš„ä¸€äº›æ ¸å¿ƒé€»è¾‘å§ã€‚æˆ‘ä»¬æŒ‰ç…§AspectJMethodBeforeAdviceè¿™é‡Œè¿™ä¸ªç±»é‡Œé¢beforeæä¾›çš„çº¿ç´¢æ¥ä¸€æ­¥æ­¥åˆ†æã€‚ é¦–å…ˆåœ¨AspectJMethodBeforeAdviceé‡Œbeforeæ–¹æ³•ä¸­è°ƒç”¨çš„æ˜¯è¿™ä¸ªé€»è¾‘ï¼š 12345678910111213/** * Invoke the advice method. * @param jpMatch the JoinPointMatch that matched this execution join point * @param returnValue the return value from the method execution (may be null) * @param ex the exception thrown by the method execution (may be null) * @return the invocation result * @throws Throwable in case of invocation failure */protected Object invokeAdviceMethod(JoinPointMatch jpMatch, ObjectreturnValue, Throwable ex) throws Throwable &#123; return invokeAdviceMethodWithGivenArgs(argBinding(getJoinPoint(), jpMatch, returnValue, ex));&#125; è¿™é‡Œ argBinding æ–¹æ³•çš„ä½œç”¨æ˜¯è·å–æ–¹æ³•æ‰§è¡Œè¿æ¥ç‚¹ä¸Šçš„å‚æ•°ï¼Œå¹¶å°†ä¸€ç»„å‚æ•°è¾“å‡ºç»™Adviceæ–¹æ³•ã€‚ ç»§ç»­æ¥çœ‹invokeAdviceMethodWithGivenArgsè¿™ä¸ªæ–¹æ³•ï¼š 1234567891011121314151617181920212223protected Object invokeAdviceMethodWithGivenArgs(Object[] args) throwsThrowable &#123; //ä¿å­˜ä¸€ä»½å‚æ•°å‰¯æœ¬ Object[] actualArgs = args; //éªŒè¯ä¸‹å‚æ•°æ˜¯å¦ä¸å­˜åœ¨ if (this.aspectJAdviceMethod.getParameterTypes().length == 0) &#123; actualArgs = null; &#125; try &#123; //è®¾ç½®ä¸‹æ–¹æ³•çš„è®¿é—®æƒé™ ReflectionUtils.makeAccessible(this.aspectJAdviceMethod); // invokeæ‰§è¡Œï¼›è¿™é‡Œå…ˆé€šè¿‡aspectInstanceFactoryå¯¹åƒæ‹¿åˆ°æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡å®ä¾‹ï¼Œç„¶åå†è¿›è¡Œinvokeè°ƒç”¨æ‰§è¡Œ return this.aspectJAdviceMethod.invoke(this.aspectInstanceFactory.getAspectInstance(), actualArgs); &#125; catch (IllegalArgumentException ex) &#123; throw new AopInvocationException("Mismatch on arguments to advice method [" + this.aspectJAdviceMethod + "]; pointcut expression [" + this.pointcut.getPointcutExpression() + "]", ex); &#125; catch (InvocationTargetException ex) &#123; throw ex.getTargetException(); &#125;&#125; ä¸Šé¢è¿™æ®µä»£ç å…¶å®å°±æ˜¯é€šè¿‡åå°„çš„æ–¹å¼æ‰§è¡Œäº†æˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•ã€‚æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ä¸‹æˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•åˆ°åº•åœ¨å“ªé‡Œå»è¿›è¡Œå¢å¼ºçš„ï¼›è¿™é‡Œæˆ‘ä»¬é€šè¿‡é…ç½®æ–‡ä»¶æ¥çœ‹ï¼š 123456789101112&lt;!-- ä»£ç†å¯¹è±¡ è¿”å›å®ä¾‹æ˜¯ç›®æ ‡å¯¹è±¡ targetå±æ€§æŒ‡å®šçš„AOPserviceå¯¹è±¡--&gt;&lt;bean id="proxyService"class="org.springframework.aop.framework.ProxyFactoryBean"&gt; &lt;property name="target"&gt; &lt;ref bean="goodsService" /&gt; &lt;/property&gt; &lt;!--æºç å†…å›ºå®šçš„å±æ€§private String[] interceptorNames; --&gt; &lt;property name="interceptorNames"&gt; &lt;value&gt;adviser&lt;/value&gt; &lt;/property&gt;&lt;/bean&gt; ä»£ç†å¯¹è±¡proxyServiceå®ç°ä¸Šæ˜¯ProxyFactoryBeanäº§ç”Ÿçš„ï¼›è¿™é‡Œå°±ä¸åœ¨é˜è¿°BeanFactoryå’ŒFactoryBeançš„åŒºåˆ«äº†ã€‚ ä»ä¸Šé¢çš„é…ç½®æ–‡ä»¶æˆ‘ä»¬å¯ä»¥ç®€å•çš„äº†è§£åˆ°ï¼Œä»£ç†å¯¹è±¡å®é™…ä¸Šæ˜¯æˆ‘ä»¬ç›®æ ‡å¯¹è±¡+adviserå…±åŒç»„æˆï¼›è€Œåœ¨adviseré‡Œé¢åˆåŒ…æ‹¬äº†æˆ‘ä»¬çš„é€šçŸ¥ã€‚ ProxyFactoryBeanç»§æ‰¿äº†FactoryBeanï¼Œæˆ‘ä»¬çŸ¥é“FactoryBeanä¹Ÿæ˜¯ç”¨æ¥ç”Ÿæˆbeançš„ï¼Œä½†æ˜¯å®ƒç”Ÿæˆçš„beanæ˜¯é€šè¿‡å…¶getObjectæ–¹æ³•æ¥è·å–çš„ã€‚OKï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸‹ProxyFactoryBeançš„getObjectæ–¹æ³•ï¼š 1234567891011121314151617181920212223/** * Return a proxy. Invoked when clients obtain beans from this factory bean. * Create an instance of the AOP proxy to be returned by this factory. * The instance will be cached for a singleton, and create on each call to * &#123;@code getObject()&#125; for a proxy. * @return a fresh AOP proxy reflecting the current state of this factory */@Overridepublic Object getObject() throws BeansException &#123; //åˆå§‹åŒ–Advisoré“¾ initializeAdvisorChain(); //å¦‚æœæ˜¯å•ä¾‹ï¼Œåˆ™è·å–å•ä¾‹å¯¹è±¡ if (isSingleton()) &#123; return getSingletonInstance(); &#125; else &#123; if (this.targetName == null) &#123; logger.warn("Using non-singleton proxies with singleton targets is often undesirable. " + "Enable prototype proxies by setting the 'targetName' property."); &#125; return newPrototypeInstance(); &#125;&#125; è¿”å›ä¸€ä¸ªä»£ç†ã€‚å½“å®¢æˆ·ç«¯ä»è¿™ä¸ªå·¥å‚beanè·å–beanæ—¶è°ƒç”¨ã€‚åˆ›å»ºè¯¥å·¥å‚è¿”å›çš„AOPä»£ç†çš„ä¸€ä¸ªå®ä¾‹ã€‚è¯¥å®ä¾‹å°†è¢«ç¼“å­˜ä¸ºä¸€ä¸ªå•ä¾‹ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨æ—¶åˆ›å»ºã€‚ initializeAdvisorChainï¼šåˆ›å»º advisorï¼ˆæ‹¦æˆªå™¨ï¼‰é“¾ã€‚æ¯æ¬¡æ·»åŠ æ–°çš„ prototype å®ä¾‹æ—¶ï¼Œæºè‡ª BeanFactory çš„ Advisor éƒ½å°†è¢«åˆ·æ–°ã€‚é€šè¿‡å·¥å‚ API ä»¥ç¼–ç¨‹æ–¹å¼æ·»åŠ çš„æ‹¦æˆªå™¨ä¸å—æ­¤ç±»æ›´æ”¹çš„å½±å“ã€‚ï¼ˆè¯‘æ³¨ï¼‰ï¼›å…¶å®å°±æ˜¯æ ¹æ®æˆ‘ä»¬é…ç½®çš„interceptorNamesæ¥åˆå§‹åŒ–æˆ‘ä»¬çš„advisorï¼ˆæ‹¦æˆªå™¨ï¼‰é“¾ï¼Œç”¨æ¥å¢å¼ºæˆ‘ä»¬çš„ç›®æ ‡è°ƒç”¨æ–¹æ³•ã€‚ ä¸‹é¢æ˜¯getSingletonInstanceè¿™ä¸ªæ–¹æ³•ï¼š 123456789101112131415161718192021222324/** * Return the singleton instance of this class's proxy object, * lazily creating it if it hasn't been created already. * @return the shared singleton proxy */private synchronized Object getSingletonInstance() &#123; if (this.singletonInstance == null) &#123; //åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç† this.targetSource = freshTargetSource(); if (this.autodetectInterfaces &amp;&amp; getProxiedInterfaces().length == 0 &amp;&amp; !isProxyTargetClass()) &#123; // Rely on AOP infrastructure to tell us what interfaces to proxy. //è·å–ç›®æ ‡ç±» Class&lt;?&gt; targetClass = getTargetClass(); if (targetClass == null) &#123; throw new FactoryBeanNotInitializedException("Cannot determine target class for proxy"); &#125; setInterfaces(ClassUtils.getAllInterfacesForClass(targetClass, this.proxyClassLoader)); &#125; // Initialize the shared singleton instance. super.setFrozen(this.freezeProxy); this.singletonInstance = getProxy(createAopProxy()); &#125; return this.singletonInstance;&#125; ä¸Šé¢ä»£ç æœ€æ ¸å¿ƒçš„æ˜¯getProxyè¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œæ–¹å¼æœ‰ä¸¤ä¸ªæ–¹å¼ï¼Œä¸€ä¸ªæ˜¯cglibï¼Œå¦å¤–ä¸€ç§æ˜¯jdkåŠ¨æ€ä»£ç†ï¼š è¿™é‡Œæˆ‘ä»¬ä»¥é»˜è®¤çš„åŠ¨æ€ä»£ç†çš„æ–¹å¼æ¥è¯´ï¼š(org.springframework.aop.framework.JdkDynamicAopProxyç±»ä¸­) 1234567891011@Overridepublic Object getProxy(ClassLoader classLoader) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Creating JDK dynamic proxy: target source is " + this.advised.getTargetSource()); &#125; Class&lt;?&gt;[] proxiedInterfaces = AopProxyUtils.completeProxiedInterfaces(this.advised); findDefinedEqualsAndHashCodeMethods(proxiedInterfaces); return Proxy.newProxyInstance(classLoader, proxiedInterfaces, this);&#125; è¿™ä¸ªæ–¹æ³•è¿”å›çš„å°±æ˜¯æŒ‡å®šæ¥å£çš„ä»£ç†ç±»å®ä¾‹ï¼Œè¯¥æ¥å£å°†æ–¹æ³•è°ƒç”¨åˆ†æ´¾ç»™æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚ åˆ°æ­¤æ•´ä¸ªAOPä»£ç†ç”Ÿæˆé€»è¾‘å°±å®Œäº†ã€‚ æ€»ç»“ä¸€ä¸‹å°±æ˜¯æˆ‘ä»¬çš„ä»£ç†ç±»ä¸­å…¶å®åŒ…æ‹¬äº†æˆ‘ä»¬AOPå¢å¼ºçš„é‚£éƒ¨åˆ†é€»è¾‘çš„ï¼Œè¿™ä¸ªå…¶å®ä»ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­å°±å¾ˆæ¸…æ¥šçš„å¯ä»¥çœ‹å‡ºæ¥ï¼›æ‰€ä»¥ä»Adivceä»‹ä¸ªè§’åº¦æ¥è¯´ï¼Œå®ƒå…¶å®ä¼šè¢«æŠ±åœ¨advisorä¸­ï¼Œç„¶ååœ¨è¢«ä¼ é€’åˆ°ä»£ç†å¯¹è±¡ä¸­ï¼Œä»£ç†å¯¹è±¡é™¤äº†æ‹¥æœ‰æˆ‘ä»¬ç›®æ ‡å¯¹è±¡çš„èƒ½åŠ›ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬äº†Adivceçš„èƒ½åŠ›ï¼›é€šè¿‡è¿™ç§æ–¹å¼å°±å®ç°äº†å¢å¼ºã€‚ å…³äºAdviceå°±åˆ°è¿™é‡Œäº†ï¼Œä¸‹ä¸€ç« ä¼šæ¥å•ç‹¬è¯´ä¸€ä¸‹ PointCut ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>èŠä¸€èŠ</tag>
        <tag>aop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èŠä¸€èŠ AOP ï¼šè¡¨ç°å½¢å¼ä¸åŸºç¡€æ¦‚å¿µ]]></title>
    <url>%2F2018%2F11%2F10%2Fspringaopone%2F</url>
    <content type="text"><![CDATA[aop ç»ˆäºæä¸Šæ—¥ç¨‹æ¥å†™ä¸€å†™äº†ã€‚ ç³»åˆ—ç›®å½•æœ¬ç³»åˆ—åˆ†ä¸º ä¸Šã€ä¸­ã€ä¸‹ä¸‰ç¯‡ã€‚ä¸Šç¯‡ä¸»è¦æ˜¯ä»‹ç»å¦‚æœä½¿ç”¨ AOP ï¼Œæä¾›äº†demoå’Œé…ç½®æ–¹å¼è¯´æ˜ï¼›ä¸­ç¯‡æ¥å¯¹å®ç° AOP çš„æŠ€æœ¯åŸç†è¿›è¡Œåˆ†æï¼›ä¸‹ç¯‡ä¸»è¦é’ˆå¯¹Springä¸­å¯¹äºAOPçš„å®ç°è¿›è¡Œæºç åˆ†æã€‚ ä»ä¸€ä¸ªä¾‹å­è¯´èµ· åŸºäºä»£ç†çš„æ–¹å¼ çº¯POJOåˆ‡é¢ é…ç½®æ–¹å¼ AspectJ æ³¨è§£æ–¹å¼ AspectJ XML é…ç½®æ–¹å¼ è¡¨è¾¾å¼è¯´æ˜ åŸºç¡€æ¦‚å¿µ AOPæ¦‚å¿µ Target Object ç»‡å…¥ï¼ˆWeave Proxy Introduction Aspect Joinpoint Pointcut Advice æ¦‚å¿µ åˆ†ç±» å…³ç³» ä¸€äº›å‘ é¡¹ç›®åœ°å€é¡¹ç›®åœ°å€ï¼šglmapper-ssm-parent è¿™ä¸ªé¡¹ç›®é‡Œé¢åŒ…å«äº†ä¸‹é¢å‡ ç§ AOP å®ç°æ–¹å¼çš„æ‰€æœ‰ä»£ç ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥forkè·‘ä¸€ä¸‹ã€‚è¿™ä¸ªdemoä¸­åˆ—ä¸¾äº†4ä¸­æ–¹å¼çš„å®ç°ï¼š åŸºäºä»£ç çš„æ–¹å¼ åŸºäºçº¯POJOç±»çš„æ–¹å¼ åŸºäºAspectæ³¨è§£çš„æ–¹å¼ åŸºäºæ³¨å…¥å¼Aspectçš„æ–¹å¼ ç›®å‰æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„æ˜¯åŸºäºAspectæ³¨è§£çš„æ–¹å¼çš„æ–¹å¼ã€‚ä¸‹é¢æ¥ä¸€ä¸ªä¸ªäº†è§£ä¸‹ä¸åŒæ–¹å¼çš„è¡¨ç°å½¢å¼ã€‚ åŸºäºä»£ç†çš„æ–¹å¼è¿™ç§æ–¹å¼çœ‹èµ·æ¥å¾ˆå¥½ç†è§£ï¼Œä½†æ˜¯é…ç½®èµ·æ¥ç›¸å½“éº»çƒ¦ï¼›å°ä¼™ä¼´ä»¬å¯ä»¥å‚è€ƒé¡¹ç›®æ¥çœ‹ï¼Œè¿™é‡Œåªè´´å‡ºæ¯”è¾ƒå…³é”®çš„æµç¨‹ä»£ç ã€‚ 1ã€é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼šGoodsService12345678910public interface GoodsService &#123; /** * æŸ¥è¯¢æ‰€æœ‰å•†å“ä¿¡æ¯ * * @param offset æŸ¥è¯¢èµ·å§‹ä½ç½® * @param limit æŸ¥è¯¢æ¡æ•° * @return */ List&lt;Goods&gt; queryAll(int offset,int limit);&#125; 2ã€GoodsService å®ç°ç±»123456789101112@Service@Qualifier("goodsService")public class GoodsServiceImpl implements GoodsService &#123; @Autowired private GoodsDao goodsDao; public List&lt;Goods&gt; queryAll(int offset, int limit) &#123; System.out.println("æ‰§è¡Œäº†queryAllæ–¹æ³•"); List&lt;Goods&gt; list = new ArrayList&lt;Goods&gt;(); return list; &#125;&#125; 3ã€å®šä¹‰ä¸€ä¸ªé€šçŸ¥ç±» LoggerHelperï¼Œè¯¥ç±»ç»§æ‰¿ MethodBeforeAdviceå’Œ AfterReturningAdviceã€‚123456789101112131415//é€šçŸ¥ç±» LoggerHelperpublic class LoggerHelper implements MethodBeforeAdvice,AfterReturningAdvice &#123; private static final Logger LOGGER = LoggerFactory.getLogger(LoggerHelper.class); //MethodBeforeAdviceçš„beforeæ–¹æ³•å®ç° public void before(Method method, Object[] objects, Object o) throws Throwable &#123; LOGGER.info("before current time:"+System.currentTimeMillis()); &#125; //AfterReturningAdviceçš„afterReturningæ–¹æ³•å®ç° public void afterReturning(Object o, Method method, Object[] objects, Object o1) throws Throwable &#123; LOGGER.info("afterReturning current time:"+System.currentTimeMillis()); &#125;&#125; 4ã€é‡ç‚¹ï¼Œè¿™ä¸ªé…ç½®éœ€è¦å…³æ³¨ä¸‹ã€‚è¿™ä¸ªé¡¹ç›®é‡Œé¢æˆ‘æ˜¯é…ç½®åœ¨applicationContext.xmlæ–‡ä»¶ä¸­çš„ã€‚12345678910111213141516171819202122232425262728&lt;!-- å®šä¹‰è¢«ä»£ç†è€… --&gt;&lt;bean id="goodsServiceImpl" class="com.glmapper.framerwork.service.impl.GoodsServiceImpl"&gt;&lt;/bean&gt;&lt;!-- å®šä¹‰é€šçŸ¥å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åˆ‡å…¥ç‚¹æ‰§è¡Œå‰åéœ€è¦åšçš„äº‹æƒ… --&gt;&lt;bean id="loggerHelper" class="com.glmapper.framerwork.aspect.LoggerHelper"&gt;&lt;/bean&gt;&lt;!-- å®šä¹‰åˆ‡å…¥ç‚¹ä½ç½® --&gt;&lt;bean id="loggerPointcut" class="org.springframework.aop.support.JdkRegexpMethodPointcut"&gt; &lt;property name="pattern" value=".*query.*"&gt;&lt;/property&gt;&lt;/bean&gt;&lt;!-- ä½¿åˆ‡å…¥ç‚¹ä¸é€šçŸ¥ç›¸å…³è”ï¼Œå®Œæˆåˆ‡é¢é…ç½® --&gt;&lt;!-- ä»è¿™é‡Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£Advisorï¼Œadviceå’Œpointcutä¹‹é—´çš„å…³ç³»--&gt;&lt;!--adivceå’Œpointcutæ˜¯Advisorçš„ä¸¤ä¸ªå±æ€§--&gt;&lt;bean id="loggerHelperAdvisor" class="org.springframework.aop.support.DefaultPointcutAdvisor"&gt; &lt;property name="advice" ref="loggerHelper"&gt;&lt;/property&gt; &lt;property name="pointcut" ref="loggerPointcut"&gt;&lt;/property&gt;&lt;/bean&gt;&lt;!-- è®¾ç½®ä»£ç† --&gt;&lt;bean id="proxy" class="org.springframework.aop.framework.ProxyFactoryBean"&gt; &lt;!-- ä»£ç†çš„å¯¹è±¡ ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡ç±»--&gt; &lt;property name="target" ref="goodsServiceImpl"&gt;&lt;/property&gt; &lt;!-- ä½¿ç”¨åˆ‡é¢ --&gt; &lt;property name="interceptorNames" value="loggerHelperAdvisor"&gt;&lt;/property&gt; &lt;!-- ä»£ç†æ¥å£ï¼Œå•†å“æ¥å£ --&gt; &lt;property name="proxyInterfaces" value="com.glmapper.framerwork.service.GoodsService"&gt;&lt;/property&gt;&lt;/bean&gt; 5ã€ä½¿ç”¨ï¼šæ³¨è§£æ³¨å…¥æ–¹å¼1234567891011121314151617181920@Controller@RequestMapping("/buy")public class BuyController &#123; @Autowired private OrderService orderService; //å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†proxyï¼Œ //æ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥æ³¨å…¥æ‹¿åˆ°æˆ‘ä»¬çš„ä»£ç†ç±» @Autowired private GoodsService proxy; @RequestMapping("/initPage") public ModelAndView initPage(HttpServletRequest request, HttpServletResponse response, ModelAndView view) &#123; //è¿™é‡Œä½¿ç”¨proxyæ‰§è¡Œäº†*query*, List&lt;Goods&gt; goods = proxy.queryAll(10,10); view.addObject("goodsList", goods); view.setViewName("goodslist"); return view; &#125;&#125; 6ã€ä½¿ç”¨ï¼šå·¥å…·ç±»æ–¹å¼æ‰‹åŠ¨è·å–beanè¿™ä¸ªæ–¹å¼æ˜¯é€šè¿‡ä¸€ä¸ªSpringContextUtilå·¥å…·ç±»æ¥è·å–ä»£ç†å¯¹è±¡çš„ã€‚12345678910@RequestMapping(&quot;/initPage&quot;)public ModelAndView initPage(HttpServletRequest request, HttpServletResponse response, ModelAndView view) &#123; //è¿™é‡Œé€šè¿‡å·¥å…·ç±»æ¥æ‹¿ï¼Œæ•ˆæœä¸€æ ·çš„ã€‚ GoodsService proxy= (GoodsService) SpringContextUtil.getBean(&quot;proxy&quot;); List&lt;Goods&gt; goods = proxy.queryAll(10,10); view.addObject(&quot;goodsList&quot;, goods); view.setViewName(&quot;goodslist&quot;); return view;&#125; 7ã€SpringContextUtil ç±»çš„å®šä¹‰è¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹å‘çš„ï¼Œé¦–å…ˆSpringContextUtilæ˜¯ç»§æ‰¿ApplicationContextAwareè¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤ŸSpringContextUtilå¯ä»¥è¢«Springå®¹å™¨ç›´æ¥ç®¡ç†ï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ @Component æ ‡æ³¨ã€‚æ ‡æ³¨äº†ä¹‹åæœ€å…³é”®çš„æ˜¯å®ƒå¾—èƒ½å¤Ÿè¢«æˆ‘ä»¬é…ç½®çš„æ³¨å…¥æ‰«ææ‰«åˆ°ï¼ˆäº²è‡ªè¸©çš„å‘ï¼Œæˆ‘æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªæ‰«ä¸åˆ°çš„åŒ…ä¸‹é¢ï¼Œä¸€ç›´debugéƒ½æ˜¯nullï¼›å·®ç‚¹ç ¸ç”µè„‘â€¦ï¼‰ 123456789101112131415161718192021222324252627282930313233@Componentpublic class SpringContextUtil implements ApplicationContextAware &#123; // Springåº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒ private static ApplicationContext applicationContext; /** * å®ç°ApplicationContextAwareæ¥å£çš„å›è°ƒæ–¹æ³•ï¼Œè®¾ç½®ä¸Šä¸‹æ–‡ç¯å¢ƒ * * @param applicationContext */ public void setApplicationContext(ApplicationContext applicationContext) &#123; SpringContextUtil.applicationContext = applicationContext; &#125; /** * @return ApplicationContext */ public static ApplicationContext getApplicationContext() &#123; return applicationContext; &#125; /** * è·å–å¯¹è±¡ * è¿™é‡Œé‡å†™äº†beanæ–¹æ³•ï¼Œèµ·ä¸»è¦ä½œç”¨ * @param name * @return Object ä¸€ä¸ªä»¥æ‰€ç»™åå­—æ³¨å†Œçš„beançš„å®ä¾‹ * @throws BeansException */ public static Object getBean(String name) throws BeansException &#123; return applicationContext.getBean(name); &#125;&#125; 8ã€è¿è¡Œç»“æœ12345678921:04:47.940 [http-nio-8080-exec-7] INFO c.g.framerwork.aspect.LoggerHelper - before currenttime:1529413487940æ‰§è¡Œäº†queryAllæ–¹æ³•21:04:47.940 [http-nio-8080-exec-7] INFO c.g.framerwork.aspect.LoggerHelper - afterReturning currenttime:1529413487940 ä¸Šé¢å°±æ˜¯æœ€æœ€ç»å…¸çš„æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡ä»£ç†çš„æ–¹å¼æ¥å®ç°AOPçš„è¿‡ç¨‹ã€‚ çº¯POJOåˆ‡é¢ aop:configæ³¨æ„è¿™é‡Œå’ŒLoggerHelperçš„åŒºåˆ«ï¼Œè¿™é‡Œçš„LoggerAspectå¹¶æ²¡æœ‰ç»§æ‰¿ä»»ä½•æ¥å£æˆ–è€…æŠ½è±¡ç±»ã€‚ 1ã€POJO ç±»å®šä¹‰123456789101112131415161718/** * @description: [æè¿°æ–‡æœ¬] * @email: &lt;a href="guolei.sgl@antfin.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/6/20 */public class LoggerAspect &#123; private static final Logger LOGGER = LoggerFactory.getLogger(LoggerHelper.class); public void before()&#123; LOGGER.info("before current time:"+System.currentTimeMillis()); &#125; public void afterReturning() &#123; LOGGER.info("afterReturning current time:"+System.currentTimeMillis()); &#125;&#125; 2ã€é…ç½®æ–‡ä»¶123456789101112131415161718&lt;!-- å®šä¹‰é€šçŸ¥å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åˆ‡å…¥ç‚¹æ‰§è¡Œå‰åéœ€è¦åšçš„äº‹æƒ… --&gt;&lt;bean id="loggerAspect" class="com.glmapper.framerwork.aspect.LoggerAspect"&gt;&lt;/bean&gt;&lt;aop:config&gt; &lt;!--å®šä¹‰åˆ‡é¢--&gt; &lt;aop:aspect ref="loggerAspect"&gt; &lt;aop:pointcut id="loggerPointCut" expression= "execution(* com.glmapper.framerwork.service.impl.*.*(..)) " /&gt; &lt;!-- å®šä¹‰ Advice --&gt; &lt;!-- å‰ç½®é€šçŸ¥ --&gt; &lt;aop:before pointcut-ref="loggerPointCut" method="before" /&gt; &lt;!-- åç½®é€šçŸ¥ --&gt; &lt;aop:after-returning pointcut-ref="loggerPointCut" method="afterReturning"/&gt; &lt;/aop:aspect&gt;&lt;/aop:config&gt; æ³¨æ„è¿™é‡ŒLoggerAspectä¸­çš„beforeå’ŒafterReturningå¦‚æœæœ‰å‚æ•°ï¼Œè¿™é‡Œéœ€è¦å¤„ç†ä¸‹ï¼Œå¦åˆ™ä¼šæŠ¥ 0 formal unbound in pointcut å¼‚å¸¸ã€‚ @AspectJ æ³¨è§£é©±åŠ¨æ–¹å¼è¿™ç§æ–¹å¼æ˜¯æœ€ç®€å•çš„ä¸€ç§å®ç°ï¼Œç›´æ¥ä½¿ç”¨ @Aspect æ³¨è§£æ ‡æ³¨æˆ‘ä»¬çš„åˆ‡é¢ç±»å³å¯ã€‚ 1ã€å®šä¹‰åˆ‡é¢ç±»ï¼Œå¹¶ä½¿ç”¨ @Aspect è¿›è¡Œæ ‡æ³¨123456789101112131415161718192021222324/** * @description: ä½¿ç”¨Aspectæ³¨è§£é©±åŠ¨çš„æ–¹å¼ * @email: &lt;a href="guolei.sgl@antfin.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/6/20 */@Aspectpublic class LoggerAspectInject &#123; private static final Logger LOGGER = LoggerFactory.getLogger(LoggerAspectInject.class); @Pointcut("execution(* com.glmapper.framerwork.service.impl.*.*(..))") public void cutIn()&#123;&#125; @Before("cutIn()") public void before()&#123; LOGGER.info("before current time:"+System.currentTimeMillis()); &#125; @AfterReturning("cutIn()") public void AfterReturning()&#123; LOGGER.info("afterReturning current time:"+System.currentTimeMillis()); &#125;&#125; 2ã€ä½¿ç”¨æ–¹å¼1ï¼šé…ç½®æ–‡ä»¶æ–¹å¼å£°æ˜ bean123456789&lt;aop:aspectj-autoproxy /&gt;&lt;!-- å®šä¹‰é€šçŸ¥å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åˆ‡å…¥ç‚¹æ‰§è¡Œå‰åéœ€è¦åšçš„äº‹æƒ… --&gt;&lt;bean id="loggerAspectInject" class="com.glmapper.framerwork.aspect.LoggerAspectInject"&gt;&lt;/bean&gt;&lt;!-- å®šä¹‰è¢«ä»£ç†è€… --&gt;&lt;bean id="goodsServiceImpl" class="com.glmapper.framerwork.service.impl.GoodsServiceImpl"&gt;&lt;/bean&gt; 3ã€å®¢æˆ·ç«¯ä½¿ç”¨ï¼š1234567891011121314151617181920@Controller@RequestMapping("/buy")public class BuyController &#123; @Autowired private OrderService orderService; @RequestMapping("/initPage") public ModelAndView initPage(HttpServletRequest request, HttpServletResponse response, ModelAndView view) &#123; //é€šè¿‡SpringContextUtilæ‰‹åŠ¨è·å– ä»£ç†bean GoodsService goodsService=(GoodsService) SpringContextUtil.getBean("goodsServiceImpl"); List&lt;Goods&gt; goods = goodsService.queryAll(10,10); view.addObject("goodsList", goods); view.setViewName("goodslist"); return view; &#125;&#125; 4ã€ä½¿ç”¨æ–¹å¼2ï¼šä½¿ç”¨@componentæ³¨è§£æ‰˜ç®¡ç»™IOC1234567891011121314151617181920@Aspect@Component //è¿™é‡ŒåŠ ä¸Šäº†Componentæ³¨è§£ï¼Œå°±ä¸éœ€è¦åœ¨xmlä¸­é…ç½®äº†public class LoggerAspectInject &#123; private static final Logger LOGGER = LoggerFactory.getLogger(LoggerAspectInject.class); @Pointcut("execution(* com.glmapper.framerwork.service.impl.*.*(..))") public void cutIn()&#123;&#125; @Before("cutIn()") public void before()&#123; LOGGER.info("before current time:"+System.currentTimeMillis()); &#125; @AfterReturning("cutIn()") public void AfterReturning()&#123; LOGGER.info("afterReturning current time:"+System.currentTimeMillis()); &#125;&#125; 5ã€å®¢æˆ·ç«¯ä»£ç ï¼š1234567891011121314151617181920@Controller@RequestMapping("/buy")public class BuyController &#123; @Autowired private OrderService orderService; //ç›´æ¥æ³¨å…¥ @Autowired private GoodsService goodsService; @RequestMapping("/initPage") public ModelAndView initPage(HttpServletRequest request, HttpServletResponse response, ModelAndView view) &#123; List&lt;Goods&gt; goods = goodsService.queryAll(10,10); view.addObject("goodsList", goods); view.setViewName("goodslist"); return view; &#125;&#125; 6ã€æ¯”è¾ƒå®Œæ•´çš„ä¸€ä¸ªLoggerAspectInjectï¼Œåœ¨å®é™…å·¥ç¨‹ä¸­å¯ä»¥ç›´æ¥å‚è€ƒ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * @description: aop * @email: &lt;a href="henugl@1992.163.com"&gt;&lt;/a&gt; * @author: glmapper@ç£Šå” * @date: 18/6/4 */@Aspect@Componentpublic class LoggerAspectInject &#123; private static final Logger LOGGER= LoggerFactory.getLogger(LoggerAspectInject.class); @Pointcut("execution(* com.glmapper.book.web.controller.*.*(..))") public void cutIn()&#123; &#125; @Around("cutIn()") // å®šä¹‰Pointcutï¼Œåç§°å³ä¸‹é¢çš„æ ‡è¯†"aroundAdvice public Object aroundAdvice(ProceedingJoinPoint poin)&#123; System.out.println("ç¯ç»•é€šçŸ¥"); Object object = null; try&#123; object = poin.proceed(); &#125;catch (Throwable e)&#123; e.printStackTrace(); &#125; return object; &#125; // å®šä¹‰ advise //è¿™ä¸ªæ–¹æ³•åªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œç›¸å½“äºåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†pointcutçš„id,æ­¤æ–¹æ³•æ²¡æœ‰è¿”å›å€¼å’Œå‚æ•° @Before("cutIn()") public void beforeAdvice()&#123; System.out.println("å‰ç½®é€šçŸ¥"); &#125; @After("cutIn()") public void afterAdvice()&#123; System.out.println("åç½®é€šçŸ¥"); &#125; @AfterReturning("cutIn()") public void afterReturning()&#123; System.out.println("åç½®è¿”å› "); &#125; @AfterThrowing("cutIn()") public void afterThrowing()&#123; System.out.println("åç½®å¼‚å¸¸"); &#125;&#125; å…³äºå‘½ååˆ‡å…¥ç‚¹ï¼šä¸Šé¢çš„ä¾‹å­ä¸­cutInæ–¹æ³•å¯ä»¥è¢«ç§°ä¹‹ä¸ºå‘½ååˆ‡å…¥ç‚¹ï¼Œå‘½ååˆ‡å…¥ç‚¹å¯ä»¥è¢«å…¶ä»–åˆ‡å…¥ç‚¹å¼•ç”¨ï¼Œè€ŒåŒ¿ååˆ‡å…¥ç‚¹æ˜¯ä¸å¯ä»¥çš„ã€‚åªæœ‰@AspectJæ”¯æŒå‘½ååˆ‡å…¥ç‚¹ï¼Œè€ŒSchemaé£æ ¼ä¸æ”¯æŒå‘½ååˆ‡å…¥ç‚¹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ@AspectJä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¼•ç”¨å‘½ååˆ‡å…¥ç‚¹ï¼š 12345678@Pointcut("execution(* com.glmapper.book.web.controller.*.*(..))")public void cutIn()&#123;&#125;//å¼•å…¥å‘½ååˆ‡å…¥ç‚¹@Before("cutIn()")public void beforeAdvice()&#123; System.out.println("å‰ç½®é€šçŸ¥");&#125; æ³¨å…¥å¼ AspectJ åˆ‡é¢è¿™ç§æ–¹å¼æˆ‘æ„Ÿè§‰æ˜¯ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§çš„ç»“åˆçš„ä¸€ç§æ–¹å¼ã€‚ 1ã€å®šä¹‰åˆ‡é¢ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/*** @description: æ³¨å…¥å¼ ä¹Ÿæ˜¯ä¸€ç§é€šè¿‡XMLæ–¹å¼é…ç½®çš„æ–¹å¼* @email: &lt;a href="guolei.sgl@antfin.com"&gt;&lt;/a&gt;* @author: guolei.sgl* @date: 18/6/20*/public class LoggerAspectHelper &#123; private static final Logger LOGGER = LoggerFactory.getLogger(LoggerAspectHelper.class); /** * è°ƒåŠ¨æ–¹æ³•å‰æ‰§è¡Œ * @param point * @throws Throwable */ public void doBefore(JoinPoint point) throws Throwable &#123; LOGGER.info("before current time:"+System.currentTimeMillis()); &#125; /** * åœ¨è°ƒç”¨æ–¹æ³•å‰åæ‰§è¡Œ * @param point * @return * @throws Throwable */ public Object doAround(ProceedingJoinPoint point) throws Throwable &#123; LOGGER.info("around current time:"+System.currentTimeMillis()); if(point.getArgs().length&gt;0) &#123; return point.proceed(point.getArgs()); &#125;else&#123; return point.proceed(); &#125; &#125; /** * åœ¨è°ƒç”¨æ–¹æ³•ä¹‹åæ‰§è¡Œ * @param point * @throws Throwable */ public void doAfter(JoinPoint point) throws Throwable &#123; LOGGER.info("after current time:"+System.currentTimeMillis()); &#125; /** * å¼‚å¸¸é€šçŸ¥ * @param point * @param ex */ public void doThrowing(JoinPoint point, Throwable ex) &#123; LOGGER.info("throwing current time:"+System.currentTimeMillis()); &#125;&#125; 2ã€XML é…ç½®12345678910111213141516171819&lt;bean id="loggerAspectHelper" class="com.glmapper.framerwork.aspect.LoggerAspectHelper"&gt;&lt;/bean&gt;&lt;aop:config&gt; &lt;aop:aspect id="configAspect" ref="loggerAspectHelper"&gt; &lt;!--é…ç½®com.glmapper.framerwork.service.imp åŒ…ä¸‹æ‰€æœ‰ç±»æˆ–æ¥å£çš„æ‰€æœ‰æ–¹æ³• --&gt; &lt;aop:pointcut id="cutIn" expression= "execution(* com.glmapper.framerwork.service.impl.*.*(..))" /&gt; &lt;aop:before pointcut-ref="cutIn" method="doBefore" /&gt; &lt;aop:after pointcut-ref="cutIn" method="doAfter" /&gt; &lt;aop:around pointcut-ref="cutIn" method="doAround" /&gt; &lt;aop:after-throwing pointcut-ref="cutIn" method="doThrowing" throwing="ex" /&gt; &lt;/aop:aspect&gt;&lt;/aop:config&gt; 3ã€ç»“æœ123456723:39:48.756 [http-nio-8080-exec-4] INFO c.g.f.aspect.LoggerAspectHelper- before current time:152950918875623:39:48.757 [http-nio-8080-exec-4] INFO c.g.f.aspect.LoggerAspectHelper- around current time:1529509188757excute queryAll method...23:39:48.757 [http-nio-8080-exec-4] INFO c.g.f.aspect.LoggerAspectHelper- after current time:1529509188757 è¡¨è¾¾å¼ ä»ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼æ¥æŒ‡å®šæˆ‘ä»¬çš„åˆ‡å…¥ç‚¹çš„ã€‚åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä¸ä»…ä»…æ˜¯executionï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šç§ç±»å‹çš„è¡¨è¾¾å¼ã€‚ä¸‹é¢å°±åˆ—ä¸¾ä¸€äº›ï¼š 1ã€executionç”¨äºåŒ¹é…æ–¹æ³•æ‰§è¡Œçš„è¿æ¥ç‚¹; 1execution(* com.glmapper.book.web.controller.*.*(..)) executionï¼ˆï¼‰è¡¨è¾¾å¼çš„ä¸»ä½“ï¼› ç¬¬ä¸€ä¸ª â€œ*â€ ç¬¦å·è¡¨ç¤ºè¿”å›å€¼çš„ç±»å‹ä»»æ„ï¼› com.glmapper.book.web.controller AOPæ‰€åˆ‡çš„æœåŠ¡çš„åŒ…åï¼Œå³ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡éƒ¨åˆ† åŒ…ååé¢çš„â€.â€ è¡¨ç¤ºå½“å‰åŒ…åŠå­åŒ… ç¬¬äºŒä¸ªâ€*â€ è¡¨ç¤ºç±»åï¼Œå³æ‰€æœ‰ç±» .*(..) è¡¨ç¤ºä»»ä½•æ–¹æ³•åï¼Œæ‹¬å·è¡¨ç¤ºå‚æ•°ï¼Œä¸¤ä¸ªç‚¹è¡¨ç¤ºä»»ä½•å‚æ•°ç±»å‹ 2ã€withinç”¨äºåŒ¹é…æŒ‡å®šç±»å‹å†…çš„æ–¹æ³•æ‰§è¡Œ; 123456//å¦‚æœåœ¨com.glmapper.book.web.controlleråŒ…æˆ–å…¶ä¸‹çš„ä»»ä½•å­åŒ…ä¸­//å®šä¹‰äº†è¯¥ç±»å‹ï¼Œåˆ™åœ¨Webå±‚ä¸­æœ‰ä¸€ä¸ªè¿æ¥ç‚¹ã€‚within(com.glmapper.book.web.controller..*)@Pointcut("within(com.glmapper.book.web.controller..*)")public void cutIn()&#123;&#125; @withinï¼šç”¨äºåŒ¹é…æ‰€ä»¥æŒæœ‰æŒ‡å®šæ³¨è§£ç±»å‹å†…çš„æ–¹æ³•ï¼› 12345678910/** * @description: æ³¨è§£å®šä¹‰ * @email: &lt;a href="henugl@1992.163.com"&gt;&lt;/a&gt; * @author: glmapper@ç£Šå” * @date: 18/6/4 */@Retention(RetentionPolicy.RUNTIME)@Target(&#123;ElementType.METHOD,ElementType.FIELD&#125;)public @interface AuthAnnotation &#123;&#125; ä»»ä½•ç›®æ ‡å¯¹è±¡å¯¹åº”çš„ç±»å‹æŒæœ‰AuthAnnotationæ³¨è§£çš„ç±»æ–¹æ³•ï¼›å¿…é¡»æ˜¯åœ¨ç›®æ ‡å¯¹è±¡ä¸Šå£°æ˜è¿™ä¸ªæ³¨è§£ï¼Œåœ¨æ¥å£ä¸Šå£°æ˜çš„å¯¹å®ƒä¸èµ·ä½œç”¨ã€‚12345@within(com.glmapper.book.common.annotaion.AuthAnnotation)//æ‰€æœ‰è¢«@AdviceAnnotationæ ‡æ³¨çš„ç±»éƒ½å°†åŒ¹é…@Pointcut("@within(com.glmapper.book.common.annotaion.AuthAnnotation)") public void cutIn()&#123;&#125; 3ã€thisç”¨äºåŒ¹é…å½“å‰AOPä»£ç†å¯¹è±¡ç±»å‹çš„æ‰§è¡Œæ–¹æ³•ï¼›æ³¨æ„æ˜¯AOPä»£ç†å¯¹è±¡çš„ç±»å‹åŒ¹é…ï¼Œè¿™æ ·å°±å¯èƒ½åŒ…æ‹¬å¼•å…¥æ¥å£ä¹Ÿç±»å‹åŒ¹é…ï¼›thisä¸­ä½¿ç”¨çš„è¡¨è¾¾å¼å¿…é¡»æ˜¯ç±»å‹å…¨é™å®šåï¼Œä¸æ”¯æŒé€šé…ç¬¦ï¼› 12345678//å½“å‰ç›®æ ‡å¯¹è±¡ï¼ˆéAOPå¯¹è±¡ï¼‰å®ç°äº† UserService æ¥å£çš„ä»»ä½•æ–¹æ³•this(com.glmapper.book.web.service.UserService)//ç”¨äºå‘é€šçŸ¥æ–¹æ³•ä¸­ä¼ å…¥ä»£ç†å¯¹è±¡çš„å¼•ç”¨ã€‚@Before("cutIn() &amp;&amp; this(proxy)")public void beforeAdvice(ProceedingJoinPoint poin,Object proxy)&#123; System.out.println("å‰ç½®é€šçŸ¥");&#125; 4ã€targetç”¨äºåŒ¹é…å½“å‰ç›®æ ‡å¯¹è±¡ç±»å‹çš„æ‰§è¡Œæ–¹æ³•ï¼›æ³¨æ„æ˜¯ç›®æ ‡å¯¹è±¡çš„ç±»å‹åŒ¹é…ï¼Œè¿™æ ·å°±ä¸åŒ…æ‹¬å¼•å…¥æ¥å£ä¹Ÿç±»å‹åŒ¹é…ï¼›targetä¸­ä½¿ç”¨çš„è¡¨è¾¾å¼å¿…é¡»æ˜¯ç±»å‹å…¨é™å®šåï¼Œä¸æ”¯æŒé€šé…ç¬¦ï¼›12345678//å½“å‰ç›®æ ‡å¯¹è±¡ï¼ˆéAOPå¯¹è±¡ï¼‰å®ç°äº† UserService æ¥å£çš„ä»»ä½•æ–¹æ³•target(com.glmapper.book.web.service.UserService)//ç”¨äºå‘é€šçŸ¥æ–¹æ³•ä¸­ä¼ å…¥ä»£ç†å¯¹è±¡çš„å¼•ç”¨ã€‚@Before("cutIn() &amp;&amp; target(proxy)")public void beforeAdvice(ProceedingJoinPoint poin,Object proxy)&#123; System.out.println("å‰ç½®é€šçŸ¥");&#125; @targetï¼šç”¨äºåŒ¹é…å½“å‰ç›®æ ‡å¯¹è±¡ç±»å‹çš„æ‰§è¡Œæ–¹æ³•ï¼Œå…¶ä¸­ç›®æ ‡å¯¹è±¡æŒæœ‰æŒ‡å®šçš„æ³¨è§£ï¼›ä»»ä½•ç›®æ ‡å¯¹è±¡æŒæœ‰Secureæ³¨è§£çš„ç±»æ–¹æ³•ï¼›è¿™ä¸ªå’Œ@withinä¸€æ ·å¿…é¡»æ˜¯åœ¨ç›®æ ‡å¯¹è±¡ä¸Šå£°æ˜è¿™ä¸ªæ³¨è§£ï¼Œåœ¨æ¥å£ä¸Šå£°æ˜çš„å¯¹å®ƒåŒæ ·ä¸èµ·ä½œç”¨ã€‚1234@target(com.glmapper.book.common.annotaion.AuthAnnotation)@Pointcut("@target(com.glmapper.book.common.annotaion.AuthAnnotation)")public void cutIn()&#123;&#125; 5ã€argsç”¨äºåŒ¹é…å½“å‰æ‰§è¡Œçš„æ–¹æ³•ä¼ å…¥çš„å‚æ•°ä¸ºæŒ‡å®šç±»å‹çš„æ‰§è¡Œæ–¹æ³•ï¼›å‚æ•°ç±»å‹åˆ—è¡¨ä¸­çš„å‚æ•°å¿…é¡»æ˜¯ç±»å‹å…¨é™å®šåï¼Œé€šé…ç¬¦ä¸æ”¯æŒï¼›argså±äºåŠ¨æ€åˆ‡å…¥ç‚¹ï¼Œè¿™ç§åˆ‡å…¥ç‚¹å¼€é”€éå¸¸å¤§ï¼Œéç‰¹æ®Šæƒ…å†µæœ€å¥½ä¸è¦ä½¿ç”¨ï¼› 12345678910//ä»»ä½•ä¸€ä¸ªä»¥æ¥å—â€œä¼ å…¥å‚æ•°ç±»å‹ä¸ºjava.io.Serializableâ€å¼€å¤´ï¼Œ//ä¸”å…¶åå¯è·Ÿä»»æ„ä¸ªä»»æ„ç±»å‹çš„å‚æ•°çš„æ–¹æ³•æ‰§è¡Œï¼Œ//argsæŒ‡å®šçš„å‚æ•°ç±»å‹æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åŒ¹é…çš„args (java.io.Serializable,..)//ç”¨äºå°†å‚æ•°ä¼ å…¥åˆ°é€šçŸ¥æ–¹æ³•ä¸­ã€‚@Before("cutIn() &amp;&amp; args(age,username)")public void beforeAdvide(JoinPoint point, int age, String username)&#123; //...&#125; @argsï¼šç”¨äºåŒ¹é…å½“å‰æ‰§è¡Œçš„æ–¹æ³•ä¼ å…¥çš„å‚æ•°æŒæœ‰æŒ‡å®šæ³¨è§£çš„æ‰§è¡Œï¼›ä»»ä½•ä¸€ä¸ªåªæ¥å—ä¸€ä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œä¸”æ–¹æ³•è¿è¡Œæ—¶ä¼ å…¥çš„å‚æ•°æŒæœ‰æ³¨è§£AuthAnnotationï¼›åŠ¨æ€åˆ‡å…¥ç‚¹ï¼Œç±»ä¼¼äºargæŒ‡ç¤ºç¬¦ï¼› 123456@args (com.glmapper.book.common.annotaion.AuthAnnotation)@Before("@args(com.glmapper.book.common.annotaion.AuthAnnotation)")public void beforeAdvide(JoinPoint point)&#123; //...&#125; 6ã€@annotationä½¿ç”¨â€œ@annotation(æ³¨è§£ç±»å‹)â€åŒ¹é…å½“å‰æ‰§è¡Œæ–¹æ³•æŒæœ‰æŒ‡å®šæ³¨è§£çš„æ–¹æ³•ï¼›æ³¨è§£ç±»å‹ä¹Ÿå¿…é¡»æ˜¯å…¨é™å®šç±»å‹åï¼›1234567//å½“å‰æ‰§è¡Œæ–¹æ³•ä¸ŠæŒæœ‰æ³¨è§£ AuthAnnotationå°†è¢«åŒ¹é…@annotation(com.glmapper.book.common.annotaion.AuthAnnotation)//åŒ¹é…è¿æ¥ç‚¹è¢«å®ƒå‚æ•°æŒ‡å®šçš„AuthAnnotationæ³¨è§£çš„æ–¹æ³•ã€‚//ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰è¢«æŒ‡å®šæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•éƒ½å°†åŒ¹é…ã€‚@Pointcut("@annotation(com.glmapper.book.common.annotaion.AuthAnnotation)")public void cutIn()&#123;&#125; è¿˜æœ‰ä¸€ç§æ˜¯beançš„æ–¹å¼ï¼Œæ²¡ç”¨è¿‡ã€‚æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ã€‚ ä¾‹å­åœ¨ä¸‹é¢è¯´åˆ°çš„åŸºç¡€æ¦‚å¿µéƒ¨åˆ†å¯¹åº”ç»™å‡ºã€‚ åŸºç¡€æ¦‚å¿µåŸºç¡€æ¦‚å¿µéƒ¨åˆ†ä¸»è¦å°† AOP ä¸­çš„ä¸€äº›æ¦‚å¿µç‚¹æ‹ä¸€æ‹ï¼Œè¿™éƒ¨åˆ†ä¸»è¦å‚è€ƒäº†å®˜ç½‘ä¸Šçš„ä¸€äº›è§£é‡Šã€‚ AOPAOP(Aspect-Oriented Programming)ï¼Œ å³ é¢å‘åˆ‡é¢ç¼–ç¨‹, å®ƒä¸ OOP( Object-Oriented Programming, é¢å‘å¯¹è±¡ç¼–ç¨‹) ç›¸è¾…ç›¸æˆ, æä¾›äº†ä¸ OOP ä¸åŒçš„æŠ½è±¡è½¯ä»¶ç»“æ„çš„è§†è§’ã€‚åœ¨ OOP ä¸­,æˆ‘ä»¬ä»¥ç±»(class)ä½œä¸ºæˆ‘ä»¬çš„åŸºæœ¬å•å…ƒ, è€Œ AOP ä¸­çš„åŸºæœ¬å•å…ƒæ˜¯ Aspect(åˆ‡é¢)ã€‚ æ¨ªåˆ‡å…³æ³¨ç‚¹(Cross Cutting Concern)ï¼šç‹¬ç«‹æœåŠ¡ï¼Œå¦‚ç³»ç»Ÿæ—¥å¿—ã€‚å¦‚æœä¸æ˜¯ç‹¬ç«‹æœåŠ¡ï¼ˆå°±æ˜¯ä¸ä¸šåŠ¡è€¦åˆæ¯”è¾ƒå¼ºçš„æœåŠ¡ï¼‰å°±ä¸èƒ½æ¨ªåˆ‡äº†ã€‚é€šå¸¸è¿™ç§ç‹¬ç«‹æœåŠ¡éœ€è¦éå¸ƒç³»ç»Ÿå„ä¸ªè§’è½ï¼Œéå¸ƒåœ¨ä¸šåŠ¡æµç¨‹ä¹‹ä¸­ã€‚ Target Objectç›®æ ‡å¯¹è±¡ã€‚ç»‡å…¥ advice çš„ç›®æ ‡å¯¹è±¡ã€‚ ç›®æ ‡å¯¹è±¡ä¹Ÿè¢«ç§°ä¸º advised objectã€‚å› ä¸º Spring AOP ä½¿ç”¨è¿è¡Œæ—¶ä»£ç†çš„æ–¹å¼æ¥å®ç° aspect, å› æ­¤ adviced object æ€»æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡(proxied object)ï¼›æ³¨æ„ï¼Œ adviced object æŒ‡çš„ä¸æ˜¯åŸæ¥çš„ç±», è€Œæ˜¯ç»‡å…¥ advice åæ‰€äº§ç”Ÿçš„ä»£ç†ç±»ã€‚ ç»‡å…¥ï¼ˆWeaveï¼‰å³Adviceåº”ç”¨åœ¨JoinPointçš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å«ç»‡å…¥ã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦è€è¯´å°±æ˜¯å°† aspect å’Œå…¶ä»–å¯¹è±¡è¿æ¥èµ·æ¥, å¹¶åˆ›å»º adviced object çš„è¿‡ç¨‹ã€‚ æ ¹æ®ä¸åŒçš„å®ç°æŠ€æœ¯ï¼Œ AOPç»‡å…¥æœ‰ä¸‰ç§æ–¹å¼: ç¼–è¯‘å™¨ç»‡å…¥ï¼Œè¿™è¦æ±‚æœ‰ç‰¹æ®Šçš„Javaç¼–è¯‘å™¨ ç±»è£…è½½æœŸç»‡å…¥ï¼Œ è¿™éœ€è¦æœ‰ç‰¹æ®Šçš„ç±»è£…è½½å™¨ åŠ¨æ€ä»£ç†ç»‡å…¥, åœ¨è¿è¡ŒæœŸä¸ºç›®æ ‡ç±»æ·»åŠ å¢å¼º( Advice )ç”Ÿæˆå­ç±»çš„æ–¹å¼ã€‚ Spring é‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥, è€ŒAspectJé‡‡ç”¨ç¼–è¯‘å™¨ç»‡å…¥å’Œç±»è£…è½½æœŸ ä»£ç†Spring AOPé»˜è®¤ä½¿ç”¨ä»£ç†çš„æ˜¯æ ‡å‡†çš„JDKåŠ¨æ€ä»£ç†ã€‚è¿™ä½¿å¾—ä»»ä½•æ¥å£ï¼ˆæˆ–ä¸€ç»„æ¥å£ï¼‰éƒ½å¯ä»¥ä»£ç†ã€‚ Spring AOPä¹Ÿå¯ä»¥ä½¿ç”¨CGLIBä»£ç†ã€‚å¦‚æœä¸šåŠ¡å¯¹è±¡ä¸å®ç°æ¥å£ï¼Œåˆ™é»˜è®¤ä½¿ç”¨CGLIBã€‚å¯¹æ¥å£ç¼–ç¨‹è€Œä¸æ˜¯å¯¹ç±»ç¼–ç¨‹æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ï¼›ä¸šåŠ¡ç±»é€šå¸¸ä¼šå®ç°ä¸€ä¸ªæˆ–å¤šä¸ªä¸šåŠ¡æ¥å£ã€‚åœ¨ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå³éœ€è¦é€šçŸ¥çš„æ¥å£ä¸Šæ²¡æœ‰å£°æ˜çš„æ–¹æ³•ï¼Œæˆ–è€…éœ€è¦å°†ä»£ç†å¯¹è±¡ä¼ é€’ç»™å…·ä½“ç±»å‹çš„æ–¹æ³•ï¼Œæœ‰å¯èƒ½å¼ºåˆ¶ä½¿ç”¨CGLIBã€‚ Introductionsæˆ‘ä»¬çŸ¥é“Javaè¯­è¨€æœ¬èº«å¹¶éæ˜¯åŠ¨æ€çš„ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ç±»ä¸€æ—¦ç¼–è¯‘å®Œæˆï¼Œå°±å¾ˆéš¾å†ä¸ºä»–æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ä½†æ˜¯åœ¨ä¸€å¼€å§‹ç»™å‡ºçš„ä¾‹å­ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬æ²¡æœ‰å‘å¯¹è±¡ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œä½†æ˜¯å·²ç»å‘å…¶ä¸­æ·»åŠ äº†æ–°çš„åŠŸèƒ½ã€‚è¿™ç§å±äºå‘ç°æœ‰çš„æ–¹æ³•æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œé‚£èƒ½ä¸èƒ½ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆè‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œä½¿ç”¨introductionå°±èƒ½å¤Ÿå®ç°ã€‚ introductionï¼šåŠ¨æ€ä¸ºæŸä¸ªç±»å¢åŠ æˆ–å‡å°‘æ–¹æ³•ã€‚ä¸ºä¸€ä¸ªç±»å‹æ·»åŠ é¢å¤–çš„æ–¹æ³•æˆ–å­—æ®µã€‚Spring AOP å…è®¸æˆ‘ä»¬ä¸º ç›®æ ‡å¯¹è±¡ å¼•å…¥æ–°çš„æ¥å£(å’Œå¯¹åº”çš„å®ç°)ã€‚ Aspectåˆ‡é¢ï¼šé€šçŸ¥å’Œåˆ‡å…¥ç‚¹çš„ç»“åˆã€‚ åˆ‡é¢å®ç°äº†cross-cuttingï¼ˆæ¨ªåˆ‡ï¼‰åŠŸèƒ½ã€‚æœ€å¸¸è§çš„æ˜¯loggingæ¨¡å—ã€æ–¹æ³•æ‰§è¡Œè€—æ—¶æ¨¡å—ï¼Œè¿™æ ·ï¼Œç¨‹åºæŒ‰åŠŸèƒ½è¢«åˆ†ä¸ºå¥½å‡ å±‚ï¼Œå¦‚æœæŒ‰ä¼ ç»Ÿçš„ç»§æ‰¿çš„è¯ï¼Œå•†ä¸šæ¨¡å‹ç»§æ‰¿æ—¥å¿—æ¨¡å—çš„è¯éœ€è¦æ’å…¥ä¿®æ”¹çš„åœ°æ–¹å¤ªå¤šï¼Œè€Œé€šè¿‡åˆ›å»ºä¸€ä¸ªåˆ‡é¢å°±å¯ä»¥ä½¿ç”¨AOPæ¥å®ç°ç›¸åŒçš„åŠŸèƒ½äº†ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„éœ€æ±‚åšå‡ºä¸åŒçš„åˆ‡é¢ã€‚ è€Œå°†æ•£è½äºå„ä¸ªä¸šåŠ¡å¯¹è±¡ä¹‹ä¸­çš„Cross-cutting concerns æ”¶é›†èµ·æ¥ï¼Œè®¾è®¡å„ä¸ªç‹¬ç«‹å¯é‡ç”¨çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ç§°ä¹‹ä¸ºAspectï¼›åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬æ ¹æ®ä¸åŒçš„é…ç½®æ–¹å¼ï¼Œå®šä¹‰äº†å››ç§ä¸åŒå½¢å¼çš„åˆ‡é¢ã€‚ JoinpointAspect åœ¨åº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶åŠ å…¥ä¸šåŠ¡æµç¨‹çš„ç‚¹æˆ–æ—¶æœºç§°ä¹‹ä¸º Joinpoint ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ Advice åœ¨åº”ç”¨ç¨‹åºä¸­è¢«å‘¼å«æ‰§è¡Œçš„æ—¶æœºï¼Œè¿™ä¸ªæ—¶æœºå¯èƒ½æ˜¯æŸä¸ªæ–¹æ³•è¢«å‘¼å«ä¹‹å‰æˆ–ä¹‹åï¼ˆæˆ–ä¸¤è€…éƒ½æœ‰ï¼‰ï¼Œæˆ–æ˜¯æŸä¸ªå¼‚å¸¸å‘ç”Ÿçš„æ—¶å€™ã€‚ Joinpoint &amp; ProceedingJoinPointç¯ç»•é€šçŸ¥ = å‰ç½®+ç›®æ ‡æ–¹æ³•æ‰§è¡Œ+åç½®é€šçŸ¥ï¼Œproceedæ–¹æ³•å°±æ˜¯ç”¨äºå¯åŠ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„ã€‚ ç¯ç»•é€šçŸ¥ ProceedingJoinPoint æ‰§è¡Œ proceed æ–¹æ³• çš„ä½œç”¨æ˜¯è®©ç›®æ ‡æ–¹æ³•æ‰§è¡Œ ï¼Œè¿™ ä¹Ÿæ˜¯ç¯ç»•é€šçŸ¥å’Œå‰ç½®ã€åç½®é€šçŸ¥æ–¹æ³•çš„ä¸€ä¸ªæœ€å¤§åŒºåˆ«ã€‚ Proceedingjoinpoint ç»§æ‰¿äº† JoinPoint ã€‚æ˜¯åœ¨JoinPointçš„åŸºç¡€ä¸Šæš´éœ²å‡º proceed è¿™ä¸ªæ–¹æ³•ã€‚proceedå¾ˆé‡è¦ï¼Œè¿™ä¸ªæ˜¯aopä»£ç†é“¾æ‰§è¡Œçš„æ–¹æ³•ï¼›æš´éœ²å‡ºè¿™ä¸ªæ–¹æ³•ï¼Œå°±èƒ½æ”¯æŒaop:around è¿™ç§åˆ‡é¢ï¼ˆå…¶ä»–çš„å‡ ç§åˆ‡é¢åªéœ€è¦ç”¨åˆ°JoinPointï¼Œè¿™è·Ÿåˆ‡é¢ç±»å‹æœ‰å…³ï¼‰ï¼Œ èƒ½å†³å®šæ˜¯å¦èµ°ä»£ç†é“¾è¿˜æ˜¯èµ°è‡ªå·±æ‹¦æˆªçš„å…¶ä»–é€»è¾‘ã€‚ åœ¨ç¯ç»•é€šçŸ¥çš„æ–¹æ³•ä¸­æ˜¯éœ€è¦è¿”å›ä¸€ä¸ªObjectç±»å‹å¯¹è±¡çš„ï¼Œå¦‚æœæŠŠç¯ç»•é€šçŸ¥çš„æ–¹æ³•è¿”å›ç±»å‹æ˜¯voidï¼Œå°†ä¼šå¯¼è‡´ä¸€äº›æ— æ³•é¢„ä¼°çš„æƒ…å†µï¼Œæ¯”å¦‚ï¼š404ã€‚ PointcutåŒ¹é… join pointsçš„è°“è¯ã€‚Adviceä¸åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ç›¸å…³è”, å¹¶åœ¨åˆ‡å…¥ç‚¹åŒ¹é…çš„ä»»ä½•è¿æ¥ç‚¹ä¸Šè¿è¡Œã€‚ï¼ˆä¾‹å¦‚ï¼Œå…·æœ‰ç‰¹å®šåç§°çš„æ–¹æ³•çš„æ‰§è¡Œï¼‰ã€‚ç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼åŒ¹é…çš„è¿æ¥ç‚¹çš„æ¦‚å¿µæ˜¯AOPçš„æ ¸å¿ƒï¼ŒSpringé»˜è®¤ä½¿ç”¨AspectJåˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­è¨€ã€‚ åœ¨ Spring ä¸­, æ‰€æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥è®¤ä¸ºæ˜¯Joinpoint, ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨æ‰€æœ‰çš„æ–¹æ³•ä¸Šéƒ½æ·»åŠ  Advice, è€Œ Pointcut çš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ç»„è§„åˆ™(ä½¿ç”¨ AspectJ pointcut expression language æ¥æè¿°) æ¥åŒ¹é…Joinpoint, ç»™æ»¡è¶³è§„åˆ™çš„Joinpoint æ·»åŠ  Adviceã€‚ Pointcut å’Œ Joinpointåœ¨Spring AOP ä¸­, æ‰€æœ‰çš„æ–¹æ³•æ‰§è¡Œéƒ½æ˜¯ join pointã€‚ è€Œ point cut æ˜¯ä¸€ä¸ªæè¿°ä¿¡æ¯ï¼Œå®ƒä¿®é¥°çš„æ˜¯ join pointï¼Œ é€šè¿‡ point cutï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šå“ªäº› join point å¯ä»¥è¢«ç»‡å…¥Adviceã€‚ å› æ­¤join point å’Œ point cutæœ¬è´¨ä¸Šå°±æ˜¯ä¸¤ä¸ªä¸åŒç»´åº¦ä¸Šçš„ä¸œè¥¿ã€‚ advice æ˜¯åœ¨ join point ä¸Šæ‰§è¡Œçš„, è€Œ point cut è§„å®šäº†å“ªäº› join point å¯ä»¥æ‰§è¡Œå“ªäº› adviceã€‚ Adviceæ¦‚å¿µAdvice æ˜¯æˆ‘ä»¬åˆ‡é¢åŠŸèƒ½çš„å®ç°ï¼Œå®ƒæ˜¯åˆ‡ç‚¹çš„çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ã€‚æ¯”å¦‚åƒå‰é¢ä¾‹å­ä¸­æ‰“å°æ—¶é—´çš„å‡ ä¸ªæ–¹æ³•ï¼ˆè¢«@Beforeç­‰æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªé€šçŸ¥ï¼‰ï¼›Advice åœ¨ Jointpoint å¤„æ’å…¥ä»£ç åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ åˆ†ç±»BeforeAdviceï¼ŒAfterAdviceï¼ŒåŒºåˆ«åœ¨äºAdviceåœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰è°ƒç”¨è¿˜æ˜¯ä¹‹åè°ƒç”¨ï¼ŒThrow Advice è¡¨ç¤ºå½“ç›®æ ‡å‘ç”Ÿå¼‚å¸¸æ—¶è°ƒç”¨Adviceã€‚ before adviceï¼š åœ¨ join point å‰è¢«æ‰§è¡Œçš„ advice. è™½ç„¶ before advice æ˜¯åœ¨ join point å‰è¢«æ‰§è¡Œ, ä½†æ˜¯å®ƒå¹¶ä¸èƒ½å¤Ÿé˜»æ­¢ join point çš„æ‰§è¡Œ, é™¤éå‘ç”Ÿäº†å¼‚å¸¸(å³æˆ‘ä»¬åœ¨ before advice ä»£ç ä¸­, ä¸èƒ½äººä¸ºåœ°å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œ join point ä¸­çš„ä»£ç ) after return adviceï¼š åœ¨ä¸€ä¸ª join point æ­£å¸¸è¿”å›åæ‰§è¡Œçš„ advice after throwing adviceï¼š å½“ä¸€ä¸ª join point æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œçš„ advice after(final) adviceï¼š æ— è®ºä¸€ä¸ª join point æ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å‘ç”Ÿäº†å¼‚å¸¸, éƒ½ä¼šè¢«æ‰§è¡Œçš„ advice. around adviceï¼šåœ¨ join point å‰å’Œ joint point é€€å‡ºåéƒ½æ‰§è¡Œçš„ advice. è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ advice. Adviceã€JoinPointã€PointCut å…³ç³» ä¸‹é¢è¿™å¼ å›¾æ˜¯åœ¨ç½‘ä¸Šä¸€ä½å¤§ä½¬çš„åšå®¢é‡Œå‘ç°çš„ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç†è§£è¿™äº›æ¦‚å¿µä¹‹é—´çš„å…³ç³»ã€‚ ä¸Šé¢æ˜¯å¯¹äºAOPä¸­æ¶‰åŠåˆ°çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µåŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»åšäº†ç®€å•çš„æ¢³ç†ã€‚ ä¸€äº›å‘åœ¨è°ƒè¯•ç¨‹åºè¿‡ç¨‹ä¸­å‡ºç°çš„ä¸€äº›é—®é¢˜è®°å½• 1ã€ä½¿ç”¨AOPæ‹¦æˆªcontrollerå±‚çš„æœåŠ¡æˆåŠŸï¼Œä½†æ˜¯é¡µé¢æŠ¥é”™4041234@Around("cutIn()")public void aroundAdvice(ProceedingJoinPoint poin) &#123; System.out.println("ç¯ç»•é€šçŸ¥");&#125; è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å†ä½¿ç”¨ç¯ç»•é€šçŸ¥æ—¶ï¼Œéœ€è¦ç»™æ–¹æ³•ä¸€ä¸ªè¿”å›å€¼ã€‚ 12345@Around("cutIn()")public Object aroundAdvice(ProceedingJoinPoint poin) throws Throwable &#123; System.out.println("ç¯ç»•é€šçŸ¥"); return poin.proceed();&#125; 2ã€0 formal unbound in pointcutåœ¨spring 4.xä¸­ æä¾›äº†aopæ³¨è§£æ–¹å¼ å¸¦å‚æ•°çš„æ–¹å¼ã€‚çœ‹ä¸‹é¢ä¾‹å­ï¼š 1234567@Pointcut(value = "execution(* com.glmapper.framerwork.service.impl.*(int,int)) &amp;&amp; args(i,j)") public void cutIn(int i, int j) &#123;&#125; @Before(value="cutIn(i, j)",argNames = "i,j") public void beforeMethod( int i, int j) &#123; System.out.println("---------begins with " + i + "-" +j); &#125; æ¯”å¦‚è¯´è¿™é‡Œï¼ŒBeforeä¸­æœ‰ä¸¤ä¸ªintç±»å‹çš„å‚æ•°ï¼Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶æ²¡æœ‰ç»™å…¶æŒ‡å®šå‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºï¼šCaused by: java.lang.IllegalArgumentException: error at ::0 formal unbound in pointcut å¼‚å¸¸ä¿¡æ¯ã€‚ æœ¬æ¥æ˜¯æƒ³æ”¾åœ¨ä¸€ç¯‡é‡Œé¢çš„ï¼Œä½†æ˜¯å®åœ¨å¤ªé•¿äº†ï¼Œå°±åˆ†å¼€å§ï¼›å‘¨æœ«æ›´æ–°ä¸‹]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>èŠä¸€èŠ</tag>
        <tag>aop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google Guava åœ¨å®é™…åœºæ™¯ä¸­çš„åº”ç”¨å°è£…]]></title>
    <url>%2F2018%2F11%2F10%2Fguavacacheone%2F</url>
    <content type="text"><![CDATA[æ¯•ç«Ÿè¥¿æ¹–å…­æœˆä¸­ï¼Œé£å…‰ä¸ä¸å››æ—¶åŒã€‚ æ¥å¤©è²å¶æ— ç©·ç¢§ï¼Œæ˜ æ—¥è·èŠ±åˆ«æ ·çº¢ã€‚ æ™“å‡ºå‡€æ…ˆå¯ºé€æ—å­æ–¹-æ¨ä¸‡é‡Œ å‘¨æœ«ä¸å°ä¼™ä¼´çº¦äº†ä¸€æ³¢è¥¿æ¹–ï¼Œè¿™ä¸ªæ—¶é—´è·èŠ±å¼€çš„æ­£å¥½â€¦ï¼Œåœ¨å¼€å§‹æ–‡ç« ä¹‹å‰å…ˆæ”¾ä¸€å¼ â€œä½›ç³»â€ç¾å›¾æ¥é•‡æ¥¼ï¼ï¼ï¼ æœ€è¿‘è¿™æ®µæ—¶é—´ç”¨äº†ä¸‹è°·æ­Œçš„guavaï¼Œè‡ªå·±å°äº†ä¸€ä¸ªç¼“å­˜æ¨¡æ¿æ–¹æ¡ˆï¼Œç‰¹æ­¤è®°å½•ï¼Œä»¥å¤‡åç»­æ‰€éœ€ã€‚ ä¸€ä¸ªç¼“å­˜å®šæ—¶æ¸…é™¤ä»»åŠ¡å¸¦æ¥çš„GCé—®é¢˜ä¸ºä»€ä¹ˆè¦ä»è¿™ä¸ªæ¥è¯´èµ·ï¼Œå› ä¸ºä¸è¯´è¿™ä¸ªå°±æ²¡guavaä»€ä¹ˆäº‹äº†ï¼ æœ€è¿‘é¡¹ç›®ä¸­éœ€è¦ä½¿ç”¨ç¼“å­˜æ¥å¯¹ä¸€æŸ¥æŸ¥è¯¢é¢‘ç¹çš„æ•°æ®åšç¼“å­˜å¤„ç†ï¼›é¦–å…ˆæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›å¼•å…¥ä¸‰æ–¹çš„å¦‚redisæˆ–è€…memcacheè¿™æ ·çš„æœåŠ¡è¿›æ¥ï¼Œå…¶æ¬¡æ˜¯æˆ‘ä»¬å¯¹äºæ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œä¸éœ€è¦é›†ç¾¤å†…çš„æŸ¥è¯¢æ¥å£å…±äº«åˆ°ä¸€ä»½ç¼“å­˜æ•°æ®ï¼›æ‰€ä»¥è¿™æ ·ä¸€æ¥æˆ‘ä»¬åªè¦å®ç°ä¸€ä¸ªåŸºäºå†…å­˜çš„ç¼“å­˜å³å¯ã€‚ æœ€å¼€å§‹æˆ‘å¹¶æ²¡æœ‰è€ƒè™‘ä½¿ç”¨guavaæ¥åšè¿™ä¸ªäº‹æƒ…ï¼Œè€Œæ˜¯è‡ªå·±å†™äº†ä¸€å¥—åŸºäºCurrentHashMapçš„ç¼“å­˜æ–¹æ¡ˆï¼›è¿™é‡Œéœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œå› ä¸ºç¼“å­˜åœ¨è¿™ä¸ªåœºæ™¯é‡Œé¢å¸Œæœ›æä¾›è¶…æ—¶æ¸…é™¤çš„èƒ½åŠ›ï¼Œè€ŒåŸºäºæ‰€ä»¥åœ¨è‡ªå·±ç¼“å­˜æ¡†æ¶ä¸­å¢åŠ äº†å®šæ—¶æ¸…é™¤è¿‡æœŸæ•°æ®çš„èƒ½åŠ›ã€‚ è¿™é‡Œæˆ‘å°±ç›´æ¥æŠŠå®šæ—¶æ¸…æ¥šçš„è¿™æ®µä»£ç æ”¾ä¸Šæ¥ï¼š 123456789101112131415161718192021222324252627 /** * é™æ€å†…éƒ¨ç±»æ¥è¿›è¡Œè¶…æ—¶å¤„ç† */private class ClearCacheThread extends Thread &#123; @Override public void run() &#123; while (true)&#123; try &#123; long now = System.currentTimeMillis(); Object[] keys = map.keySet().toArray(); for (Object key : keys) &#123; CacheEntry entry = map.get(key); if (now - entry.time &gt;= cacheTimeout) &#123; synchronized (map) &#123; map.remove(key); if (LOGGER.isDebugEnabled())&#123; LOGGER.debug("language cache timeout clear"); &#125; &#125; &#125; &#125; &#125;catch (Exception e)&#123; LOGGER.error("clear out time cache value error;",e); &#125; &#125; &#125;&#125; è¿™ä¸ªçº¿ç¨‹æ˜¯ç”¨æ¥å•ç‹¬å¤„ç†è¿‡æœŸæ•°æ®çš„ã€‚ç¼“å­˜åˆå§‹åŒ–æ—¶å°±ä¼šè§¦å‘è¿™ä¸ªçº¿ç¨‹çš„startæ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚ æ­£å¼ç”±äºè¿™æ®µä»£ç çš„ä¸åˆç†å¯¼è‡´æˆ‘åœ¨å‘å¸ƒdevç¯å¢ƒä¹‹åï¼Œæœºå™¨GCè§¦å‘çš„é¢‘æ¬¡é«˜çš„ç¦»è°±ã€‚åœ¨å°è¯•äº†ä¸åŒçš„ä¿®å¤æ–¹æ¡ˆä¹‹åï¼Œæœ€åé€‰æ‹©æ”¾å¼ƒäº†ï¼›æ”¹ç”¨guavaäº†ï¼ å°ä¼™ä¼´ä»¬å¯ä»¥åœ¨ä¸‹é¢ç•™è¨€æ¥è®¨è®ºä¸‹è¿™é‡Œä¸ºä»€ä¹ˆä¼šå­˜åœ¨é¢‘ç¹GCçš„é—®é¢˜ï¼›æˆ‘ä¼šæŠŠç»“è®ºæ”¾åœ¨è¯„è®ºå›å¤é‡Œé¢ã€‚ guavaä¸ºä»€ä¹ˆé€‰ç”¨guavaå‘¢ï¼Œå¾ˆæ˜¾ç„¶ï¼Œæ˜¯å¤§ä½¬æ¨èçš„ï¼ï¼ï¼ guavaæ˜¯è°·æ­Œæä¾›çš„ä¸€ä¸ªåŸºäºå†…å­˜çš„ç¼“å­˜å·¥å…·åŒ…ï¼ŒGuava Cache æä¾›äº†ä¸€ç§æŠŠæ•°æ®ï¼ˆkey-valueå¯¹ï¼‰ç¼“å­˜åˆ°æœ¬åœ°ï¼ˆJVMï¼‰å†…å­˜ä¸­çš„æœºåˆ¶ï¼Œé€‚ç”¨äºå¾ˆå°‘ä¼šæ”¹åŠ¨çš„æ•°æ®ã€‚Guava Cache ä¸ ConcurrentMap å¾ˆç›¸ä¼¼ï¼Œä½†ä¹Ÿä¸å®Œå…¨ä¸€æ ·ã€‚æœ€åŸºæœ¬çš„åŒºåˆ«æ˜¯ ConcurrentMap ä¼šä¸€ç›´ä¿å­˜æ‰€æœ‰æ·»åŠ çš„å…ƒç´ ï¼Œç›´åˆ°æ˜¾å¼åœ°ç§»é™¤ã€‚ç›¸å¯¹åœ°ï¼ŒGuava Cache ä¸ºäº†é™åˆ¶å†…å­˜å ç”¨ï¼Œé€šå¸¸éƒ½è®¾å®šä¸ºè‡ªåŠ¨å›æ”¶å…ƒç´ ã€‚ å¯¹äºæˆ‘ä»¬çš„åœºæ™¯ï¼Œguava æä¾›çš„èƒ½åŠ›æ»¡è¶³äº†æˆ‘ä»¬çš„éœ€è¦ï¼š æ•°æ®æ”¹åŠ¨å° åŸºäºå†…å­˜ å¯ä»¥è‡ªåŠ¨å›æ”¶ æ—¢ç„¶é€‰æ‹©å®ƒäº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯æœ‰å¿…è¦æ¥å…ˆå¯¹å®ƒæœ‰ä¸ªå¤§è‡´çš„äº†è§£ï¼›å…ˆæ¥çœ‹çœ‹å®ƒæä¾›çš„ä¸€äº›ç±»å’Œæ¥å£ï¼š æ¥å£/ç±» è¯¦ç»†è§£é‡Š Cache ã€Iã€‘;å®šä¹‰getã€putã€invalidateç­‰æ“ä½œï¼Œè¿™é‡Œåªæœ‰ç¼“å­˜å¢åˆ æ”¹çš„æ“ä½œï¼Œæ²¡æœ‰æ•°æ®åŠ è½½çš„æ“ä½œã€‚ AbstractCache ã€Cã€‘;å®ç°Cacheæ¥å£ã€‚å…¶ä¸­æ‰¹é‡æ“ä½œéƒ½æ˜¯å¾ªç¯æ‰§è¡Œå•æ¬¡è¡Œä¸ºï¼Œè€Œå•æ¬¡è¡Œä¸ºéƒ½æ²¡æœ‰å…·ä½“å®šä¹‰ã€‚ LoadingCache ã€Iã€‘;ç»§æ‰¿è‡ªCacheã€‚å®šä¹‰getã€getUncheckedã€getAllç­‰æ“ä½œï¼Œè¿™äº›æ“ä½œéƒ½ä¼šä»æ•°æ®æºloadæ•°æ®ã€‚ AbstractLoadingCache ã€Cã€‘;ç»§æ‰¿è‡ªAbstractCacheï¼Œå®ç°LoadingCacheæ¥å£ã€‚ LocalCache ã€Cã€‘;æ•´ä¸ªguava cacheçš„æ ¸å¿ƒç±»ï¼ŒåŒ…å«äº†guava cacheçš„æ•°æ®ç»“æ„ä»¥åŠåŸºæœ¬çš„ç¼“å­˜çš„æ“ä½œæ–¹æ³•ã€‚ LocalManualCache ã€Cã€‘;LocalCacheå†…éƒ¨é™æ€ç±»ï¼Œå®ç°Cacheæ¥å£ã€‚å…¶å†…éƒ¨çš„å¢åˆ æ”¹ç¼“å­˜æ“ä½œå…¨éƒ¨è°ƒç”¨æˆå‘˜å˜é‡localCacheï¼ˆLocalCacheç±»å‹ï¼‰çš„ç›¸åº”æ–¹æ³•ã€‚ LocalLoadingCache ã€Cã€‘;LocalCacheå†…éƒ¨é™æ€ç±»ï¼Œç»§æ‰¿è‡ªLocalManualCacheç±»ï¼Œå®ç°LoadingCacheæ¥å£ã€‚å…¶æ‰€æœ‰æ“ä½œä¹Ÿæ˜¯è°ƒç”¨æˆå‘˜å˜é‡localCacheï¼ˆLocalCacheç±»å‹ï¼‰çš„ç›¸åº”æ–¹æ³• CacheBuilder ã€Cã€‘;ç¼“å­˜æ„å»ºå™¨ã€‚æ„å»ºç¼“å­˜çš„å…¥å£ï¼ŒæŒ‡å®šç¼“å­˜é…ç½®å‚æ•°å¹¶åˆå§‹åŒ–æœ¬åœ°ç¼“å­˜ã€‚CacheBuilderåœ¨buildæ–¹æ³•ä¸­ï¼Œä¼šæŠŠå‰é¢è®¾ç½®çš„å‚æ•°ï¼Œå…¨éƒ¨ä¼ é€’ç»™LocalCacheï¼Œå®ƒè‡ªå·±å®é™…ä¸å‚ä¸ä»»ä½•è®¡ç®— CacheLoader ã€Cã€‘;ç”¨äºä»æ•°æ®æºåŠ è½½æ•°æ®ï¼Œå®šä¹‰loadã€reloadã€loadAllç­‰æ“ä½œã€‚ æ•´ä¸ªæ¥çœ‹çš„è¯ï¼Œguavaé‡Œé¢æœ€æ ¸å¿ƒçš„åº”è¯¥ç®—æ˜¯ LocalCache è¿™ä¸ªç±»äº†ã€‚ 123@GwtCompatible(emulated = true)class LocalCache&lt;K, V&gt; extends AbstractMap&lt;K, V&gt; implementsConcurrentMap&lt;K, V&gt; å…³äºè¿™ä¸ªç±»çš„æºç è¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œç›´æ¥æ¥çœ‹ä¸‹åœ¨å®é™…åº”ç”¨ä¸­æˆ‘çš„å°è£…æ€è·¯ã€å°è£…æ»¡è¶³æˆ‘å½“å‰çš„éœ€æ±‚ï¼Œå¦‚æœæœ‰å°ä¼™ä¼´éœ€è¦å€Ÿé‰´ï¼Œå¯ä»¥è‡ªå·±åœ¨åšæ‰©å±•ã€‘ 12345678910111213141516private static final int MAX_SIZE = 1000;private static final int EXPIRE_TIME = 10;private static final int DEFAULT_SIZE = 100;private int maxSize = MAX_SIZE;private int expireTime = EXPIRE_TIME;/** æ—¶é—´å•ä½ï¼ˆåˆ†é’Ÿï¼‰ */private TimeUnit timeUnit = TimeUnit.MINUTES;/** Cacheåˆå§‹åŒ–æˆ–è¢«é‡ç½®çš„æ—¶é—´ */private Date resetTime;/** åˆ†åˆ«è®°å½•å†å²æœ€å¤šç¼“å­˜ä¸ªæ•°åŠæ—¶é—´ç‚¹*/private long highestSize = 0;private Date highestTime;private volatile LoadingCache&lt;K, V&gt; cache; è¿™é‡Œå…ˆæ˜¯å®šä¹‰äº†ä¸€äº›å¸¸é‡å’ŒåŸºæœ¬çš„å±æ€§ä¿¡æ¯ï¼Œå½“ç„¶è¿™äº›å±æ€§ä¼šæä¾›set&amp;getæ–¹æ³•ï¼Œä¾›å®é™…ä½¿ç”¨æ—¶å»è‡ªè¡Œè®¾ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738public LoadingCache&lt;K, V&gt; getCache() &#123; //ä½¿ç”¨åŒé‡æ ¡éªŒé”ä¿è¯åªæœ‰ä¸€ä¸ªcacheå®ä¾‹ if(cache == null)&#123; synchronized (this) &#123; if(cache == null)&#123; //CacheBuilderçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œåªèƒ½é€šè¿‡å…¶é™æ€æ–¹æ³•newBuilder()æ¥è·å¾—CacheBuilderçš„å®ä¾‹ cache = CacheBuilder.newBuilder() //è®¾ç½®ç¼“å­˜å®¹å™¨çš„åˆå§‹å®¹é‡ä¸º100 .initialCapacity(DEFAULT_SIZE) //ç¼“å­˜æ•°æ®çš„æœ€å¤§æ¡ç›® .maximumSize(maxSize) //å®šæ—¶å›æ”¶:ç¼“å­˜é¡¹åœ¨ç»™å®šæ—¶é—´å†…æ²¡æœ‰è¢«å†™è®¿é—®ï¼ˆåˆ›å»ºæˆ–è¦†ç›–ï¼‰ï¼Œåˆ™å›æ”¶ã€‚ .expireAfterWrite(expireTime, timeUnit) //å¯ç”¨ç»Ÿè®¡-&gt;ç»Ÿè®¡ç¼“å­˜çš„å‘½ä¸­ç‡ç­‰ .recordStats() //è®¾ç½®ç¼“å­˜çš„ç§»é™¤é€šçŸ¥ .removalListener((notification)-&gt; &#123; if (LOGGER.isDebugEnabled())&#123; LOGGER.debug("&#123;&#125; was removed, cause is &#123;&#125;" ,notification.getKey(), notification.getCause()); &#125; &#125;) .build(new CacheLoader&lt;K, V&gt;() &#123; @Override public V load(K key) throws Exception &#123; return fetchData(key); &#125; &#125;); this.resetTime = new Date(); this.highestTime = new Date(); if (LOGGER.isInfoEnabled())&#123; LOGGER.info("æœ¬åœ°ç¼“å­˜&#123;&#125;åˆå§‹åŒ–æˆåŠŸ.", this.getClass().getSimpleName()); &#125; &#125; &#125; &#125; return cache;&#125; ä¸Šé¢è¿™æ®µä»£ç æ˜¯æ•´ä¸ªç¼“å­˜çš„æ ¸å¿ƒï¼Œé€šè¿‡è¿™æ®µä»£ç æ¥ç”Ÿæˆæˆ‘ä»¬çš„ç¼“å­˜å¯¹è±¡ã€ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼ã€‘ã€‚å…·ä½“çš„å±æ€§å‚æ•°çœ‹æ³¨é‡Šã€‚ å› ä¸ºä¸Šé¢çš„é‚£äº›éƒ½æ˜¯å°è£…åœ¨ä¸€ä¸ªæŠ½è±¡ç±»AbstractGuavaCacheé‡Œé¢çš„ï¼Œæ‰€ä»¥æˆ‘åˆå°è£…äº†ä¸€ä¸ªCacheMangerç”¨æ¥ç®¡ç†ç¼“å­˜ï¼Œå¹¶å¯¹å¤–æä¾›å…·ä½“çš„åŠŸèƒ½æ¥å£ï¼›åœ¨CacheMangerä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»æ¥åˆ›å»ºå½“å‰é»˜è®¤çš„ç¼“å­˜ã€‚ 12345678910111213141516171819202122232425262728/** * ä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°ä¸€ä¸ªé»˜è®¤çš„ç¼“å­˜ï¼Œå§”æ‰˜ç»™manageræ¥ç®¡ç† * * DefaultGuavaCache ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å•ä¾‹æ¨¡å¼ * @param &lt;String&gt; * @param &lt;Object&gt; */private static class DefaultGuavaCache&lt;String, Object&gt; extendsAbstractGuavaCache&lt;String, Object&gt; &#123; private static AbstractGuavaCache cache = new DefaultGuavaCache(); /** * å¤„ç†è‡ªåŠ¨è½½å…¥ç¼“å­˜ï¼ŒæŒ‰å®é™…æƒ…å†µè½½å…¥ * è¿™é‡Œ * @param key * @return */ @Override protected Object fetchData(String key) &#123; return null; &#125; public static AbstractGuavaCache getInstance() &#123; return DefaultGuavaCache.cache; &#125;&#125; å¤§æ¦‚æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œå¦‚æœéœ€è¦æ‰©å±•ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§å®é™…çš„éœ€æ±‚å»æ‰©å±•AbstractGuavaCacheè¿™ä¸ªæŠ½è±¡ç±»å°±å¯ä»¥äº†ã€‚å…·ä½“çš„ä»£ç è´´åœ¨ä¸‹é¢äº†ã€‚ å®Œæ•´çš„ä¸¤ä¸ªç±»AbstractGuavaCache123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137public abstract class AbstractGuavaCache&lt;K, V&gt; &#123; protected final Logger LOGGER = LoggerFactory.getLogger(AbstractGuavaCache.class); private static final int MAX_SIZE = 1000; private static final int EXPIRE_TIME = 10; /** ç”¨äºåˆå§‹åŒ–cacheçš„å‚æ•°åŠå…¶ç¼ºçœå€¼ */ private static final int DEFAULT_SIZE = 100; private int maxSize = MAX_SIZE; private int expireTime = EXPIRE_TIME; /** æ—¶é—´å•ä½ï¼ˆåˆ†é’Ÿï¼‰ */ private TimeUnit timeUnit = TimeUnit.MINUTES; /** Cacheåˆå§‹åŒ–æˆ–è¢«é‡ç½®çš„æ—¶é—´ */ private Date resetTime; /** åˆ†åˆ«è®°å½•å†å²æœ€å¤šç¼“å­˜ä¸ªæ•°åŠæ—¶é—´ç‚¹*/ private long highestSize = 0; private Date highestTime; private volatile LoadingCache&lt;K, V&gt; cache; public LoadingCache&lt;K, V&gt; getCache() &#123; //ä½¿ç”¨åŒé‡æ ¡éªŒé”ä¿è¯åªæœ‰ä¸€ä¸ªcacheå®ä¾‹ if(cache == null)&#123; synchronized (this) &#123; if(cache == null)&#123; //CacheBuilderçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œåªèƒ½é€šè¿‡å…¶é™æ€æ–¹æ³•ne //wBuilder()æ¥è·å¾—CacheBuilderçš„å®ä¾‹ cache = CacheBuilder.newBuilder() //è®¾ç½®ç¼“å­˜å®¹å™¨çš„åˆå§‹å®¹é‡ä¸º100 .initialCapacity(DEFAULT_SIZE) //ç¼“å­˜æ•°æ®çš„æœ€å¤§æ¡ç›® .maximumSize(maxSize) //å®šæ—¶å›æ”¶:ç¼“å­˜é¡¹åœ¨ç»™å®šæ—¶é—´å†…æ²¡æœ‰è¢«å†™è®¿é—® //ï¼ˆåˆ›å»ºæˆ–è¦†ç›–ï¼‰ï¼Œåˆ™å›æ”¶ã€‚ .expireAfterWrite(expireTime, timeUnit) //å¯ç”¨ç»Ÿè®¡-&gt;ç»Ÿè®¡ç¼“å­˜çš„å‘½ä¸­ç‡ç­‰ .recordStats() //è®¾ç½®ç¼“å­˜çš„ç§»é™¤é€šçŸ¥ .removalListener((notification)-&gt; &#123; if (LOGGER.isDebugEnabled())&#123; //... &#125; &#125;) .build(new CacheLoader&lt;K, V&gt;() &#123; @Override public V load(K key) throws Exception &#123; return fetchData(key); &#125; &#125;); this.resetTime = new Date(); this.highestTime = new Date(); if (LOGGER.isInfoEnabled())&#123; //... &#125; &#125; &#125; &#125; return cache; &#125; /** * æ ¹æ®keyä»æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºä¸­è·å–ä¸€ä¸ªvalueï¼Œå¹¶è¢«è‡ªåŠ¨ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚ * * æ”¹æ–¹æ³•æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»éœ€è¦å®ç° * * @param key * @return value,è¿åŒkeyä¸€èµ·è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­çš„ã€‚ */ protected abstract V fetchData(K key); /** * ä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼ˆç¬¬ä¸€æ¬¡è‡ªåŠ¨è°ƒç”¨fetchDataä»å¤–éƒ¨è·å–æ•°æ®ï¼‰ï¼Œå¹¶å¤„ç†å¼‚å¸¸ * @param key * @return Value * @throws ExecutionException */ protected V getValue(K key) throws ExecutionException &#123; V result = getCache().get(key); if (getCache().size() &gt; highestSize) &#123; highestSize = getCache().size(); highestTime = new Date(); &#125; return result; &#125; public int getMaxSize() &#123; return maxSize; &#125; public void setMaxSize(int maxSize) &#123; this.maxSize = maxSize; &#125; public int getExpireTime() &#123; return expireTime; &#125; public void setExpireTime(int expireTime) &#123; this.expireTime = expireTime; &#125; public TimeUnit getTimeUnit() &#123; return timeUnit; &#125; public void setTimeUnit(TimeUnit timeUnit) &#123; this.timeUnit = timeUnit; &#125; public Date getResetTime() &#123; return resetTime; &#125; public void setResetTime(Date resetTime) &#123; this.resetTime = resetTime; &#125; public long getHighestSize() &#123; return highestSize; &#125; public void setHighestSize(long highestSize) &#123; this.highestSize = highestSize; &#125; public Date getHighestTime() &#123; return highestTime; &#125; public void setHighestTime(Date highestTime) &#123; this.highestTime = highestTime; &#125;&#125; DefaultGuavaCacheManager123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687public class DefaultGuavaCacheManager &#123; private static final Logger LOGGER = LoggerFactory.getLogger(DefaultGuavaCacheManager.class); //ç¼“å­˜åŒ…è£…ç±» private static AbstractGuavaCache&lt;String, Object&gt; cacheWrapper; /** * åˆå§‹åŒ–ç¼“å­˜å®¹å™¨ */ public static boolean initGuavaCache() &#123; try &#123; cacheWrapper = DefaultGuavaCache.getInstance(); if (cacheWrapper != null) &#123; return true; &#125; &#125; catch (Exception e) &#123; LOGGER.error("Failed to init Guava cache;", e); &#125; return false; &#125; public static void put(String key, Object value) &#123; cacheWrapper.getCache().put(key, value); &#125; /** * æŒ‡å®šç¼“å­˜æ—¶æ•ˆ * @param key */ public static void invalidate(String key) &#123; cacheWrapper.getCache().invalidate(key); &#125; /** * æ‰¹é‡æ¸…é™¤ * @param keys */ public static void invalidateAll(Iterable&lt;?&gt; keys) &#123; cacheWrapper.getCache().invalidateAll(keys); &#125; /** * æ¸…é™¤æ‰€æœ‰ç¼“å­˜é¡¹ ï¼š æ…ç”¨ */ public static void invalidateAll() &#123; cacheWrapper.getCache().invalidateAll(); &#125; public static Object get(String key) &#123; try &#123; return cacheWrapper.getCache().get(key); &#125; catch (Exception e) &#123; LOGGER.error("Failed to get value from guava cache;", e); &#125; return null; &#125; /** * ä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°ä¸€ä¸ªé»˜è®¤çš„ç¼“å­˜ï¼Œå§”æ‰˜ç»™manageræ¥ç®¡ç† * * DefaultGuavaCache ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å•ä¾‹æ¨¡å¼ * @param &lt;String&gt; * @param &lt;Object&gt; */ private static class DefaultGuavaCache&lt;String, Object&gt; extends AbstractGuavaCache&lt;String, Object&gt; &#123; private static AbstractGuavaCache cache = new DefaultGuavaCache(); /** * å¤„ç†è‡ªåŠ¨è½½å…¥ç¼“å­˜ï¼ŒæŒ‰å®é™…æƒ…å†µè½½å…¥ * @param key * @return */ @Override protected Object fetchData(String key) &#123; return null; &#125; public static AbstractGuavaCache getInstance() &#123; return DefaultGuavaCache.cache; &#125; &#125;&#125; å‚è€ƒGoogle Guavaå®˜æ–¹æ•™ç¨‹ï¼ˆä¸­æ–‡ç‰ˆï¼‰]]></content>
      <categories>
        <category>ç¼“å­˜</category>
      </categories>
      <tags>
        <tag>cache</tag>
        <tag>guava</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªç»„ä»¶ SOFATracer å’Œ Zipkin æ¨¡å‹è½¬æ¢åŸç†]]></title>
    <url>%2F2018%2F11%2F10%2Fsofatracertwo%2F</url>
    <content type="text"><![CDATA[SOFATracer æ˜¯ä¸€ä¸ªç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªçš„ç»„ä»¶ï¼Œé€šè¿‡ç»Ÿä¸€çš„ traceId å°†è°ƒç”¨é“¾è·¯ä¸­çš„å„ç§ç½‘ç»œè°ƒç”¨æƒ…å†µä»¥æ—¥å¿—çš„æ–¹å¼è®°å½•ä¸‹æ¥æˆ–è€…ä¸ŠæŠ¥åˆ° zipkinï¼Œä»¥è¾¾åˆ°é€è§†åŒ–ç½‘ç»œè°ƒç”¨çš„ç›®çš„ã€‚è¿™ç§ä»¥æ—¥å¿—çš„æ–¹å¼è®°å½•ä¸‹æ¥æˆ–è€…ä¸ŠæŠ¥åˆ°zipkiné€šå¸¸ç§°ä¸º Reportï¼Œå³æ•°æ®ä¸ŠæŠ¥ SOFATracer çš„æ•°æ®ä¸ŠæŠ¥æ˜¯åœ¨éµå¾ª OpenTracing è§„èŒƒåŸºç¡€ä¸Šæ‰©å±•å‡ºæ¥çš„èƒ½åŠ›ï¼ŒOpenTracing è§„èŒƒæœ¬èº«åªæ˜¯çº¦å®šäº†æ•°æ®æ¨¡å‹å’Œè¡Œä¸ºã€‚æœ¬æ–‡ä¸»è¦ç›®çš„åœ¨äºåˆ†æ SOFATracer çš„æ•°æ®ä¸ŠæŠ¥åŠŸèƒ½éƒ¨åˆ†ï¼Œä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š åŸºäº OpenTracing è§„èŒƒçš„åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆ SOFATracer Report æ•°æ®ä¸ŠæŠ¥æ¨¡å‹ SOFATracer å’Œ Zipkin æ¨¡å‹è½¬æ¢åŸç† åŸºäº OpenTracing è§„èŒƒçš„åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆ OpenTracing æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ ‡å‡†åŒ–å±‚ï¼Œå®ƒä½äºåº”ç”¨ç¨‹åº/ç±»åº“å’Œè¿½è¸ªæˆ–æ—¥å¿—åˆ†æç¨‹åºä¹‹é—´ã€‚ä¸ºäº†è§£å†³ä¸åŒçš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿ API ä¸å…¼å®¹çš„é—®é¢˜ï¼ŒOpenTracing æä¾›äº†ä¸€å¥—å¹³å°æ— å…³ã€å‚å•†æ— å…³çš„ APIï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ç»Ÿä¸€çš„æ¦‚å¿µå’Œæ•°æ®æ ‡å‡†ã€‚å…³äºå¯¹ OpenTracing æ ‡å‡†çš„ç‰ˆæœ¬åŒ–æè¿°å¯ä»¥å‚è€ƒ specification.mdï¼ˆhttps://github.com/opentracing/specification/blob/master/specification.mdï¼‰ã€‚ä¸€äº›å…·ä½“çš„æ¦‚å¿µä¸‹é¢å°†ç»“åˆSOFATracer çš„å®ç°æ¥ä¸€ä¸€è¯´æ˜ã€‚ ç›®å‰åŸºäº OpenTracing è§„èŒƒå®ç°çš„é“¾è·¯è·Ÿè¸ªç»„ä»¶æœ‰ Jaegerï¼ŒAppdashï¼ŒApache SkyWalking ï¼ŒDatadog ç­‰ã€‚åƒè°·æ­Œçš„ StackDriver Tracer å®é™…ä¸Šå¹¶ä¸æ˜¯éµå¾ª OpenTracing è§„èŒƒçš„ï¼Œä½†æ˜¯éƒ½æºè‡ªäº Dapper è¿™ç¯‡è®ºæ–‡ã€‚ è§„èŒƒå…¶å®å°±æ˜¯æ¨¡å‹å’Œè¡Œä¸ºçš„çº¦æŸï¼Œåœ¨ OpenTracing è§„èŒƒä¸­æœ‰ä¸‰ç§å…³é”®å’Œç›¸äº’å…³è”çš„æ¨¡å‹ï¼šTracerã€Span å’ŒSpanContextï¼›å¹¶ä¸”åœ¨è§„èŒƒä¸­å¯¹äºæ¯ä¸ªæ¨¡å‹çš„è¡Œä¸ºä¹Ÿåšäº†çº¦å®šã€‚ Tracer Tracer å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç”±å¤šä¸ª Span ç»„æˆçš„æœ‰å‘æ— ç¯å›¾ã€‚ä¸€ä¸ª Tracer å¯ä»¥ç”¨æ¥æè¿°ä¸€ä¸ªè¯·æ±‚ä»å‘å‡ºåˆ°æ”¶åˆ°å“åº”æ•´ä¸ªé“¾è·¯è¿‡ç¨‹ã€‚å‰ææ˜¯éœ€è¦åœ¨é€‚å½“çš„åœ°æ–¹è¿›è¡ŒåŸ‹ç‚¹ã€‚ä¸‹å›¾å°±æ˜¯ä¸€æ¡å®Œæ•´çš„é“¾è·¯çš„å±•ç¤ºï¼š åœ¨ SOFATracer ä¸­ ï¼ŒSofaTracer å®ç°äº† Tracer æ¥å£ï¼Œå®ç°äº†æ„å»º spanï¼Œæ•°æ®è½½å…¥ï¼ˆInjectï¼‰å’Œ æ•°æ®æå–ï¼ˆExtract ) çš„èƒ½åŠ›ã€‚ Start a new Span ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Span ã€‚é€šè¿‡æŒ‡å®šçš„ operationName æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Spanã€‚operationName è¡¨ç¤ºç”± Span å®Œæˆçš„å…·ä½“çš„å·¥ä½œ ( ä¾‹å¦‚ï¼ŒRPC æ–¹æ³•åç§°ã€å‡½æ•°åç§°æˆ–ä¸€ä¸ªè¾ƒå¤§çš„è®¡ç®—ä»»åŠ¡ä¸­çš„é˜¶æ®µçš„åç§°)ã€‚ Inject a SpanContextï¼šå°† SpanContext æ³¨å…¥åˆ°ç»™å®šç±»å‹çš„ â€œcarrierâ€ ä¸­ï¼Œç”¨äºè¿›è¡Œè·¨è¿›ç¨‹çš„ä¼ è¾“ã€‚ Extract a SpanContext ï¼šä»è½½ä½“ä¸­æå–ä¸­ spanContext å®ä¾‹å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯æ³¨å…¥çš„é€†è¿‡ç¨‹ã€‚spanContext ä¸­åŒ…æ‹¬äº†è´¯ç©¿æ•´ä¸ªé“¾è·¯çš„ traceId ï¼Œå˜åŒ–çš„ spanId ï¼Œçˆ¶ spanId ä»¥åŠé€ä¼ æ•°æ®ç­‰ã€‚ Span ä¸€ä¸ª span ä»£è¡¨ç³»ç»Ÿä¸­å…·æœ‰å¼€å§‹æ—¶é—´å’Œæ‰§è¡Œæ—¶é•¿çš„é€»è¾‘è¿è¡Œå•å…ƒã€‚span ä¹‹é—´é€šè¿‡åµŒå¥—æˆ–è€…é¡ºåºæ’åˆ—å»ºç«‹é€»è¾‘å› æœå…³ç³»ï¼Œç„¶åå†é€šè¿‡è¿™ç§å…³ç³»æ¥æ„å»ºæ•´ä¸ªè°ƒç”¨é“¾è·¯ï¼ˆTracerï¼‰ã€‚ OpenTracing è§„èŒƒ API çº¦å®š Span çš„æ¨¡å‹å¦‚ä¸‹ï¼ˆå®é™…ä¸Šå°±æ˜¯ Span æ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•ï¼Œéœ€è¦ç”±éµå¾ªè¯¥è§„èŒƒçš„å®ç°è€…å¿…é¡»æä¾›çš„æœ€å°èƒ½åŠ›çš„é›†åˆï¼‰ï¼š Get the Spanâ€™s SpanContextï¼š é€šè¿‡ Span è·å– SpanContext ï¼ˆå³ä½¿ span å·²ç»ç»“æŸï¼Œæˆ–è€…å³å°†ç»“æŸï¼‰ Finishï¼šç»“æŸä¸€ä¸ª Span ã€‚Finish å¿…é¡»æ˜¯ span å®ä¾‹çš„æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨ä¸»çº¿ç¨‹å¤„ç†å¤±è´¥æˆ–è€…å…¶ä»–ç¨‹åºé”™è¯¯å‘ç”Ÿæ—¶ï¼ŒFinish æ–¹æ³•å¯èƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ç°è€…åº”è¯¥æ˜ç¡®çš„è®°å½• Spanï¼Œä¿è¯æ•°æ®çš„æŒä¹…åŒ–ï¼ˆè¿™ä¸€ç‚¹ SOFATracer å…¶å®æ˜¯æ²¡æœ‰åšçš„ï¼‰ã€‚ Set a K:V tag on the Spanï¼šä¸º Span è®¾ç½® tag ã€‚tag çš„ key å¿…é¡»æ˜¯ string ç±»å‹ï¼›value å¿…é¡»æ˜¯ stringã€boolean æˆ–æ•°å­—ç±»å‹ã€‚é€šå¸¸ä¼šä½¿ç”¨ Tag æ¥è®°å½•è·Ÿè¸ªç³»ç»Ÿæ„Ÿå…´è¶£çš„ä¸€äº›æŒ‡æ ‡æ•°æ®ã€‚ Add a new log eventï¼šä¸º Span å¢åŠ ä¸€ä¸ª log äº‹ä»¶ï¼Œç”¨äºè®°å½• Span ç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚ Set a Baggage itemï¼š è®¾ç½®ä¸€ä¸ª string:string ç±»å‹çš„é”®å€¼å¯¹ï¼Œä¸€èˆ¬æ˜¯ä¸šåŠ¡æ•°æ®åœ¨å…¨é“¾è·¯æ•°æ®é€æ˜ä¼ è¾“ï¼Œå­˜å‚¨åœ¨ SpanContext ä¸­ã€‚ Get a Baggage itemï¼š é€šè¿‡ key è·å– Baggage ä¸­çš„å…ƒç´ ã€‚ SpanContext Span ä¸Šä¸‹æ–‡ï¼Œå‡ ä¹åŒ…å«äº†éœ€è¦åœ¨é“¾è·¯ä¸­ä¼ é€’çš„å…¨éƒ¨ä¿¡æ¯ã€‚å¦å¤–ï¼ŒSpan é—´ References å°±æ˜¯é€šè¿‡ SpanContext æ¥å»ºç«‹å…³ç³»çš„ã€‚æ ¹æ® OpenTracing è§„èŒƒè¦æ±‚ï¼ŒSpanContext æ˜¯ä¸å¯å˜çš„ï¼Œç›®çš„æ˜¯é˜²æ­¢ç”±äº Span çš„ç»“æŸå’Œç›¸äº’å…³ç³»ï¼Œé€ æˆçš„å¤æ‚ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚ SpanContext è¡¨ç¤ºå¿…é¡»ä¼ æ’­åˆ°åä»£ Spans å’Œè·¨è¿›ç¨‹è¾¹ç•Œçš„ Span çŠ¶æ€ã€‚SpanContext åœ¨é€»è¾‘ä¸Šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š è·¨ Span è¾¹ç•Œä¼ æ’­çš„ç”¨æˆ·çº§ â€œBaggageâ€ è¯†åˆ«æˆ–ä»¥å…¶ä»–æ–¹å¼å…³è” Span å®ä¾‹æ‰€éœ€çš„ä»»ä½• Tracer å®ç°ç‰¹å®šå­—æ®µï¼ˆä¾‹å¦‚ï¼Œtrace_idï¼Œspan_idï¼Œsamplingï¼Œå…ƒç»„ï¼‰ Opentracing ä¸­ SpanContext æ¥å£ä¸­åªæœ‰ä¸€ä¸ª baggageItems æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥éå†æ‰€æœ‰çš„ baggage å…ƒç´ ã€‚ 123public interface SpanContext &#123; Iterable&lt;Map.Entry&lt;String, String&gt;&gt; baggageItems();&#125; SOFATracer æ‰©å±•çš„ Tracer çš„èƒ½åŠ›ä¸Šé¢ç®€å•ä»‹ç»äº† OpenTracing è§„èŒƒ API å¯¹äº Tracerã€Spanã€SpanContext ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å‹çš„è§„èŒƒå®šä¹‰ã€‚ä¸‹é¢æ¥çœ‹ä¸‹ SOFATracer æ˜¯å¦‚ä½•éµå¾ªè§„èŒƒå¹¶åšæ‰©å±•çš„ã€‚ åœ¨ OpenTracing è§„èŒƒ åŸºç¡€ä¸Šï¼ŒSOFATracer æä¾›äº†å®ç°ï¼Œå¹¶åœ¨è§„èŒƒåŸºç¡€ä¸Šæä¾›äº†æ‰©å±•åŠŸèƒ½ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸Šå›¾ä¸­æ ‡ç»¿è‰²çš„éƒ¨åˆ†ï¼Œå³æ•°æ®ä¸ŠæŠ¥åŠŸèƒ½ã€‚ SOFATracer ä¸­æä¾›äº† Report æ¥å£ï¼Œç„¶ååŸºäºæ­¤æ¥å£æ‰©å±•äº†ä¸¤ä¸ªå®ç°ï¼š ç¬¬ä¸€ç§ Report æ‰©å±•æ˜¯åŸºäº Disruptorï¼ˆhttps://github.com/LMAX-Exchange/disruptorï¼‰ é«˜æ€§èƒ½æ— é”å¾ªç¯é˜Ÿåˆ—çš„å¼‚æ­¥è½åœ°ç£ç›˜çš„æ—¥å¿—æ‰“å°ã€‚ ç¬¬äºŒç§ Report æ‰©å±•æ˜¯æä¾›è¿œç¨‹ä¸ŠæŠ¥ï¼Œèƒ½å¤Ÿå°† SOFATracer çš„é“¾è·¯æ•°æ®æ¨¡å‹æ±‡æŠ¥åˆ° Zipkin ä¸­åšè°ƒç”¨é“¾è·¯çš„å±•ç¤ºã€‚ å½“ç„¶ï¼ŒSOFATracer ä¹Ÿå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ä¸ŠæŠ¥åŠŸèƒ½ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„å·¥ç¨‹ä»£ç ä¸­å®ç° Report æ¥å£å³å¯ï¼Œä¸‹é¢æ˜¯ Report æ¥å£çš„å®šä¹‰ï¼š 123456789101112public interface Reporter &#123; // ä¸ŠæŠ¥åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æŒä¹…åŒ–ç±»å‹ String REMOTE_REPORTER = "REMOTE_REPORTER"; // ç»„åˆç±»å‹ String COMPOSITE_REPORTER = "COMPOSITE_REPORTER"; // è·å– Reporter å®ä¾‹ç±»å‹ String getReporterType(); // ä¸ŠæŠ¥ span void report(SofaTracerSpan span); // å…³é—­ä¸ŠæŠ¥ span çš„èƒ½åŠ› void close();&#125; SOFATracer Report æ•°æ®ä¸ŠæŠ¥æ¨¡å‹ ä¸Šé¢æåˆ° SOFATracer çš„ Report æœ‰ä¸¤ç§æœºåˆ¶ï¼Œä¸€ç§æ˜¯è½åˆ°ç£ç›˜ï¼Œå¦å¤–ä¸€ç§æ˜¯ä¸ŠæŠ¥åˆ° zipkinã€‚SOFATracer ä¸­è¿™ä¸¤ç§æ–¹æ¡ˆå¹¶ä¸æ˜¯äºŒé€‰ä¸€çš„ï¼Œè€Œæ˜¯å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªå®ç°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ŠæŠ¥æ•°æ®åˆ° zipkinï¼Œå…ˆå¼•å…¥ tracer-sofa-boot-starter è¿™ä¸ªä¾èµ–ï¼Œå¹¶è¿›è¡Œç›¸å…³ zipkin çš„é…ç½®ä¹‹åå°±å¯ä»¥å°†é“¾è·¯æ•°æ®ä¸ŠæŠ¥åˆ° zipkinï¼Œå¦‚æœæ²¡æœ‰å¼•å…¥ä¾èµ–åˆ™ä¸ä¼šä¸ŠæŠ¥ã€‚æœ¬èŠ‚æ¥åˆ†æä¸‹ SOFATracer ä¸ŠæŠ¥æ•°æ®è¿‡ç¨‹çš„å…·ä½“é€»è¾‘ã€‚ ä¸Šé¢è¿™å¼ å›¾æè¿°äº†æ•°æ®ä¸ŠæŠ¥çš„å‡ ç§æ–¹å¼ï¼š ç»¿è‰²éƒ¨åˆ†ï¼Œä¸ŠæŠ¥ zipkinï¼šè¿™é‡Œå…¶å®å°±æ˜¯å®ç°ä¸ŠæŠ¥ zipkin çš„ä¸€ä¸ªå›è°ƒï¼Œå½“è¿›è¡Œ reportSpan æ“ä½œæ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªinvokeReportListeners ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯é€šçŸ¥æ‰€æœ‰å®ç°äº† SpanReportListener æ¥å£çš„ç±»æ‰§è¡Œå›è°ƒæ–¹æ³•ï¼Œç„¶ååœ¨è¿™ä¸ªå›è°ƒæ–¹æ³•ä¸­å°† span æ•°æ®ä¸ŠæŠ¥åˆ° zipkinã€‚ çº¢è‰²éƒ¨åˆ†ï¼Œè¾“å‡ºåˆ°ç£ç›˜ï¼šSOFATracer ä¸ºäº†æä¾›æ›´å¥½çš„æ‰©å±•èƒ½åŠ›ï¼Œå°†è¾“å‡ºæ—¥å¿—çš„ Report ç»†åˆ†ä¸º client å’Œ server ä¸¤ç§ï¼›å¹¶åœ¨ Tracer åŸºç±»ä¸­æä¾› generateClientStatReporter å’Œ generateServerStatReporter ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä¾›ä¸åŒçš„ç»„ä»¶è‡ªå·±æ¥å®ç°ä¸€äº›ç‰¹æ®ŠåŒ–çš„å®šåˆ¶ã€‚ å…³äºä½•æ—¶è¿›è¡Œä¸ŠæŠ¥ï¼Œå…¶å®è¿™ä¸ªåœ¨ Opentracing API çš„è§„èŒƒä¸­å·²ç»ç»™å‡ºäº†æ˜ç¡®çš„æ—¶æœºã€‚åœ¨ä¸Šé¢çš„ä»‹ç»ä¸­æåˆ°ï¼Œâ€œFinishå¿…é¡»æ˜¯ span å®ä¾‹çš„æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•â€ï¼Œå½“ finish æ–¹æ³•è¢«è°ƒç”¨æ—¶ä¹Ÿå°±æ„å‘³ç€ä¸€ä¸ª span ç”Ÿå‘½å‘¨æœŸçš„ç»“æŸï¼Œä¸ºäº†ä¿è¯ span æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼ŒSOFATracer reportSpan çš„é€»è¾‘å°±æ˜¯åœ¨ finish æ–¹æ³•è¢«è°ƒç”¨æ—¶è§¦å‘æ‰§è¡Œã€‚ æ•°æ®è½åœ°ç£ç›˜ SOFATracer æ—¥å¿—è½ç›˜æ˜¯åŸºäºDisruptoré«˜æ€§èƒ½æ— é”å¾ªç¯é˜Ÿåˆ—å®ç°çš„ï¼Œæä¾›äº†å¼‚æ­¥æ‰“å°æ—¥å¿—åˆ°æœ¬åœ°ç£ç›˜çš„èƒ½åŠ›ã€‚ append : è¿½æº¯ Reportï¼Œæ— è®ºæ˜¯ clientReport è¿˜æ˜¯ serverReport ï¼Œåº•å±‚å‡ä¾èµ– DiskReporterImpl çš„å®ç°ã€‚DiskReporterImpl æ˜¯ SOFATracer ç»Ÿç­¹å¤„ç†æ—¥å¿—è½ç›˜çš„ç±»ã€‚clientReport å’Œ serverReport çš„æœ€ç»ˆè°ƒç”¨éƒ½ä¼šèµ°åˆ°DiskReporterImpl ä¸­çš„ digestReport è¿™ä¸ªæ–¹æ³•ã€‚digestReport ä¸­ä¼šå°†å½“å‰ span append åˆ°ç¯å½¢ç¼“å†²é˜Ÿåˆ—ä¸­ï¼Œappend æ“ä½œå°±æ˜¯å‘å¸ƒä¸€ä¸ªäº‹ä»¶çš„è¿‡ç¨‹ã€‚ consumeï¼šconsume æ˜¯ Disruptor ä¸­çš„å¯¹åº”çš„æ¶ˆè´¹æ¨¡å‹ï¼›SOFATracer ä¸­è¿™ä¸ªæ¶ˆè´¹è€…å°±æ˜¯å°† SofaTracerSpan ä¸­çš„æ•°æ®å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­çš„ã€‚ äº‹ä»¶å‘å¸ƒè¿‡ç¨‹ï¼š æ•°æ®ä¸ŠæŠ¥ zipkin å‰é¢æåˆ°ï¼Œä¸ŠæŠ¥ zipkin çš„æ˜¯é€šè¿‡ onSpanReport è¿™ä¸ªå›è°ƒå‡½æ•°å®Œæˆçš„ã€‚tracer-sofa-boot-starter è¿™ä¸ªä¾èµ–ä¸­æä¾›äº† SpanReportListener æ¥å£å®ç° ZipkinSofaTracerSpanRemoteReporter ã€‚è€Œåœ¨ onSpanReport è¿™ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œåˆå°†å…·ä½“ä¸ŠæŠ¥å§”æ‰˜ç»™äº† AsyncReporter æ¥å¤„ç†ã€‚ 123456789@Overridepublic void onSpanReport(SofaTracerSpan span) &#123; if (span == null) &#123; return; &#125; //convert Span zipkinSpan = convertToZipkinSpan(span); this.delegate.report(zipkinSpan);&#125; æ„å»º AsyncReporter å¯¹è±¡éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š senderï¼š æ•°æ®å‘é€å™¨ï¼ŒSOFATracer ä¸­ï¼Œsender çš„æ˜¯é€šè¿‡ RestTemplate ä»¥ http æ–¹å¼ æ¥ä¸ zipkin è¿›è¡Œé€šä¿¡ä¼ è¾“çš„ã€‚ urlï¼šZipkin é»˜è®¤çš„ Collector ä½¿ç”¨ http åè®®é‡Œæ”¶é›† Trace ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯è°ƒç”¨ /api/v1/spans æˆ– /api/v2/spans æ¥ä¸ŠæŠ¥ tracer ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Zipkin V2 çš„ APIã€‚ AsyncReporter ä¸­å®é™…æ„å»ºçš„æ˜¯ BoundedAsyncReporter å¯¹è±¡ ï¼Œ å¹¶ä¸”åœ¨æ„å»ºä¸€ä¸ªå¼‚æ­¥æŠ¥å‘Šå™¨æ˜¯ï¼Œä¼šæ ¹æ®messageTimeoutNanos æ˜¯å¦å¤§äº 0 æ¥å†³å®šæ˜¯å¦èµ·ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ flushThreadï¼›flushThread ä½œç”¨æ˜¯ä¸€ç›´å¾ªç¯è°ƒç”¨ BoundedAsyncReporter çš„ flush æ–¹æ³•ï¼Œå°†å†…å­˜ä¸­çš„ Span ä¿¡æ¯ä¸ŠæŠ¥ç»™ Zipkinã€‚å…·ä½“ç»†èŠ‚è¿™é‡Œä¸å±•å¼€åˆ†æã€‚ SOFATracer å’Œ Zipkin æ¨¡å‹è½¬æ¢åŸç† åœ¨ä¸Šå°èŠ‚ä¸­è´´å‡ºçš„å°æ®µä»£ç ä¸­ï¼Œé™¤äº†æ„å»º delegate å¯¹è±¡ç”¨äºæ‰§è¡Œä¸ŠæŠ¥å¤–ï¼›å¦ä¸€ä¸ªå…³é”®å°±æ˜¯ SOFATracer çš„ Span æ¨¡å‹è½¬æ¢æˆ Zipkin Span æ¨¡å‹ã€‚SOFATracer ä» 2.2.0 ç‰ˆæœ¬ä¹‹åæ”¯æŒ Zipkin v2 çš„æ¨¡å‹ ï¼Œå¯¹äº Zipkin v1 çš„æ¨¡å‹ä¸åœ¨æä¾›æ”¯æŒã€‚ Zipkin v2çš„æ¨¡å‹ ä¸‹é¢æ˜¯ zipkin GitHub ä¸Šæä¾›çš„ Zipkin v2 çš„æ¨¡å‹çš„ç»“æ„åŒ–æ•°æ® Demoã€‚å…³äº Zipkin çš„ Span æ¨¡å‹æ”¯æŒå¯ä»¥æŸ¥çœ‹ Simplified span2 format #1499 12345678910111213141516171819202122&#123; "kind": "CLIENT", "traceId": "5af7183fb1d4cf5f", "parentId": "6b221d5bc9e6496c", "id": "352bff9a74ca9ad2", "name": "query", "timestamp": 1461750040359000, "duration": 5000, "localEndpoint": &#123; "serviceName": "zipkin-server", "ipv4": "172.19.0.3", "port": 9411 &#125;, "remoteEndpoint": &#123; "serviceName": "mysql", "ipv4": "172.19.0.2", "port": 3306 &#125;, "tags": &#123; "jdbc.query": "//....discard" &#125;&#125; Zipkin v2 çš„æ¨¡å‹ç»“æ„è¾ƒä¸ºç®€æ´ï¼Œæ•´ä½“çœ‹èµ·æ¥å¹¶æ²¡æœ‰ä»€ä¹ˆç¹é‡ï¼Œè¿™ç§å¯¹äºä½¿ç”¨è€…æ¥è¯´æ˜¯å¾ˆå‹å¥½çš„ï¼Œæ–¹ä¾¿ç†è§£ã€‚å…¶å®åœ¨Zipkin v1 æ¨¡å‹æ—¶ï¼Œå…¶æ•´ä¸ªæ¨¡å‹ä¹Ÿæ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œzipkin ç¤¾åŒºå¯¹äº Zipkin æ•°æ®æ¨¡å‹çš„å˜æ›´ä¹Ÿæœ‰è®¨è®ºï¼Œè§ Zipkin v2 span model #939 ï¼›åƒç°åœ¨ v2 æ¨¡å‹ä¸­çš„ tagsï¼Œæ›¿æ¢äº†åŸæœ¬ v1 ä¸­çš„ binaryAnnotationsï¼ŒbinaryAnnotations çš„å­˜åœ¨æ˜¯ v1 æ¨¡å‹å¤æ‚çš„é‡è¦åŸå› ã€‚è¯¦è§ å»é™¤åŸå› ã€‚ SofaTracerSpan æ¨¡å‹SofaTracerSpan æ˜¯åŸºäº Opentracing æ ‡å‡†æ¥çš„ã€‚ä½†æ˜¯ Opentracing æ ‡å‡†å¹¶æ²¡æœ‰è§„å®šä¸€ä¸ª Span æ¨¡å‹å¿…é¡»æœ‰å“ªäº›å±æ€§ã€‚æ‰€ä»¥å„ä¸ªåŸºäºè¯¥æ ‡å‡†çš„äº§å“åœ¨äº Span çš„æ¨¡å‹ä¸Šæ˜¯ä¸ç»Ÿä¸€çš„ï¼Œå¤§å¤šä¼šåŸºäºå…¶æœ¬èº«äº§ç”Ÿçš„åœºæ™¯å¸¦æœ‰ä¸€äº›ç‰¹æ®Šçš„å±æ€§ã€‚ 12345678910111213141516171819202122232425&#123; "client":true, "server":false, "durationMicroseconds":775, "endTime":1536288243446, "logType":"httpclient-digest.log", "operationName":"GET", "logs":[ // ... ], "sofaTracer":&#123; "clientReporter":&#123;&#125;, "tracerTags":&#123;&#125;, "tracerType":"httpclient" &#125;, "sofaTracerSpanContext":&#123; // sofaTracerSpanContext info &#125;, "spanReferences":[], "startTime":1536288242671, "tagsWithBool":&#123;&#125;, "tagsWithNumber":&#123;&#125;, "tagsWithStr":&#123;&#125;, "thisAsParentWhenExceedLayer":&#123;&#125;&#125; SOFATracer çš„ Span æ¨¡å‹ç›¸è¾ƒäº Opentracing è§„èŒƒæ¨¡å‹å’Œ Zipkin v2 çš„æ¨¡å‹æ¥è¯´ï¼Œè®°å½•çš„æ•°æ®ä¿¡æ¯æ›´åŠ ä¸°å¯Œï¼Œä¸”åœ¨ Opentracing è§„èŒƒçš„åŸºç¡€ä¸Šæ‰©å±•äº†ä¸€å¥—è‡ªå·±çš„ APIï¼Œå¯ä»¥è®©ä½¿ç”¨è€…èƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿çš„åœ¨è‡ªå·±çš„ä»£ç ä¸­æ¥è·å–é“¾è·¯ä¸­çš„ä¿¡æ¯ï¼›åœ¨æ—¥å¿—ä¸­å±•ç¤ºæ›´å¤šçš„ span ä¿¡æ¯ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å»äº†è§£ä¸€äº›è°ƒç”¨ç»†èŠ‚ï¼Œåœ¨å‘ç”Ÿé—®é¢˜æ—¶ï¼Œä¹Ÿæä¾›äº†æ›´å¤šæ’æŸ¥é—®é¢˜çš„ä¾æ®ä¿¡æ¯ã€‚ æ¨¡å‹è½¬æ¢å¯¹ç…§ä¸ºäº†ä½¿å¾— SOFATracer çš„æ•°æ®èƒ½å¤Ÿè¢« zipkin è§£æï¼Œéœ€è¦å°† SOFATracer çš„ Span æ¨¡å‹è½¬æ¢æˆ zipkin v2 çš„æ•°æ®æ¨¡å‹ã€‚ Zipkin v2 Span Model SOFATracer Span Model å¤‡æ³¨ traceId traceId traceId id spanId spanId parentId parentId çˆ¶spanId name operationName span åï¼Œç”¨æ¥æè¿°å½“å‰span çš„è¡Œä¸º duration - å½“å‰spançš„æ—¶é—´è·¨åº¦;è¿™é‡Œé€šè¿‡spançš„ï¼ˆç»“æŸæ—¶é—´-å¼€å§‹æ—¶é—´ï¼‰è·å– timestamp timestamp å½“å‰spançš„å¼€å§‹æ—¶é—´ localEndPoint operationName&amp;host&amp;logData æ ‡æ˜è¿™ä¸ªspançš„æ¥æº remoteEndPoint - è¢«è°ƒç”¨æ–¹çš„æœåŠ¡åå’Œåœ°å€ tags bizBaggage &amp; tags é¢å¤–çš„ç”¨äºæè¿°spançš„ä¿¡æ¯ æ•´ä½“æ¥çœ‹ï¼ŒSpan æ¨¡å‹ç›¸ä¼¼åº¦æ˜¯å¾ˆé«˜ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸èƒ½ç›´æ¥å°†æŸäº›ç›¸åŒçš„å­—æ®µç›´æ¥è¿›è¡Œå€¼å¤åˆ¶ï¼›è¿™é‡Œæœ‰ä¸€ä¸ª æ¡ˆä¾‹ï¼šISSUE#57 ã€‚ traceId å’Œ spanId å¤„ç†zipkin åœ¨è‡ªå·±çš„æ¨¡å‹é‡Œåšäº†å¾ˆå¤šç‰¹æ®Šçš„å¤„ç†ã€‚æ¯”å¦‚ traceId éœ€æ»¡è¶³16 æˆ–è€… 32 ä½ï¼Œé•¿åº¦ä¸å¤Ÿçš„ä¼šé«˜ä½è¡¥ 0ï¼›æ‰€ä»¥åœ¨ä½¿ç”¨ SOFATracer æ—¶ï¼Œæ—¥å¿—ä¸­çš„ traceId å’Œä¸ŠæŠ¥åˆ° zipkin çš„ traceId é•¿åº¦ä¸ä¸€è‡´æ˜¯åˆç†çš„ã€‚ å…³äº spanIdï¼Œæˆ‘ä»¬æœŸæœ›åœ¨ zipkin ä¸­å±•ç¤ºæ˜¯ä»¥ï¼ˆ0.1,0.1.1,â€¦ï¼‰è¿™ç§å½¢å¼æ¥æè¿°ï¼Œèƒ½å¤Ÿç›´è§‚çš„çœ‹åˆ° span ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ä½†æ˜¯ç›®å‰ä½¿ç”¨çš„ zipkin æ¨¡å‹å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä¸»è¦åŸå› åœ¨äºè™½ç„¶ zipkin åœ¨ v2 æ¨¡å‹ä¸­è™½ç„¶æ”¯æŒ string ç±»å‹çš„ id ï¼Œä½†æ˜¯å…¶é•¿åº¦é™åˆ¶æ˜¯16ä½ï¼Œå¯¹äº SOFATracer æ¥è¯´ï¼Œå¦‚æœå­˜åœ¨è¾ƒé•¿çš„é“¾è·¯è°ƒç”¨ï¼Œä¼šå¯¼è‡´å±‚æ¬¡ä¸¢å¤±ã€‚å¦å¤–ï¼Œå¦‚æœä¸ŠæŠ¥ zipkin çš„ span çš„ parentId ä¸º 0ï¼Œé‚£ä¹ˆ zipkin å°†ä¼šä¸è¿›è¡Œè®¾ç½®ï¼›è€Œ SOFATracer çš„ç¬¬ä¸€ä¸ª span çš„ id å°±æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´é“¾è·¯æ„å»ºå¤±è´¥ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•é€šè¿‡æ”¹å˜èµ·å§‹ id æ¥æ”¹å˜ï¼Œä¼šå¯¹æ•´ä¸ªæ¨¡å‹äº§ç”Ÿå½±å“ã€‚ç»è¿‡éªŒè¯æµ‹è¯•ï¼Œæˆ‘ä»¬æœ€ç»ˆé‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨å†²çªè¾ƒå°çš„ FNV64 Hash ç®—æ³•å°† String ç±»å‹è½¬æ¢æˆ long å‹æ¥æè¿°æˆ‘ä»¬çš„ spanIdã€‚ SOFARPC ä¸ŠæŠ¥çš„æ•°æ®å¤„ç†åœ¨æ•´ä¸ªæ¨¡å‹è½¬æ¢ä¸­ï¼Œæ¯”è¾ƒæ ¸å¿ƒçš„å°±æ˜¯å¦‚ä½•å…¼å®¹ SOFARPC ä¸ŠæŠ¥çš„æ•°æ®ã€‚Zipkin åœ¨æ„å»ºé“¾è·¯æ•°æ—¶ï¼Œå…¶åŸºæœ¬çš„æ¨¡å‹æ˜¯ client-server-client-server-.. è¿™ç§æ¨¡å¼ï¼›ä¸ä¼šå‡ºç° a server calling a server è¿™ç§æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å¸¦æœ‰kind = server çš„ span çš„ çˆ¶span åº”è¯¥æ˜¯ kind = clientã€‚ SOFARPC å¯¹äºä¸€ä¸ª rpc span ä¸ŠæŠ¥äº†ä¸¤ä¸ª span ä¿¡æ¯ï¼Œè¿™ä¸¤ä¸ª span é™¤äº† kind ç±»å‹ä¸åŒä¹‹å¤–ï¼Œå…¶ä»–çš„ä¿¡æ¯æ˜¯ä¸€æ ·çš„ã€‚å½“æ•°æ®ä¸ŠæŠ¥ç»™ zipkin ä¹‹åï¼Œzipkin é€šè¿‡è‡ªå·±çš„ç®—æ³•æ¥æ„å»ºä¾èµ–æ ‘æ—¶ï¼Œä¼šå¯¹ä¸ŠæŠ¥çš„ SOFARPC æ•°æ®å¤„ç†æœ‰é—®é¢˜ã€‚ä¸‹å›¾æ˜¯æ²¡æœ‰é€‚é… SOFARPC ç”Ÿæˆçš„é“¾è·¯: è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œä» mvc åˆ° rpc ä¹‹é—´çš„å…³ç³»è¢«â€˜åˆ‡æ–­â€™äº†ã€‚ é€ æˆä¸Šè¿°é—®é¢˜çš„åŸå› åœ¨äºï¼ŒSOFATracer ä¸ŠæŠ¥æ•°æ®åˆ° zipkin æ—¶ï¼Œåœ¨ v2 æ¨¡å‹ä¸­ï¼Œzipkin ä¼šé€šè¿‡å¹¿åº¦ä¼˜å…ˆéå†æ¥æ„å»ºä¾èµ–æ ‘ï¼Œå®é™…ä¸Šåœ¨å±•ç¤º services æˆ–è€… dependencies æ—¶ï¼Œzipkin ui ä¸­çš„å±•ç¤ºä¼šä¾èµ– endpiont ä¸­çš„ serviceName ï¼›ä¸¤ä¸ªæ¡ä»¶ï¼š SOFARPC çš„ span æœ‰ä¸¤ä¸ªï¼ˆclient&amp;serverï¼‰ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ª span å…·æœ‰ç›¸åŒçš„ spanId å’Œ parentIdï¼Œspan.kind ä¸åŒã€‚ zipkin åœ¨æ„å»ºä¾èµ–æ ‘æ—¶ï¼Œä¾èµ–äº endpiont ä¸­çš„ serviceNameã€‚è¯¥ servieName ä¾èµ–äº idToNodeï¼ˆNode.TreeBuilder ä¸­çš„å±æ€§ï¼ŒMap ç»“æ„ï¼Œæ˜ å°„å…³ç³»ä¸º spanId -&gt; spanï¼‰ã€‚ 123Node&lt;V&gt; previous = idToNode.put(id, node);if (previous != null) node.setValue(mergeFunction.merge(previous.value, node.value)); è¿™é‡Œå½“å‰ node ä¸º rpc server ç±»å‹æ—¶ï¼Œprevious è¿”å›ç»“æœä¸ä¸º nullï¼Œä¼šæ‰§è¡Œ merge æ“ä½œï¼Œè¯¥ merge æ“ä½œçš„æ ¸å¿ƒå°±æ˜¯è®¾ç½®å½“å‰ rpc node çš„ remoteEndpointï¼Œå€¼ä¸º rpc client çš„ localEndpointã€‚ è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ RPC çš„ client å’Œ server Span åœ¨ Zipkin æ¨¡å‹ä¸­çš„ä¼šè¢«åˆå¹¶æˆä¸€ä¸ª spanï¼›è¿™æ ·å°±ä¼šå¯¼è‡´ server -&gt; server çš„æƒ…å†µï¼Œä¸ zipkin çš„ client -&gt; server é“¾è·¯æ¨¡å‹æœ‰å†²çªã€‚å¦‚ä¸‹å›¾ï¼ˆç»¿è‰²ä¸ºSOFATracer spanï¼Œé»„è‰²ä¸º zipkin spanï¼‰ï¼š é€šè¿‡åˆ†æ zipkin çš„æ„å»ºè¿‡ç¨‹ï¼Œé€‚é… SOFARPC ä¸ŠæŠ¥æ•°æ®æ—¶ï¼ŒSOFARPC server span çš„ remoteEndpoint ä¸èƒ½ä¾èµ– SOFARPC client span çš„ localEndpointï¼Œè€Œåº”è¯¥ä¾èµ– SOFARPC client parentSpan çš„ localEndpointã€‚ä¸‹å›¾ä¸º SOFARPC é€‚é…ä¹‹åçš„ä¾èµ–å…³ç³»å›¾ï¼š æ€»ç»“ æœ¬æ–‡ä» OpenTracing è§„èŒƒè¯´èµ·ï¼Œå¯¹ OpenTracing è§„èŒƒä¸­çš„æ¨¡å‹å’Œè¡Œä¸ºè¿›è¡Œäº†ç®€å•çš„æè¿°ã€‚ç»“åˆ OpenTracing è§„èŒƒï¼Œä»‹ç»äº†èš‚èšé‡‘æœ SOFATracer åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªçš„æ¨¡å‹å®ç°ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹ SOFATracer çš„æ•°æ®ä¸ŠæŠ¥åŠŸèƒ½è¿›è¡Œäº†è¯¦ç»†çš„åˆ†æï¼ŒåŒ…æ‹¬åŸºäº disruptor å®ç°çš„å¼‚æ­¥æ—¥å¿—è½ç›˜å’Œä¸ŠæŠ¥æ•°æ®åˆ°zipkinï¼›æœ€åå¯¹ SOFATracer å’Œ Zipkin æ¨¡å‹è½¬æ¢åŸç†è¿›è¡Œäº†è¯´æ˜ï¼Œå¹¶å¯¹ SOFARPC æ¨¡å‹æ•°æ®çš„ä¸ŠæŠ¥å¤„ç†è¿›è¡Œäº†è§£æã€‚ ç›¸å…³æ–‡æ¡£é“¾æ¥ SOFATracer GitHub Zipkin å®˜ç½‘ Zipkin GitHub opentracing è§„èŒƒ opentracing å®˜ç½‘ disruptor]]></content>
      <categories>
        <category>é“¾è·¯è·Ÿè¸ª</category>
      </categories>
      <tags>
        <tag>SOFATracer</tag>
        <tag>zipkin</tag>
        <tag>OpenTracing</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çœ‹å®Œè¿™ä¸ªä¸ä¼šé…ç½® logback ï¼Œè¯·ä½ åƒç“œï¼]]></title>
    <url>%2F2018%2F11%2F10%2Flogone%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰åœ¨ æ—¥å¿—ï¼ŸèŠä¸€èŠslf4jå§ è¿™ç¯‡æ–‡ç« ä¸­èŠäº†ä¸‹slf4jã€‚æœ¬æ–‡ä¹Ÿä»å®é™…çš„ä¾‹å­å‡ºå‘ï¼Œé’ˆå¯¹logbackçš„æ—¥å¿—é…ç½®è¿›è¡Œå­¦ä¹ ã€‚ logack ç®€ä»‹ logback å®˜ç½‘ï¼šhttps://logback.qos.ch/ ç›®å‰è¿˜æ²¡æœ‰çœ‹è¿‡æ—¥å¿—ç±»æ¡†æ¶çš„æºç ï¼Œä»…é™äºå¦‚ä½•ä½¿ç”¨ã€‚æ‰€ä»¥å°±ä¸è¯´é‚£äº›â€œç©ºè¯â€äº†ã€‚æœ€ç›´è§‚çš„è®¤çŸ¥æ˜¯ï¼š logbackå’Œlog4jæ˜¯ä¸€ä¸ªäººå†™çš„ springbooté»˜è®¤ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶æ˜¯logbackã€‚ ä¸‰ä¸ªæ¨¡å—ç»„æˆ logback-core logback-classic logback-access å…¶ä»–çš„å…³äºæ€§èƒ½ï¼Œå…³äºå†…å­˜å ç”¨ï¼Œå…³äºæµ‹è¯•ï¼Œå…³äºæ–‡æ¡£è¯¦è§æºç åŠå®˜ç½‘è¯´æ˜ logback-core æ˜¯å…¶å®ƒæ¨¡å—çš„åŸºç¡€è®¾æ–½ï¼Œå…¶å®ƒæ¨¡å—åŸºäºå®ƒæ„å»ºï¼Œæ˜¾ç„¶ï¼Œlogback-core æä¾›äº†ä¸€äº›å…³é”®çš„é€šç”¨æœºåˆ¶ã€‚logback-classic çš„åœ°ä½å’Œä½œç”¨ç­‰åŒäº Log4Jï¼Œå®ƒä¹Ÿè¢«è®¤ä¸ºæ˜¯ Log4J çš„ä¸€ä¸ªæ”¹è¿›ç‰ˆï¼Œå¹¶ä¸”å®ƒå®ç°äº†ç®€å•æ—¥å¿—é—¨é¢ SLF4Jï¼›è€Œ logback-access ä¸»è¦ä½œä¸ºä¸€ä¸ªä¸ Servlet å®¹å™¨äº¤äº’çš„æ¨¡å—ï¼Œæ¯”å¦‚è¯´tomcatæˆ–è€… jettyï¼Œæä¾›ä¸€äº›ä¸ HTTP è®¿é—®ç›¸å…³çš„åŠŸèƒ½ã€‚ é…ç½®æ–‡ä»¶è¯¦è§£è¿™éƒ¨åˆ†ä¸»è¦æ¥å­¦ä¹ ä¸‹logbacké…ç½®æ–‡ä»¶çš„ä¸€äº›é…ç½®é¡¹ã€‚ configurationå…ˆæ¥çœ‹è¿™å¼ å›¾ï¼Œè¿™ä¸ªç»“æ„å°±æ˜¯æ•´ä¸ªlogback.xmlé…ç½®æ–‡ä»¶çš„ç»“æ„ã€‚ å¯¹åº”æ¥çœ‹ä¸‹é…ç½®æ–‡ä»¶ï¼š 1234567891011121314151617&lt;configuration scan="true" scanPeriod="60 seconds" debug="false"&gt; &lt;property name="glmapper-name" value="glmapper-demo" /&gt; &lt;contextName&gt;$&#123;glmapper-name&#125;&lt;/contextName&gt; &lt;appender&gt; //xxxx &lt;/appender&gt; &lt;logger&gt; //xxxx &lt;/logger&gt; &lt;root&gt; //xxxx &lt;/root&gt; &lt;/configuration&gt; psï¼šæƒ³ä½¿ç”¨springæ‰©å±•profileæ”¯æŒï¼Œè¦ä»¥logback-spring.xmlå‘½åï¼Œå…¶ä»–å¦‚propertyéœ€è¦æ”¹ä¸ºspringProperty scan:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrueã€‚ scanPeriod:è®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ debug:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ contextNameæ¯ä¸ªloggeréƒ½å…³è”åˆ°loggerä¸Šä¸‹æ–‡ï¼Œé»˜è®¤ä¸Šä¸‹æ–‡åç§°ä¸ºâ€œdefaultâ€ã€‚ä½†å¯ä»¥ä½¿ç”¨contextNameæ ‡ç­¾è®¾ç½®æˆå…¶ä»–åå­—ï¼Œç”¨äºåŒºåˆ†ä¸åŒåº”ç”¨ç¨‹åºçš„è®°å½• propertyç”¨æ¥å®šä¹‰å˜é‡å€¼çš„æ ‡ç­¾ï¼Œpropertyæ ‡ç­¾æœ‰ä¸¤ä¸ªå±æ€§ï¼Œnameå’Œvalueï¼›å…¶ä¸­nameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueçš„å€¼æ—¶å˜é‡å®šä¹‰çš„å€¼ã€‚é€šè¿‡propertyå®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰å˜é‡åï¼Œå¯ä»¥ä½¿â€œ${name}â€æ¥ä½¿ç”¨å˜é‡ã€‚å¦‚ä¸Šé¢çš„xmlæ‰€ç¤ºã€‚ loggerç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ä»¥åŠæŒ‡å®šappenderã€‚ rootæ ¹loggerï¼Œä¹Ÿæ˜¯ä¸€ç§loggerï¼Œä¸”åªæœ‰ä¸€ä¸ªlevelå±æ€§ appenderè´Ÿè´£å†™æ—¥å¿—çš„ç»„ä»¶ï¼Œä¸‹é¢ä¼šç»†è¯´ filterfilterå…¶å®æ˜¯appenderé‡Œé¢çš„å­å…ƒç´ ã€‚å®ƒä½œä¸ºè¿‡æ»¤å™¨å­˜åœ¨ï¼Œæ‰§è¡Œä¸€ä¸ªè¿‡æ»¤å™¨ä¼šæœ‰è¿”å›DENYï¼ŒNEUTRALï¼ŒACCEPTä¸‰ä¸ªæšä¸¾å€¼ä¸­çš„ä¸€ä¸ªã€‚ DENYï¼šæ—¥å¿—å°†ç«‹å³è¢«æŠ›å¼ƒä¸å†ç»è¿‡å…¶ä»–è¿‡æ»¤å™¨ NEUTRALï¼šæœ‰åºåˆ—è¡¨é‡Œçš„ä¸‹ä¸ªè¿‡æ»¤å™¨è¿‡æ¥ç€å¤„ç†æ—¥å¿— ACCEPTï¼šæ—¥å¿—ä¼šè¢«ç«‹å³å¤„ç†ï¼Œä¸å†ç»è¿‡å‰©ä½™è¿‡æ»¤å™¨ æ¡ˆä¾‹åˆ†æé¦–å…ˆæ¥é…ç½®ä¸€ä¸ªéå¸¸ç®€å•çš„æ–‡ä»¶ã€‚è¿™é‡Œç”³è¯·ä¸‹ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ logback-spring.xmlã€‚å’Œ logback.xml åœ¨propertiesä¸Šæœ‰ç•¥å¾®å·®åˆ«ã€‚å…¶ä»–éƒ½ä¸€æ ·ã€‚ å·¥ç¨‹ï¼šspringboot+web å…ˆæ¥çœ‹ä¸‹é¡¹ç›®ç›®å½• propertiesä¸­å°±æ˜¯æŒ‡å®šäº†æ—¥å¿—çš„æ‰“å°çº§åˆ«å’Œæ—¥å¿—çš„è¾“å‡ºä½ç½®ï¼š 1234#è®¾ç½®åº”ç”¨çš„æ—¥å¿—çº§åˆ«logging.level.com.glmapper.spring.boot=INFO#è·¯å¾„logging.path=./logs é€šè¿‡æ§åˆ¶å°è¾“å‡ºçš„loglogback-spring.xmlçš„é…ç½®å¦‚ä¸‹ï¼š123456789101112&lt;configuration&gt; &lt;!-- é»˜è®¤çš„æ§åˆ¶å°æ—¥å¿—è¾“å‡ºï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯åå°å¯åŠ¨ï¼Œè¿™ä¸ªæ²¡å¤ªå¤§ä½œç”¨ --&gt; &lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;Pattern&gt;%d&#123;HH:mm:ss.SSS&#125; %-5level %logger&#123;80&#125; - %msg%n&lt;/Pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;root level="info"&gt; &lt;appender-ref ref="STDOUT"/&gt; &lt;/root&gt;&lt;/configuration&gt; æ‰“å°æ—¥å¿—çš„controller123456789101112private static final Logger LOGGER =LoggerFactory.getLogger(HelloController.class);@Autowiredprivate TestLogService testLogService;@GetMapping("/hello")public String hello()&#123; LOGGER.info("GLMAPPER-SERVICE:info"); LOGGER.error("GLMAPPER-SERVICE:error"); testLogService.printLogToSpecialPackage(); return "hello spring boot";&#125; éªŒè¯ç»“æœï¼š123401:50:39.633 INFO com.glmapper.spring.boot.controller.HelloController- GLMAPPER-SERVICE:info01:50:39.633 ERROR com.glmapper.spring.boot.controller.HelloController- GLMAPPER-SERVICE:error ä¸Šé¢çš„å°±æ˜¯é€šè¿‡æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„ï¼Œè¿™ä¸ªæ—¶å€™å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºï¼Œå› ä¸ºä¸ä¼šåœ¨å·¥ç¨‹ç›®å½•ä¸‹ç”Ÿäº§logsæ–‡ä»¶å¤¹ã€‚ æ§åˆ¶å°ä¸æ‰“å°ï¼Œç›´æ¥è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶å…ˆæ¥çœ‹ä¸‹é…ç½®æ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132333435&lt;configuration&gt; &lt;!-- å±æ€§æ–‡ä»¶:åœ¨propertiesæ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„é…ç½®é¡¹ --&gt; &lt;springProperty scope="context" name="logging.path" source="logging.path"/&gt; &lt;springProperty scope="context" name="logging.level" source="logging.level.com.glmapper.spring.boot"/&gt; &lt;!-- é»˜è®¤çš„æ§åˆ¶å°æ—¥å¿—è¾“å‡ºï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯åå°å¯åŠ¨ï¼Œè¿™ä¸ªæ²¡å¤ªå¤§ä½œç”¨ --&gt; &lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;Pattern&gt;%d&#123;HH:mm:ss.SSS&#125; %-5level %logger&#123;80&#125; - %msg%n&lt;/Pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;appender name="GLMAPPER-LOGGERONE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;append&gt;true&lt;/append&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;$&#123;logging.level&#125;&lt;/level&gt; &lt;/filter&gt; &lt;file&gt; $&#123;logging.path&#125;/glmapper-spring-boot/glmapper-loggerone.log &lt;/file&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;FileNamePattern&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-loggerone.log.%d&#123;yyyy-MM-dd&#125;&lt;/FileNamePattern&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;root level="info"&gt; &lt;appender-ref ref="GLMAPPER-LOGGERONE"/&gt; &lt;/root&gt;&lt;/configuration&gt; è¿™é‡Œæˆ‘ä»¬appender-refæŒ‡å®šçš„appenderæ˜¯GLMAPPER-LOGGERONEï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰åå­—ä¸ºGLMAPPER-LOGGERONEçš„appenderï¼Œæ‰€ä»¥è¦å¢åŠ ä¸€ä¸ªnameä¸ºGLMAPPER-LOGGERONEçš„appenderã€‚ æ³¨æ„ä¸Šé¢è¿™ä¸ªé…ç½®ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æ¥å°†rootçš„appender-refç›´æ¥æŒ‡å®šåˆ°æˆ‘ä»¬çš„GLMAPPER-LOGGERONEè¿™ä¸ªappenderçš„ã€‚æ‰€ä»¥æ§åˆ¶å°ä¸­å°†åªä¼šæ‰“å°å‡ºbannarä¹‹åå°±å•¥ä¹Ÿä¸æ‰“å°äº†ï¼Œæ‰€æœ‰çš„å¯åŠ¨ä¿¡æ¯éƒ½ä¼šè¢«æ‰“å°åœ¨æ—¥å¿—æ–‡ä»¶glmapper-loggerone.logä¸­ã€‚ ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬ä¸å¸Œæœ›æˆ‘çš„ä¸šåŠ¡æ—¥å¿—ä¸­ä¼šåŒ…æ‹¬è¿™äº›å¯åŠ¨ä¿¡æ¯ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦é€šè¿‡loggeræ ‡ç­¾æ¥æäº‹æƒ…äº†ã€‚å°†ä¸Šé¢çš„é…ç½®æ–‡ä»¶è¿›è¡Œç®€å•ä¿®æ”¹ï¼š 12345678&lt;logger name="com.glmapper.spring.boot.controller" level="$&#123;logging.level&#125;" additivity="false"&gt; &lt;appender-ref ref="GLMAPPER-LOGGERONE" /&gt;&lt;/logger&gt;&lt;root level="$&#123;logging.level&#125;"&gt; &lt;appender-ref ref="STDOUT"/&gt;&lt;/root&gt; è®©rootæŒ‡å‘æ§åˆ¶å°è¾“å‡ºï¼›loggerè´Ÿè´£æ‰“å°åŒ…com.glmapper.spring.boot.controllerä¸‹çš„æ—¥å¿—ã€‚ éªŒè¯ç»“æœè¿˜æ˜¯é€šè¿‡æˆ‘ä»¬çš„æµ‹è¯•controlleræ¥æ‰“å°æ—¥å¿—ä¸ºä¾‹ï¼Œä½†æ˜¯è¿™é‡Œä¸ä¼šåœ¨æ§åˆ¶å°å‡ºç°æ—¥å¿—ä¿¡æ¯äº†ã€‚æœŸæœ›çš„æ—¥å¿—æ–‡ä»¶åœ¨./logs/glmapper-spring-boot/glmapper-loggerone.logã€‚ loggerå’Œappenderçš„å…³ç³»ä¸Šé¢ä¸¤ç§æ˜¯ä¸€ä¸ªåŸºæœ¬çš„é…ç½®æ–¹å¼ï¼Œé€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹logger/appender/rootä¹‹é—´çš„å…³ç³»ï¼Œç„¶åå†è¯¦ç»†çš„è¯´ä¸‹loggerå’Œappenderçš„é…ç½®ç»†èŠ‚ã€‚ åœ¨æœ€å‰é¢ä»‹ç»ä¸­æåˆ°ï¼Œrootæ˜¯æ ¹logger,æ‰€ä»¥ä»–ä¸¤æ˜¯ä¸€å›äº‹ï¼›åªä¸è¿‡rootä¸­ä¸èƒ½æœ‰nameå’Œadditivityå±æ€§ï¼Œæ˜¯æœ‰ä¸€ä¸ªlevelã€‚ appenderæ˜¯ä¸€ä¸ªæ—¥å¿—æ‰“å°çš„ç»„ä»¶ï¼Œè¿™é‡Œç»„ä»¶é‡Œé¢å®šä¹‰äº†æ‰“å°è¿‡æ»¤çš„æ¡ä»¶ã€æ‰“å°è¾“å‡ºæ–¹å¼ã€æ»šåŠ¨ç­–ç•¥ã€ç¼–ç æ–¹å¼ã€æ‰“å°æ ¼å¼ç­‰ç­‰ã€‚ä½†æ˜¯å®ƒä»…ä»…æ˜¯ä¸€ä¸ªæ‰“å°ç»„ä»¶ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ä¸€ä¸ªloggeræˆ–è€…rootçš„appender-refæŒ‡å®šæŸä¸ªå…·ä½“çš„appenderæ—¶ï¼Œå®ƒå°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ å› æ­¤appenderè®©æˆ‘ä»¬çš„åº”ç”¨çŸ¥é“æ€ä¹ˆæ‰“ã€æ‰“å°åˆ°å“ªé‡Œã€æ‰“å°æˆä»€ä¹ˆæ ·ï¼›è€Œloggeråˆ™æ˜¯å‘Šè¯‰åº”ç”¨å“ªäº›å¯ä»¥è¿™ä¹ˆæ‰“ã€‚ä¾‹å¦‚æŸä¸ªç±»ä¸‹çš„æ—¥å¿—å¯ä»¥ä½¿ç”¨è¿™ä¸ªappenderæ‰“å°æˆ–è€…æŸä¸ªåŒ…ä¸‹çš„æ—¥å¿—å¯ä»¥è¿™ä¹ˆæ‰“å°ã€‚ appender é…ç½®è¯¦è§£è¿™é‡Œä»¥ä¸Šé¢æ¡ˆä¾‹ä¸­çš„åä¸ºGLMAPPER-LOGGERONEçš„appenderè¯´æ˜ï¼š 123456789101112131415161718&lt;appender name="GLMAPPER-LOGGERONE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;append&gt;true&lt;/append&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;$&#123;logging.level&#125;&lt;/level&gt; &lt;/filter&gt; &lt;file&gt; $&#123;logging.path&#125;/glmapper-spring-boot/glmapper-loggerone.log &lt;/file&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;FileNamePattern&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-loggerone.log.%d&#123;yyyy-MM-dd&#125;&lt;/FileNamePattern&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt;&lt;/appender&gt; appender æœ‰ä¸¤ä¸ªå±æ€§ nameå’Œclass;nameæŒ‡å®šappenderåç§°ï¼ŒclassæŒ‡å®šappenderçš„å…¨é™å®šåã€‚ä¸Šé¢å£°æ˜çš„æ˜¯åä¸ºGLMAPPER-LOGGERONEï¼Œclassä¸ºch.qos.logback.core.rolling.RollingFileAppenderçš„ä¸€ä¸ªappenderã€‚ appender çš„ç§ç±» ConsoleAppenderï¼šæŠŠæ—¥å¿—æ·»åŠ åˆ°æ§åˆ¶å° FileAppenderï¼šæŠŠæ—¥å¿—æ·»åŠ åˆ°æ–‡ä»¶ RollingFileAppenderï¼šæ»šåŠ¨è®°å½•æ–‡ä»¶ï¼Œå…ˆå°†æ—¥å¿—è®°å½•åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œå½“ç¬¦åˆæŸä¸ªæ¡ä»¶æ—¶ï¼Œå°†æ—¥å¿—è®°å½•åˆ°å…¶ä»–æ–‡ä»¶ã€‚å®ƒæ˜¯FileAppenderçš„å­ç±» append å­æ ‡ç­¾1&lt;append&gt;true&lt;/append&gt; å¦‚æœæ˜¯ trueï¼Œæ—¥å¿—è¢«è¿½åŠ åˆ°æ–‡ä»¶ç»“å°¾ï¼Œå¦‚æœæ˜¯falseï¼Œæ¸…ç©ºç°å­˜æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯trueã€‚ filter å­æ ‡ç­¾åœ¨ç®€ä»‹ä¸­æåˆ°äº†filterï¼›ä½œç”¨å°±æ˜¯ä¸Šé¢è¯´çš„ã€‚å¯ä»¥ä¸ºappender æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨ï¼Œå¯ä»¥ç”¨ä»»æ„æ¡ä»¶å¯¹æ—¥å¿—è¿›è¡Œè¿‡æ»¤ã€‚appender æœ‰å¤šä¸ªè¿‡æ»¤å™¨æ—¶ï¼ŒæŒ‰ç…§é…ç½®é¡ºåºæ‰§è¡Œã€‚ ThresholdFilterä¸´ç•Œå€¼è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤æ‰ä½äºæŒ‡å®šä¸´ç•Œå€¼çš„æ—¥å¿—ã€‚å½“æ—¥å¿—çº§åˆ«ç­‰äºæˆ–é«˜äºä¸´ç•Œå€¼æ—¶ï¼Œè¿‡æ»¤å™¨è¿”å›NEUTRALï¼›å½“æ—¥å¿—çº§åˆ«ä½äºä¸´ç•Œå€¼æ—¶ï¼Œæ—¥å¿—ä¼šè¢«æ‹’ç»ã€‚ 123&lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;INFO&lt;/level&gt;&lt;/filter&gt; LevelFilterçº§åˆ«è¿‡æ»¤å™¨ï¼Œæ ¹æ®æ—¥å¿—çº§åˆ«è¿›è¡Œè¿‡æ»¤ã€‚å¦‚æœæ—¥å¿—çº§åˆ«ç­‰äºé…ç½®çº§åˆ«ï¼Œè¿‡æ»¤å™¨ä¼šæ ¹æ®onMath(ç”¨äºé…ç½®ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ“ä½œ) å’Œ onMismatch(ç”¨äºé…ç½®ä¸ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ“ä½œ)æ¥æ”¶æˆ–æ‹’ç»æ—¥å¿—ã€‚ 12345&lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; å…³äºNEUTRALã€ACCEPTã€DENY è§ä¸Šæ–‡ç®€ä»‹ä¸­å…³äºfilterçš„ä»‹ç»ã€‚ file å­æ ‡ç­¾file æ ‡ç­¾ç”¨äºæŒ‡å®šè¢«å†™å…¥çš„æ–‡ä»¶åï¼Œå¯ä»¥æ˜¯ç›¸å¯¹ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹ç›®å½•ï¼Œå¦‚æœä¸Šçº§ç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚ 123&lt;file&gt; $&#123;logging.path&#125;/glmapper-spring-boot/glmapper-loggerone.log&lt;/file&gt; è¿™ä¸ªè¡¨ç¤ºå½“å‰appenderå°†ä¼šå°†æ—¥å¿—å†™å…¥åˆ°${logging.path}/glmapper-spring-boot/glmapper-loggerone.logè¿™ä¸ªç›®å½•ä¸‹ã€‚ rollingPolicy å­æ ‡ç­¾è¿™ä¸ªå­æ ‡ç­¾ç”¨æ¥æè¿°æ»šåŠ¨ç­–ç•¥çš„ã€‚è¿™ä¸ªåªæœ‰appenderçš„classæ˜¯RollingFileAppenderæ—¶æ‰éœ€è¦é…ç½®ã€‚è¿™ä¸ªä¹Ÿä¼šæ¶‰åŠæ–‡ä»¶çš„ç§»åŠ¨å’Œé‡å‘½åï¼ˆa.log-&gt;a.log.2018.07.22ï¼‰ã€‚ TimeBasedRollingPolicyæœ€å¸¸ç”¨çš„æ»šåŠ¨ç­–ç•¥ï¼Œå®ƒæ ¹æ®æ—¶é—´æ¥åˆ¶å®šæ»šåŠ¨ç­–ç•¥ï¼Œæ—¢è´Ÿè´£æ»šåŠ¨ä¹Ÿè´Ÿè´£å‡ºå‘æ»šåŠ¨ã€‚è¿™ä¸ªä¸‹é¢åˆåŒ…æ‹¬äº†ä¸¤ä¸ªå±æ€§ï¼š FileNamePattern maxHistory 123456789&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å:æŒ‰å¤©å›æ»š daily --&gt; &lt;FileNamePattern&gt; $&#123;logging.path&#125;/glmapper-spring-boot/glmapper-loggerone.log.%d&#123;yyyy-MM-dd&#125; &lt;/FileNamePattern&gt; &lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt;&lt;/rollingPolicy&gt; ä¸Šé¢çš„è¿™æ®µé…ç½®è¡¨æ˜æ¯å¤©ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿å­˜30å¤©çš„æ—¥å¿—æ–‡ä»¶ FixedWindowRollingPolicyæ ¹æ®å›ºå®šçª—å£ç®—æ³•é‡å‘½åæ–‡ä»¶çš„æ»šåŠ¨ç­–ç•¥ã€‚ encoder å­æ ‡ç­¾å¯¹è®°å½•äº‹ä»¶è¿›è¡Œæ ¼å¼åŒ–ã€‚å®ƒå¹²äº†ä¸¤ä»¶äº‹ï¼š æŠŠæ—¥å¿—ä¿¡æ¯è½¬æ¢æˆå­—èŠ‚æ•°ç»„ æŠŠå­—èŠ‚æ•°ç»„å†™å…¥åˆ°è¾“å‡ºæµ 12345&lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt;&lt;/encoder&gt; ç›®å‰encoderåªæœ‰PatternLayoutEncoderä¸€ç§ç±»å‹ã€‚ å®šä¹‰ä¸€ä¸ªåªæ‰“å°errorçº§åˆ«æ—¥å¿—çš„appcener1234567891011121314151617181920212223 &lt;!-- é”™è¯¯æ—¥å¿— appender ï¼š æŒ‰ç…§æ¯å¤©ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ --&gt;&lt;appender name="ERROR-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;append&gt;true&lt;/append&gt; &lt;!-- è¿‡æ»¤å™¨ï¼Œåªè®°å½• error çº§åˆ«çš„æ—¥å¿— --&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;error&lt;/level&gt; &lt;/filter&gt; &lt;!-- æ—¥å¿—åç§° --&gt; &lt;file&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-error.log&lt;/file&gt; &lt;!-- æ¯å¤©ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿å­˜30å¤©çš„æ—¥å¿—æ–‡ä»¶ --&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å:æŒ‰å¤©å›æ»š daily --&gt; &lt;FileNamePattern&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-error.log.%d&#123;yyyy-MM-dd&#125;&lt;/FileNamePattern&gt; &lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;!-- ç¼–ç  --&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt;&lt;/appender&gt; å®šä¹‰ä¸€ä¸ªè¾“å‡ºåˆ°æ§åˆ¶å°çš„appender123456&lt;!-- é»˜è®¤çš„æ§åˆ¶å°æ—¥å¿—è¾“å‡ºï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯åå°å¯åŠ¨ï¼Œè¿™ä¸ªæ²¡å¤ªå¤§ä½œç”¨ --&gt;&lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;Pattern&gt;%d&#123;HH:mm:ss.SSS&#125; %-5level %logger&#123;80&#125; - %msg%n&lt;/Pattern&gt; &lt;/encoder&gt;&lt;/appender&gt; logger é…ç½®è¯¦è§£1234&lt;logger name="com.glmapper.spring.boot.controller" level="$&#123;logging.level&#125;" additivity="false"&gt; &lt;appender-ref ref="GLMAPPER-LOGGERONE" /&gt;&lt;/logger&gt; ä¸Šé¢çš„è¿™ä¸ªé…ç½®æ–‡ä»¶æè¿°çš„æ˜¯ï¼šcom.glmapper.spring.boot.controllerè¿™ä¸ªåŒ…ä¸‹çš„${logging.level}çº§åˆ«çš„æ—¥å¿—å°†ä¼šä½¿ç”¨GLMAPPER-LOGGERONEæ¥æ‰“å°ã€‚loggeræœ‰ä¸‰ä¸ªå±æ€§å’Œä¸€ä¸ªå­æ ‡ç­¾ï¼š name:ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»ã€‚ level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼ˆTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªå€¼INHERITEDæˆ–è€…åŒä¹‰è¯NULLï¼Œä»£è¡¨å¼ºåˆ¶æ‰§è¡Œä¸Šçº§çš„çº§åˆ«ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®æ­¤å±æ€§ï¼Œé‚£ä¹ˆå½“å‰loggerå°†ä¼šç»§æ‰¿ä¸Šçº§çš„çº§åˆ«ã€‚ addtivity:ç”¨æ¥æè¿°æ˜¯å¦å‘ä¸Šçº§loggerä¼ é€’æ‰“å°ä¿¡æ¯ã€‚é»˜è®¤æ˜¯trueã€‚ appender-refåˆ™æ˜¯ç”¨æ¥æŒ‡å®šå…·ä½“appenderçš„ã€‚ ä¸åŒæ—¥å¿—éš”ç¦»æ‰“å°æ¡ˆä¾‹åœ¨å‰é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬æœ‰ä¸‰ç§appender,ä¸€ä¸ªæ˜¯æŒ‡å®šåŒ…çº¦æŸçš„ï¼Œä¸€ä¸ªæ˜¯æ§åˆ¶errorçº§åˆ«çš„ï¼Œä¸€ä¸ªæ˜¯æ§åˆ¶å°çš„ã€‚ç„¶åè¿™å°èŠ‚æˆ‘ä»¬å°±æ¥å®ç°ä¸‹ä¸åŒæ—¥å¿—æ‰“å°åˆ°ä¸åŒçš„logæ–‡ä»¶ä¸­ã€‚ æ ¹æ®åŒ…è¿›è¡Œæ—¥å¿—æ–‡ä»¶éš”ç¦»è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬å°†com.glmapper.spring.boot.controllerä¸­çš„æ—¥å¿—è¾“å‡ºåˆ°glmapper-controller.logï¼›å°†com.glmapper.spring.boot.serviceä¸­çš„æ—¥å¿—è¾“å‡ºåˆ°glmapper-service.logã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;!--æ‰“å°æ—¥å¿—åˆ°glmapper-service.logçš„appender--&gt;&lt;appender name="GLMAPPER-SERVICE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;append&gt;true&lt;/append&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;$&#123;logging.level&#125;&lt;/level&gt; &lt;/filter&gt; &lt;file&gt; $&#123;logging.path&#125;/glmapper-spring-boot/glmapper-service.log &lt;/file&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;FileNamePattern&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-service.log.%d&#123;yyyy-MM-dd&#125;&lt;/FileNamePattern&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt;&lt;/appender&gt;&lt;!--æ‰“å°æ—¥å¿—åˆ°glmapper-controller.logçš„appender--&gt;&lt;appender name="GLMAPPER-CONTROLLER" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;append&gt;true&lt;/append&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;$&#123;logging.level&#125;&lt;/level&gt; &lt;/filter&gt; &lt;file&gt; $&#123;logging.path&#125;/glmapper-spring-boot/glmapper-controller.log &lt;/file&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;FileNamePattern&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-controller.log.%d&#123;yyyy-MM-dd&#125;&lt;/FileNamePattern&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt;&lt;/appender&gt;&lt;!--æ­¤loggerçº¦æŸå°†.controlleråŒ…ä¸‹çš„æ—¥å¿—è¾“å‡ºåˆ°GLMAPPER-CONTROLLERï¼Œé”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°GERROR-APPENDEï¼›GERROR-APPENDEè§ä¸Šé¢--&gt;&lt;logger name="com.glmapper.spring.boot.controller" level="$&#123;logging.level&#125;" additivity="false"&gt; &lt;appender-ref ref="GLMAPPER-CONTROLLER" /&gt; &lt;appender-ref ref="GERROR-APPENDER" /&gt;&lt;/logger&gt;&lt;!--æ­¤loggerçº¦æŸå°†.serviceåŒ…ä¸‹çš„æ—¥å¿—è¾“å‡ºåˆ°GLMAPPER-SERVICEï¼Œé”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°GERROR-APPENDEï¼›GERROR-APPENDEè§ä¸Šé¢--&gt;&lt;logger name="com.glmapper.spring.boot.service" level="$&#123;logging.level&#125;" additivity="false"&gt; &lt;appender-ref ref="GLMAPPER-SERVICE" /&gt; &lt;appender-ref ref="GERROR-APPENDER" /&gt;&lt;/logger&gt; æ¥çœ‹è¿è¡Œç»“æœ 1ã€glmaper-controller 2ã€glmapper-service 3ã€glmapper-error æ»¡è¶³æˆ‘ä»¬çš„é¢„æœŸï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ã€‚åœ¨infoæ—¥å¿—é‡Œå‡ºç°äº†error,å½“ç„¶è¿™æ˜¯æ­£å¸¸çš„ã€‚å‡å¦‚æˆ‘ä»¬ä¸æƒ³åœ¨infoé‡Œé¢å‡ºç°erroræ€ä¹ˆåŠå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬ä»¥APPENDER-SERVICEä¸ºä¾‹ï¼Œå°†filterè¿‡æ»¤å™¨è¿›è¡Œä¿®æ”¹ï¼š å°†ä¸‹é¢çš„ï¼š123&lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;$&#123;logging.level&#125;&lt;/level&gt;&lt;/filter&gt; ä¿®æ”¹ä¸ºï¼š 1234567&lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;!-- å¦‚æœå‘½ä¸­å°±ç¦æ­¢è¿™æ¡æ—¥å¿— --&gt; &lt;onMatch&gt;DENY&lt;/onMatch&gt; &lt;!-- å¦‚æœæ²¡æœ‰å‘½ä¸­å°±ä½¿ç”¨è¿™æ¡è§„åˆ™ --&gt; &lt;onMismatch&gt;ACCEPT&lt;/onMismatch&gt; &lt;/filter&gt; è¿™é‡ŒåŒæ—¶è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨loggerä¸­leveléœ€è¦è®¾ç½®ä¸ºinfoçº§åˆ«ã€‚ æ ¹æ®ç±»è¿›è¡Œæ—¥å¿—æ–‡ä»¶éš”ç¦»è¿™ä¸ªå…¶å®ä¹Ÿæ˜¯å’Œä¸Šé¢é‚£ä¸ªå·®ä¸è¿‡ï¼Œåªä¸è¿‡ç²’åº¦æ›´ç»†ä¸€ç‚¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸ªå®šæ—¶ä»»åŠ¡ç±»éœ€è¦å•ç‹¬æ¥è®°å½•å…¶æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨åŸºäºç±»ç»´åº¦æ¥çº¦æŸæ‰“å°ã€‚ 123456789101112131415161718192021222324252627&lt;!--ç‰¹æ®ŠåŠŸèƒ½å•ç‹¬appender ä¾‹å¦‚è°ƒåº¦ç±»çš„æ—¥å¿—--&gt;&lt;appender name="SCHEDULERTASKLOCK-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;append&gt;true&lt;/append&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;$&#123;logging.level&#125;&lt;/level&gt; &lt;/filter&gt; &lt;file&gt;$&#123;logging.path&#125;/glmapper-spring-boot/scheduler-task-lock.log&lt;/file&gt; &lt;!-- æ¯å¤©ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿å­˜30å¤©çš„æ—¥å¿—æ–‡ä»¶ --&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å:æŒ‰å¤©å›æ»š daily --&gt; &lt;FileNamePattern&gt;$&#123;logging.path&#125;/glmapper-spring-boot/scheduler-task-lock.log.%d&#123;yyyy-MM-dd&#125;&lt;/FileNamePattern&gt; &lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;!-- ç¼–ç  --&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt;&lt;/appender&gt;&lt;!--è¿™é‡ŒæŒ‡å®šåˆ°äº†å…·ä½“çš„æŸä¸€ä¸ªç±»--&gt;&lt;logger name="com.glmapper.spring.boot.task.TestLogTask" level="$&#123;logging.level&#125;" additivity="true"&gt; &lt;appender-ref ref="SCHEDULERTASKLOCK-APPENDER" /&gt; &lt;appender-ref ref="ERROR-APPENDER" /&gt; &lt;/logger&gt; æœ€ç»ˆTestLogTaskä¸­çš„æ—¥å¿—å°†ä¼šè¢«æ‰“å°åˆ°è¿™ä¸ªè‡ªå·±ç‹¬ç«‹çš„logæ–‡ä»¶ä¸­ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š æ ¹æ®è‡ªå®šä¹‰ logger çš„ name è¿›è¡Œæ—¥å¿—æ–‡ä»¶éš”ç¦»loggerçš„nameé™¤äº†ç±»ã€åŒ…ç­‰çº¦æŸä¹‹å¤–ï¼Œå½“ç„¶è¿˜å¯ä»¥è¿™æ ·æ¥ç©ã€‚ã€‚ã€‚ åœ¨è¿›è¡Œæ¡ˆä¾‹ä¹‹å‰ï¼Œè¿™é‡Œå…ˆæŠŠå‰é¢æ¡ˆä¾‹ä¸­loggerå£°æ˜çš„ä»£ç è´´ä¸€ä¸‹ï¼Œä»¥ä½œå¯¹æ¯”,ä»¥TestLogTaskç±»ä¸­çš„æ—¥å¿—ä¸ºä¾‹ï¼š 12private static final Logger LOGGER =LoggerFactory.getLogger(TestLogTask.class); åœ¨getLoggerä¸­æˆ‘ä»¬æ˜¯å°†å½“å‰å¯¹è±¡çš„classä½œä¸ºå‚æ•°çš„ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†æ‰“å°æ—¶è·å–å…¶å…¨é™å®šåçš„ï¼ˆè§ä¸‹é¢3-ï¼‰ã€‚ 12341-2018-07-21 11:15:42.003 [pool-1-thread-1] 2-INFO 3-com.glmapper.spring.boot.task.TestLogTask -4-com.glmapper.spring.boot.task:info ä¸šåŠ¡ç±»å®šä¹‰æˆ‘ä»¬åŒæ ·æ˜¯serviceåŒ…ä¸‹å®šä¹‰ä¸€ä¸ªç±»TestLogNameServiceImpl 1234567891011121314package com.glmapper.spring.boot.service;@Service("testLogNameService")public class TestLogNameServiceImpl implements TestLogNameService &#123; private static final Logger LOGGER = LoggerFactory.getLogger("GLMAPPER-TEST-LOG"); @Override public void print() &#123; LOGGER.info("GLMAPPER-TEST-LOG:this is special logger-----info"); LOGGER.error("GLMAPPER-TEST-LOG:this is special logger-------error"); &#125;&#125; appenderå’Œloggeré…ç½®123456789101112131415161718192021222324252627&lt;appender name="ROOT-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;append&gt;true&lt;/append&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;$&#123;logging.level&#125;&lt;/level&gt; &lt;/filter&gt; &lt;file&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-test.log&lt;/file&gt; &lt;!-- æ¯å¤©ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿å­˜30å¤©çš„æ—¥å¿—æ–‡ä»¶ --&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å:æŒ‰å¤©å›æ»š daily --&gt; &lt;FileNamePattern&gt;$&#123;logging.path&#125;/glmapper-spring-boot/glmapper-test.log.%d&#123;yyyy-MM-dd&#125; &lt;/FileNamePattern&gt; &lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt; &lt;MaxHistory&gt;30&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt; &lt;!-- ç¼–ç  --&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt;&lt;/appender&gt;&lt;!--è¿™é‡Œçš„nameå’Œä¸šåŠ¡ç±»ä¸­çš„getLoggerä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„--&gt;&lt;logger name="GLMAPPER-TEST-LOG" level="$&#123;logging.level&#125;" additivity="true"&gt; &lt;appender-ref ref="ROOT-APPENDER" /&gt; &lt;appender-ref ref="ERROR-APPENDER" /&gt; &lt;/logger&gt; æˆ‘ä»¬è¿™ä¸ªé¢„æœŸçš„æ˜¯TestLogNameServiceImplä¸­çš„æ—¥å¿—ä¸æ‰“å°åˆ°glmapper-service.logä¸­ï¼Œè€Œæ˜¯æ‰“å°åˆ°glmapper-test.logä¸­ã€‚ 1ã€glmapper-test.log 2ã€glmapper-service.log æ»¡è¶³æˆ‘ä»¬çš„é¢„æœŸã€‚ å¦‚ä½•ä½¿ç”¨logbackæ‰“å°mybatisçš„sqlè¯­å¥è¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒå‘çš„ã€‚ä¸ºä»€ä¹ˆã€‚çœ‹ä¸‹è¿™ä¸ªï¼š 123&lt;settings&gt; &lt;setting name="logImpl" value="slf4j" /&gt;&lt;/settings&gt; åœ¨mybatis-configration.xmlä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è¿™æ ·ä¸€ä¸ªé…ç½®é¡¹æ¥å…³è”åˆ°å…·ä½“çš„æ—¥å¿—ç»„ä»¶ã€‚ä½†æ˜¯logImplçš„å®ç°ä¸­æ˜¯æ²¡æœ‰logbackçš„ã€‚é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™é‡Œåªèƒ½é€šè¿‡slf4jçš„æ–¹å¼æ¡¥æ¥åˆ°logbackã€‚ ç„¶ååœ¨æˆ‘ä»¬çš„logback-spring.xmlä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š 1234 &lt;!-- å°†sqlè¯­å¥è¾“å‡ºåˆ°å…·ä½“çš„æ—¥å¿—æ–‡ä»¶ä¸­ --&gt;&lt;logger name="com.alipay.sofa.cloudplatform.common.dao" level="$&#123;logging.sql.level&#125;" additivity="false"&gt; &lt;appender-ref ref="SQL-APPENDER"/&gt;&lt;/logger&gt; è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„çš„ã€‚é¦–å…ˆæ˜¯${logging.sql.level}è¿™ä¸ªå¿…é¡»æ˜¯debugï¼Œè¿™ä¸ªæ˜¯ç”±mybatisæœ¬èº«å®ç°å†³å®šçš„ã€‚è€Œè¿™é‡Œçš„nameè®¾å®šçš„com.alipay.sofa.cloudplatform.common.daoå€¼å°±æ˜¯æˆ‘ä»¬daoæ¥å£çš„åŒ…è·¯å¾„ã€‚ ç½‘ä¸Šçœ‹äº†ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„æ¡ˆä¾‹ï¼Œè¿™ç§æ–¹å¼åªèƒ½è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¹¶ä¸èƒ½å°†æ–‡ä»¶è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼›å®ƒæ˜¯æ ¹æ®å†…éƒ¨çš„ä¸€ä¸ªå®ç°æœºåˆ¶å·äº†ä¸ªæ‡’ã€‚mybatisç”¨logbackæ—¥å¿—ä¸æ˜¾ç¤ºsqlçš„è§£å†³åŠæ³•ã€‚ æ€»ç»“æœ¬ç¯‡åšå®¢ä¸»è¦æ˜¯æ•´ç†æœ€è¿‘å·¥ä½œä¸­çš„ä¸€äº›æ—¥å¿—é…ç½®ç§¯ç´¯ï¼Œå°†æ¯ä¸ªç»†èŠ‚è¿›è¡Œæ€»ç»“ä¸€ä¸‹ï¼Œä»¥ä½œå¤‡å¿˜ã€‚å¦‚æœæœ‰æ—¶é—´çš„è¯ä¼šè€ƒè™‘çœ‹ä¸€ä¸ªæ—¥å¿—æ¡†æ¶çš„æºç ã€‚å…¶å®æˆ‘è§‰å¾—è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæ—¥å¿—ç»„ä»¶æ¯•ç«Ÿæ˜¯éœ€è¦è¿›è¡Œæ—¥å¿—æ–‡ä»¶è½ç›˜çš„ï¼Œè¿™ä¸ªä¼šæ¶‰åŠåˆ°è®¸å¤šçš„æ€§èƒ½é—®é¢˜ã€ç¼“å†²åŒºé—®é¢˜ã€é˜Ÿåˆ—é—®é¢˜ã€å½“ç„¶è¿˜æœ‰ä¸€äº›é”çš„é—®é¢˜ã€åŒæ­¥æ‰“å°æˆ–è€…å¼‚æ­¥æ‰“å°ç­‰é—®é¢˜ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ï¼Œç„¶ååˆ†äº«ç»™æˆ‘ä»¬ã€‚ åé¢å‡†å¤‡å†™ä¸€å†™èš‚èšé‡‘æœSOFABootå’ŒSpringBootçš„ä¸€äº›æ–‡ç« ï¼Œå¦‚æœæœ‰å…´è¶£å¯ä»¥å…ˆçœ‹ä¸€æ³¢ã€‚ SOFABoot GitHub ä¼ é€é—¨]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>logback</tag>
        <tag>slf4j</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SOFATracer ä¸­ Disruptor å®è·µ]]></title>
    <url>%2F2018%2F11%2F10%2Fsofatracerone%2F</url>
    <content type="text"><![CDATA[OpenTraceing è§„èŒƒ OpenTracingè¯­ä¹‰æ ‡å‡† è¯­ä¹‰æƒ¯ä¾‹ å®˜æ–¹æ–‡æ¡£ SOFATracer å¯¹ OpenTraceing çš„å®ç° SOFATracer å°±æ˜¯æ ¹æ® OpenTracing è§„èŒƒ è¡ç”Ÿå‡ºæ¥çš„åˆ†å¸ƒå¼ é“¾è·¯è·Ÿ è¸ªçš„è§£å†³æ–¹æ¡ˆã€‚ GitHub SOFATrcer æ¦‚å¿µOpenTracing æ ‡å‡†ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„ç›¸äº’å…³è”çš„ç±»å‹ï¼Œåˆ†åˆ«æ˜¯Tracer, Spanå’Œ SpanContextã€‚ ã€ä¸‹é¢çš„æ¦‚å¿µè¯´æ˜è¿‡ç¨‹ä¸­ï¼Œå¦‚ä¸åšè¯´æ˜ï¼Œæ‰€ä½¿ç”¨çš„æ¡ˆä¾‹ä»£ç å‡ä»¥SOFATracerä¸­çš„å®ç°ä¸ºä¾‹ã€‚ã€‘ Tracerä¸€ä¸ª trace ä»£è¡¨ä¸€ä¸ªæ½œåœ¨çš„ï¼Œåˆ†å¸ƒå¼çš„ï¼Œå­˜åœ¨å¹¶è¡Œæ•°æ®æˆ–å¹¶è¡Œæ‰§è¡Œè½¨è¿¹ï¼ˆæ½œåœ¨çš„åˆ†å¸ƒå¼ã€å¹¶è¡Œï¼‰çš„ç³»ç»Ÿã€‚ä¸€ä¸ªtraceå¯ä»¥è®¤ä¸ºæ˜¯å¤šä¸ªspançš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚ Traceræ¥å£ç”¨æ¥åˆ›å»ºSpanï¼Œä»¥åŠå¤„ç†å¦‚ä½•å¤„ç†Inject(serialize) å’Œ Extract (deserialize)ï¼Œç”¨äºè·¨è¿›ç¨‹è¾¹ç•Œä¼ é€’ã€‚ SOFATracer ä¸­ SofaTracerè¿™ä¸ªç±»å®ç°äº† opentracing çš„ Tracer æ¥å£ï¼Œå¹¶åœ¨æ­¤è§„èŒƒæ¥å£ä¸Šåšäº†ä¸€äº›æ‰©å±•ã€‚çœ‹ä¸‹Tracer ä¸­å£°æ˜çš„æ–¹æ³•ï¼š 123456789101112public interface Tracer &#123; //å¯åŠ¨ä¸€ä¸ªæ–°çš„span SpanBuilder buildSpan(String operationName); //å°†SpanContextä¸Šä¸‹æ–‡Injectï¼ˆæ³¨å…¥ï¼‰åˆ°carrier &lt;C&gt; void inject(SpanContext spanContext, Format&lt;C&gt; format, C carrier); //å°†SpanContextä¸Šä¸‹æ–‡ä»carrierä¸­Extractï¼ˆæå–ï¼‰ &lt;C&gt; SpanContext extract(Format&lt;C&gt; format, C carrier); interface SpanBuilder &#123; // çœç•¥ &#125; &#125; æ‰€ä»¥ä»æ¥å£å®šä¹‰æ¥çœ‹ï¼Œè¦å®ç°ä¸€ä¸ªTracerï¼Œå¿…é¡»è¦å®ç°å…¶ä»¥ä¸‹çš„å‡ ä¸ªèƒ½åŠ›ï¼š å¯åŠ¨ä¸€ä¸ªæ–°çš„spanSOFATracer å®ç°äº† Tracer ä¸­ buildSpan æ–¹æ³•ï¼š 1234@Overridepublic SpanBuilder buildSpan(String operationName) &#123; return new SofaTracerSpanBuilder(operationName);&#125; operationName :æ“ä½œåç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œè¡¨ç¤ºç”±Spanå®Œæˆçš„å·¥ä½œ (ä¾‹å¦‚ï¼ŒRPCæ–¹æ³•åç§°ã€å‡½æ•°åç§°æˆ–ä¸€ä¸ªè¾ƒå¤§çš„è®¡ç®—ä»»åŠ¡ä¸­çš„é˜¶æ®µçš„åç§°)ã€‚æ“ä½œåç§°åº”è¯¥ç”¨æ³›åŒ–çš„å­—ç¬¦ä¸²å½¢å¼æ ‡è¯†å‡ºä¸€ä¸ªSpanå®ä¾‹ã€‚ ä½•ä¸ºæ³›åŒ–çš„å­—ç¬¦ä¸²å½¢å¼ï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªæ“ä½œï¼šè·å–ç”¨æˆ· ï¼›ä¸‹é¢æœ‰å‡ ç§æ ‡è¯†æ–¹å¼ï¼š 1ã€/get 2ã€/get/user 3ã€/get/user/123 æ–¹å¼1è¿‡äºæŠ½è±¡ï¼Œæ–¹å¼3è¿‡äºå…·ä½“ã€‚æ–¹å¼2æ˜¯æ­£ç¡®çš„æ“ä½œåã€‚ å°†SpanContextä¸Šä¸‹æ–‡Injectï¼ˆæ³¨å…¥ï¼‰åˆ°carrier12345678@Overridepublic &lt;C&gt; void inject(SpanContext spanContext, Format&lt;C&gt; format, C carrier) &#123; RegistryExtractorInjector&lt;C&gt; registryInjector = TracerFormatRegistry.getRegistry(format); if (registryInjector == null) &#123; throw new IllegalArgumentException("Unsupported injector format: " + format); &#125; registryInjector.inject((SofaTracerSpanContext) spanContext, carrier);&#125; SpanContext :å®ä¾‹ formatï¼ˆæ ¼å¼åŒ–ï¼‰æè¿°ï¼Œä¸€èˆ¬ä¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œä½†ä¸åšå¼ºåˆ¶è¦æ±‚ã€‚é€šè¿‡æ­¤æè¿°ï¼Œé€šçŸ¥Tracerå®ç°ï¼Œå¦‚ä½•å¯¹SpanContextè¿›è¡Œç¼–ç æ”¾å…¥åˆ°carrierä¸­ã€‚carrierï¼Œæ ¹æ®formatç¡®å®šã€‚Tracerå®ç°æ ¹æ®formatå£°æ˜çš„æ ¼å¼ï¼Œå°†SpanContextåºåˆ—åŒ–åˆ°carrierå¯¹è±¡ä¸­ã€‚ RegistryExtractorInjector è§åé¢ å°†SpanContextä¸Šä¸‹æ–‡ä»carrierä¸­Extractï¼ˆæå–ï¼‰12345678@Overridepublic &lt;C&gt; SpanContext extract(Format&lt;C&gt; format, C carrier) &#123; RegistryExtractorInjector&lt;C&gt; registryExtractor = TracerFormatRegistry.getRegistry(format); if (registryExtractor == null) &#123; throw new IllegalArgumentException("Unsupported extractor format: " + format); &#125; return registryExtractor.extract(carrier);&#125; æ ¼å¼æè¿°ç¬¦(format descriptor)(é€šå¸¸ä½†ä¸ä¸€å®šæ˜¯å­—ç¬¦ä¸²å¸¸é‡)ï¼Œå‘Šè¯‰Tracerçš„å®ç°å¦‚ä½•åœ¨è½½ä½“å¯¹è±¡ä¸­å¯¹SpanContextè¿›è¡Œç¼–ç  è½½ä½“(carrier)ï¼Œå…¶ç±»å‹ç”±æ ¼å¼æè¿°ç¬¦æŒ‡å®šã€‚Tracerçš„å®ç°å°†æ ¹æ®æ ¼å¼æè¿°å¯¹æ­¤è½½ä½“å¯¹è±¡ä¸­çš„SpanContextè¿›è¡Œç¼–ç  è¿”å›ä¸€ä¸ªSpanContextå®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªSpanContextå®ä¾‹ï¼Œé€šè¿‡Traceråˆ›å»ºæ–°çš„Spanã€‚ Formatä»Tracerçš„æ³¨å…¥å’Œæå–æ¥çœ‹ï¼Œformatéƒ½æ˜¯å¿…é¡»çš„ã€‚ Injectï¼ˆæ³¨å…¥ï¼‰å’ŒExtractï¼ˆæå–ï¼‰ä¾èµ–äºå¯æ‰©å±•çš„formatå‚æ•°ã€‚formatå‚æ•°è§„å®šäº†å¦ä¸€ä¸ªå‚æ•°&quot;carrier&quot;çš„ç±»å‹ï¼ŒåŒæ—¶çº¦æŸäº†&quot;carrier&quot;ä¸­SpanContextæ˜¯å¦‚ä½•ç¼–ç çš„ã€‚æ‰€æœ‰çš„Tracerå®ç°ï¼Œéƒ½å¿…é¡»æ”¯æŒä¸‹é¢çš„formatã€‚ Text Map: åŸºäºå­—ç¬¦ä¸²ï¼šå­—ç¬¦ä¸²çš„map,å¯¹äºkeyå’Œvalueä¸çº¦æŸå­—ç¬¦é›†ã€‚ HTTP Headers: é€‚åˆä½œä¸ºHTTPå¤´ä¿¡æ¯çš„ï¼ŒåŸºäºå­—ç¬¦ä¸²ï¼šå­—ç¬¦ä¸²çš„mapã€‚ï¼ˆRFC 7230.åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œå¦‚ä½•å¤„ç†HTTPå¤´å…·æœ‰å¤šæ ·æ€§ï¼Œå¼ºçƒˆå»ºè®®tracerçš„ä½¿ç”¨è€…è°¨æ…ä½¿ç”¨HTTPå¤´çš„é”®å€¼ç©ºé—´å’Œè½¬ä¹‰ç¬¦ï¼‰ Binary: ä¸€ä¸ªç®€å•çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡ï¼Œè®°å½•SpanContextçš„ä¿¡æ¯ã€‚ åœ¨ä¸Šé¢çš„æ³¨å…¥å’Œæå–ä»£ç ä¸­ï¼Œæœ‰å¦‚ä¸‹ä»£ç ç‰‡æ®µï¼š 123456//æ³¨å…¥RegistryExtractorInjector&lt;C&gt; registryInjector = TracerFormatRegistry.getRegistry(format);//æå–RegistryExtractorInjector&lt;C&gt; registryExtractor = TracerFormatRegistry.getRegistry(format); æ¥é€šè¿‡TracerFormatRegistryè¿™ä¸ªç±»æ¥æ¥çœ‹ä¸‹ SOFATracer ä¸­çš„ Format çš„å…·ä½“å®ç°ã€‚ X-B3åœ¨çœ‹Formatä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹X-B3ã€‚ 12Access-Control-Expose-Headers: X-B3-TraceId,X-B3-ParentSpanId,X-B3-SpanId HTTPè¯·æ±‚æ—¶å…¶spanå‚æ•°é€šè¿‡http headersæ¥ä¼ é€’è¿½è¸ªä¿¡æ¯ï¼›headerä¸­å¯¹åº”çš„keyåˆ†åˆ«æ˜¯: X-B3-TraceId: 64 encoded bitsï¼ˆidè¢«encodeä¸ºhex Stringsï¼‰ X-B3-SpanId : 64 encoded bits X-B3-ParentSpanId: 64 encoded bits X-B3-Sampled:(æ˜¯å¦é‡‡æ ·) Boolean (either â€œ1â€ or â€œ0â€)ï¼ˆä¸‹é¢çš„è°ƒç”¨æ˜¯å¦è¿›è¡Œé‡‡æ ·ï¼‰ X-B3-Flags:a Long SOFATracer ä¸­çš„ Formatå…·ä½“ä»£ç åœ¨ tracer-core -&gt; com.alipay.common.tracer.core.registy åŒ…ä¸‹: TextMapFormatter TextMapB3Formatter HttpHeadersFormatter HttpHeadersB3Formatter BinaryFormater BinaryFormaterï¼šè¿™ä¸ªçš„æ³¨å…¥å’Œæå–å®ç°æ²¡æœ‰ç¼–è§£ç ä¸€è¯´ï¼›æœ¬èº«å°±æ˜¯åŸºäºäºŒè¿›åˆ¶æµçš„æ“ä½œã€‚ TextMapB3Formatter/TextMapFormatter å’Œ HttpHeadersB3Formatter/HttpHeadersFormatter åŒºåˆ«å°±åœ¨äºç¼–è§£ç ä¸åŒã€‚HttpHeadersB3Formatterä½¿ç”¨çš„æ˜¯ URLDecoder.decode &amp;&amp; URLDecoder.encode ; TextMapB3Formatter è¿”å›çš„æ˜¯å€¼æœ¬èº«ï¼ˆå¦‚æœä¸ºç©ºæˆ–è€…nullåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰ã€‚ TextMapFormatterå’ŒTextMapB3FormatteråŒºåˆ«åœ¨äºæ³¨å…¥æˆ–è€…æå–æ˜¯ä½¿ç”¨çš„keyä¸ç”¨ã€‚TextMapB3Formatterä¸­ä½¿ç”¨çš„æ˜¯ x-b3-{} çš„å­—ç¬¦ä¸²ä½œä¸ºkeyã€‚ Spanä¸€ä¸ªspanä»£è¡¨ç³»ç»Ÿä¸­å…·æœ‰å¼€å§‹æ—¶é—´å’Œæ‰§è¡Œæ—¶é•¿çš„é€»è¾‘è¿è¡Œå•å…ƒã€‚spanä¹‹é—´é€šè¿‡åµŒå¥—æˆ–è€…é¡ºåºæ’åˆ—å»ºç«‹é€»è¾‘å› æœå…³ç³»ã€‚å½“Spanç»“æŸå(span.finish())ï¼Œé™¤äº†é€šè¿‡Spanè·å–SpanContextå¤–ï¼Œä¸‹åˆ—å…¶ä»–æ‰€æœ‰æ–¹æ³•éƒ½ä¸å…è®¸è¢«è°ƒç”¨ã€‚ åŒæ ·å…ˆæ¥çœ‹ä¸‹opentracingè§„èŒƒapi å®šä¹‰çš„ span çš„å®šä¹‰åŠæ–¹æ³•ï¼š 123456789101112131415161718public interface Span extends Closeable &#123; SpanContext context(); void finish(); void finish(long finishMicros); void close(); Span setTag(String key, String value); Span setTag(String key, boolean value); Span setTag(String key, Number value); Span log(Map&lt;String, ?&gt; fields); Span log(long timestampMicroseconds, Map&lt;String, ?&gt; fields); Span log(String event); Span log(long timestampMicroseconds, String event); Span setBaggageItem(String key, String value); String getBaggageItem(String key); Span setOperationName(String operationName); Span log(String eventName, /* @Nullable */ Object payload); Span log(long timestampMicroseconds, String eventName, /* @Nullable */ Object payload);&#125; é€šè¿‡Spanè·å–SpanContext12345//SOFATracerSpan@Overridepublic SpanContext context() &#123; return this.sofaTracerSpanContext;&#125; è¿”å›å€¼ï¼ŒSpanæ„å»ºæ—¶ä¼ å…¥çš„SpanContextã€‚è¿™ä¸ªè¿”å›å€¼åœ¨Spanç»“æŸå(span.finish())ï¼Œä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚ å¤å†™æ“ä½œå12345@Overridepublic Span setOperationName(String operationName) &#123; this.operationName = operationName; return this;&#125; operationName:æ–°çš„æ“ä½œåï¼Œè¦†ç›–æ„å»ºSpanæ—¶ï¼Œä¼ å…¥çš„æ“ä½œåã€‚ ç»“æŸSpan123456789101112@Overridepublic void finish() &#123; this.finish(System.currentTimeMillis());&#125;@Overridepublic void finish(long endTime) &#123; this.setEndTime(endTime); //å…³é”®è®°å½•:report span this.sofaTracer.reportSpan(this); SpanExtensionFactory.logStoppedSpan(this);&#125; æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¦‚æœæŒ‡å®šå®Œæˆæ—¶é—´åˆ™ä½¿ç”¨å½“å‰æŒ‡å®šçš„æ—¶é—´ï¼›å¦‚æœçœç•¥æ­¤å‚æ•°ï¼Œä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºå®Œæˆæ—¶é—´ã€‚finishæ–¹æ³•ä¸­ä¼šå°†å½“å‰spanè¿›è¡Œreportæ“ä½œã€‚ ä¸ºSpanè®¾ç½®tagTagæ˜¯ä¸€ä¸ªkey:valueæ ¼å¼çš„æ•°æ®ã€‚keyå¿…é¡»æ˜¯Stringç±»å‹ï¼Œvalueå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å¸ƒå°”æˆ–è€…æ•°å­—ã€‚ å­—ç¬¦ä¸²ç±»å‹çš„value è®¾ç½®tag 1234567891011121314151617181920@Overridepublic Span setTag(String key, String value) &#123; if (StringUtils.isBlank(key) || StringUtils.isBlank(value)) &#123; return this; &#125; this.tagsWithStr.put(key, value); //æ³¨æ„:server è¿˜æ˜¯ client åœ¨ OpenTracing æ ‡å‡†ä¸­æ˜¯ç”¨ tags æ ‡è¯†çš„,æ‰€ä»¥åœ¨è¿™é‡Œè¿›è¡Œåˆ¤æ–­ if (isServer()) &#123; Reporter serverReporter = this.sofaTracer.getServerReporter(); if (serverReporter != null) &#123; this.setLogType(serverReporter.getReporterType()); &#125; &#125; else if (isClient()) &#123; Reporter clientReporter = this.sofaTracer.getClientReporter(); if (clientReporter != null) &#123; this.setLogType(clientReporter.getReporterType()); &#125; &#125; return this;&#125; å¸ƒå°”ç±»å‹çš„value è®¾ç½®tag 1234public Span setTag(String key, boolean value) &#123; this.tagsWithBool.put(key, value); return this;&#125; æ•°å­—ç±»å‹çš„value è®¾ç½®tag 1234567public Span setTag(String key, Number number) &#123; if (number == null) &#123; return this; &#125; this.tagsWithNumber.put(key, number); return this;&#125; Logç»“æ„åŒ–æ•°æ®1234567891011@Overridepublic Span log(long currentTime, Map&lt;String, ?&gt; map) &#123; AssertUtils.isTrue(currentTime &gt;= startTime, "current time must greater than start time"); this.logs.add(new LogData(currentTime, map)); return this;&#125;@Overridepublic Span log(Map&lt;String, ?&gt; map) &#123; return this.log(System.currentTimeMillis(), map);&#125; Map&lt;String, ?&gt; map : é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ currentTime : æ—¶é—´æˆ³ã€‚å¦‚æœæŒ‡å®šæ—¶é—´æˆ³ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨spançš„å¼€å§‹å’Œç»“æŸæ—¶é—´ä¹‹å†…ã€‚ è®¾ç½®ä¸€ä¸ªbaggageï¼ˆéšè¡Œæ•°æ®ï¼‰å…ƒç´ Baggageå…ƒç´ æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆï¼Œå°†è¿™äº›å€¼è®¾ç½®ç»™ç»™å®šçš„Spanï¼ŒSpançš„SpanContextï¼Œä»¥åŠæ‰€æœ‰å’Œæ­¤Spanæœ‰ç›´æ¥æˆ–è€…é—´æ¥å…³ç³»çš„æœ¬åœ°Spanã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œbaggageå…ƒç´ éštraceä¸€èµ·ä¿æŒåœ¨å¸¦å†…ä¼ é€’ã€‚ï¼ˆè¯‘è€…æ³¨ï¼šå¸¦å†…ä¼ é€’ï¼Œåœ¨è¿™é‡ŒæŒ‡ï¼Œéšåº”ç”¨ç¨‹åºè°ƒç”¨è¿‡ç¨‹ä¸€èµ·ä¼ é€’ï¼‰ Baggageå…ƒç´ ä¸ºOpenTracingçš„å®ç°å…¨æ ˆé›†æˆï¼Œæä¾›äº†å¼ºå¤§çš„åŠŸèƒ½ ï¼ˆä¾‹å¦‚ï¼šä»»æ„çš„åº”ç”¨ç¨‹åºæ•°æ®ï¼Œå¯ä»¥åœ¨ç§»åŠ¨ç«¯åˆ›å»ºå®ƒï¼Œæ˜¾ç„¶çš„ï¼Œå®ƒä¼šä¸€ç›´ä¼ é€’äº†ç³»ç»Ÿæœ€åº•å±‚çš„å­˜å‚¨ç³»ç»Ÿã€‚ç”±äºå®ƒå¦‚æ­¤å¼ºå¤§çš„åŠŸèƒ½ï¼Œä»–ä¹Ÿä¼šäº§ç”Ÿå·¨å¤§çš„å¼€é”€ï¼Œè¯·å°å¿ƒä½¿ç”¨æ­¤ç‰¹æ€§ã€‚ å†æ¬¡å¼ºè°ƒï¼Œè¯·è°¨æ…ä½¿ç”¨æ­¤ç‰¹æ€§ã€‚æ¯ä¸€ä¸ªé”®å€¼éƒ½ä¼šè¢«æ‹·è´åˆ°æ¯ä¸€ä¸ªæœ¬åœ°å’Œè¿œç¨‹çš„ä¸‹çº§ç›¸å…³çš„spanä¸­ï¼Œå› æ­¤ï¼Œæ€»ä½“ä¸Šï¼Œä»–ä¼šæœ‰æ˜æ˜¾çš„ç½‘ç»œå’ŒCPUå¼€é”€ã€‚ 12345@Overridepublic Span setBaggageItem(String key, String value) &#123; this.sofaTracerSpanContext.setBizBaggageItem(key, value); return this;&#125; SofaTracerSpan ä¸­çš„å±æ€§ sofaTracer : å½“å‰ tracer spanReferences : å½“å‰spançš„å…³ç³»ï¼ŒChildOf(å¼•ç”¨) or FollowsFromï¼ˆè·Ÿéšï¼‰ tagsWithStr : String ç±»å‹çš„tag é›†åˆ tagsWithBool : å¸ƒå°”ç±»å‹çš„tagé›†åˆ tagsWithNumber : æ•°å€¼ç±»å‹çš„tagé›†åˆ logs : logç»“æ„åŒ–æ•°æ®åˆ—è¡¨ï¼Œé€šè¿‡span.logï¼ˆmapï¼‰æ“ä½œçš„map,å‡å­˜å‚¨åœ¨logsä¸­ã€‚ operationNameï¼šå½“å‰spançš„æ“ä½œå sofaTracerSpanContextï¼šå½“å‰ spanContext startTime : å½“å‰span å¼€å§‹æ—¶é—´ endTime : å½“å‰span ç»“æŸæ—¶é—´ï¼Œåœ¨finishæ–¹æ³•ä¸­ä¼ å…¥ã€‚ logType : reportæ—¶æ‰æœ‰æ„ä¹‰:æ‘˜è¦æ—¥å¿—ç±»å‹,æ—¥å¿—èƒ½å¤Ÿæ­£ç¡®æ‰“å°çš„å…³é”®ä¿¡æ¯ï¼›å½“å‰ span çš„æ—¥å¿—ç±»å‹,å¦‚:å®¢æˆ·ç«¯ä¸º rpc-client-digest.log,æœåŠ¡ç«¯ä¸º rpc-server-digest.log parentSofaTracerSpanï¼šçˆ¶äº² span,å½“ä½œä¸ºå®¢æˆ·ç«¯ç»“æŸå¹¶å¼¹å‡ºçº¿ç¨‹ä¸Šä¸‹æ–‡æ—¶,éœ€è¦å°†çˆ¶äº² span å†æ”¾å…¥ SpanContextopentracing ä¸­ SpanContext æ¥å£ä¸­åªæœ‰ä¸€ä¸ªbaggageItemsæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥éå†æ‰€æœ‰çš„baggageå…ƒç´ ã€‚ 123public interface SpanContext &#123; Iterable&lt;Map.Entry&lt;String, String&gt;&gt; baggageItems();&#125; ç›¸å¯¹äºOpenTracingä¸­å…¶ä»–çš„åŠŸèƒ½ï¼ŒSpanContextæ›´å¤šçš„æ˜¯ä¸€ä¸ªâ€œæ¦‚å¿µâ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒOpenTracingå®ç°ä¸­ï¼Œéœ€è¦é‡ç‚¹è€ƒè™‘ï¼Œå¹¶æä¾›ä¸€å¥—è‡ªå·±çš„APIã€‚ OpenTracingçš„ä½¿ç”¨è€…ä»…ä»…éœ€è¦ï¼Œåœ¨åˆ›å»ºspanã€å‘ä¼ è¾“åè®®Injectï¼ˆæ³¨å…¥ï¼‰å’Œä»ä¼ è¾“åè®®ä¸­Extractï¼ˆæå–ï¼‰æ—¶ï¼Œä½¿ç”¨SpanContextå’Œreferencesï¼Œ OpenTracingè¦æ±‚ï¼ŒSpanContextæ˜¯ä¸å¯å˜çš„ï¼Œç›®çš„æ˜¯é˜²æ­¢ç”±äºSpançš„ç»“æŸå’Œç›¸äº’å…³ç³»ï¼Œé€ æˆçš„å¤æ‚ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚ Disruptor ç®€ä»‹ A High Performance Inter-Thread Messaging Library é«˜æ€§èƒ½çš„çº¿ç¨‹é—´æ¶ˆæ¯ä¼ é€’åº“ å…³äº Disruptor çš„ ä¸€äº›åŸç†åˆ†æå¯ä»¥å‚è€ƒï¼šdisruptor æ¡ˆä¾‹å…ˆé€šè¿‡ Disruptor çš„ä¸€ä¸ªå°ä¾‹å­æ¥æœ‰ä¸ªç›´è§‚çš„è®¤è¯†ï¼›å…ˆçœ‹ä¸‹å®ƒçš„æ„é€ å‡½æ•°ï¼š 1234567891011public Disruptor( final EventFactory&lt;T&gt; eventFactory, final int ringBufferSize, final ThreadFactory threadFactory, final ProducerType producerType, final WaitStrategy waitStrategy)&#123; this( RingBuffer.create(producerType, eventFactory, ringBufferSize, waitStrategy), new BasicExecutor(threadFactory));&#125; eventFactory : åœ¨ç¯å½¢ç¼“å†²åŒºä¸­åˆ›å»ºäº‹ä»¶çš„ factory ringBufferSize:ç¯å½¢ç¼“å†²åŒºçš„å¤§å°ï¼Œå¿…é¡»æ˜¯2çš„å¹‚ã€‚ threadFactoryï¼šç”¨äºä¸ºå¤„ç†å™¨åˆ›å»ºçº¿ç¨‹ã€‚ producerTypeï¼šç”Ÿæˆå™¨ç±»å‹ä»¥æ”¯æŒä½¿ç”¨æ­£ç¡®çš„sequencerå’Œpublisheråˆ›å»ºRingBufferï¼›æšä¸¾ç±»å‹ï¼ŒSINGLEã€MULTIä¸¤ä¸ªé¡¹ã€‚å¯¹åº”äº SingleProducerSequencerå’ŒMultiProducerSequencerä¸¤ç§Sequencerã€‚ waitStrategy : ç­‰å¾…ç­–ç•¥ï¼› å¦‚æœæˆ‘ä»¬æƒ³æ„é€ ä¸€ä¸ªdisruptor,é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸Šé¢çš„è¿™äº›ç»„ä»¶ã€‚ä»eventFactoryæ¥çœ‹ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå…·ä½“çš„Eventæ¥ä½œä¸ºæ¶ˆæ¯äº‹ä»¶çš„è½½ä½“ã€‚ã€ä¸‹é¢æŒ‰ç…§å®˜æ–¹ç»™çš„æ¡ˆä¾‹è¿›è¡Œç®€å•çš„ä¿®æ”¹ä½œä¸ºç¤ºä¾‹ã€‘ æ¶ˆæ¯äº‹ä»¶ LongEvent ï¼Œèƒ½å¤Ÿè¢«æ¶ˆè´¹çš„æ•°æ®è½½ä½“123456789public class LongEvent &#123; private long value; public void set(long value) &#123; this.value = value; &#125; public long getValue() &#123; return value; &#125;&#125; åˆ›å»ºæ¶ˆæ¯äº‹ä»¶çš„factory123456public class LongEventFactory implements EventFactory&lt;LongEvent&gt; &#123; @Override public LongEvent newInstance() &#123; return new LongEvent(); &#125;&#125; ConsumerThreadFactory1234567public class ConsumerThreadFactory implements ThreadFactory &#123; private final AtomicInteger index = new AtomicInteger(1); @Override public Thread newThread(Runnable r) &#123; return new Thread(r, "disruptor-thread-" + index.getAndIncrement()); &#125;&#125; OK ï¼Œä¸Šé¢çš„è¿™äº›å¯ä»¥æ»¡è¶³åˆ›å»ºä¸€ä¸ªdisruptoräº†ï¼š 123456789101112131415private int ringBufferCapacity = 8;//æ¶ˆæ¯äº‹ä»¶ç”Ÿäº§FactoryLongEventFactory longEventFactory = new LongEventFactory();//æ‰§è¡Œäº‹ä»¶å¤„ç†å™¨çº¿ç¨‹FactoryConsumerThreadFactory consumerThreadFactory = new ConsumerThreadFactory();//ç”¨äºç¯å½¢ç¼“å†²åŒºçš„ç­‰å¾…ç­–ç•¥ã€‚WaitStrategy waitStrategy = new BlockingWaitStrategy();//æ„å»ºdisruptorDisruptor&lt;LongEvent&gt; disruptor = new Disruptor&lt;&gt;( longEventFactory, ringBufferCapacity, longEventThreadFactory, ProducerType.SINGLE, waitStrategy); ç°åœ¨æ˜¯å·²ç»æœ‰äº† disruptor äº†ï¼Œç„¶åé€šè¿‡ï¼šstart æ¥å¯åŠ¨ï¼š 12//å¯åŠ¨ disruptor disruptor.start(); åˆ°è¿™é‡Œï¼Œå·²ç»æ„å»ºäº†ä¸€ä¸ªdisruptorï¼›ä½†æ˜¯ç›®å‰æ€ä¹ˆä½¿ç”¨å®ƒæ¥å‘å¸ƒæ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯å‘¢ï¼Ÿ å‘å¸ƒæ¶ˆæ¯ä¸‹é¢åœ¨ for å¾ªç¯ä¸­ å‘å¸ƒ 5 æ¡æ•°æ®ï¼š 12345678910RingBuffer&lt;LongEvent&gt; ringBuffer = disruptor.getRingBuffer();for (long l = 0; l &lt; 5; l++)&#123; long sequence = ringBuffer.next(); LongEvent event = ringBuffer.get(sequence); event.set(100+l); System.out.println("publish event :" + l); ringBuffer.publish(sequence); Thread.sleep(1000);&#125; æ¶ˆæ¯å·²ç»å‘å¸ƒï¼Œä¸‹é¢éœ€è¦è®¾å®šå½“å‰disruptorçš„æ¶ˆè´¹å¤„ç†å™¨ã€‚å‰é¢å·²ç»æœ‰ä¸ªLongEvent å’Œ EventFactory ; åœ¨disruptorä¸­æ˜¯é€šè¿‡ EventHandler æ¥è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹çš„ã€‚ ç¼–å†™æ¶ˆè´¹è€…ä»£ç 1234567public class LongEventHandler implements EventHandler&lt;LongEvent&gt; &#123; @Override public void onEvent(LongEvent event, long sequence, boolean endOfBatch) throws Exception &#123; System.out.println("Event: " + event.getValue()+" -&gt; " + Thread.currentThread().getName()); Thread.sleep(2000); &#125;&#125; å°† eventHandler è®¾ç½®åˆ° disruptor çš„å¤„ç†é“¾ä¸Š 123//å°†å¤„ç†äº‹ä»¶çš„äº‹ä»¶å¤„ç†ç¨‹åº -&gt; æ¶ˆè´¹äº‹ä»¶çš„å¤„ç†ç¨‹åºLongEventHandler longEventHandler = new LongEventHandler();disruptor.handleEventsWith(longEventHandler); è¿è¡Œç»“æœï¼ˆè¿™é‡Œï¼‰ï¼š123456789101112131415publish event :0Event: 0 -&gt; disruptor-thread-1--------------------------------&gt;publish event :1Event: 1 -&gt; disruptor-thread-1--------------------------------&gt;publish event :2Event: 2 -&gt; disruptor-thread-1--------------------------------&gt;publish event :3Event: 3 -&gt; disruptor-thread-1--------------------------------&gt;publish event :4Event: 4 -&gt; disruptor-thread-1--------------------------------&gt; åŸºæœ¬æ¦‚å¿µå’ŒåŸç†Disruptoræ•´ä¸ªåŸºäºringBufferå®ç°çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„å®¹å™¨ã€‚ä¸»è¦å±æ€§ 12345private final RingBuffer&lt;T&gt; ringBuffer;private final Executor executor;private final ConsumerRepository&lt;T&gt; consumerRepository = new ConsumerRepository&lt;&gt;();private final AtomicBoolean started = new AtomicBoolean(false);private ExceptionHandler&lt;? super T&gt; exceptionHandler = new ExceptionHandlerWrapper&lt;&gt;(); ringBufferï¼šå†…éƒ¨æŒæœ‰ä¸€ä¸ª RingBuffer å¯¹è±¡ï¼ŒDisruptor å†…éƒ¨çš„äº‹ä»¶å‘å¸ƒéƒ½æ˜¯ä¾èµ–è¿™ä¸ªRingBufferå¯¹è±¡å®Œæˆçš„ã€‚ executorï¼šæ¶ˆè´¹äº‹ä»¶çš„çº¿ç¨‹æ±  consumerRepositoryï¼šæä¾›å­˜å‚¨åº“æœºåˆ¶ï¼Œç”¨äºå°†EventHandlerä¸EventProcessorå…³è”èµ·æ¥ started : ç”¨äºæ ‡å¿—å½“å‰Disruptoræ˜¯å¦å·²ç»å¯åŠ¨ exceptionHandler : å¼‚å¸¸å¤„ç†å™¨ï¼Œç”¨äºå¤„ç†BatchEventProcessoräº‹ä»¶å‘¨æœŸä¸­ uncaught exceptions ã€‚ RingBufferç¯å½¢é˜Ÿåˆ—[å®ç°ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„]ï¼Œå¯ä»¥ç±»æ¯”ä¸ºBlockingQueueä¹‹ç±»çš„é˜Ÿåˆ—ï¼ŒringBufferçš„ä½¿ç”¨ï¼Œä½¿å¾—å†…å­˜è¢«å¾ªç¯ä½¿ç”¨ï¼Œå‡å°‘äº†æŸäº›åœºæ™¯çš„å†…å­˜åˆ†é…å›æ”¶æ‰©å®¹ç­‰è€—æ—¶æ“ä½œã€‚ 12public final class RingBuffer&lt;E&gt; extends RingBufferFields&lt;E&gt; implements Cursored, EventSequencer&lt;E&gt;, EventSink&lt;E&gt; Eï¼šåœ¨äº‹ä»¶çš„äº¤æ¢æˆ–å¹¶è¡Œåè°ƒæœŸé—´å­˜å‚¨ç”¨äºå…±äº«çš„æ•°æ®çš„å®ç° -&gt; æ¶ˆæ¯äº‹ä»¶ Sequencer RingBuffer ä¸­ ç”Ÿäº§è€…çš„é¡¶çº§çˆ¶æ¥å£ï¼Œå…¶ç›´æ¥å®ç°æœ‰SingleProducerSequencerå’ŒMultiProducerSequencerï¼›å¯¹åº” SINGLEã€MULTI ä¸¤ä¸ªæšä¸¾å€¼ã€‚ EventHandleräº‹ä»¶å¤„ç½®å™¨ï¼Œæ”¹æ¥å£ç”¨äºå¯¹å¤–æ‰©å±•æ¥å®ç°å…·ä½“çš„æ¶ˆè´¹é€»è¾‘ã€‚å¦‚ä¸Šé¢ demo ä¸­çš„ LongEventHandler ; 1234//å›è°ƒæ¥å£ï¼Œç”¨äºå¤„ç†&#123;@link RingBuffer&#125;ä¸­å¯ç”¨çš„äº‹ä»¶public interface EventHandler&lt;T&gt; &#123; void onEvent(T event, long sequence, boolean endOfBatch) throws Exception;&#125; event : RingBuffer å·²ç»å‘å¸ƒçš„äº‹ä»¶ sequence : æ­£åœ¨å¤„ç†çš„äº‹ä»¶ çš„åºåˆ—å· endOfBatch : ç”¨æ¥æ ‡è¯†å¦æ˜¯æ¥è‡ª RingBuffer çš„æ‰¹æ¬¡ä¸­çš„æœ€åä¸€ä¸ªäº‹ä»¶ SequenceBarrieræ¶ˆè´¹è€…è·¯éšœã€‚è§„å®šäº†æ¶ˆè´¹è€…å¦‚ä½•å‘ä¸‹èµ°ã€‚äº‹å®ä¸Šï¼Œè¯¥è·¯éšœç®—æ˜¯å˜å‘çš„é”ã€‚ 12345678910111213final class ProcessingSequenceBarrier implements SequenceBarrier &#123; //å½“ç­‰å¾…ï¼ˆæ¢æµ‹ï¼‰çš„éœ€è¦ä¸å¯ç”¨æ—¶ï¼Œç­‰å¾…çš„ç­–ç•¥ private final WaitStrategy waitStrategy; //ä¾èµ–çš„å…¶å®ƒConsumerçš„åºå·ï¼Œè¿™ä¸ªç”¨äºä¾èµ–çš„æ¶ˆè´¹çš„æƒ…å†µï¼Œ //æ¯”å¦‚Aã€Bä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œåªæœ‰Aæ¶ˆè´¹å®Œï¼ŒBæ‰èƒ½æ¶ˆè´¹ã€‚ private final Sequence dependentSequence; private volatile boolean alerted = false; //Ringbufferçš„å†™å…¥æŒ‡é’ˆ private final Sequence cursorSequence; //RingBufferå¯¹åº”çš„Sequencer private final Sequencer sequencer; //exclude method&#125; waitStrategy å†³å®šäº†æ¶ˆè´¹è€…é‡‡ç”¨ä½•ç§ç­‰å¾…ç­–ç•¥ã€‚ WaitStrategy Strategy employed for making {@link EventProcessor}s wait on a cursor {@link Sequence}. EventProcessor çš„ç­‰å¾…ç­–ç•¥ï¼›å…·ä½“å®ç°åœ¨ disruptor ä¸­æœ‰8ç§ï¼Œ è¿™äº›ç­‰å¾…ç­–ç•¥ä¸åŒçš„æ ¸å¿ƒä½“ç°æ˜¯åœ¨å¦‚ä½•å®ç° waitFor è¿™ä¸ªæ–¹æ³•ä¸Šã€‚ EventProcessoräº‹ä»¶å¤„ç†å™¨ï¼Œå®é™…ä¸Šå¯ä»¥ç†è§£ä¸ºæ¶ˆè´¹è€…æ¨¡å‹çš„æ¡†æ¶ï¼Œå®ç°äº†çº¿ç¨‹Runnableçš„runæ–¹æ³•ï¼Œå°†å¾ªç¯åˆ¤æ–­ç­‰æ“ä½œå°åœ¨äº†é‡Œé¢ã€‚è¯¥æ¥å£æœ‰ä¸‰ä¸ªå®ç°ç±»: 1ã€BatchEventProcessor 12345678910public final class BatchEventProcessor&lt;T&gt; implements EventProcessor &#123; private final AtomicBoolean running = new AtomicBoolean(false); private ExceptionHandler&lt;? super T&gt; exceptionHandler = new FatalExceptionHandler(); private final DataProvider&lt;T&gt; dataProvider; private final SequenceBarrier sequenceBarrier; private final EventHandler&lt;? super T&gt; eventHandler; private final Sequence sequence = new Sequence( Sequencer.INITIAL_CURSOR_VALUE); private final TimeoutHandler timeoutHandler; //exclude method&#125; ExceptionHandlerï¼šå¼‚å¸¸å¤„ç†å™¨ DataProviderï¼šæ•°æ®æ¥æºï¼Œå¯¹åº” RingBuffer EventHandlerï¼šå¤„ç† Event çš„å›è°ƒå¯¹è±¡ SequenceBarrierï¼šå¯¹åº”çš„åºå·å±éšœ TimeoutHandlerï¼šè¶…æ—¶å¤„ç†å™¨ï¼Œé»˜è®¤æƒ…å†µä¸ºç©ºï¼Œå¦‚æœè¦è®¾ç½®ï¼Œåªéœ€è¦è¦å°†å…³è”çš„EventHandlerå®ç°TimeOutHandlerå³å¯ã€‚ å¦‚æœæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ EventHandler çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ BatchEventProcessorï¼Œå®ƒä¸EventHandleræ˜¯ä¸€ä¸€å¯¹åº”ï¼Œå¹¶ä¸”æ˜¯å•çº¿ç¨‹æ‰§è¡Œã€‚ å¦‚æœæŸä¸ªRingBufferæœ‰å¤šä¸ªBatchEventProcessorï¼Œé‚£ä¹ˆå°±ä¼šæ¯ä¸ªBatchEventProcessorå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚ 2ã€WorkProcessor 1234567891011121314151617public final class WorkProcessor&lt;T&gt; implements EventProcessor &#123; private final AtomicBoolean running = new AtomicBoolean(false); private final Sequence sequence = new Sequence(Sequencer.INITIAL_CURSOR_VALUE); private final RingBuffer&lt;T&gt; ringBuffer; private final SequenceBarrier sequenceBarrier; private final WorkHandler&lt;? super T&gt; workHandler; private final ExceptionHandler&lt;? super T&gt; exceptionHandler; private final Sequence workSequence; private final EventReleaser eventReleaser = new EventReleaser() &#123; @Override public void release() &#123; sequence.set(Long.MAX_VALUE); &#125; &#125;; private final TimeoutHandler timeoutHandler;&#125; åŸºæœ¬å’Œ BatchEventProcessor ç±»ä¼¼ï¼Œä¸åŒåœ¨äºï¼Œç”¨äºå¤„ç†Eventçš„å›è°ƒå¯¹è±¡æ˜¯WorkHandlerã€‚ åŸç†å›¾ æ— æ¶ˆè´¹è€…æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ä¿æŒç”Ÿäº§ï¼Œä½†æ˜¯ remainingCapacity ä¿æŒä¸å˜åœ¨å†™demoçš„è¿‡ç¨‹ä¸­ï¼Œæœ¬æ¥æƒ³é€šè¿‡ä¸è®¾å®š æ¶ˆè´¹è€… æ¥è§‚å¯Ÿ RingBuffer å¯ç”¨å®¹é‡å˜åŒ–çš„ã€‚ä½†æ˜¯éªŒè¯è¿‡ç¨‹ä¸­ï¼Œä¸€ç›´å¾—ä¸åˆ°é¢„æœŸçš„ç»“æœï¼Œ(æ³¨ï¼šæ²¡æœ‰è®¾ç½®æ¶ˆè´¹è€…ï¼Œåªæœ‰ç”Ÿäº§è€…)ï¼Œå…ˆçœ‹ç»“æœï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950publish event :0bufferSie:8remainingCapacity:8cursor:0--------------------------------&gt;publish event :1bufferSie:8remainingCapacity:8cursor:1--------------------------------&gt;publish event :2bufferSie:8remainingCapacity:8cursor:2--------------------------------&gt;publish event :3bufferSie:8remainingCapacity:8cursor:3--------------------------------&gt;publish event :4bufferSie:8remainingCapacity:8cursor:4--------------------------------&gt;publish event :5bufferSie:8remainingCapacity:8cursor:5--------------------------------&gt;publish event :6bufferSie:8remainingCapacity:8cursor:6--------------------------------&gt;publish event :7bufferSie:8remainingCapacity:8cursor:7--------------------------------&gt;publish event :8bufferSie:8remainingCapacity:8cursor:8--------------------------------&gt;publish event :9bufferSie:8remainingCapacity:8cursor:9--------------------------------&gt; ä»ç»“æœæ¥çœ‹ï¼ŒremainingCapacity çš„å€¼åº”è¯¥éšç€ å‘å¸ƒçš„æ•°é‡ é€’å‡çš„ï¼›ä½†æ˜¯å®é™…ä¸Šå®ƒå¹¶æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚ æ¥çœ‹ä¸‹ringBuffer.remainingCapacity() è¿™ä¸ªæ–¹æ³•ï¼š 123456789/** * Get the remaining capacity for this ringBuffer. * * @return The number of slots remaining. */public long remainingCapacity()&#123; return sequencer.remainingCapacity();&#125; è¿™é‡Œé¢åˆä½¿ç”¨ sequencer.remainingCapacity()è¿™ä¸ªæ–¹æ³•æ¥è®¡ç®—çš„ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯ProducerType.SINGLEï¼Œé‚£æ¥çœ‹SingleProducerSequencer è¿™ä¸ªé‡Œé¢remainingCapacityçš„å®ç°ã€‚ 1234567891011@Overridepublic long remainingCapacity()&#123; //ä¸Šæ¬¡ç”³è¯·å®Œæ¯•çš„åºåˆ—å€¼ long nextValue = this.nextValue; //è®¡ç®—å½“å‰å·²ç»æ¶ˆè´¹åˆ°çš„åºåˆ—å€¼ long consumed = Util.getMinimumSequence(gatingSequences, nextValue); //å½“å‰ç”Ÿäº§åˆ°çš„åºåˆ—å€¼ long produced = nextValue; return getBufferSize() - (produced - consumed);&#125; æ¥è§£é‡Šä¸‹è¿™æ®µä»£ç çš„å«ä¹‰ï¼š å‡è®¾å½“å‰ ringBuffer çš„ bufferSize æ˜¯ 8 ï¼›ä¸Šæ¬¡ç”³è¯·åˆ°çš„åºåˆ—å·æ˜¯ 5ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è¯´å·²ç»ç”Ÿäº§è¿‡å ç”¨çš„åºåˆ—å·æ˜¯5ï¼›å‡è®¾å½“å‰å·²ç»æ¶ˆè´¹åˆ°çš„åºåˆ—å·æ˜¯ 3ï¼Œé‚£ä¹ˆå‰©ä½™çš„å®¹é‡ä¸ºï¼š 8-ï¼ˆ5-2ï¼‰ = 5ï¼› å› ä¸ºè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç¡®å®š bufferSize å’Œ produced çš„å€¼äº†ï¼Œé‚£ä¹ˆ remainingCapacity çš„ç»“æœå°±å–å†³äºgetMinimumSequenceçš„è®¡ç®—ç»“æœäº†ã€‚ 123456789public static long getMinimumSequence(final Sequence[] sequences, long minimum)&#123; for (int i = 0, n = sequences.length; i &lt; n; i++) &#123; long value = sequences[i].get(); minimum = Math.min(minimum, value); &#125; return minimum;&#125; è¿™ä¸ªæ–¹æ³•æ˜¯ä» Sequence æ•°ç»„ä¸­è·å–æœ€å°åºåˆ— ã€‚å¦‚æœsequences ä¸ºç©ºï¼Œåˆ™è¿”å› minimumã€‚å›åˆ°ä¸Šä¸€æ­¥ï¼Œçœ‹ä¸‹sequencesè¿™ä¸ªæ•°ç»„æ˜¯ä»å“ªé‡Œè¿‡æ¥çš„ï¼Œå®ƒçš„å€¼åœ¨å“ªé‡Œè®¾ç½®çš„ã€‚ 1long consumed = Util.getMinimumSequence(gatingSequences, nextValue); gatingSequencesæ˜¯ SingleProducerSequencerçˆ¶ç±» AbstractSequencer ä¸­çš„æˆå‘˜å˜é‡ï¼š 1protected volatile Sequence[] gatingSequences = new Sequence[0]; gatingSequences æ˜¯åœ¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•é‡Œé¢æ¥ç®¡ç†çš„ã€‚ 12345678/** * @see Sequencer#addGatingSequences(Sequence...) */@Overridepublic final void addGatingSequences(Sequence... gatingSequences)&#123; SequenceGroups.addSequences(this, SEQUENCE_UPDATER, this, gatingSequences);&#125; è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ ˆå‘å‰è¿½æº¯æœ‰è¿™å‡ ä¸ªåœ°æ–¹è°ƒç”¨äº†ï¼š WorkerPoolæ¥ç®¡ç†å¤šä¸ªæ¶ˆè´¹è€…ï¼›hangdlerEventsWith è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç”¨æ¥è®¾ç½®æ¶ˆè´¹è€…çš„ã€‚ä½†æ˜¯åœ¨ä¸Šé¢çš„æµ‹è¯•æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ˜¯æƒ³é€šè¿‡ä¸è®¾å®šæ¶ˆè´¹è€… åªè®¾å®šç”Ÿæˆè€… æ¥è§‚å¯Ÿ ç¯å½¢é˜Ÿåˆ—çš„å ç”¨æƒ…å†µï¼Œæ‰€ä»¥gatingSequences ä¼šä¸€ç›´æ˜¯ç©ºçš„ï¼Œå› æ­¤åœ¨è®¡ç®—æ—¶ä¼šæŠŠ produced çš„å€¼ä½œä¸º minimum è¿”å›ã€‚è¿™æ ·æ¯æ¬¡è®¡ç®—å°±ç›¸å½“äºï¼š 1return getBufferSize() - (produced - produced) === getBufferSize(); ä¹Ÿå°±éªŒè¯äº†ä¸ºä½•åœ¨ä¸è®¾å®šæ¶ˆè´¹è€…çš„æƒ…å†µä¸‹ï¼ŒremainingCapacity çš„å€¼ä¼šä¸€ç›´ä¿æŒä¸å˜ã€‚ SOFATracer ä¸­ Disruptor å®è·µSOFATracerä¸­ï¼ŒAsyncCommonDigestAppenderManager å¯¹ disruptor è¿›è¡Œäº†å°è£…ï¼Œç”¨äºå¤„ç†å¤–éƒ¨ç»„ä»¶çš„Traceræ‘˜è¦æ—¥å¿—ã€‚è¯¥éƒ¨åˆ†å€ŸåŠ© AsyncCommonDigestAppenderManager çš„æºç æ¥åˆ†æä¸‹SOFATracerå¦‚ä½•ä½¿ç”¨disruptorçš„ã€‚ SOFATracerä¸­ä½¿ç”¨äº†ä¸¤ç§ä¸åŒçš„äº‹ä»¶æ¨¡å‹ï¼Œä¸€ç§æ˜¯SOFATracerå†…éƒ¨ä½¿ç”¨çš„ StringEvent , ä¸€ç§æ˜¯ å¤–éƒ¨æ‰©å±•ä½¿ç”¨çš„ SofaTacerSpanEventã€‚è¿™é‡Œä»¥ SofaTacerSpanEvent è¿™ç§äº‹ä»¶æ¨¡å‹æ¥åˆ†æã€‚StringEvent æ¶ˆæ¯äº‹ä»¶æ¨¡å‹å¯¹åº”çš„æ˜¯ AsyncCommonAppenderManager ç±»å°è£…çš„disruptorã€‚ SofaTracerSpanEvent ( -&gt; LongEvent)å®šä¹‰æ¶ˆæ¯äº‹ä»¶æ¨¡å‹ï¼ŒSofaTacerSpanEvent å’Œ å‰é¢ demo ä¸­çš„ LongEvent åŸºæœ¬ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦æ˜¯å†…éƒ¨æŒæœ‰çš„æ¶ˆæ¯æ•°æ®ä¸åŒï¼ŒLongEvent ä¸­æ˜¯ä¸€ä¸ªlongç±»å‹çš„æ•°æ®ï¼ŒSofaTacerSpanEventä¸­æŒæœ‰çš„æ˜¯ SofaTracerSpan ã€‚ 123456789public class SofaTracerSpanEvent &#123; private volatile SofaTracerSpan sofaTracerSpan; public SofaTracerSpan getSofaTracerSpan() &#123; return sofaTracerSpan; &#125; public void setSofaTracerSpan(SofaTracerSpan sofaTracerSpan) &#123; this.sofaTracerSpan = sofaTracerSpan; &#125;&#125; Consumer ( -&gt; LongEventHandler)Consumer æ˜¯ AsyncCommonDigestAppenderManager çš„å†…éƒ¨ç±»;å®ç°äº† EventHandler æ¥å£ï¼Œè¿™ä¸ªconsumerå°±æ˜¯ä½œä¸ºæ¶ˆè´¹è€…å­˜åœ¨çš„ã€‚ åœ¨AsyncCommonAppenderManagerä¸­ä¹Ÿæœ‰ä¸€ä¸ªï¼Œè¿™ä¸ªåœ°æ–¹ä¸ªäººè§‰å¾—å¯ä»¥æŠ½å‡ºå»ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—AsyncCommonDigestAppenderManager/AsyncCommonAppenderManagerçš„ä»£ç çœ‹èµ·æ¥æ›´å¹²å‡€ï¼› 123456789101112131415161718192021222324252627282930313233343536373839private class Consumer implements EventHandler&lt;SofaTracerSpanEvent&gt; &#123; //æ—¥å¿—ç±»å‹é›†åˆï¼Œéè¯¥é›†åˆå†…çš„æ—¥å¿—ç±»å‹å°†ä¸ä¼šè¢«å¤„ç† protected Set&lt;String&gt; logTypes = Collections.synchronizedSet(new HashSet&lt;String&gt;()); @Override public void onEvent(SofaTracerSpanEvent event, long sequence, boolean endOfBatch) throws Exception &#123; // æ‹¿åˆ°å…·ä½“çš„æ¶ˆæ¯æ•°æ® sofaTracerSpan SofaTracerSpan sofaTracerSpan = event.getSofaTracerSpan(); // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ™ä¸åšä»»ä½•å¤„ç† if (sofaTracerSpan != null) &#123; try &#123; String logType = sofaTracerSpan.getLogType(); // éªŒè¯å½“å‰æ—¥å¿—ç±»å‹æ˜¯å¦å¯ä»¥è¢«å½“å‰consumeræ¶ˆè´¹ if (logTypes.contains(logType)) &#123; // è·å–ç¼–ç ç±»å‹ SpanEncoder encoder = contextEncoders.get(logType); //è·å– appender TraceAppender appender = appenders.get(logType); // å¯¹æ•°æ®è¿›è¡Œç¼–ç å¤„ç† String encodedStr = encoder.encode(sofaTracerSpan); if (appender instanceof LoadTestAwareAppender) &#123; ((LoadTestAwareAppender) appender).append(encodedStr, TracerUtils.isLoadTest(sofaTracerSpan)); &#125; else &#123; appender.append(encodedStr); &#125; // åˆ·æ–°ç¼“å†²åŒºï¼Œæ—¥å¿—è¾“å‡º appender.flush(); &#125; &#125; catch (Exception e) &#123; // å¼‚å¸¸çœç•¥ &#125; &#125; &#125; public void addLogType(String logType) &#123; logTypes.add(logType); &#125; &#125; SofaTracerSpanEventFactory ï¼ˆ-&gt; LongEventFactoryï¼‰ç”¨äºäº§ç”Ÿæ¶ˆæ¯äº‹ä»¶çš„ Factory 123456public class SofaTracerSpanEventFactory implements EventFactory&lt;SofaTracerSpanEvent&gt; &#123; @Override public SofaTracerSpanEvent newInstance() &#123; return new SofaTracerSpanEvent(); &#125;&#125; ConsumerThreadFactory (-&gt; LongEventThreadFactory )ç”¨æ¥äº§ç”Ÿæ¶ˆè´¹çº¿ç¨‹çš„ Factoryã€‚ 123456789101112131415public class ConsumerThreadFactory implements ThreadFactory &#123; private String workName; public String getWorkName() &#123; return workName; &#125; public void setWorkName(String workName) &#123; this.workName = workName; &#125; @Override public Thread newThread(Runnable runnable) &#123; Thread worker = new Thread(runnable, "Tracer-AsyncConsumer-Thread-" + workName); worker.setDaemon(true); return worker; &#125;&#125; æ„å»ºdisruptordisruptor çš„æ„å»ºæ˜¯åœ¨ AsyncCommonDigestAppenderManager çš„æ„é€ å‡½æ•°ä¸­å®Œæˆçš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041public AsyncCommonDigestAppenderManager(int queueSize, int consumerNumber) &#123; // ä½¿ç”¨è¿™ä¸ªè®¡ç®—æ¥ä¿è¯realQueueSizeæ˜¯2çš„æ¬¡å¹‚ï¼ˆè¿”å›å½“å‰ å¤§äºç­‰äºqueueSizeçš„æœ€å°çš„2çš„æ¬¡å¹‚æ•° ï¼‰ int realQueueSize = 1 &lt;&lt; (32 - Integer.numberOfLeadingZeros(queueSize - 1)); //æ„å»ºdisruptorï¼Œä½¿ç”¨çš„æ˜¯ ProducerType.MULTI //ç­‰å¾…ç­–ç•¥æ˜¯ BlockingWaitStrategy disruptor = new Disruptor&lt;SofaTracerSpanEvent&gt;(new SofaTracerSpanEventFactory(), realQueueSize, threadFactory, ProducerType.MULTI, new BlockingWaitStrategy()); //æ¶ˆè´¹è€…åˆ—è¡¨ this.consumers = new ArrayList&lt;Consumer&gt;(consumerNumber); for (int i = 0; i &lt; consumerNumber; i++) &#123; Consumer consumer = new Consumer(); consumers.add(consumer); //è®¾ç½®å¼‚å¸¸å¤„ç†ç¨‹åº disruptor.setDefaultExceptionHandler(new ConsumerExceptionHandler()); //ç»‘å®šæ¶ˆè´¹è€… disruptor.handleEventsWith(consumer); &#125; //æ˜¯å¦å…è®¸ä¸¢å¼ƒï¼Œä»é…ç½®æ–‡ä»¶è·å– this.allowDiscard = Boolean.parseBoolean(SofaTracerConfiguration.getProperty( SofaTracerConfiguration.TRACER_ASYNC_APPENDER_ALLOW_DISCARD, DEFAULT_ALLOW_DISCARD)); if (allowDiscard) &#123; //æ˜¯å¦è®°å½•ä¸¢å¤±æ—¥å¿—çš„æ•°é‡ this.isOutDiscardNumber = Boolean.parseBoolean(SofaTracerConfiguration.getProperty( SofaTracerConfiguration.TRACER_ASYNC_APPENDER_IS_OUT_DISCARD_NUMBER, DEFAULT_IS_OUT_DISCARD_NUMBER)); //æ˜¯å¦è®°å½•ä¸¢å¤±æ—¥å¿—çš„TraceIdå’ŒRpcId this.isOutDiscardId = Boolean.parseBoolean(SofaTracerConfiguration.getProperty( SofaTracerConfiguration.TRACER_ASYNC_APPENDER_IS_OUT_DISCARD_ID, DEFAULT_IS_OUT_DISCARD_ID)); //ä¸¢å¤±æ—¥å¿—çš„æ•°é‡è¾¾åˆ°è¯¥é˜ˆå€¼è¿›è¡Œä¸€æ¬¡æ—¥å¿—è¾“å‡º this.discardOutThreshold = Long.parseLong(SofaTracerConfiguration.getProperty( SofaTracerConfiguration.TRACER_ASYNC_APPENDER_DISCARD_OUT_THRESHOLD, DEFAULT_DISCARD_OUT_THRESHOLD)); if (isOutDiscardNumber) &#123; this.discardCount = new PaddedAtomicLong(0L); &#125; &#125;&#125; å¯åŠ¨ disruptordisruptorçš„å¯åŠ¨å§”æ‰˜ç»™äº†AsyncCommonDigestAppenderManager çš„startæ–¹æ³•æ¥æ‰§è¡Œã€‚ 1234public void start(final String workerName) &#123; this.threadFactory.setWorkName(workerName); this.ringBuffer = this.disruptor.start();&#125; æ¥çœ‹ä¸‹ï¼ŒSOFATracer ä¸­ å…·ä½“æ˜¯åœ¨å“ªé‡Œè°ƒç”¨è¿™ä¸ªstart çš„ï¼š CommonTracerManager : è¿™ä¸ªé‡Œé¢æŒæœ‰äº†AsyncCommonDigestAppenderManager ç±»çš„ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œå¹¶ä¸”æ˜¯static é™æ€ä»£ç å—ä¸­è°ƒç”¨äº†startæ–¹æ³•ï¼›è¿™ä¸ªç”¨æ¥è¾“å‡ºæ™®é€šæ—¥å¿—ã€‚ SofaTracerDigestReporterAsyncManagerï¼šè¿™é‡Œç±»é‡Œé¢ä¹Ÿæ˜¯æŒæœ‰äº†AsyncCommonDigestAppenderManager ç±»çš„ä¸€ä¸ªå•ä¾‹å¯¹åƒï¼Œå¹¶ä¸”æä¾›äº†getSofaTracerDigestReporterAsyncManageræ–¹æ³•æ¥è·å–è¯¥å•ä¾‹ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨äº†startæ–¹æ³•ï¼›è¯¥å¯¹è±¡ç”¨æ¥è¾“å‡ºæ‘˜è¦æ—¥å¿—ã€‚ å‘å¸ƒäº‹ä»¶å‰é¢çš„demoä¸­æ˜¯é€šè¿‡ä¸€ä¸ªforå¾ªç¯æ¥å‘å¸ƒäº‹ä»¶çš„ï¼Œåœ¨ SOFATracer ä¸­ çš„äº‹ä»¶å‘å¸ƒæ— éå°±æ˜¯å½“æœ‰Traceræ—¥å¿—éœ€è¦è¾“å‡ºæ—¶ä¼šè§¦å‘å‘å¸ƒï¼Œé‚£ä¹ˆå¯¹åº”çš„å°±æ˜¯æ—¥å¿—çš„ append æ“ä½œï¼Œå°†æ—¥å¿— append åˆ°ç¯å½¢ç¼“å†²åŒºã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445public boolean append(SofaTracerSpan sofaTracerSpan) &#123; long sequence = 0L; //æ˜¯å¦å…è®¸ä¸¢å¼ƒ if (allowDiscard) &#123; try &#123; //å…è®¸ä¸¢å¼ƒå°±ä½¿ç”¨tryNextå°è¯•ç”³è¯·åºåˆ—ï¼Œç”³è¯·ä¸åˆ°æŠ›å‡ºå¼‚å¸¸ sequence = ringBuffer.tryNext(); &#125; catch (InsufficientCapacityException e) &#123; //æ˜¯å¦è¾“å‡ºä¸¢å¤±æ—¥å¿—çš„TraceIdå’ŒRpcId if (isOutDiscardId) &#123; SofaTracerSpanContext sofaTracerSpanContext = sofaTracerSpan .getSofaTracerSpanContext(); if (sofaTracerSpanContext != null) &#123; SynchronizingSelfLog.warn("discarded tracer: traceId[" + sofaTracerSpanContext.getTraceId() + "];spanId[" + sofaTracerSpanContext.getSpanId() + "]"); &#125; &#125; //æ˜¯å¦è¾“å‡ºä¸¢å¤±æ—¥å¿—çš„æ•°é‡ if ((isOutDiscardNumber) &amp;&amp; discardCount.incrementAndGet() == discardOutThreshold) &#123; discardCount.set(0); if (isOutDiscardNumber) &#123; SynchronizingSelfLog.warn("discarded " + discardOutThreshold + " logs"); &#125; &#125; return false; &#125; &#125; else &#123; // ä¸å…è®¸ä¸¢å¼ƒåˆ™ä½¿ç”¨nextæ–¹æ³• sequence = ringBuffer.next(); &#125; try &#123; SofaTracerSpanEvent event = ringBuffer.get(sequence); event.setSofaTracerSpan(sofaTracerSpan); &#125; catch (Exception e) &#123; SynchronizingSelfLog.error("fail to add event"); return false; &#125; //å‘å¸ƒ ringBuffer.publish(sequence); return true;&#125; SOFATracer äº‹ä»¶å‘å¸ƒçš„è°ƒç”¨é€»è¾‘ï¼š è¿½æº¯è°ƒç”¨çš„æµç¨‹ï¼Œå¯ä»¥çŸ¥é“å½“å‰ span è°ƒç”¨ finishæ—¶æˆ–è€… SOFATracerä¸­è°ƒç”¨reportSpanæ—¶ å°±ç›¸å½“äºå‘å¸ƒäº†ä¸€ä¸ªæ¶ˆæ¯äº‹ä»¶ã€‚ å°ç»“æœ¬æ–‡å¯¹ SOFATracer ä¸­ä½¿ç”¨ Disruptor æ¥è¿›è¡Œæ—¥å¿—è¾“å‡ºçš„ä»£ç è¿›è¡Œäº†ç®€å•çš„åˆ†æï¼Œæ›´å¤šå†…éƒ¨ç»†èŠ‚åŸç†å¯ä»¥è‡ªè¡Œçœ‹ä¸‹SOFATracerçš„ä»£ç ã€‚SOFATracer ä½œä¸ºä¸€ç§æ¯”è¾ƒåº•å±‚çš„ä¸­é—´ä»¶ç»„ä»¶ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡å¼€å‘ä¸­åŸºæœ¬æ˜¯æ— æ³•æ„ŸçŸ¥çš„ã€‚ä½†æ˜¯ä½œä¸ºæŠ€æœ¯æ¥å­¦ä¹ ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šç‚¹å¯ä»¥æŒ–ä¸€æŒ–ã€‚ SOFATracer GitHub ä¼ é€é—¨ã€‚ å¦‚æœæœ‰å°ä¼™ä¼´å¯¹ä¸­é—´ä»¶æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘ä»¬å›¢é˜Ÿï¼Œæ¬¢è¿æ¥æ’©ï¼›å¯¹ SOFA æŠ€æœ¯ä½“ç³»æœ‰å…´è¶£çš„å¯ä»¥å…³æ³¨æˆ‘ä»¬ ALIPAY SOFA ç¤¾åŒºï¼›é™„å›¢é˜Ÿé•‡æ¥¼å›¾ã€‚]]></content>
      <categories>
        <category>é“¾è·¯è·Ÿè¸ª</category>
      </categories>
      <tags>
        <tag>SOFATracer</tag>
        <tag>OpenTracing</tag>
        <tag>Disruptor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èŠä¸€èŠ RestTemplate]]></title>
    <url>%2F2018%2F11%2F10%2Fresttemplate1%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘è¿™æ®µæ—¶é—´ç”¨äº†ä¸‹ RestTemplate è¿™ä¸ªç±»ï¼ŒæŠ½ç‚¹æ—¶é—´æ€»ç»“ä¸‹ä¸€äº›ä¸œè¥¿ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚ ä» 3.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒSpring æä¾›äº† RestTemplate ä½œä¸ºç”¨äºè®¿é—® Rest æœåŠ¡çš„å®¢æˆ·ç«¯ï¼ŒRestTemplate æä¾›äº†å¤šç§ä¾¿æ·è®¿é—®è¿œç¨‹ Http æœåŠ¡çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿå¤§å¤§æé«˜å®¢æˆ·ç«¯çš„ç¼–å†™æ•ˆç‡ã€‚ æœ¬ç¯‡æ–‡ç« å°†ä» RestTemplate æä¾›çš„ API å…¥æ‰‹ï¼Œå…ˆæ¥äº†è§£ä¸‹ RestTemplate çš„å…·ä½“ä½¿ç”¨ï¼Œç„¶åå†å¯¹å…¶ä¸­æ¶‰åŠåˆ°çš„å‡ ä¸ªæ ¸å¿ƒç±»è¿›è¡Œåˆ†æï¼Œæœ€åå†æ¥åˆ†æä¸‹ RestTemplate æ‰§è¡Œçš„æ•´ä¸ªæµç¨‹ï¼Œç¯‡å¹…æ¯”è¾ƒé•¿ï¼Œå»ºè®®å…ˆç ä¸ºå¿«ï¼ æ ¸å¿ƒ APIåœ¨å¹³æ—¶çš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ä½¿ç”¨åŒ…è£…å¥½çš„getForObject/getForEntityï¼ŒpostForObject/postForEntity/postForLocationï¼Œputä»¥åŠdeleteã€‚ get è¯·æ±‚å¤„ç†getForEntityæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªResponseEntityï¼ŒResponseEntityæ˜¯Springå¯¹HTTPè¯·æ±‚å“åº”çš„å°è£…ï¼ŒåŒ…æ‹¬äº†å‡ ä¸ªé‡è¦çš„å…ƒç´ ï¼Œå¦‚å“åº”ç ã€contentTypeã€contentLengthã€å“åº”æ¶ˆæ¯ä½“ç­‰ã€‚ urlï¼šè°ƒç”¨çš„æœåŠ¡çš„åœ°å€ responseTypeï¼šè¿”å›çš„bodyç±»å‹ uriVariablesï¼šæœ‰ä¸¤ç§å½¢å¼: å¯ä»¥ç”¨ä¸€ä¸ªæ•°å­—åšå ä½ç¬¦ï¼Œæœ€åæ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦çš„å‚æ•°ï¼Œæ¥ä¸€ä¸€æ›¿æ¢å‰é¢çš„å ä½ç¬¦ ä¹Ÿå¯ä»¥å‰é¢ä½¿ç”¨name={name}è¿™ç§å½¢å¼ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªmapï¼Œmapçš„keyå³ä¸ºå‰è¾¹å ä½ç¬¦çš„åå­—ï¼Œmapçš„valueä¸ºå‚æ•°å€¼ responseType æµ‹è¯•æ¡ˆä¾‹å®šä¹‰çš„ä¸€ä¸ªcontrollerèµ„æºï¼š è¿™é‡Œåˆ†åˆ«ä½¿ç”¨ä¸åŒçš„ responseType è¿›è¡Œæµ‹è¯•ï¼š ç»“æœï¼š12getForEntity(responseType=Map.class):&#123;glmapper=hello glmapper&#125;getForEntity(responseType=String.class):&#123;&quot;glmapper&quot;:&quot;hello glmapper&quot;&#125; uriVariables æµ‹è¯•æ¡ˆä¾‹å…ˆæ¥çœ‹ä¸‹émapæ–¹å¼çš„ï¼Œä¸¤ä¸ªcontrollerï¼Œä¸¤ç§ä¸åŒæ–¹å¼çš„å‚æ•°è·å–ï¼ˆæœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼‰ ä½¿ç”¨å ä½ç¬¦çš„æ–¹å¼ï¼š ä½¿ç”¨ map çš„æ–¹å¼ï¼š getForObjectgetForObject å‡½æ•°å®é™…ä¸Šæ˜¯å¯¹ getForEntity å‡½æ•°çš„è¿›ä¸€æ­¥å°è£…ï¼Œå¦‚æœåªå…³æ³¨è¿”å›çš„æ¶ˆæ¯ä½“çš„å†…å®¹ï¼Œå¯¹å…¶ä»–ä¿¡æ¯éƒ½ä¸å…³æ³¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ getForObjectã€‚ è¿™é‡Œè°ƒç”¨å°±æ¯”getForEntityè¦ç®€å•ä¸€ç‚¹äº†ï¼Œå¯ä»¥ç›´æ¥æ‹¿åˆ°å¯¹è±¡ï¼š getForObject çš„å‡ ä¸ªé‡è½½æ–¹æ³•å’Œ getForEntity åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚ post è¯·æ±‚å¤„ç†åœ¨RestTemplateä¸­ï¼ŒPOSTè¯·æ±‚å¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸‰ä¸ªæ–¹æ³•æ¥å‘èµ·ï¼špostForEntityï¼ŒpostForObjectï¼ŒpostForLocationã€‚ postForEntity æ¡ˆä¾‹è°ƒç”¨è·å–ï¼š 1postForEntity(URI url, @Nullable Object request, Class&lt;T&gt; responseType) æ–¹æ³•çš„ç¬¬ä¸€å‚æ•°è¡¨ç¤ºè¦è°ƒç”¨çš„æœåŠ¡çš„åœ°å€ æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºä¸Šä¼ çš„å‚æ•° æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºè¿”å›çš„æ¶ˆæ¯ä½“çš„æ•°æ®ç±»å‹ postForObject æ¡ˆä¾‹å’Œ getForObject ç›¸å¯¹åº”ï¼Œåªå…³æ³¨è¿”å›çš„æ¶ˆæ¯ä½“ã€‚ postForLocation æ¡ˆä¾‹postForLocationä¹Ÿæ˜¯æäº¤æ–°èµ„æºï¼Œæäº¤æˆåŠŸä¹‹åï¼Œè¿”å›æ–°èµ„æºçš„URIï¼ŒpostForLocationçš„å‚æ•°å’Œå‰é¢ä¸¤ç§çš„å‚æ•°åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•çš„è¿”å›å€¼ä¸ºUriï¼Œè¿™ä¸ªåªéœ€è¦æœåŠ¡æä¾›è€…è¿”å›ä¸€ä¸ªUriå³å¯ï¼Œè¯¥Uriè¡¨ç¤ºæ–°èµ„æºçš„ä½ç½®ã€‚ è¿™é‡Œæœ‰ç‚¹å‘ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªuriæ·»åŠ åˆ°responseçš„headerä¸­ï¼Œä¸ç„¶åé¢æ‹¿åˆ°çš„æ˜¯nullã€‚ exchangeexchange æ–¹æ³•å’Œä¸Šè¿°è¿™äº›æ–¹æ³•å·®åˆ«åœ¨äºéœ€è¦å¤šä¸€ä¸ªè¯·æ±‚ç±»å‹çš„å‚æ•°ï¼š AsyncRestTemplate å¼‚æ­¥å®¢æˆ·ç«¯RestTemplateçš„å¼‚æ­¥å®ç°æ–¹å¼ã€‚æ‰€æ¶‰åŠåˆ°çš„APIå’ŒRestTemplateåŸºæœ¬ä¸€è‡´ã€‚åŒºåˆ«åœ¨äºRestTemplateç›´æ¥è¿”å›ç»“æœï¼Œè€ŒAsyncRestTemplateè¿”å›çš„æ˜¯ListenableFutureã€‚ RestTemplate æ‹¦æˆªå™¨Springæä¾›äº†ClientHttpRequestInterceptorå’ŒAsyncClientHttpRequestInterceptorä¸¤ä¸ªæ¥å£ï¼Œåˆ†åˆ«å¯ä»¥å¯¹RestTemplateå’ŒAsyncRestTemplateå‘èµ·çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå¹¶åœ¨å…¶è¢«å‘é€è‡³æœåŠ¡ç«¯ä¹‹å‰ä¿®æ”¹è¯·æ±‚æˆ–æ˜¯å¢å¼ºç›¸åº”çš„ä¿¡æ¯ã€‚ ClientHttpRequestInterceptor æ‹¦æˆª RestTemplate AsyncClientHttpRequestInterceptor æ‹¦æˆªAsyncRestTemplate è®¾ç½®æ‹¦æˆªå™¨å°±æ˜¯é€šè¿‡æä¾›çš„ setInterceptors è®¾ç½®å³å¯ï¼š è‡ªå®šä¹‰ ResponseErrorHandlerResponseErrorHandler æ¥å£å®šä¹‰äº†å½“responseå‘ç”Ÿé”™è¯¯æ—¶éœ€è¦è¿›è¡Œçš„æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªCustomResponseErrorHandlerï¼Œå½“è¿”å›çš„codeä¸æ˜¯200æ—¶ï¼Œå°±è¡¨ç¤ºæ‰§è¡Œå‡ºé”™äº†ã€‚ è®¾ç½® ResponseErrorHandlerï¼š æ‰§è¡Œç»“æœï¼š å¤„ç†æµç¨‹ä¸‹é¢æ¥æ¢³ç†ä¸‹ RestTemplate ä¸­è¯·æ±‚å¤„ç†çš„æµç¨‹ã€‚ä¸‹å›¾ä¸­ XXXX è¡¨ç¤ºæˆ‘ä»¬è°ƒç”¨çš„ API æ–¹æ³•ã€‚å¤§ä½“æµç¨‹å°±æ˜¯ï¼šapi å†…éƒ¨åšä¸€äº›è¯·æ±‚ç›¸å…³çš„å¤„ç†å°è£…ï¼Œç„¶åäº¤ç»™ execute æ–¹æ³•æ‰§è¡Œï¼Œæœ€åçœŸæ­£å¤„ç†åˆ™æ˜¯åœ¨ doExecute æ–¹æ³•ä¸­å®Œæˆã€‚ ä¸‹é¢ä»¥ getForEntity æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹æ¥åˆ†æï¼š getForEntity æ–¹æ³•ï¼š åŸºäºç»™å®šå“åº”ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªè¯·æ±‚å›è°ƒå®ç°ï¼Œå‡†å¤‡è¯·æ±‚ã€‚ åŸºäºç»™å®šå“åº”ç±»å‹ï¼Œè¿”å› ResponseEntity çš„å“åº”æå–å™¨ã€‚ execute æ–¹æ³•ï¼š è¿™ä¸ªæ–¹æ³•é‡Œé¢æ˜¯å¯¹urlè¿›è¡Œurlencodeç¼–ç å¤„ç†çš„ï¼Œç»Ÿä¸€è½¬ä¸ºURLã€‚è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŠŠå‚æ•°è¿›è¡Œç½‘ç»œç¼–ç ã€‚ doExecuteæ˜¯è¯·æ±‚çœŸæ­£å¤„ç†çš„æ–¹æ³•ï¼Œè¿™é‡Œæ¥é‡ç‚¹çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š createRequest doWithRequest execute handleResponse 1ã€createRequestè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ª ClientHttpRequest å¯¹è±¡ã€‚RestTemplateé›†æˆäº† HttpAccessorè¿™ä¸ªæŠ½è±¡ç±»ï¼Œåˆ›å»ºClientHttpRequestçš„è¿‡ç¨‹å°±æ˜¯åœ¨å…¶çˆ¶ç±»HttpAccessorä¸­é€šè¿‡é»˜è®¤çš„ ClientHttpRequestFactory å®ç°ç±» SimpleClientHttpRequestFactory å®Œæˆå…·ä½“çš„è¯·æ±‚åˆ›å»ºã€‚ 1ã€åˆ›å»º java.net.HttpURLConnection å¯¹è±¡ 2ã€è®¾ç½® connectionï¼ŒåŒ…æ‹¬ connectTimeoutã€setDoInput ç­‰ã€‚ 3ã€bufferRequestBody ç”¨äºæ ‡å¿—æ˜¯å¦ä½¿ç”¨ç¼“å­˜æµçš„å½¢å¼ï¼Œé»˜è®¤æ˜¯ trueã€‚ç¼ºç‚¹æ˜¯å½“å‘é€å¤§é‡æ•°æ®æ—¶ï¼Œæ¯”å¦‚ put/postï¼Œå­˜åœ¨å†…å­˜æ¶ˆè€—ä¸¥é‡ã€‚è¯¥å€¼å¯ä»¥é€šè¿‡ SimpleClientHttpRequestFactory#setBufferRequestBodyæ¥ä¿®æ”¹ã€‚ ä¸åŒç‰ˆæœ¬çš„å˜æ›´è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå¤§å®¶åœ¨é˜…è¯»æºç æ—¶ï¼Œè¿˜æ˜¯ä»æœ€æ–°çš„ä»£ç æ¥çœ‹ã€‚ 2ã€doWithRequestRequestCallback å°è£…äº†è¯·æ±‚ä½“å’Œè¯·æ±‚å¤´å¯¹è±¡ã€‚è¿™é‡Œä¼šéå†æ‰€æœ‰çš„ HttpMessageConverterï¼Œè§£ææˆæ‰€æœ‰æ”¯æŒçš„MediaTypeï¼Œæ”¾åœ¨allSupportedMediaTypesä¸­ã€‚ 1request.getHeaders().setAccept(allSupportedMediaTypes); RestTemplateä¸­å¯¹åº”äº†ä¸¤ä¸ªå†…éƒ¨ç±»çš„å®ç°ï¼š AcceptHeaderRequestCallback.doWithRequestçš„å¤„ç†ã€‚å‘é€è¯·æ±‚æ—¶ï¼ŒHttpå¤´éƒ¨éœ€è¦è®¾ç½®Acceptå­—æ®µï¼Œè¯¥å­—æ®µè¡¨æ˜äº†å‘é€è¯·æ±‚çš„è¿™æ–¹æ¥å—çš„åª’ä½“ç±»å‹ï¼ˆæ¶ˆæ¯æ ¼å¼ï¼‰ï¼Œä¹Ÿæ˜¯å“åº”ç«¯è¦è¿”å›çš„ä¿¡æ¯çš„åª’ä½“ç±»å‹ï¼ˆæ¶ˆæ¯æ ¼å¼ï¼‰ã€‚æ ¹æ®postForEntityæ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°responseTypeï¼Œç¨‹åºå°†é€‰æ‹©é€‚åˆçš„è§£æå™¨XXXConverterï¼Œå¹¶ä¾æ®è¯¥è§£æå™¨æ‰¾å‡ºæ‰€æœ‰æ”¯æŒçš„åª’ä½“ç±»å‹ã€‚ HttpEntityRequestCallback.doWithRequestçš„å¤„ç†ã€‚å¦‚æœæ˜¯POSTè¯·æ±‚å¹¶ä¸”æ¶ˆæ¯ä½“å­˜åœ¨æ—¶ï¼Œé™¤äº†è®¾ç½®Acceptå­—æ®µï¼Œè¿˜å¯èƒ½éœ€è¦è®¾ç½®Content-Typeå­—æ®µï¼Œè¯¥å­—æ®µè¡¨æ˜äº†æ‰€å‘é€è¯·æ±‚çš„åª’ä½“ç±»å‹ï¼ˆæ¶ˆæ¯æ ¼å¼ï¼‰ï¼Œä¹Ÿæ˜¯å“åº”ç«¯æ¥å—çš„åª’ä½“ç±»å‹ï¼ˆæ¶ˆæ¯æ ¼å¼ï¼‰ã€‚æ ¹æ®postForEntityæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°requestï¼Œç¨‹åºå°†é€‰æ‹©é€‚åˆçš„è§£æå™¨XXXConverterï¼Œå°†è¯·æ±‚æ¶ˆæ¯å†™å…¥è¾“å‡ºæµã€‚ 3ã€executeè¿™é‡Œä¼šæŠŠè¯·æ±‚å¤´/ä½“å°è£…åˆ°connectï¼Œç„¶åå‘é€è¯·æ±‚ã€‚è·Ÿè¸ª execute æ–¹æ³•æ‰§è¡Œï¼Œå®šä½åˆ°SimpleBufferingClientHttpRequest#executeInternalæ–¹æ³•ï¼š è¿™é‡Œæ˜¯ä½¿ç”¨å®ä¾‹ SimpleBufferingClientHttpRequest å°è£…è¯·æ±‚ä½“å’Œè¯·æ±‚å¤´ã€‚ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼š delete æ—¶é€šè¿‡å‰é¢è®¾ç½®çš„ DoOutputå‚æ•°å’Œæ˜¯å¦å¯ä»¥è®¾ç½®è¾“å‡ºæµæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å‘é€è¯·æ±‚ä½“å¦‚æœæ˜¯ delete è¯·æ±‚ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾ DoOutput = falseï¼Œä¸ä¼šæœ‰å°è£…è¯·æ±‚ä½“çš„è¿‡ç¨‹ï¼Œå³ä¸æ‰§è¡ŒFileCopyUtils.copy(bufferedOutput, this.connection.getOutputStream())ã€‚ 4ã€handleResponseæœ€åå°±æ˜¯ response çš„è§£æäº†ï¼Œä»ä»£ç æ¥çœ‹ï¼Œä¸»è¦è¿˜æ˜¯ Error çš„è§£æã€‚è¿™é‡Œçš„ErrorHandleræˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°ï¼Œå¯ä»¥é€šè¿‡å®ç° ResponseErrorHandler æ¥è‡ªå®šä¹‰ å¼‚å¸¸å¤„ç†ã€‚ å°ç»“æœ¬ç¯‡å…ˆä»‹ç»äº†RestTemplateçš„APIä½¿ç”¨ï¼ŒæŒ‘äº†å‡ ä¸ªä»‹ç»äº†ä¸‹ï¼Œæ›´å¤šä½¿ç”¨ç»†èŠ‚è¿˜æ˜¯è¦é’ˆå¯¹ä¸åŒçš„åœºæ™¯æ¥å†³å®šã€‚æ¥ç€å¯¹æ‹¦æˆªå™¨ï¼Œå¼‚æ­¥RestTemplateä»¥åŠé”™è¯¯å¤„ç†å™¨åšäº†ç®€å•çš„ä»‹ç»å¹¶ç»™å‡ºäº†æ¡ˆä¾‹ã€‚æœ€ååˆ†æäº†ä¸‹RestTemplateçš„æ‰§è¡Œæµç¨‹ï¼Œç¯‡å¹…åŸå› æ‰§è¡Œæµç¨‹éƒ¨åˆ†åªæ˜¯å¤§æ¦‚æ‹äº†æ‹ï¼Œå…¶ä¸­è¿˜æ˜¯å¾ˆå¤šç»†èŠ‚æœ‰æ—¶é—´å†è¡¥å……ï¼Œè¿™éƒ¨åˆ†ä¸»è¦å°±æ˜¯çœ‹åº•å±‚æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Œå·²ç»è¯·æ±‚å‚æ•°çš„ä¼ é€’ç­‰ã€‚]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>web</tag>
        <tag>restful</tag>
        <tag>èŠä¸€èŠ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èŠä¸€èŠ Spring ä¸­çš„æ‰©å±•æœºåˆ¶(äºŒ) - NamespaceHandler]]></title>
    <url>%2F2018%2F11%2F10%2Fspringextentiontwo%2F</url>
    <content type="text"><![CDATA[å‰ä¸€ç¯‡ èŠä¸€èŠ Spring ä¸­çš„æ‰©å±•æœºåˆ¶ï¼ˆä¸€ï¼‰ ä¸­èŠåˆ°äº†ApplicationListenerã€ApplicationContextAwareã€BeanFactoryAwareä¸‰ç§æœºåˆ¶ã€‚æœ¬ç¯‡å°†ä»‹ç» NamespaceHandler çš„æ‰©å±•ä½¿ç”¨ã€‚ ç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´å¯¹äºè¿™å‡ ä¸ªç±»éƒ½ä¸é™Œç”Ÿï¼ŒåŸºæœ¬åŸºäºjavaå®ç°çš„RPCæ¡†æ¶éƒ½ä¼šä½¿ç”¨ï¼Œæ¯”å¦‚ Dubbo , SOFARpc ç­‰ã€‚æœ¬æ–‡å…ˆä»å‡ ä¸ªå°demoå…¥æ‰‹ï¼Œäº†è§£ä¸‹åŸºæœ¬çš„æ¦‚å¿µå’Œç¼–ç¨‹æµç¨‹ï¼Œç„¶ååˆ†æä¸‹ SOFARpc ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚ NamespaceHandlerNamespaceHandler æ˜¯ Spring æä¾›çš„ å‘½åç©ºé—´å¤„ç†å™¨ã€‚ä¸‹é¢è¿™å¼ å›¾ä¸­ï¼Œé™¤äº†ä¹±å…¥çš„æœ¬ç¯‡ demo ä¸­æ¶‰åŠåˆ°çš„ BridgeNameSpaceHandler ä¹‹å¤–ï¼Œå…¶ä»–å‡ä¸º Spring è‡ªèº«æä¾›çš„ã€‚å› ä¸ºè¿™é‡Œæˆ‘åªå¼•å…¥äº† bean å’Œ context ä¾èµ–ï¼Œæ‰€ä»¥è¿™ä¹Ÿä»…ä»…æ˜¯ä¸€éƒ¨åˆ†ã€‚å›¾ä¸­æˆ‘ä»¬å¸¸ç”¨çš„åº”è¯¥ç®—æ˜¯ AopNamespaceHandlerã€‚ æˆ‘ä»¬ä½¿ç”¨åŸºäºxmlçš„springé…ç½®æ—¶ï¼Œå¯èƒ½éœ€è¦é…ç½®å¦‚&lt;aop:config /&gt;è¿™æ ·çš„æ ‡ç­¾ï¼Œåœ¨é…ç½®è¿™ä¸ªæ ‡ç­¾ä¹‹å‰ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦å¼•å…¥è¿™ä¸ªaopæ‰€åœ¨çš„å‘½åç©ºé—´ï¼š 1234567891011&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/aophttp://www.springframework.org/schema/aop/spring-aop.xsdhttp://www.springframework.org/schema/contexthttp://www.springframework.org/schema/context/spring-context.xsd" /&gt; å…³äºAOP å¯ä»¥äº†è§£ä¸‹ èŠä¸€èŠ AOP ï¼šè¡¨ç°å½¢å¼ä¸åŸºç¡€æ¦‚å¿µï¼Œè¿™é‡Œä¸è¿‡å¤šè§£é‡Šï¼Œä¸‹é¢å°±æŒ‰ç…§ å®˜æ–¹æ–‡æ¡£çš„æµç¨‹ æ¥å†™ä¸€ä¸ªè‡ªå®šä¹‰xmlï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š 12345&lt;bridge:application id="bridgeTestApplication" name="bridgeTestApplication" version="1.0" organization="bridge.glmapper.com" owner="leishu@glmapper"/&gt; 1ã€å®šä¹‰ xsd æ–‡ä»¶å…³äº xsd æ–‡ä»¶çš„è¯­æ³•è§„åˆ™ä¸åœ¨æœ¬ç¯‡èŒƒå›´ä¹‹å†…ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œgoogleã€‚ä¸‹é¢è¿™ä¸ªæ–‡ä»¶å¾ˆç®€å•ï¼Œå®šä¹‰çš„element name ä¸ºapplicationï¼Œå¯¹åº”äº bridge:applicationä¸­çš„applicationã€‚attributeå°±æ˜¯ä¸Šé¢æ•ˆæœå±•ç¤ºä¸­å¯¹åº”çš„å‡ ä¸ªå±æ€§åã€‚ 12345678910111213141516171819&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;&lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:beans="http://www.springframework.org/schema/beans" xmlns:tool="http://www.springframework.org/schema/tool" xmlns="http://bridge.glmapper.com/schema/bridge" targetNamespace="http://bridge.glmapper.com/schema/bridge"&gt; &lt;xsd:import namespace="http://www.springframework.org/schema/beans"/&gt; &lt;xsd:complexType name="applicationType"&gt; &lt;xsd:attribute name="id" type="xsd:ID"/&gt; &lt;xsd:attribute name="name" type="xsd:string" use="required"/&gt; &lt;xsd:attribute name="version" type="xsd:string"/&gt; &lt;xsd:attribute name="owner" type="xsd:string"/&gt; &lt;xsd:attribute name="organization" type="xsd:string"/&gt; &lt;/xsd:complexType&gt; &lt;xsd:element name="application" type="applicationType"/&gt;&lt;/xsd:schema&gt; 2ã€ç¼–å†™ NamespaceHandler In addition to the schema, we need a NamespaceHandler that will parse all elements of this specific namespace Spring encounters while parsing configuration files. ç”¨ç¼–å†™çš„è¿™ä¸ª NamespaceHandler æ¥è§£æé…ç½®æ–‡ä»¶ã€‚ å…·ä½“è¯´æ¥NamespaceHandlerä¼šæ ¹æ®schemaå’ŒèŠ‚ç‚¹åæ‰¾åˆ°æŸä¸ªBeanDefinitionParserï¼Œç„¶åç”±BeanDefinitionParserå®Œæˆå…·ä½“çš„è§£æå·¥ä½œã€‚ Springæä¾›äº†é»˜è®¤å®ç°ç±»NamespaceHandlerSupportå’ŒAbstractSingleBeanDefinitionParserï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å»ç»§æ‰¿è¿™ä¸¤ä¸ªç±»ã€‚ è¿™é‡Œé€šè¿‡ç»§æ‰¿ NamespaceHandlerSupport è¿™ä¸ªæŠ½è±¡ç±»æ¥å®Œæˆã€‚ 123456public class BridgeNamespaceHandler extends NamespaceHandlerSupport &#123; public void init() &#123; registerBeanDefinitionParser("application", new ApplicationBeanDefinitionParser()); &#125;&#125; è¿™é‡Œå®é™…ä¸Šåªæ˜¯æ³¨å†Œäº†ä¸€ä¸ªè§£æå™¨ï¼Œå…·ä½“çš„ BeanDefinitionParser æ‰æ˜¯å°† XMLå…ƒç´ æ˜ å°„åˆ°ç‰¹å®šbeançš„ã€‚ 3ã€ç¼–å†™ BeanDefinitionParserè¿™é‡Œç›´æ¥é€šè¿‡å®ç°BeanDefinitionParseræ¥å£çš„æ–¹å¼å®šä¹‰æˆ‘ä»¬çš„BeanDefinitionParserå®ç°ç±»ã€‚å…³äºAbstractSingleBeanDefinitionParser çš„ä½¿ç”¨åœ¨ SPFARpc ä¸­ä¼šæ¶‰åŠåˆ°ã€‚ 123456789101112131415161718192021222324252627public class ApplicationBeanDefinitionParser implements BeanDefinitionParser &#123; public BeanDefinition parse(Element element, ParserContext parserContext) &#123; //beanDefinition RootBeanDefinition beanDefinition = new RootBeanDefinition(); beanDefinition.setBeanClass(ApplicationConfig.class); beanDefinition.setLazyInit(false); //è§£æid String id = element.getAttribute("id"); beanDefinition.getPropertyValues().add("id", id); //è§£æname beanDefinition.getPropertyValues().add("name", element.getAttribute("name")); //è§£æversion beanDefinition.getPropertyValues().add("version", element.getAttribute("version")); //owner beanDefinition.getPropertyValues().add("owner", element.getAttribute("owner")); //organization beanDefinition.getPropertyValues().add("organization", element.getAttribute("organization")); parserContext.getRegistry().registerBeanDefinition(id, beanDefinition); return beanDefinition; &#125;&#125; è¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯å¼€å§‹è§£æè‡ªå®šä¹‰æ ‡ç­¾çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡BeanDefinitionParserDelegate-&gt;parseCustomElementæ–¹æ³•æ¥å¤„ç†çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€šè¿‡eleå…ƒç´ æ‹¿åˆ°å½“å‰namespaceUriï¼Œä¹Ÿå°±æ˜¯åœ¨xsdä¸­å®šä¹‰çš„å‘½åç©ºé—´ï¼Œæ¥ç€å§”æ‰˜ç»™ DefaultNamespaceResolver å¾—åˆ°å…·ä½“çš„handlerï¼ˆBridgenamspaceHandlerï¼‰ ,ç„¶åæ‰§è¡Œparse è§£æã€‚ 4ã€é…ç½® spring.handlers å’Œ spring.schmas1234http\://bridge.glmapper.com/schema/bridge=com.glmapper.extention.namespacehandler.BridgeNamespaceHandlerhttp\://bridge.glmapper.com/schema/bridge.xsd=META-INF/bridge.xsd é…ç½®è¿™ä¸ªå…¶å®æ˜¯ä¸ºäº†è®©Springåœ¨è§£æxmlçš„æ—¶å€™èƒ½å¤Ÿæ„ŸçŸ¥åˆ°æˆ‘ä»¬çš„è‡ªå®šä¹‰å…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦æŠŠNamespaceHandlerå’Œxsdæ–‡ä»¶æ”¾åˆ°ä½äºMETA-INFç›®å½•ä¸‹çš„spring.handlers å’Œ spring.schmasæ–‡ä»¶ä¸­ã€‚è¿™æ ·å°±å¯ä»¥åœ¨springé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ ‡ç­¾äº†ã€‚å¦‚ä¸‹ï¼š 123456789101112131415&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:bridge="http://bridge.glmapper.com/schema/bridge" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://bridge.glmapper.com/schema/bridge http://bridge.glmapper.com/schema/bridge.xsd"&gt; &lt;bridge:application id="bridgeTestApplication" name="bridgeTestApplication" version="1.0" organization="bridge.glmapper.com" owner="leishu@glmapper"/&gt;&lt;/beans&gt; éªŒè¯ä¸‹ä»å®¹å™¨ä¸­è·å–æˆ‘ä»¬çš„beanï¼š 123456789public static void main(String[] args) &#123; ApplicationContext applicationContext = new ClassPathXmlApplicationContext("classpath:bean.xml"); ApplicationConfig applicationConfig = (ApplicationConfig) applicationContext.getBean("bridgeTestApplication"); System.out.println("applicationConfig = "+applicationConfig);&#125; è¾“å‡ºç¤ºä¾‹ï¼š1234567applicationConfig = ApplicationConfig &#123; id=bridgeTestApplication, name=&apos;bridgeTestApplication&apos;, version=&apos;1.0&apos;, owner=&apos;leishu@glmapper&apos;, organization=&apos;bridge.glmapper.com&apos;&#125; æ•´ä½“æ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬è¦å®ç°è‡ªå·±çš„ xml æ ‡ç­¾ï¼Œä»…éœ€å®Œæˆä»¥ä¸‹å‡ æ­¥å³å¯ï¼š 1ã€å®šä¹‰ xsd æ–‡ä»¶ 2ã€ç¼–å†™ NamespaceHandler 3ã€ç¼–å†™ BeanDefinitionParser 4ã€é…ç½® spring.handlers å’Œ spring.schmas SOFARpc ä¸­ä½¿ç”¨åˆ†æSOFARpc ä¸­çš„ rpc.xsd æ–‡ä»¶æ˜¯é›†æˆåœ¨ sofaboot.xsd æ–‡ä»¶ä¸­çš„ï¼Œè¯¦ç»†å¯è§ï¼šsofa-boot xsd æ–‡ä»¶è¿™é‡Œä¸è´´äº†ï¼Œæœ‰ç‚¹é•¿ spring.handlers å’Œ spring.schmaså…ˆçœ‹ä¸‹ spring.handlers å’Œ spring.schmas é…ç½®ï¼š 12345678http\://sofastack.io/schema/sofaboot=com.alipay.sofa.infra.config.spring.namespace.handler.SofaBootNamespaceHandlerhttp\://sofastack.io/schema/sofaboot.xsd=META-INF/com/alipay/sofa/infra/config/spring/namespace/schema/sofaboot.xsdhttp\://sofastack.io/schema/rpc.xsd=META-INF/com/alipay/sofa/infra/config/spring/namespace/schema/rpc.xsd ä» spring.handlersæ‰¾åˆ° NamespaceHandler : SofaBootNamespaceHandlerã€‚ SofaBootNamespaceHandleræºç å¦‚ä¸‹ï¼Œè¿™é‡Œçœ‹å‡ºæ¥ï¼Œå¹¶ä¸æ˜¯åƒä¸Šé¢æˆ‘ä»¬è‡ªå·±å†™çš„é‚£ç§æ–¹å¼é‚£æ ·ï¼Œä¼šæœ‰ä¸€ä¸ª BeanDefinitionParserã€‚è¿™é‡Œå…¶å®è®¾è®¡çš„å¾ˆå·§å¦™ï¼Œé€šè¿‡spiçš„æ–¹å¼æ¥è½½å…¥å…·ä½“çš„BeanDefinitionParserã€‚ 12345678910111213141516171819202122public class SofaBootNamespaceHandler extends NamespaceHandlerSupport &#123; @Override public void init() &#123; ServiceLoader&lt;SofaBootTagNameSupport&gt; serviceLoaderSofaBoot = ServiceLoader.load(SofaBootTagNameSupport.class); //SOFABoot for (SofaBootTagNameSupport tagNameSupport : serviceLoaderSofaBoot) &#123; this.registerTagParser(tagNameSupport); &#125; &#125; private void registerTagParser(SofaBootTagNameSupport tagNameSupport) &#123; if (!(tagNameSupport instanceof BeanDefinitionParser)) &#123; // log return; &#125; String tagName = tagNameSupport.supportTagName(); registerBeanDefinitionParser(tagName, (BeanDefinitionParser) tagNameSupport); &#125;&#125; è¿™é‡Œå¯ä»¥çœ‹å‡ºæœ‰ ReferenceDefinitionParser å’Œ ServiceDefinitionParser ä¸¤ä¸ªè§£æç±»ï¼Œåˆ†åˆ«å¯¹åº”æœåŠ¡å¼•ç”¨å’ŒæœåŠ¡æš´éœ²ã€‚ ä¸‹é¢ä»¥ReferenceDefinitionParserä¸ºä¾‹ï¼Œå…ˆçœ‹ä¸‹å®ƒçš„ç±»å›¾ï¼š è§£æå·¥ä½œéƒ½æ˜¯åœ¨ AbstractContractDefinitionParser ç±»ä¸­å®Œæˆï¼Œ ReferenceDefinitionParser è‡ªå·±åªæ˜¯åšäº†ä¸€äº›ç‰¹æ®Šå¤„ç†ã€jvm-firstï¼ŒjvmæœåŠ¡ã€‘ã€‚ å°ç»“æœ¬ç¯‡é€šè¿‡ NamespaceHandler äº†è§£äº†å¦‚ä½•å»ç¼–å†™æˆ‘ä»¬è‡ªå®šä¹‰çš„xmlæ ‡ç­¾ï¼Œä»NamespaceHandlerçš„è§’åº¦å¯ä»¥å¾ˆå¥½çš„ç†è§£ä¸€äº› RPC æ¡†æ¶ä¸­æœ€åŸºç¡€çš„åŸºäºxml æ–¹å¼çš„æœåŠ¡å¼•ç”¨å’Œæš´éœ²çš„å®ç°æ€è·¯ã€‚å¦å¤–é€šè¿‡åˆ†æ SOFARpc ï¼Œä¹Ÿäº†è§£äº†åœ¨å®é™…çš„å·¥ç¨‹ç»„ä»¶ä¸­å¯¹äºNamespaceHandlerçš„æ‰©å±•ä½¿ç”¨ã€‚ æœ¬æ–‡ä»£ç ï¼šglmapper-spring-extention]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>èŠä¸€èŠ</tag>
        <tag>spring æ‰©å±•æœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èŠä¸€èŠ Spring ä¸­çš„æ‰©å±•æœºåˆ¶ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2018%2F11%2F10%2Fspringextentionone%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰ Spring æºç ç³»åˆ—æ–‡ç« ä¸­å¤§å¤šæ˜¯åº•å±‚æºç çš„åˆ†æï¼Œé€šè¿‡æºç å¯ä»¥è®©æˆ‘ä»¬èƒ½å¤Ÿæ¸…æ™°çš„äº†è§£ Spring åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè€Œä¸æ˜¯åœç•™äºè¡¨é¢çš„è®¤çŸ¥ã€‚æ¯”å¦‚å½“æˆ‘ä»¬è¦ä½¿ç”¨ @Autowired æ³¨è§£æ—¶ï¼Œå¯ä»¥æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„ bean ,ä½†æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥æ˜¯å€¼å¾—æ€è€ƒçš„ã€‚â€“ å…³äºé˜…è¯»æºç  Springæºç çš„é˜…è¯»ç»“åˆæ—¥å¸¸çš„ä½¿ç”¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„æŒæ¡è¿™ä¸ªåºå¤§çš„æŠ€æœ¯ä½“ç³»ï¼Œå®é™…çš„å¼€å‘å·¥ä½œä¸­æœ‰å¾ˆå¤šåœ°æ–¹å¯ä»¥å€Ÿé‰´å®ƒçš„ä¸€äº›æ€æƒ³æ¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚æœ¬ç¯‡å°†ä»¥æ‰©å±•ç‚¹ä¸ºåˆ‡å…¥ç‚¹ï¼Œæ¥äº†è§£ä¸‹åœ¨Springç”Ÿå‘½å‘¨æœŸä¸­æ‰©å±•Springä¸­çš„BeanåŠŸèƒ½ã€‚ ApplicationListener æ‰©å±•ApplicationListener å…¶å®æ˜¯ spring äº‹ä»¶é€šçŸ¥æœºåˆ¶ä¸­æ ¸å¿ƒæ¦‚å¿µï¼›åœ¨javaçš„äº‹ä»¶æœºåˆ¶ä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸‰ä¸ªæ¦‚å¿µï¼š event object : äº‹ä»¶å¯¹è±¡ event source ï¼šäº‹ä»¶æºï¼Œäº§ç”Ÿäº‹ä»¶çš„åœ°æ–¹ event listener ï¼šç›‘å¬äº‹ä»¶å¹¶å¤„ç† ApplicationListener ç»§æ‰¿è‡ª java.util.EventListener ï¼Œæä¾›äº†å¯¹äºSpringä¸­äº‹ä»¶æœºåˆ¶çš„æ‰©å±•ã€‚ ApplicationListener åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨çš„éå¸¸å¤šï¼Œæ¯”å¦‚æˆ‘ä¸€èˆ¬å–œæ¬¢åœ¨å®¹å™¨åˆå§‹åŒ–å®Œæˆä¹‹åæ¥åšä¸€äº›èµ„æºè½½å…¥æˆ–è€…ä¸€äº›ç»„ä»¶çš„åˆå§‹åŒ–ã€‚è¿™é‡Œçš„å®¹å™¨æŒ‡çš„å°±æ˜¯Iocå®¹å™¨ï¼Œå¯¹åº”çš„äº‹ä»¶æ˜¯ContextRefreshedEvent ã€‚ 1234567891011@Componentpublic class StartApplicationListener implementsApplicationListener&lt;ContextRefreshedEvent&gt; &#123; @Override public void onApplicationEvent(ContextRefreshedEvent contextRefreshedEvent) &#123; //åˆå§‹åŒ–èµ„æºæ–‡ä»¶ //åˆå§‹åŒ–ç»„ä»¶ å¦‚ï¼šcache &#125;&#125; ä¸Šé¢è¿™æ®µä»£ç ä¼šåœ¨å®¹å™¨åˆ·æ–°å®Œæˆä¹‹åæ¥åšä¸€äº›äº‹æƒ…ã€‚ä¸‹é¢é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶æ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨ï¼Œåœ¨çœ‹å…·ä½“çš„demoä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸‹ä¸€äº›å…³æ³¨ç‚¹ã€‚ æ—¥å¸¸å·¥ä½œäº†ï¼Œå¦‚æœè¦ä½¿ç”¨ Spring äº‹ä»¶ä¼ æ’­æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ç‚¹æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š äº‹ä»¶ç±»ï¼Œè¿™ä¸ªç”¨æ¥æè¿°äº‹ä»¶æœ¬èº«ä¸€äº›å±æ€§ï¼Œä¸€èˆ¬ç»§æ‰¿ApplicationEvent ç›‘å¬ç±»ï¼Œç”¨æ¥ç›‘å¬å…·ä½“çš„äº‹ä»¶å¹¶ä½œå‡ºå“åº”ã€‚éœ€è¦å®ç° ApplicationListener æ¥å£ äº‹ä»¶å‘å¸ƒç±»ï¼Œéœ€è¦é€šè¿‡è¿™ä¸ªç±»å°†æ—¶é—´å‘å¸ƒå‡ºå»ï¼Œè¿™æ ·æ‰èƒ½è¢«ç›‘å¬è€…ç›‘å¬åˆ°ï¼Œéœ€è¦å®ç°ApplicationContextAwareæ¥å£ã€‚ å°†äº‹ä»¶ç±»å’Œç›‘å¬ç±»äº¤ç»™Springå®¹å™¨ã€‚ é‚£ä¹ˆä¸‹é¢å°±æŒ‰ç…§è¿™ä¸ªæ€è·¯æ¥çœ‹ä¸‹demoçš„å…·ä½“å®ç°ã€‚ äº‹ä»¶ç±»ï¼šUserRegisterEventUserRegisterEvent ï¼Œç”¨æˆ·æ³¨å†Œäº‹ä»¶ï¼›è¿™é‡Œä½œä¸ºäº‹ä»¶å¯¹è±¡ï¼Œç»§æ‰¿è‡ª ApplicationEventã€‚ 12345678910111213141516171819/** * @description: ç”¨æˆ·æ³¨å†Œäº‹ä»¶ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/25 */public class UserRegisterEvent extends ApplicationEvent &#123; public String name; public UserRegisterEvent(Object o) &#123; super(o); &#125; public UserRegisterEvent(Object o, String name) &#123; super(o); this.name=name; &#125;&#125; äº‹ä»¶å‘å¸ƒç±»ï¼šUserServiceç”¨æˆ·æ³¨å†ŒæœåŠ¡ï¼Œè¿™é‡Œéœ€è¦åœ¨ç”¨æˆ·æ³¨å†Œæ—¶å°†æ³¨å†Œäº‹ä»¶å‘å¸ƒå‡ºå»ï¼Œæ‰€ä»¥é€šè¿‡å®ç°ApplicationEventPublisherAwareæ¥å£ï¼Œä½¿UserServiceå…·æœ‰äº‹ä»¶å‘å¸ƒèƒ½åŠ›ã€‚ ApplicationEventPublisherAware:å‘å¸ƒäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯æŠŠæŸä¸ªäº‹ä»¶å‘Šè¯‰çš„æ‰€æœ‰ä¸è¿™ä¸ªäº‹ä»¶ç›¸å…³çš„ç›‘å¬å™¨ã€‚ 123456789101112131415161718192021/** * @description: ç”¨æˆ·æ³¨å†ŒæœåŠ¡ï¼Œå®ç°ApplicationEventPublisherAwareæ¥å£ ï¼Œè¡¨æ˜æœ¬èº«å…·æœ‰äº‹ä»¶å‘å¸ƒèƒ½åŠ› * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/25 */public class UserService implements ApplicationEventPublisherAware &#123; private ApplicationEventPublisher applicationEventPublisher; public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) &#123; this.applicationEventPublisher = applicationEventPublisher; &#125; public void register(String name) &#123; System.out.println("ç”¨æˆ·ï¼š" + name + " å·²æ³¨å†Œï¼"); applicationEventPublisher.publishEvent(new UserRegisterEvent(name)); &#125;&#125; è¿™é‡Œçš„UserServiceå®é™…ä¸Šæ˜¯ä½œä¸ºäº‹ä»¶æºå­˜åœ¨çš„ï¼Œé€šè¿‡registerå°†ç”¨æˆ·æ³¨å†Œäº‹ä»¶ä¼ æ’­å‡ºå»ã€‚é‚£ä¹ˆä¸‹é¢å°±æ˜¯éœ€è¦å®šä¹‰å¦‚ä½•æ¥ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶ä¸”å°†äº‹ä»¶è¿›è¡Œæ¶ˆè´¹å¤„ç†æ‰ï¼Œè¿™é‡Œå°±æ˜¯é€šè¿‡ApplicationListeneræ¥å®Œæˆã€‚ ç›‘å¬ç±»ï¼šBonusServerListenerå½“ç”¨æˆ·è§¦å‘æ³¨å†Œæ“ä½œæ—¶ï¼Œå‘ç§¯åˆ†æœåŠ¡å‘é€æ¶ˆæ¯ï¼Œä¸ºç”¨æˆ·åˆå§‹åŒ–ç§¯åˆ†ã€‚ 1234567891011121314/** * @description: BonusServerListener ç§¯åˆ†å¤„ç†ï¼Œå½“ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç»™å½“å‰ç”¨æˆ·å¢åŠ åˆå§‹åŒ–ç§¯åˆ† * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/25 */public class BonusServerListener implementsApplicationListener&lt;UserRegisterEvent&gt; &#123; public void onApplicationEvent(UserRegisterEvent event) &#123; System.out.println("ç§¯åˆ†æœåŠ¡æ¥åˆ°é€šçŸ¥ï¼Œç»™ " + event.getSource() + " å¢åŠ ç§¯åˆ†..."); &#125;&#125; æ³¨å†Œåˆ°å®¹å™¨ä¸­123456789101112131415&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xsi:schemaLocation=" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt; &lt;bean id="userService" class="com.glmapper.extention.UserService"/&gt; &lt;bean id="bonusServerListener" class="com.glmapper.extention.BonusServerListener"/&gt; &lt;/beans&gt; å®¢æˆ·ç«¯ç±»12345678910111213141516/** * @description: å®¢æˆ·ç«¯ç±» * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/25 */public class MainTest &#123; public static void main(String[] args) &#123; ApplicationContext context =new ClassPathXmlApplicationContext("beans.xml"); UserService userService = (UserService) context.getBean("userService"); //æ³¨å†Œäº‹ä»¶è§¦å‘ userService.register("glmapper"); &#125;&#125; å®¢æˆ·ç«¯ç±»ä¸­ï¼Œæ³¨å†Œä¸€ä¸ªnameä¸ºglmapperçš„ç”¨æˆ·ï¼Œæ‰§è¡Œç»“æœï¼š 12ç”¨æˆ·ï¼šglmapper å·²æ³¨å†Œï¼ç§¯åˆ†æœåŠ¡æ¥åˆ°é€šçŸ¥ï¼Œç»™ glmapper å¢åŠ ç§¯åˆ†... ç°åœ¨æ¥è€ƒè™‘å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨æˆ·æ³¨å†Œä¹‹åç»™ç”¨æˆ·å‘ä¸€ä¸ªé‚®ä»¶ã€‚è¿™ä¸ªå…¶å®å°±æ˜¯å¢åŠ ä¸€ä¸ªç›‘å¬ç±»å°±å¯ä»¥ï¼Œå‰ææ˜¯è¿™ä¸ªç›‘å¬è€…æ˜¯ç›‘å¬å½“å‰äº‹ä»¶çš„ã€‚ 123456789101112/** * @description: é‚®ä»¶æœåŠ¡ç›‘å¬å™¨ï¼Œå½“ç›‘å¬åˆ°ç”¨æˆ·çš„æ³¨å†Œè¡Œä¸ºæ—¶ï¼Œ ç»™ç”¨æˆ·å‘é€é‚®ä»¶é€šçŸ¥ * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/25 */public class EmailServerListener implementsApplicationListener&lt;UserRegisterEvent&gt; &#123; public void onApplicationEvent(UserRegisterEvent event) &#123; System.out.println("é‚®ä»¶æœåŠ¡æ¥åˆ°é€šçŸ¥ï¼Œç»™ " + event.getSource() + " å‘é€é‚®ä»¶..."); è¿™é‡Œå¦‚æœå°†UserRegisterEventæ¢æˆUserLoginEventï¼Œé‚£ä¹ˆé‚®ä»¶æœåŠ¡å°†ä¸ä¼šæœ‰ä»»ä½•è¡Œä¸ºã€‚ å¢åŠ å‘é€é‚®ä»¶ç›‘å¬ç±»ä¹‹åçš„æ‰§è¡Œç»“æœï¼š123ç”¨æˆ·ï¼šglmapper å·²æ³¨å†Œï¼é‚®ä»¶æœåŠ¡æ¥åˆ°é€šçŸ¥ï¼Œç»™ glmapper å‘é€é‚®ä»¶...ç§¯åˆ†æœåŠ¡æ¥åˆ°é€šçŸ¥ï¼Œç»™ glmapper å¢åŠ ç§¯åˆ†... Spring çš„äº‹ä»¶ä¼ æ’­æœºåˆ¶æ˜¯åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰å®ç°çš„ï¼Œå®ƒå¯ä»¥å°† Spring Beançš„æ”¹å˜å®šä¹‰ä¸ºäº‹ä»¶ ApplicationEventï¼Œé€šè¿‡ ApplicationListener ç›‘å¬ ApplicationEvent äº‹ä»¶ï¼Œä¸€æ—¦Spring Bean ä½¿ç”¨ ApplicationContext.publishEvent( ApplicationEvent event )å‘å¸ƒäº‹ä»¶åï¼ŒSpring å®¹å™¨ä¼šé€šçŸ¥æ³¨å†Œåœ¨ å®¹å™¨ä¸­æ‰€æœ‰ ApplicationListener æ¥å£çš„å®ç°ç±»ï¼Œæœ€å ApplicationListener æ¥å£å®ç°ç±»åˆ¤æ–­æ˜¯å¦å¤„ç†åˆšå‘å¸ƒå‡ºæ¥çš„ ApplicationEvent äº‹ä»¶ã€‚ ApplicationContextAware æ‰©å±•ApplicationContextAwareä¸­åªæœ‰ä¸€ä¸ªsetApplicationContextæ–¹æ³•ã€‚å®ç°äº†ApplicationContextAwareæ¥å£çš„ç±»ï¼Œå¯ä»¥åœ¨è¯¥Beanè¢«åŠ è½½çš„è¿‡ç¨‹ä¸­è·å–Springçš„åº”ç”¨ä¸Šä¸‹æ–‡ApplicationContextï¼Œé€šè¿‡ApplicationContextå¯ä»¥è·å–Springå®¹å™¨å†…çš„å¾ˆå¤šä¿¡æ¯ã€‚ è¿™ç§ä¸€èˆ¬åœ¨éœ€è¦æ‰‹åŠ¨è·å–Beançš„æ³¨å…¥å®ä¾‹å¯¹è±¡æ—¶ä¼šä½¿ç”¨åˆ°ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„demoæ¥äº†è§£ä¸‹ã€‚ GlmapperApplicationContext æŒæœ‰ApplicationContextå¯¹è±¡ï¼Œé€šè¿‡å®ç° ApplicationContextAwareæ¥å£æ¥ç»™ApplicationContextåšèµ‹å€¼ã€‚12345678910111213141516171819/** * @description: GlmapperApplicationContext * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/29 */public class GlmapperApplicationContext implementsApplicationContextAware &#123; private ApplicationContext applicationContext; public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext=applicationContext; &#125; public ApplicationContext getApplicationContext()&#123; return applicationContext; &#125;&#125; éœ€è¦æ‰‹åŠ¨è·å–çš„bean: 1234567891011/** * @description: HelloService * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/29 */public class HelloService &#123; public void sayHello()&#123; System.out.println("Hello Glmapper"); &#125;&#125; åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š 12345&lt;bean id="helloService"class="com.glmapper.extention.applicationcontextaware.HelloService"/&gt;&lt;bean id="glmapperApplicationContext"class="com.glmapper.extention.applicationcontextaware.GlmapperApplicationContext"/&gt; å®¢æˆ·ç«¯ç±»è°ƒç”¨ï¼š 12345678910111213141516171819202122public class MainTest &#123; public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml"); HelloService helloService = (HelloService) context.getBean("helloService"); helloService.sayHello(); //è¿™é‡Œé€šè¿‡å®ç°ApplicationContextAwareæ¥å£çš„ç±»æ¥å®Œæˆbeançš„è·å– GlmapperApplicationContext glmapperApplicationContext = (GlmapperApplicationContext) context.getBean("glmapperApplicationContext"); ApplicationContext applicationContext = glmapperApplicationContext.getApplicationContext(); HelloService glmapperHelloService = (HelloService) applicationContext.getBean("helloService"); glmapperHelloService.sayHello(); &#125;&#125; BeanFactoryAware æ‰©å±•æˆ‘ä»¬çŸ¥é“BeanFactoryæ˜¯æ•´ä¸ªIocå®¹å™¨æœ€é¡¶å±‚çš„æ¥å£ï¼Œå®ƒè§„å®šäº†å®¹å™¨çš„åŸºæœ¬è¡Œä¸ºã€‚å®ç°BeanFactoryAwareæ¥å£å°±è¡¨æ˜å½“å‰ç±»å…·ä½“BeanFactoryçš„èƒ½åŠ›ã€‚ BeanFactoryAwareæ¥å£ä¸­åªæœ‰ä¸€ä¸ªsetBeanFactoryæ–¹æ³•ã€‚å®ç°äº†BeanFactoryAwareæ¥å£çš„ç±»ï¼Œå¯ä»¥åœ¨è¯¥Beanè¢«åŠ è½½çš„è¿‡ç¨‹ä¸­è·å–åŠ è½½è¯¥Beançš„BeanFactoryï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è·å–è¿™ä¸ªBeanFactoryä¸­åŠ è½½çš„å…¶å®ƒBeanã€‚ æ¥æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦é€šè¿‡BeanFactoryçš„getBeanæ¥è·å–Beanå‘¢ï¼ŸSpringå·²ç»æä¾›äº†å¾ˆå¤šä¾¿æ·çš„æ³¨å…¥æ–¹å¼ï¼Œé‚£ä¹ˆé€šè¿‡BeanFactoryçš„getBeanæ¥è·å–Beanæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæ¥çœ‹ä¸€ä¸ªåœºæ™¯ã€‚ ç°åœ¨æœ‰ä¸€ä¸ªHelloServiceï¼Œè¿™ä¸ªHelloServiceå°±æ˜¯æ‰“æ‹›å‘¼ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸åŒçš„è¯­è¨€æ¥å®ç°æ‰“æ‹›å‘¼ï¼Œæ¯”å¦‚ç”¨ä¸­æ–‡ï¼Œç”¨è‹±æ–‡ã€‚ä¸€èˆ¬çš„åšæ³•æ˜¯ï¼š 1234567891011121314151617public interface HelloService &#123; void sayHello();&#125;//è‹±æ–‡æ‰“æ‹›å‘¼å®ç°public class GlmapperHelloServiceImpl implements HelloService &#123; public void sayHello() &#123; System.out.println("Hello Glmapper"); &#125;&#125;//ä¸­æ–‡æ‰“æ‹›å‘¼å®ç°public class LeishuHelloServiceImpl implements HelloService &#123; public void sayHello() &#123; System.out.println("ä½ å¥½ï¼Œç£Šå”"); &#125;&#125; å®¢æˆ·ç«¯ç±»æ¥è°ƒç”¨åŠ¡å¿…ä¼šå‡ºç°ä¸‹é¢çš„æ–¹å¼ï¼š 123456if (condition==&quot;è‹±æ–‡&quot;)&#123; glmapperHelloService.sayHello();&#125;if (condition==&quot;ä¸­æ–‡&quot;)&#123; leishuHelloService.sayHello();&#125; å¦‚æœæœ‰ä¸€å¤©ï¼Œè€æ¿è¯´æˆ‘ä»¬è¦åšå›½é™…åŒ–ï¼Œè¦å®ç°å…¨çƒæ‰€æœ‰çš„è¯­è¨€æ¥é—®å€™ã€‚ä½ æ˜¯è¯´å¥½çš„ï¼Œè¿˜æ˜¯æ§åˆ¶ä¸ä½è¦åŠ¨æ‰‹å‘¢ï¼Ÿ é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥åŠ¨æ€çš„å»å†³å®šæˆ‘çš„å®¢æˆ·ç«¯ç±»åˆ°åº•å»è°ƒç”¨å“ªä¸€ç§è¯­è¨€å®ç°ï¼Œè€Œä¸æ˜¯ç”¨è¿‡if-elseæ–¹å¼æ¥ç½—åˆ—å‘¢ï¼Ÿæ˜¯çš„ï¼Œå¯¹äºè¿™äº›éœ€è¦åŠ¨æ€çš„å»è·å–å¯¹è±¡çš„åœºæ™¯ï¼ŒBeanFactoryAwareå°±å¯ä»¥å¾ˆå¥½çš„æå®šã€‚OKï¼Œæ¥çœ‹ä»£ç æ”¹é€ ï¼š å¼•å…¥BeanFactoryAwareï¼š 123456789101112131415161718192021222324252627282930/** * @description: å®ç°BeanFactoryAware ï¼Œè®©å½“å‰beanæœ¬èº«å…·æœ‰ BeanFactory çš„èƒ½åŠ› * * å®ç° BeanFactoÎ·Aware æ¥å£çš„ bean å¯ä»¥ç›´æ¥è®¿é—® Spring å®¹å™¨ï¼Œè¢«å®¹å™¨åˆ›å»ºä»¥åï¼Œ * å®ƒä¼šæ‹¥æœ‰ä¸€ä¸ªæŒ‡å‘ Spring å®¹å™¨çš„å¼•ç”¨ï¼Œå¯ä»¥åˆ©ç”¨è¯¥beanæ ¹æ®ä¼ å…¥å‚æ•°åŠ¨æ€è·å–è¢«springå·¥å‚åŠ è½½çš„bean * * @email: &lt;a href="glmapper_2018@163.com"&gt;&lt;/a&gt; * @author: guolei.sgl * @date: 18/7/29 */public class GlmapperBeanFactory implements BeanFactoryAware &#123; private BeanFactory beanFactory; public void setBeanFactory(BeanFactory beanFactory) throws BeansException &#123; this.beanFactory=beanFactory; &#125; /** * æä¾›ä¸€ä¸ªexecute æ–¹æ³•æ¥å®ç°ä¸åŒä¸šåŠ¡å®ç°ç±»çš„è°ƒåº¦å™¨æ–¹æ¡ˆã€‚ * @param beanName */ public void execute(String beanName)&#123; HelloService helloService=(HelloService) beanFactory.getBean(beanName); helloService.sayHello(); &#125;&#125; è¿™é‡Œä¸ºäº†é€»è¾‘æ–¹ä¾¿ç†è§£ï¼Œå†åŠ å…¥ä¸€ä¸ªHelloFacade ç±»,è¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯æŒæœ‰ä¸€ä¸ªBeanFactoryAwareçš„å®ä¾‹å¯¹è±¡ï¼Œç„¶åé€šè¿‡HelloFacadeå®ä¾‹å¯¹è±¡çš„æ–¹æ³•æ¥å±è”½åº•å±‚BeanFactoryAwareå®ä¾‹çš„å®ç°ç»†èŠ‚ã€‚ 12345678910public class HelloFacade &#123; private GlmapperBeanFactory glmapperBeanFactory; //è°ƒç”¨glmapperBeanFactoryçš„executeæ–¹æ³• public void sayHello(String beanName)&#123; glmapperBeanFactory.execute(beanName); &#125; public void setGlmapperBeanFactory(GlmapperBeanFactory beanFactory)&#123; this.glmapperBeanFactory = beanFactory; &#125;&#125; å®¢æˆ·ç«¯ç±» 1234567891011121314151617181920212223public class MainTest &#123; public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml"); HelloFacade helloFacade = (HelloFacade) context.getBean("helloFacade"); GlmapperBeanFactory glmapperBeanFactory = (GlmapperBeanFactory) context.getBean("glmapperBeanFactory"); //è¿™é‡Œå…¶å®å¯ä»¥ä¸é€šè¿‡setæ–¹æ³•æ³¨å…¥åˆ°helloFacadeä¸­ï¼Œ //å¯ä»¥åœ¨helloFacadeä¸­é€šè¿‡autowired //æ³¨å…¥ï¼›è¿™é‡Œåœ¨ä½¿ç”¨mainæ–¹æ³•æ¥æ‰§è¡ŒéªŒè¯ï¼Œæ‰€ä»¥å°±æ‰‹åŠ¨setè¿›å…¥äº† helloFacade.setGlmapperBeanFactory(glmapperBeanFactory); //è¿™ä¸ªåªéœ€è¦ä¼ å…¥ä¸åŒHelloServiceçš„å®ç°ç±»çš„beanNameï¼Œ //å°±å¯ä»¥æ‰§è¡Œä¸åŒçš„ä¸šåŠ¡é€»è¾‘ helloFacade.sayHello("glmapperHelloService"); helloFacade.sayHello("leishuHelloService"); &#125;&#125; å¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰ç±»ä¸­ï¼Œåªéœ€è¦é€šè¿‡ä¸€ä¸ªbeanNameå°±å¯ä»¥å®ç°ä¸åŒå®ç°ç±»çš„åˆ‡æ¢ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¸€å †if-elseæ¥åˆ¤æ–­ã€‚å¦å¤–æœ‰çš„å°ä¼™ä¼´å¯èƒ½ä¼šè¯´ï¼Œç¨‹åºæ€ä¹ˆçŸ¥é“ç”¨å“ªä¸ªbeanNameå‘¢ï¼Ÿå…¶å®è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼Œè¿™ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›é€”å¾„æ¥æ‹¼æ¥å¾—åˆ°ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸€ä¸ªprefixç”¨æ¥æŒ‡å®šè¯­è¨€ï¼Œprefix+HelloServiceå°±å¯ä»¥ç¡®å®šå”¯ä¸€çš„beanNameã€‚ å°ç»“æœ¬æ¥æƒ³ç€åœ¨ä¸€ç¯‡æ–‡ç« é‡Œé¢æŠŠæ‰©å±•ç‚¹éƒ½å†™ä¸€ä¸‹çš„ï¼Œä½†æ˜¯å®åœ¨å¤ªé•¿äº†ã€‚åé¢å·®ä¸å¤šè¿˜æœ‰ä¸¤ç¯‡ã€‚æœ¬ç³»åˆ—ä¸­æ‰€æœ‰çš„demoå¯ä»¥åœ¨githubè·å–ï¼Œä¹Ÿæ¬¢è¿å°ä¼™ä¼´æŠŠèƒ½å¤Ÿæƒ³åˆ°çš„æ‰©å±•ç‚¹prè¿‡æ¥ã€‚ glmapper-spring-extention]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>èŠä¸€èŠ</tag>
        <tag>spring æ‰©å±•æœºåˆ¶</tag>
        <tag>spring äº‹ä»¶æœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ï¼šSpringBoot é›†æˆ SpringSession]]></title>
    <url>%2F2018%2F11%2F10%2Fspringsessionone%2F</url>
    <content type="text"><![CDATA[springSessionæ˜¯ spring æ——ä¸‹çš„ä¸€ä¸ªé¡¹ç›®ï¼ŒæŠŠ servlet å®¹å™¨å®ç°çš„ httpSessionæ›¿æ¢ä¸ºspringSessionï¼Œä¸“æ³¨äºè§£å†³sessionç®¡ç†é—®é¢˜ã€‚å¯ç®€å•å¿«é€Ÿä¸”æ— ç¼çš„é›†æˆåˆ°æˆ‘ä»¬çš„åº”ç”¨ä¸­ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼Œä½¿ç”¨SpringBootæ¥é›†æˆ SpringSessionï¼Œå¹¶ä¸”ä½¿ç”¨Redisä½œä¸ºå­˜å‚¨æ¥å®è·µä¸‹SpringSession çš„ä½¿ç”¨ã€‚ ç¯å¢ƒå‡†å¤‡å› ä¸ºéœ€è¦ä½¿ç”¨Redisä½œä¸ºåº•å±‚Sessionçš„å­˜å‚¨ä»‹è´¨ï¼Œå®ç°åˆ†å¸ƒå¼sessionï¼Œå› æ­¤éœ€è¦å®‰è£…Redisã€‚ Redis å®‰è£…1ã€ä»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆçš„Redis 2ã€è§£å‹ 1tar zxvf redis-5.0.0.tar.gz 3ã€ç¼–è¯‘æµ‹è¯• 1sudo make test 4ã€ç¼–è¯‘å®‰è£… 1sudo make install 5ã€å®‰è£…é—®é¢˜ å¦‚æœæ‚¨ä¹‹å‰å®‰è£…è¿‡ï¼Œé‡å¤å®‰è£…ä¸”æ²¡æœ‰å¸è½½å¹²å‡€çš„è¯ï¼Œä¼šæŠ¥ä¸‹é¢çš„é”™ 12make[1]: *** [test] Error 1 make: *** [test] Error 2 è§£å†³è¿™ä¸ªé”™è¯¯ï¼Œæ‰§è¡Œä¸‹é¢çš„è¯­å¥å³å¯ï¼š 123make distclean make make test æ­£ç¡®å®‰è£…å§¿åŠ¿å¦‚ä¸‹ï¼š 6ã€å¯åŠ¨Redisåœ¨æ‚¨çš„Rediså®‰è£…ç›®å½•ä¸‹ï¼Œæœ‰ redis-server ï¼Œæ‰§è¡Œè¯¥è„šæœ¬å‘½ä»¤ï¼š OKï¼Œåˆ°è¿™é‡Œï¼ŒRedisçš„å®‰è£…å·¥ä½œå®Œæ¯•ã€‚ SpringBoot å·¥ç¨‹å‡†å¤‡è¿™é‡Œæˆ‘ä»¬ç›´æ¥é€šè¿‡Ideaæ¥æ„å»ºæˆ‘ä»¬çš„SpringBootå·¥ç¨‹ã€‚ 1File-&gt;New-&gt;Project : Spring Initializr OKï¼ŒSpringBoot å·¥ç¨‹å‡†å¤‡å®Œæ¯•ï¼Œè¿™é‡Œé€‰æ‹©åˆ›å»ºçš„æ˜¯ä¸€ä¸ªWebå·¥ç¨‹ã€‚ é›†æˆé›†æˆä¸»è¦æ˜¯ä¾èµ–å¼•å…¥ï¼Œè¿™é‡Œéœ€è¦rediså’Œsessionçš„ä¾èµ– ä¾èµ–å¼•å…¥123456789101112&lt;dependencies&gt; &lt;!--redis ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--sessions ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.session&lt;/groupId&gt; &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; é…ç½®application.properties123456789#æœåŠ¡ç«¯å£server.port=8080#rediä¸»æœºåœ°å€spring.redis.host=localhost#redisæœåŠ¡ç«¯å£spring.redis.port=6379# spring sessionä½¿ç”¨å­˜å‚¨ç±»å‹ï¼Œspirngbooté»˜è®¤å°±æ˜¯ä½¿ç”¨redisæ–¹å¼ï¼Œå¦‚æœä¸æƒ³ç”¨å¯ä»¥å¡«noneã€‚spring.session.store-type=redis åœ¨å¯åŠ¨ç±»ä¸­åŠ å…¥@EnableRedisHttpSession æ³¨è§£1234567@SpringBootApplication@EnableRedisHttpSessionpublic class SpringBootSessionApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootSessionApplication.class, args); &#125;&#125; æµ‹è¯•å…ˆæ¥ç¼–å†™ä¸€ä¸ªController 123456789101112131415161718192021222324252627/** * SessionController * * @author: glmapper@leishu * @since: 18/11/3 ä¸‹åˆ3:16 * @version 1.0 **/@Controller@RequestMapping(value = "/")public class SessionController &#123; @ResponseBody @RequestMapping(value = "/session") public Map&lt;String, Object&gt; getSession(HttpServletRequest request) &#123; request.getSession().setAttribute("userName", "glmapper"); Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(); map.put("sessionId", request.getSession().getId()); return map; &#125; @ResponseBody @RequestMapping(value = "/get") public String get(HttpServletRequest request) &#123; String userName = (String) request.getSession().getAttribute("userName"); return userName; &#125;&#125; æµ‹è¯•ç»“æœå¯åŠ¨SpringBoot å·¥ç¨‹ï¼›ç„¶åæµè§ˆå™¨ä¸­è¾“å…¥åœ°å€ http://localhost:8080/sessionï¼› è¿™é‡Œå¯¹åº”æ‰§è¡Œçš„æ˜¯æˆ‘ä»¬ä¸Šé¢Controllerä¸­çš„ç¬¬ä¸€ä¸ªæ–¹æ³•getSessionï¼Œè¿™ä¸ªæ–¹æ³•å‘sessionä¸­è®¾ç½®äº†ä¸€ä¸ªå€¼ã€‚ ä¸‹é¢æˆ‘ä»¬æ‰§è¡Œï¼šhttp://localhost:8080/get è¿™é‡Œæ˜¯ä»sessionä¸­å–å€¼: åˆ°æ­¤ï¼ŒSpringBoot æ•´åˆ SpringSession çš„è¿‡ç¨‹å°±å®Œæˆäº†ã€‚è¿™é‡Œæˆ‘ä»¬åªæ˜¯å¼•å…¥äº†ä¾èµ–ï¼Œç„¶ååšäº†ç®€å•çš„é…ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è¯·æ±‚æ˜¯å¦‚ä½•è¢« SpringSession å¤„ç†çš„å‘¢ï¼Ÿä»æˆ‘ä»¬ä¸€è´¯çš„è®¤çŸ¥æ¥çœ‹ï¼Œå¯¹äºåŸºäºServletè§„èŒƒçš„å®¹å™¨ï¼ˆSpringBoot ä½¿ç”¨çš„æ˜¯åµŒå…¥å¼Tomcatï¼‰çš„åº”ç”¨ï¼Œè¯·æ±‚æœ€å…ˆè¢«å¤„ç†çš„æ˜¯Filterã€‚æˆ‘ä»¬åœ¨åŸºäºSpring+SpringMvcè¿™å¥—æŠ€æœ¯æ ˆå¼€å‘æ—¶,å¦‚æœæˆ‘ä»¬éœ€è¦åšæƒé™ç®¡ç†ï¼Œé€šè¿‡ä¼šåŸºäºFilteræˆ–è€…æ‹¦æˆªå™¨ã€‚ä½†æ˜¯è¿™é‡Œè²Œä¼¼æˆ‘ä»¬ä»€ä¹ˆä¹Ÿæ²¡åšï¼Œä½†æ˜¯è¯·æ±‚ç¡®å®è¢«SpringSessionå¤„ç†äº†ã€‚OKï¼Œæˆ‘ä»¬æ¥æ‰’ä¸€æ‰’ã€‚ SpringSession æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿä¸Šé¢è¿™å¼ æˆªå›¾æƒ³å¿…å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œæ˜¯SpringBootçš„å¯åŠ¨æ—¥å¿—ï¼›ä¸Šå›¾çº¢è‰²æ¡†å†…çš„æ˜¯å½“å‰åº”ç”¨æ³¨å†Œæ˜¯Filterä¿¡æ¯ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸ªå’Œ session æœ‰å…³çš„Filterï¼šsessionRepositoryFilterï¼›è¿™ä¸ªbeanå¯¹åº”çš„ç±»æ˜¯ï¼š 12org.springframework.boot.autoconfigure.session.SessionRepositoryFilterConfiguration.ConditionalOnBean=org.springframework.session.web.http.SessionRepositoryFilter åœ¨è¿™é‡Œæ‰¾åˆ°äº† è¿™é‡Œæ¶‰åŠåˆ°SpringBootçš„è‡ªåŠ¨é…ç½®ï¼Œä»spring-boot-autoconfigåŒ…ä¸‹åŠ è½½spring-autoconfigure-metadata.properties é…ç½®æ–‡ä»¶ï¼Œç„¶åè·å–æ‰€æœ‰æ”¯æŒè‡ªåŠ¨é…ç½®çš„ä¿¡æ¯ï¼›SpringSession ä¹Ÿåœ¨å…¶ä¸­ã€‚å…³äºå¦‚ä½•åŠ è½½å¹¶ä¸”æ³¨å†Œä¸åœ¨æœ¬æ–‡çš„èŒƒç•´ä¹‹å†…ï¼Œæˆ‘ä»¬ç»§ç»­æ¥åˆ†æSpringSessionçš„å¤„ç†è¿‡ç¨‹ã€‚ SpringSession çš„å¤„ç†è¿‡ç¨‹ä»ä¸Šé¢SpringBootçš„å¯åŠ¨è¿‡ç¨‹æˆ‘ä»¬æ‰¾åˆ°äº†å¤„ç†sessionçš„Filterï¼Œç„¶åçŸ¥é“äº†å®ƒæ˜¯é€šè¿‡è‡ªåŠ¨é…ç½®çš„æ–¹å¼è¢«æ³¨å†Œåˆ°å½“å‰çš„å®¹å™¨å¹¶ä¸”æ¥å¤„ç†è¯·æ±‚ã€‚123@Order(SessionRepositoryFilter.DEFAULT_ORDER)public class SessionRepositoryFilter&lt;S extends Session&gt; extends OncePerRequestFilter &#123; ä»SessionRepositoryFilterçš„å®šä¹‰æ¥çœ‹ï¼š 1ã€ä½¿ç”¨äº†Orderï¼Œå¹¶ä¸”é…ç½®äº†ä¸€ä¸ªå¾ˆå°çš„å€¼ï¼ˆInteger.MIN_VALUE + 50ï¼‰ï¼Œä»¥æ­¤æ¥ç¡®ä¿sessionçš„Filteråœ¨Filteré“¾ä¸­è¢«ä¼˜å…ˆæ‰§è¡Œã€‚ 2ã€é›†æˆäº†OncePerRequestFilterï¼Œç¡®ä¿åœ¨ä¸€æ¬¡è¯·æ±‚åªé€šè¿‡ä¸€æ¬¡filterï¼Œè€Œä¸éœ€è¦é‡å¤æ‰§è¡Œ ä¸ºä»€ä¹ˆ session çš„ Filter è¦è¢«ä¼˜å…ˆæ‰§è¡Œå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„è¯·æ±‚è¢«åŒ…è£…äº†ï¼Œå¦‚æœSessionRepositoryFilterä¸ä¼˜å…ˆå¤„ç†è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´åç»­çš„è¯·æ±‚è¡Œä¸ºä¸ä¸€è‡´ï¼Œè¿™é‡Œæ¶‰åŠåˆ° springSessionæ— ç¼æ›¿æ¢åº”ç”¨æœåŠ¡å™¨çš„requestçš„åŸç†ï¼š 1.è‡ªå®šä¹‰ä¸ªFilterï¼Œå®ç°doFilteræ–¹æ³• 2.ç»§æ‰¿ HttpServletRequestWrapper ã€HttpServletResponseWrapper ç±»ï¼Œé‡å†™getSessionç­‰ç›¸å…³æ–¹æ³•(åœ¨è¿™äº›æ–¹æ³•é‡Œè°ƒç”¨ç›¸å…³çš„ sessionå­˜å‚¨å®¹å™¨æ“ä½œç±»)ã€‚ 3.è‡ªå®šä¹‰requestå’Œresponseç±»ï¼›å¹¶æŠŠå®ƒä»¬åˆ†åˆ«ä¼ é€’åˆ°è¿‡æ»¤å™¨é“¾ 4.æŠŠè¯¥filteré…ç½®åˆ°è¿‡æ»¤å™¨é“¾çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸Š OKï¼Œäº†è§£äº†è¿™äº›èƒŒæ™¯ï¼Œæˆ‘ä»¬æ¥è·Ÿè¸ªä¸‹æ•´ä¸ªå¤„ç†æµç¨‹ã€‚ 1ã€æ–­ç‚¹åˆ° doFilterInternal ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°requestå’Œresponseç±»è¢«åŒ…è£…äº†ã€‚ 2ã€æ–­ç‚¹åˆ° getSessionè¿™é‡Œæ˜¯ä»Redisä¸­æ‹¿æˆ‘ä»¬sessionæ•°æ®çš„åœ°æ–¹ å…ˆä»æˆ‘ä»¬å½“å‰servletå®¹å™¨ä¸­å»æ‹¿ï¼Œå¦‚æœæ‹¿åˆ°åˆ™ç›´æ¥è¿”å› å»Redisä¸­å– è¿™é‡Œä¼šæœ‰ä¸€ä¸ªç¼“å­˜å¤„ç†ï¼Œå¹¶éæ˜¯æ¯æ¬¡éƒ½åˆ°Reidsä¸­å»æŸ¥ä¸€æ¬¡ï¼Œé¿å…ä¸€æ¬¡ä¸Reidsçš„äº¤äº’ã€‚ å¦‚æœç¼“å­˜å½“å‰åº”ç”¨å®¹å™¨ç¼“å­˜ä¸­æœ‰ï¼Œåˆ™ç›´æ¥è¿”å›å½“å‰è¢«ç¼“å­˜çš„session å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä»è¯·æ±‚ä¸­è·å–sessionIdï¼Œå¹¶ä¸”æ ¹æ®å½“å‰sessionIdå»Reidsä¸­æŸ¥æ‰¾sessionæ•°æ® æ›´æ–°ç¼“å­˜sessionï¼ŒsessionId,requestedSessionCachedç­‰æ•°æ®çŠ¶æ€ å¦‚æœRedisä¸­æœ‰ï¼Œåˆ™æ›´æ–°sessionç›¸å…³ä¿¡æ¯å¹¶è¿”å› å¦‚æœReidsä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æ ¹æ® create æ¥åˆ¤æ–­æ˜¯å¦åˆ›å»ºæ–°çš„sessionã€‚ æ–­ç‚¹åˆ° readCookieValuesSpringSessionæä¾›äº†ä¸¤ç§ä¿å­˜å’Œä¼ é€’SessionIdçš„æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºCookieçš„ï¼Œä¸€ç§æ˜¯åŸºäºHeaderçš„ã€‚SpringSessionä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯åŸºäºCookieçš„æ–¹å¼ã€‚readCookieValues å°±æ˜¯å®ç°å¦‚ä½•ä»Cookieä¸­è·å–sessionIdçš„ã€‚ è¿™ä¸ªè¿‡ç¨‹å…¶å®å¾ˆç®€å•ï¼Œå…ˆæ˜¯ä»requestä¸­è·å–å½“å‰è¯·æ±‚æºå¸¦çš„æ‰€ä»¥çš„Cookieä¿¡æ¯ï¼Œç„¶åå°†åŒ¹é…åˆ°çš„ cookieName ä¸º â€œSESSIONâ€ çš„Cookieè¿›è¡Œè§£æã€‚ æ–­ç‚¹åˆ° RedisOperationsSessionRepository -&gt; getSessionè¿™é‡Œæ˜¯ä»Redisä¸­å–sessionæ•°æ®çš„åœ°æ–¹ æ ¹æ®sessionIdä» Redisä¸­å–åˆ° entries æ•°æ® æ„å»º RedisSession å¹¶è¿”å› æ–­ç‚¹åˆ° commitSessioncommitSessionä½œç”¨æ˜¯é€šè¿‡HttpSessionIdResolver å°†sessionIdå†™åˆ°responseï¼Œå¹¶ä¸”è¿›è¡ŒæŒä¹…åŒ–ã€‚ è¿™é‡Œçš„ session å…¶å®æ˜¯å·²ç»æ›´æ–°è¿‡çŠ¶æ€çš„ï¼Œæ¯”å¦‚é‡æ–°è®¾ç½®äº† session çš„è¿‡æœŸæ—¶é—´ç­‰ã€‚session æäº¤å®é™…ä¸Šå°±æ„å‘³ç€å½“å‰è¯·æ±‚å·²ç»å¤„ç†å®Œæ¯•äº†ã€‚ å°ç»“æœ¬æ–‡å…ˆä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ SpringBoot é›†æˆ SpringSessionï¼Œå¹¶ä¸”ä»¥ Redis ä½œä¸ºå­˜å‚¨ã€‚ç„¶åç®€å•åˆ†æäº† SpringSession çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ¬æ–‡å¯¹ SpringSession çš„åŸç†éƒ¨åˆ†æ²¡æœ‰è¿›è¡Œæ·±å…¥åˆ†æï¼Œä¸‹ä¸€ç¯‡åˆ†æä¸‹SpringSessionçš„åŸç†ã€‚]]></content>
      <categories>
        <category>spring</category>
        <category>session</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>session</tag>
      </tags>
  </entry>
</search>
