{"title":"使用 docker 部署 kafka 集群","uid":"d753fae6fcae22e0a4f351ebed82c72a","slug":"docker/docker-compose-kakfa-install","date":"2021-07-23T13:47:16.000Z","updated":"2024-07-05T04:09:05.756Z","comments":true,"path":"api/articles/docker/docker-compose-kakfa-install.json","keywords":"宋国磊, glmapper, 卫恒, 分享, 开源","cover":null,"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>参考文档：<a href=\"https://github.com/wurstmeister/kafka-docker\">https://github.com/wurstmeister/kafka-docker</a></p></blockquote>\n<p>在你的文件系统中找个目录，然后新建一个 docker-compose.yaml 文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">➜  kafka-guides </span><br><span class=\"line\">total 8</span><br><span class=\"line\">-rw-r--r--@ 1 sgl  staff   1.1K  7 13 21:56 docker-compose.yaml</span><br></pre></td></tr></table></figure>\n\n<p>编辑 docker-compose.yaml 文件</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;2&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">zookeeper:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">wurstmeister/zookeeper</span>   <span class=\"comment\">## zk 镜像</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;2181:2181&quot;</span>                 <span class=\"comment\">## 对外暴露的端口号</span></span><br><span class=\"line\">  <span class=\"attr\">kafka:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">wurstmeister/kafka</span>       <span class=\"comment\">## kafka 镜像</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/etc/localtime:/etc/localtime</span> <span class=\"comment\">## 挂载位置（kafka镜像和宿主机器之间时间保持一致）</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9092:9092&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_ADVERTISED_HOST_NAME:</span> <span class=\"number\">192.168</span><span class=\"number\">.10</span><span class=\"number\">.67</span>     <span class=\"comment\">## 修改:宿主机IP  ---- 192.168.10.67  是我当前的机器ip</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_ZOOKEEPER_CONNECT:</span> <span class=\"string\">zookeeper:2181</span>       <span class=\"comment\">## kafka 运行是基于zookeeper的</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_ADVERTISED_PORT:</span> <span class=\"number\">9092</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_LOG_RETENTION_HOURS:</span> <span class=\"number\">120</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_MESSAGE_MAX_BYTES:</span> <span class=\"number\">10000000</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_REPLICA_FETCH_MAX_BYTES:</span> <span class=\"number\">10000000</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_GROUP_MAX_SESSION_TIMEOUT_MS:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_NUM_PARTITIONS:</span> <span class=\"number\">3</span></span><br><span class=\"line\">      <span class=\"attr\">KAFKA_DELETE_RETENTION_MS:</span> <span class=\"number\">1000</span></span><br><span class=\"line\">  <span class=\"attr\">kafka-manager:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">sheepkiller/kafka-manager</span>                <span class=\"comment\">## 镜像：kafka-manager</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">        <span class=\"attr\">ZK_HOSTS:</span> <span class=\"number\">192.168</span><span class=\"number\">.10</span><span class=\"number\">.67</span>                     <span class=\"comment\">## 修改:宿主机IP</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9001:9000&quot;</span>                                 <span class=\"comment\">## 暴露端口 9001</span></span><br></pre></td></tr></table></figure>\n\n<p>启动服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~ docker-compose up -d</span><br><span class=\"line\"><span class=\"comment\"># 执行日志大致如下</span></span><br><span class=\"line\">Pulling kafka (wurstmeister/kafka:)...</span><br><span class=\"line\">latest: Pulling from wurstmeister/kafka</span><br><span class=\"line\">540db60ca938: Pull complete</span><br><span class=\"line\">789c480dd801: Pull complete</span><br><span class=\"line\">0705a4c47ffe: Pull complete</span><br><span class=\"line\">661f40345821: Pull complete</span><br><span class=\"line\">a84fa3c6a2b3: Pull complete</span><br><span class=\"line\">Digest: sha256:4bad02cf8f07d0bf65d5cc73cce7aa75f9a90e32b585f867fce7c3fff229bd6d</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> wurstmeister/kafka:latest</span><br><span class=\"line\">Pulling kafka-manager (sheepkiller/kafka-manager:)...</span><br><span class=\"line\">latest: Pulling from sheepkiller/kafka-manager</span><br><span class=\"line\">469cfcc7a4b3: Pull complete</span><br><span class=\"line\">4458b033eac3: Pull complete</span><br><span class=\"line\">838a0ff6e24f: Pull complete</span><br><span class=\"line\">0128a98dafdb: Pull complete</span><br><span class=\"line\">Digest: sha256:615f3b99d38aba2d5fdb3fb750a5990ba9260c8fb3fd29c7e776e8c150518b78</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> sheepkiller/kafka-manager:latest</span><br><span class=\"line\">Creating kafka-guides_kafka-manager_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Creating kafka-guides_zookeeper_1     ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Creating kafka-guides_kafka_1         ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>此时可以通过访问 <a href=\"http://localhost:9001/\">http://localhost:9001/</a> 来打开 kafka manager 页面进行验证。也可以通过 docker-compose ps 查看</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">➜  kafka-guides docker-compose ps</span><br><span class=\"line\">            Name                          Command               State                        Ports</span><br><span class=\"line\">------------------------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">kafka-guides_kafka-manager_1   ./start-kafka-manager.sh         Up      0.0.0.0:9001-&gt;9000/tcp,:::9001-&gt;9000/tcp</span><br><span class=\"line\">kafka-guides_kafka_1           start-kafka.sh                   Up      0.0.0.0:9092-&gt;9092/tcp,:::9092-&gt;9092/tcp</span><br><span class=\"line\">kafka-guides_zookeeper_1       /bin/sh -c /usr/sbin/sshd  ...   Up      0.0.0.0:2181-&gt;2181/tcp,:::2181-&gt;2181/tcp,</span><br><span class=\"line\">                                                                        22/tcp, 2888/tcp, 3888/tcp</span><br></pre></td></tr></table></figure>\n\n<p>停止服务 docker-compose stop</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 停止服务</span></span><br><span class=\"line\">➜  kafka-guides docker-compose stop</span><br><span class=\"line\">Stopping kafka-guides_kafka_1         ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Stopping kafka-guides_zookeeper_1     ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Stopping kafka-guides_kafka-manager_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>停止并删除服务 <code>docker-compose down</code></p>\n","text":" 参考文档：https://github.com/wurstmeister/kafka-docker 在你的文件系统中找个目录，然后新建一个 docker-co...","permalink":"/post/docker/docker-compose-kakfa-install","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"docker","slug":"docker","count":2,"path":"api/categories/docker.json"}],"tags":[{"name":"docker","slug":"docker","count":2,"path":"api/tags/docker.json"},{"name":"kafka","slug":"kafka","count":1,"path":"api/tags/kafka.json"}],"toc":"","author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"记：SOFA Meepup 合肥站-SOFA 微服务体系技术生态于实践","uid":"9622fa03747232916676b6477e1a4975","slug":"share/shares-sofa-meetup-7","date":"2021-07-25T08:06:55.000Z","updated":"2024-07-05T04:09:05.797Z","comments":true,"path":"api/articles/share/shares-sofa-meetup-7.json","keywords":"宋国磊, glmapper, 卫恒, 分享, 开源","cover":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/meetup-hf/hf/team.jpeg","text":"SOFA Meepup 合肥站从 5 月份开始筹划，至 7.24 在合肥成功举办，历时 2 个多月的时间，从到场人数来看，并没有受到大雨的影响，合肥开发者同学对...","permalink":"/post/share/shares-sofa-meetup-7","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"experience","slug":"experience","count":2,"path":"api/categories/experience.json"}],"tags":[{"name":"SOFA","slug":"SOFA","count":2,"path":"api/tags/SOFA.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}},"next_post":{"title":"SpringAop 代理模式及 AopContext 问题小记","uid":"36de71f48064befd8223d8b0f7b379a4","slug":"spring/spring-proxy-aopcontext","date":"2021-07-17T08:17:04.000Z","updated":"2024-07-05T04:09:05.817Z","comments":true,"path":"api/articles/spring/spring-proxy-aopcontext.json","keywords":"宋国磊, glmapper, 卫恒, 分享, 开源","cover":[],"text":"AOP 称为面向切面编程，其底层原理就是动态代理；JAVA 中比较常见的动态代理有两种，分别是 JDK 动态代理和 CGLIB 动态代理，这点从 Spring ...","permalink":"/post/spring/spring-proxy-aopcontext","photos":[],"count_time":{"symbolsCount":"7.5k","symbolsTime":"7 mins."},"categories":[{"name":"spring","slug":"spring","count":15,"path":"api/categories/spring.json"}],"tags":[{"name":"spring","slug":"spring","count":11,"path":"api/tags/spring.json"},{"name":"aop","slug":"aop","count":3,"path":"api/tags/aop.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}}}