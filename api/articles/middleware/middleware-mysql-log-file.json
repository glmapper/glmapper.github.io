{"title":"mysql 日志文件","uid":"b98b36bd5e2d6f53b8f282c8597b8e9d","slug":"middleware/middleware-mysql-log-file","date":"2021-11-08T03:30:18.000Z","updated":"2024-07-05T04:09:05.789Z","comments":true,"path":"api/articles/middleware/middleware-mysql-log-file.json","keywords":null,"cover":null,"content":"<p>日志文件记录了影响 mysql 数据库的各种类型活动，mysql 中常见的日志文件主要包括以下 4 种：</p>\n<ul>\n<li>错误日志</li>\n<li>二进制日志</li>\n<li>慢查询日志</li>\n<li>查询日志</li>\n</ul>\n<p>这些日志文件可以帮助我们对mysql数据库的运行状态进行诊断，从而更好的进行数据库层面的优化。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"错误日志\"><a href=\"#错误日志\" class=\"headerlink\" title=\"错误日志\"></a>错误日志</h2><p>错误日志文件对 mysql 的启动，运行，关闭过程进行了记录。错误日志不仅记录了所有的错误信息，也记录了一些警告信息或者正确的信息。可以通过以下方式 找到错误日志的路径：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;log_error&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------+----------------------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Variable_name <span class=\"operator\">|</span> <span class=\"keyword\">Value</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------+----------------------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> log_error     <span class=\"operator\">|</span> .<span class=\"operator\">/</span>weihengdeMacBook<span class=\"operator\">-</span>Pro.local.err <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------+----------------------------------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br></pre></td></tr></table></figure>\n\n<p>可以看到错误日志的全路径，这里我本机没有做过调整，所以默认使用的是主机名作为错误日志的文件名。如果你的 mysql 数据库不能正常启动，可以第一时间查找的文件就是错误日志文件，这里可能会记录相关的错误日志，通过这个日志来找到不能正常启动的原因。下面截取部分日志：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2021-05-06T08:57:03.359102Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class=\"line\">2021-05-06T08:57:03.439761Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class=\"line\">2021-05-06T08:57:03.495740Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;127.0.0.1&#x27; port: 33060, socket: /tmp/mysqlx.sock</span><br><span class=\"line\">2021-05-06T08:57:03.521389Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class=\"line\">2021-05-06T08:57:03.521511Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class=\"line\">2021-05-06T08:57:03.529529Z 0 [System] [MY-010931] [Server] /opt/homebrew/Cellar/mysql/8.0.23_1/bin/mysqld: ready for connections. Version: &#x27;8.0.23&#x27;  socket: &#x27;/tmp/mysql.sock&#x27;  port: 3306  Homebrew.</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"慢查询日志\"><a href=\"#慢查询日志\" class=\"headerlink\" title=\"慢查询日志\"></a>慢查询日志</h2><h3 id=\"long-query-time\"><a href=\"#long-query-time\" class=\"headerlink\" title=\"long_query_time\"></a>long_query_time</h3><p>mysql 启动时可以设定一个阈值，mysql 会将运行时间超过该值的所有 sql语句都记录到慢查询日志中。如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;long_query_time&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Variable_name   <span class=\"operator\">|</span> <span class=\"keyword\">Value</span>     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> long_query_time <span class=\"operator\">|</span> <span class=\"number\">10.000000</span> <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.02</span> sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;log_slow_queries&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">Empty</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.01</span> sec)</span><br></pre></td></tr></table></figure>\n\n<p>设置 long_query_time 阈值之后，mysql 数据库会记录运行时间超过该阈值的所有 sql 语句，但是对于时间刚好等于 long_query_time 值的不会被记录。从 mysql 5.1 开始，long_query_time开始以微秒记录 sql 语句运行的时间，在此之前都是用秒作为单位记录的。</p>\n<h3 id=\"log-queries-not-using-indexes\"><a href=\"#log-queries-not-using-indexes\" class=\"headerlink\" title=\"log_queries_not_using_indexes\"></a>log_queries_not_using_indexes</h3><p>这是另一个和慢查询有关的参数，这个参数表示，如果运行的 sql 语句没有使用索引，则 mysql 数据库同样会将这条 sql 语句记录到慢查询日志文件。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;log_queries_not_using_indexes&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Variable_name                 <span class=\"operator\">|</span> <span class=\"keyword\">Value</span> <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> log_queries_not_using_indexes <span class=\"operator\">|</span> OFF   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"log-throttle-queries-not-using-indexes\"><a href=\"#log-throttle-queries-not-using-indexes\" class=\"headerlink\" title=\"log_throttle_queries_not_using_indexes\"></a>log_throttle_queries_not_using_indexes</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;log_throttle_queries_not_using_indexes&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Variable_name                          <span class=\"operator\">|</span> <span class=\"keyword\">Value</span> <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> log_throttle_queries_not_using_indexes <span class=\"operator\">|</span> <span class=\"number\">0</span>     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.01</span> sec)</span><br></pre></td></tr></table></figure>\n\n<p>mysql 5.6.5 版本开始新增了 log_throttle_queries_not_using_indexes 这个参数，用来表示每分钟允许记录到 slow log 的且未使用索引的 sql 语句次数。该值默认是0，表示没有限制。在生产环境，如果没有使用索引，此类 sql 语句会频繁的被记录到 slow log，从而导致 slow log 文件不断增加，因此可以通过配置该值进行控制。</p>\n","text":"日志文件记录了影响 mysql 数据库的各种类型活动，mysql 中常见的日志文件主要包括以下 4 种： 错误日志 二进制日志 慢查询日志 查询日志 这些日志文...","permalink":"/post/middleware/middleware-mysql-log-file","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"Middleware","slug":"Middleware","count":14,"path":"api/categories/Middleware.json"}],"tags":[{"name":"mysql","slug":"mysql","count":4,"path":"api/tags/mysql.json"},{"name":"log","slug":"log","count":5,"path":"api/tags/log.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97\"><span class=\"toc-text\">错误日志</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97\"><span class=\"toc-text\">慢查询日志</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#long-query-time\"><span class=\"toc-text\">long_query_time</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#log-queries-not-using-indexes\"><span class=\"toc-text\">log_queries_not_using_indexes</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#log-throttle-queries-not-using-indexes\"><span class=\"toc-text\">log_throttle_queries_not_using_indexes</span></a></li></ol></li></ol>","author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"git 中 merge 和 rebase 小记","uid":"fcd3e7ce113bd1990030da77cb454e76","slug":"git/git-cmd-rebase-merge","date":"2021-11-09T03:32:40.000Z","updated":"2024-07-05T04:09:05.758Z","comments":true,"path":"api/articles/git/git-cmd-rebase-merge.json","keywords":null,"cover":[],"text":"作为一线工程师的你，对于 git一定不会陌生，git 作为一个开源的分布式版本控制系统，有着广泛的用户基础。git 使用有很多可视化的工具，idea 自身也大多...","permalink":"/post/git/git-cmd-rebase-merge","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"git","slug":"git","count":3,"path":"api/categories/git.json"}],"tags":[{"name":"git","slug":"git","count":3,"path":"api/tags/git.json"},{"name":"merge","slug":"merge","count":1,"path":"api/tags/merge.json"},{"name":"rebase","slug":"rebase","count":1,"path":"api/tags/rebase.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}},"next_post":{"title":"聊一聊 Mockito","uid":"9d1ebf7903ce83ad9e7fd07935406bb4","slug":"tests/test-mock-mockito","date":"2021-11-06T03:26:33.000Z","updated":"2024-07-05T04:09:05.845Z","comments":true,"path":"api/articles/tests/test-mock-mockito.json","keywords":null,"cover":[],"text":"Mockito 是 mocking 框架，它让你用简洁的API做测试。而且 Mockito 简单易学，它可读性强和验证语法简洁。 从一个最简单的案例看起 123...","permalink":"/post/tests/test-mock-mockito","photos":[],"count_time":{"symbolsCount":"20k","symbolsTime":"18 mins."},"categories":[{"name":"test","slug":"test","count":5,"path":"api/categories/test.json"}],"tags":[{"name":"test","slug":"test","count":5,"path":"api/tags/test.json"},{"name":"mock","slug":"mock","count":1,"path":"api/tags/mock.json"},{"name":"Mockito","slug":"Mockito","count":1,"path":"api/tags/Mockito.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}}}