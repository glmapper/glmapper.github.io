{"title":"nginx åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥å®æˆ˜æ¡ˆä¾‹","uid":"91728ee079160c4f8cfcf9d960a59096","slug":"middleware/middleware-nginx-proxy","date":"2018-11-15T13:24:52.000Z","updated":"2024-07-05T04:09:05.790Z","comments":true,"path":"api/articles/middleware/middleware-nginx-proxy.json","keywords":null,"cover":[],"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>åŸæ–‡ï¼š<a href=\"https://juejin.cn/post/6844903594244702215\">https://juejin.cn/post/6844903594244702215</a></p></blockquote>\n<h2 id=\"å¼•è¨€\"><a href=\"#å¼•è¨€\" class=\"headerlink\" title=\"å¼•è¨€\"></a>å¼•è¨€</h2><p>å…ˆæ¥çœ‹ä¸‹nginxåœ¨webæœåŠ¡å™¨æ’åä¸Šçš„è¶‹åŠ¿ï¼š<br><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/4/22/162ec151c277a385~tplv-t2oaga2asx-image.image\"></p>\n<p>å­˜åœ¨å³åˆç†ï¼Œé‚£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨nginxå‘¢ï¼Ÿè¿™å¾—çœ‹çœ‹nginxèƒ½å¸®æˆ‘ä»¬åšäº›ä»€ä¹ˆã€‚</p>\n<span id=\"more\"></span>\n\n<p>é¦–å…ˆï¼Œnginxèƒ½åšåå‘ä»£ç†ã€å…³äºåå‘ä»£ç†å’Œæ­£å‘ä»£ç†æ­¤å¤„ä¸åšè¯´æ˜äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´è‡ªè¡Œè°·æ­Œã€‘ï¼›æ¯”æ–¹è¯´ï¼Œæˆ‘æƒ³åœ¨æœ¬åœ°ä½¿ç”¨ <a href=\"http://www.glmapper1.com/\">www.glmapper1.com</a> çš„åŸŸåå»è®¿é—®<a href=\"http://www.taobao.com.é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡nginxå»å®ç°./\">www.taobao.comã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡nginxå»å®ç°ã€‚</a></p>\n<p>å†è€…ï¼Œnginxèƒ½å®ç°è´Ÿè½½å‡è¡¡ï¼Œä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡å‘¢ï¼Ÿå°±æ˜¯è¯´åº”ç”¨éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯é€šè¿‡ç»Ÿä¸€çš„åŸŸåè¿›å…¥ï¼Œnginxåˆ™å¯¹è¯·æ±‚è¿›è¡Œåˆ†å‘ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šå»å¤„ç†ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„å‡è½»äº†å•å°æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p>\n<p>åœ¨ä¸Šé¢è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒnginxæœåŠ¡å™¨çš„ä½œç”¨éƒ½åªæ˜¯ä½œä¸ºåˆ†å‘æœåŠ¡å™¨ï¼ŒçœŸæ­£çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾åœ¨å…¶ä»–çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ¥ï¼Œè¿˜èƒ½èµ·åˆ°ä¸€å±‚å®‰å…¨éš”å£çš„ä½œç”¨ï¼Œnginxä½œä¸ºéš”ç¦»å±‚ã€‚</p>\n<p><strong>è§£å†³è·¨åŸŸé—®é¢˜</strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>åŒæºï¼šURLç”±åè®®ã€åŸŸåã€ç«¯å£å’Œè·¯å¾„ç»„æˆï¼Œå¦‚æœä¸¤ä¸ªURLçš„åè®®ã€åŸŸåå’Œç«¯å£ç›¸åŒï¼Œåˆ™è¡¨ç¤ºä»–ä»¬åŒæºã€‚</p></blockquote>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼šæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œé™åˆ¶äº†æ¥è‡ªä¸åŒæºçš„â€documentâ€æˆ–è„šæœ¬ï¼Œå¯¹å½“å‰â€documentâ€è¯»å–æˆ–è®¾ç½®æŸäº›å±æ€§ã€‚ä»ä¸€ä¸ªåŸŸä¸ŠåŠ è½½çš„è„šæœ¬ä¸å…è®¸è®¿é—®å¦å¤–ä¸€ä¸ªåŸŸçš„æ–‡æ¡£å±æ€§ã€‚</p></blockquote>\n<p>å› ä¸ºnginxå’Œtomcatä¸èƒ½å…±ç”¨åŒä¸€ç«¯å£,urlä¸€æ ·ï¼Œç«¯å£ä¸åŒï¼Œè¿™æ ·å°±ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚</p>\n<p><code>PSï¼šç‚¹åˆ°ä¸ºæ­¢ï¼Œè¿™é‡Œæœ¬æ¬¡æµ‹è¯•æ²¡æœ‰æ¶‰åŠï¼Œå°±ä¸å¦„è‡ªè²è–„äº†ï¼ï¼!</code></p>\n<h2 id=\"é…ç½®æ–‡ä»¶è§£æ\"><a href=\"#é…ç½®æ–‡ä»¶è§£æ\" class=\"headerlink\" title=\"é…ç½®æ–‡ä»¶è§£æ\"></a>é…ç½®æ–‡ä»¶è§£æ</h2><p>é…ç½®æ–‡ä»¶ä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š</p>\n<ul>\n<li>main(å…¨åŒºè®¾ç½®)</li>\n<li>server(ä¸»æœºé…ç½®)</li>\n<li>http(æ§åˆ¶ç€nginx httpå¤„ç†çš„æ‰€æœ‰æ ¸å¿ƒç‰¹æ€§)<ul>\n<li>location(URLåŒ¹é…ç‰¹å®šä½ç½®è®¾ç½®)ã€‚</li>\n</ul>\n</li>\n<li>upstream(è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®)</li>\n</ul>\n<p>ä¸‹é¢ä»¥é»˜è®¤çš„é…ç½®æ–‡ä»¶æ¥è¯´æ˜ä¸‹å…·ä½“çš„é…ç½®æ–‡ä»¶å±æ€§å«ä¹‰ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#Nginxçš„workerè¿›ç¨‹è¿è¡Œç”¨æˆ·ä»¥åŠç”¨æˆ·ç»„</span><br><span class=\"line\">#user  nobody;</span><br><span class=\"line\"></span><br><span class=\"line\">#Nginxå¼€å¯çš„è¿›ç¨‹æ•°</span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\"></span><br><span class=\"line\">#å®šä¹‰å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[debug|info|notice|warn|crit]</span><br><span class=\"line\">#error_log  logs/error.log;</span><br><span class=\"line\">#error_log  logs/error.log  notice;</span><br><span class=\"line\">#error_log  logs/error.log  info;</span><br><span class=\"line\"></span><br><span class=\"line\">#æŒ‡å®šè¿›ç¨‹IDå­˜å‚¨æ–‡ä»¶ä½ç½®</span><br><span class=\"line\">#pid        logs/nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#äº‹ä»¶é…ç½®</span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    #use [ kqueue | rtsig | epoll | /dev/poll | select | poll ];</span><br><span class=\"line\">    #epollæ¨¡å‹æ˜¯Linuxå†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œå¦‚æœåœ¨macä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚</span><br><span class=\"line\">    use kqueue;</span><br><span class=\"line\">    </span><br><span class=\"line\">    #æ¯ä¸ªè¿›ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§è¿æ¥æ•°ï¼Œç†è®ºä¸Šæ¯å°nginxæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸ºworker_processes*worker_connectionsã€‚ç†è®ºå€¼ï¼šworker_rlimit_nofile/worker_processes</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">#httpå‚æ•°</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    #é»˜è®¤æ–‡ä»¶ç±»å‹</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\">    </span><br><span class=\"line\">    #æ—¥å¿—ç›¸å…³å®šä¹‰</span><br><span class=\"line\">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    #è¿æ¥æ—¥å¿—çš„è·¯å¾„ï¼ŒæŒ‡å®šçš„æ—¥å¿—æ ¼å¼æ”¾åœ¨æœ€åã€‚</span><br><span class=\"line\">    #access_log  logs/access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    #å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼</span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    </span><br><span class=\"line\">    #é˜²æ­¢ç½‘ç»œé˜»å¡</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</span><br><span class=\"line\">    #keepalive_timeout  0;</span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\"></span><br><span class=\"line\">    #å¼€å¯gzipå‹ç¼©è¾“å‡º</span><br><span class=\"line\">    #gzip  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #è™šæ‹Ÿä¸»æœºåŸºæœ¬è®¾ç½®</span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        #ç›‘å¬çš„ç«¯å£å·</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        #è®¿é—®åŸŸå</span><br><span class=\"line\">        server_name  localhost;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #ç¼–ç æ ¼å¼ï¼Œå¦‚æœç½‘é¡µæ ¼å¼ä¸å½“å‰é…ç½®çš„ä¸åŒçš„è¯å°†ä¼šè¢«è‡ªåŠ¨è½¬ç </span><br><span class=\"line\">        #charset koi8-r;</span><br><span class=\"line\"></span><br><span class=\"line\">        #è™šæ‹Ÿä¸»æœºè®¿é—®æ—¥å¿—å®šä¹‰</span><br><span class=\"line\">        #access_log  logs/host.access.log  main;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #å¯¹URLè¿›è¡ŒåŒ¹é…</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            #è®¿é—®è·¯å¾„ï¼Œå¯ç›¸å¯¹ä¹Ÿå¯ç»å¯¹è·¯å¾„</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">            #é¦–é¡µæ–‡ä»¶ï¼ŒåŒ¹é…é¡ºåºæŒ‰ç…§é…ç½®é¡ºåºåŒ¹é…</span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #é”™è¯¯ä¿¡æ¯è¿”å›é¡µé¢</span><br><span class=\"line\">        #error_page  404              /404.html;</span><br><span class=\"line\">        </span><br><span class=\"line\">        # redirect server error pages to the static page /50x.html</span><br><span class=\"line\">        #</span><br><span class=\"line\">        error_page   500 502 503 504  /50x.html;</span><br><span class=\"line\">        location = /50x.html &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #è®¿é—®URLä»¥.phpç»“å°¾åˆ™è‡ªåŠ¨è½¬äº¤ç»™127.0.0.1</span><br><span class=\"line\">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ \\.php$ &#123;</span><br><span class=\"line\">        #    proxy_pass   http://127.0.0.1;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #phpè„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘ç»™FastCGIå¤„ç†</span><br><span class=\"line\">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ \\.php$ &#123;</span><br><span class=\"line\">        #    root           html;</span><br><span class=\"line\">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">        #    fastcgi_index  index.php;</span><br><span class=\"line\">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class=\"line\">        #    include        fastcgi_params;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        #ç¦æ­¢è®¿é—®.hté¡µé¢</span><br><span class=\"line\">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class=\"line\">        # concurs with nginx&#x27;s one</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ /\\.ht &#123;</span><br><span class=\"line\">        #    deny  all;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    #ç¬¬äºŒä¸ªè™šæ‹Ÿä¸»æœºé…ç½®</span><br><span class=\"line\">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class=\"line\">    #</span><br><span class=\"line\">    #server &#123;</span><br><span class=\"line\">    #    listen       8000;</span><br><span class=\"line\">    #    listen       somename:8080;</span><br><span class=\"line\">    #    server_name  somename  alias  another.alias;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    location / &#123;</span><br><span class=\"line\">    #        root   html;</span><br><span class=\"line\">    #        index  index.html index.htm;</span><br><span class=\"line\">    #    &#125;</span><br><span class=\"line\">    #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    #HTTPSè™šæ‹Ÿä¸»æœºå®šä¹‰</span><br><span class=\"line\">    # HTTPS server</span><br><span class=\"line\">    #</span><br><span class=\"line\">    #server &#123;</span><br><span class=\"line\">    #    listen       443 ssl;</span><br><span class=\"line\">    #    server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_certificate      cert.pem;</span><br><span class=\"line\">    #    ssl_certificate_key  cert.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class=\"line\">    #    ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    #    ssl_prefer_server_ciphers  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    location / &#123;</span><br><span class=\"line\">    #        root   html;</span><br><span class=\"line\">    #        index  index.html index.htm;</span><br><span class=\"line\">    #    &#125;</span><br><span class=\"line\">    #&#125;</span><br><span class=\"line\">    include servers/*;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"åå‘ä»£ç†å®ä¾‹\"><a href=\"#åå‘ä»£ç†å®ä¾‹\" class=\"headerlink\" title=\"åå‘ä»£ç†å®ä¾‹\"></a>åå‘ä»£ç†å®ä¾‹</h2><p>å‡è®¾æˆ‘ç°åœ¨éœ€è¦æœ¬åœ°è®¿é—®<a href=\"http://www.baidu.com;é…ç½®å¦‚ä¸‹ï¼š\">www.baidu.com;é…ç½®å¦‚ä¸‹ï¼š</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    #ç›‘å¬80ç«¯å£</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name localhost;</span><br><span class=\"line\">     # individual nginx logs for this web vhost</span><br><span class=\"line\">    access_log /tmp/access.log;</span><br><span class=\"line\">    error_log  /tmp/error.log ;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://www.baidu.com;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>éªŒè¯ç»“æœï¼š</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/4/22/162ec5d6cc09a498~tplv-t2oaga2asx-image.image\"></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨localhostæ‰“å¼€äº†ç™¾åº¦çš„é¦–é¡µâ€¦</p>\n<h2 id=\"è´Ÿè½½å‡è¡¡å®ä¾‹\"><a href=\"#è´Ÿè½½å‡è¡¡å®ä¾‹\" class=\"headerlink\" title=\"è´Ÿè½½å‡è¡¡å®ä¾‹\"></a>è´Ÿè½½å‡è¡¡å®ä¾‹</h2><p>ä¸‹é¢ä¸»è¦éªŒè¯æœ€å¸¸ç”¨çš„ä¸‰ç§è´Ÿè½½ç­–ç•¥ã€‚è™šæ‹Ÿä¸»æœºé…ç½®ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    #ç›‘å¬80ç«¯å£</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name localhost;</span><br><span class=\"line\">    </span><br><span class=\"line\">    # individual nginx logs for this web vhost</span><br><span class=\"line\">    access_log /tmp/access.log;</span><br><span class=\"line\">    error_log  /tmp/error.log ;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        #è´Ÿè½½å‡è¡¡</span><br><span class=\"line\">        #è½®è¯¢ </span><br><span class=\"line\">        #proxy_pass http://polling_strategy;</span><br><span class=\"line\">        #weightæƒé‡</span><br><span class=\"line\">        #proxy_pass http://weight_strategy;</span><br><span class=\"line\">        #ip_hash</span><br><span class=\"line\">        # proxy_pass http://ip_hash_strategy;</span><br><span class=\"line\">        #fair</span><br><span class=\"line\">        # proxy_pass http://fair_strategy;</span><br><span class=\"line\">        #url_hash</span><br><span class=\"line\">        # proxy_pass http://url_hash_strategy;</span><br><span class=\"line\">        #é‡å®šå‘</span><br><span class=\"line\">        #rewrite ^ http://localhost:8080;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"è½®è¯¢ç­–ç•¥\"><a href=\"#è½®è¯¢ç­–ç•¥\" class=\"headerlink\" title=\"è½®è¯¢ç­–ç•¥\"></a>è½®è¯¢ç­–ç•¥</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰</span><br><span class=\"line\"># æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ </span><br><span class=\"line\">upstream polling_strategy &#123; </span><br><span class=\"line\">    server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1</span><br><span class=\"line\">    server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n<p>æµ‹è¯•ç»“æœï¼ˆé€šè¿‡ç«¯å£å·æ¥åŒºåˆ†å½“å‰è®¿é—®ï¼‰ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">8081ï¼šhello</span><br><span class=\"line\">8080ï¼šhello</span><br><span class=\"line\">8081ï¼šhello</span><br><span class=\"line\">8080ï¼šhello</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æƒé‡ç­–ç•¥\"><a href=\"#æƒé‡ç­–ç•¥\" class=\"headerlink\" title=\"æƒé‡ç­–ç•¥\"></a>æƒé‡ç­–ç•¥</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#2ã€æŒ‡å®šæƒé‡</span><br><span class=\"line\">#æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ </span><br><span class=\"line\">upstream  weight_strategy &#123; </span><br><span class=\"line\">    server glmapper.net:8080 weight=1; # åº”ç”¨æœåŠ¡å™¨1</span><br><span class=\"line\">    server glmapper.net:8081 weight=9; # åº”ç”¨æœåŠ¡å™¨2</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æµ‹è¯•ç»“æœï¼šæ€»è®¿é—®æ¬¡æ•°15æ¬¡ï¼Œæ ¹æ®ä¸Šé¢çš„æƒé‡é…ç½®ï¼Œä¸¤å°æœºå™¨çš„è®¿é—®æ¯”é‡ï¼š2ï¼š13ï¼›æ»¡è¶³é¢„æœŸï¼</p>\n<h3 id=\"ip-hashç­–ç•¥\"><a href=\"#ip-hashç­–ç•¥\" class=\"headerlink\" title=\"ip hashç­–ç•¥\"></a>ip hashç­–ç•¥</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#3ã€IPç»‘å®š ip_hash</span><br><span class=\"line\">#æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œ</span><br><span class=\"line\">#å¯ä»¥è§£å†³sessionçš„é—®é¢˜;åœ¨ä¸è€ƒè™‘å¼•å…¥åˆ†å¸ƒå¼sessionçš„æƒ…å†µä¸‹ï¼Œ</span><br><span class=\"line\">#åŸç”ŸHttpSessionåªå¯¹å½“å‰servletå®¹å™¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæœ‰æ•ˆ</span><br><span class=\"line\">upstream ip_hash_strategy &#123; </span><br><span class=\"line\">    ip_hash; </span><br><span class=\"line\">    server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1</span><br><span class=\"line\">    server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>iphash ç®—æ³•:ipæ˜¯åŸºæœ¬çš„ç‚¹åˆ†åè¿›åˆ¶ï¼Œå°†ipçš„å‰ä¸‰ä¸ªç«¯ä½œä¸ºå‚æ•°åŠ å…¥hashå‡½æ•°ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¿è¯ipåœ°å€å‰ä¸‰ä½ç›¸åŒçš„ç”¨æˆ·ç»è¿‡hashè®¡ç®—å°†åˆ†é…åˆ°ç›¸åŒçš„åç«¯serverã€‚ä½œè€…çš„è¿™ä¸ªè€ƒè™‘æ˜¯æä¸ºå¯å–çš„ï¼Œå› æ­¤ipåœ°å€å‰ä¸‰ä½ç›¸åŒé€šå¸¸æ„å‘³ç€æ¥ç€åŒä¸€ä¸ªå±€åŸŸç½‘æˆ–è€…ç›¸é‚»åŒºåŸŸï¼Œä½¿ç”¨ç›¸åŒçš„åç«¯æœåŠ¡è®©nginxåœ¨ä¸€å®šç¨‹åº¦ä¸Šæ›´å…·æœ‰ä¸€è‡´æ€§ã€‚</p></blockquote>\n<p>ä¸ºä»€ä¹ˆè¯´è¦è§£é‡Šä¸‹iphash,å› ä¸ºé‡‡å‘äº†ï¼›å’ŒçŒªå¼Ÿåœ¨è¿›è¡Œè¿™ä¸ªç­–ç•¥æµ‹è¯•æ—¶ä½¿ç”¨äº†5å°æœºå™¨æ¥æµ‹è¯•çš„ï¼Œ5å°æœºå™¨å‡åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€192.168.3.Xã€‘;æµ‹è¯•æ—¶å‘ç°5å°æœºå™¨æ¯æ¬¡éƒ½è·¯ç”±åˆ°äº†åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯é…ç½®é—®é¢˜ï¼Œä½†æ˜¯æ’æŸ¥ä¹‹åä¹Ÿæ’é™¤äº†è¿™ä¸ªå¯èƒ½æ€§ã€‚æœ€åè€ƒè™‘åˆ°å¯èƒ½æ˜¯å¯¹äºåŒç½‘æ®µçš„ipåšäº†ç‰¹æ®Šå¤„ç†ï¼ŒéªŒè¯ä¹‹åç¡®è®¤äº†çŒœæµ‹ã€‚</p>\n<h3 id=\"å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥\"><a href=\"#å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥\" class=\"headerlink\" title=\"å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥\"></a>å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p>è¿™é‡Œå› ä¸ºéœ€è¦å®‰è£…ä¸‰æ–¹æ’ä»¶ï¼Œæ—¶é—´æœ‰é™å°±ä¸éªŒè¯äº†ï¼ŒçŸ¥æ‚‰å³å¯ï¼</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#4ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</span><br><span class=\"line\">#æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ </span><br><span class=\"line\">upstream fair_strategy &#123; </span><br><span class=\"line\">    server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1</span><br><span class=\"line\">    server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2</span><br><span class=\"line\">    fair; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">#5ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</span><br><span class=\"line\">#æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œ</span><br><span class=\"line\">#åç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ </span><br><span class=\"line\">upstream url_hash_strategy &#123; </span><br><span class=\"line\">    server glmapper.net:8080; # åº”ç”¨æœåŠ¡å™¨1</span><br><span class=\"line\">    server glmapper.net:8081; # åº”ç”¨æœåŠ¡å™¨2 </span><br><span class=\"line\">    hash $request_uri; </span><br><span class=\"line\">    hash_method crc32; </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"é‡å®šå‘rewrite\"><a href=\"#é‡å®šå‘rewrite\" class=\"headerlink\" title=\"é‡å®šå‘rewrite\"></a>é‡å®šå‘rewrite</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location / &#123;</span><br><span class=\"line\">    #é‡å®šå‘</span><br><span class=\"line\">    #rewrite ^ http://localhost:8080;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>éªŒè¯æ€è·¯ï¼šæœ¬åœ°ä½¿ç”¨localhost:80ç«¯å£è¿›è¡Œè®¿é—®ï¼Œæ ¹æ®nginxçš„é…ç½®ï¼Œå¦‚æœé‡å®šå‘æ²¡æœ‰ç”Ÿæ•ˆï¼Œåˆ™æœ€åä¼šåœç•™åœ¨å½“å‰localhost:80è¿™ä¸ªè·¯å¾„ï¼Œæµè§ˆå™¨ä¸­çš„åœ°å€æ åœ°å€ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼›å¦‚æœç”Ÿæ•ˆäº†åˆ™åœ°å€æ åœ°å€å˜ä¸ºlocalhost:8080ï¼›</p>\n<p>é€šè¿‡éªŒè¯ï¼Œæ»¡è¶³é¢„æœŸï¼</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>æœ¬æ–‡å…ˆå¯¹nginxçš„ä½œç”¨å’ŒåŸºæœ¬çš„é…ç½®åšäº†ç®€å•è¯´æ˜ï¼›ç„¶åé€šè¿‡è´Ÿè½½å‡è¡¡çš„å®ä¾‹æµ‹è¯•äº†ä¸åŒè´Ÿè½½å‡è¡¡ç®—æ³•çš„å…·ä½“åº”ç”¨åé¦ˆç»“æœã€‚å¸®åŠ©è‡ªå·±æ›´åŠ æ·±åˆ»çš„ç†è§£nginxæœåŠ¡å™¨ä¸­çš„ä¸€äº›é…ç½®ç»†èŠ‚ã€‚æ„Ÿè°¢åˆ˜ç§˜æä¾›çš„helloworldç¨‹åºã€åŸºäºspringbootçš„è„šæ‰‹æ¶ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è”ç³»ä»–è·å–ï¼›è¿˜æœ‰å°±æ˜¯åˆ˜ç§˜æ˜¯ä¸ªç”·çš„â€¦ğŸ˜œã€‘</p>\n<h2 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h2><ul>\n<li><a href=\"http://nginx.org/\">http://nginx.org/</a></li>\n<li><a href=\"https://www.nginx.com/\">https://www.nginx.com/</a></li>\n<li><a href=\"http://www.sohu.com/a/161411719_324809\">http://www.sohu.com/a/161411719_324809</a></li>\n</ul>\n","text":" åŸæ–‡ï¼šhttps://juejin.cn/post/6844903594244702215 å¼•è¨€å…ˆæ¥çœ‹ä¸‹nginxåœ¨webæœåŠ¡å™¨æ’åä¸Šçš„è¶‹åŠ¿ï¼š å­˜åœ¨å³åˆç†ï¼Œé‚£...","permalink":"/post/middleware/middleware-nginx-proxy","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[{"name":"Middleware","slug":"Middleware","count":14,"path":"api/categories/Middleware.json"}],"tags":[{"name":"nginx","slug":"nginx","count":2,"path":"api/tags/nginx.json"},{"name":"åå‘ä»£ç†","slug":"åå‘ä»£ç†","count":2,"path":"api/tags/åå‘ä»£ç†.json"},{"name":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","count":3,"path":"api/tags/è´Ÿè½½å‡è¡¡.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BC%95%E8%A8%80\"><span class=\"toc-text\">å¼•è¨€</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">é…ç½®æ–‡ä»¶è§£æ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E4%BE%8B\"><span class=\"toc-text\">åå‘ä»£ç†å®ä¾‹</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E4%BE%8B\"><span class=\"toc-text\">è´Ÿè½½å‡è¡¡å®ä¾‹</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BD%AE%E8%AF%A2%E7%AD%96%E7%95%A5\"><span class=\"toc-text\">è½®è¯¢ç­–ç•¥</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9D%83%E9%87%8D%E7%AD%96%E7%95%A5\"><span class=\"toc-text\">æƒé‡ç­–ç•¥</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ip-hash%E7%AD%96%E7%95%A5\"><span class=\"toc-text\">ip hashç­–ç•¥</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B6%E4%BB%96%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5\"><span class=\"toc-text\">å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%AE%9A%E5%90%91rewrite\"><span class=\"toc-text\">é‡å®šå‘rewrite</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">æ€»ç»“</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83\"><span class=\"toc-text\">å‚è€ƒ</span></a></li></ol>","author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"å¼€æ”¾ï¼Œå¼€æºï¼Œåˆ†äº«ï¼Œå…±äº«","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"SOFABoot å¥åº·æ£€æŸ¥èƒ½åŠ›åˆ†æ","uid":"1e1a697103974a7aac0ac3d3d33e9f33","slug":"sofa/sofa-boot-health-analizy","date":"2018-11-16T11:14:43.000Z","updated":"2024-07-05T04:09:05.801Z","comments":true,"path":"api/articles/sofa/sofa-boot-health-analizy.json","keywords":null,"cover":[],"text":"Liveness Check & Readiness CheckSpring Boot æä¾›äº†ä¸€ä¸ªåŸºç¡€çš„å¥åº·æ£€æŸ¥çš„èƒ½åŠ›ï¼Œä¸­é—´ä»¶å’Œåº”ç”¨éƒ½å¯ä»¥æ‰©å±•æ¥å®ç°è‡ªå·±çš„å¥åº·æ£€...","permalink":"/post/sofa/sofa-boot-health-analizy","photos":[],"count_time":{"symbolsCount":"21k","symbolsTime":"19 mins."},"categories":[{"name":"SOFA","slug":"SOFA","count":9,"path":"api/categories/SOFA.json"}],"tags":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","count":1,"path":"api/tags/æ¡†æ¶.json"},{"name":"Readiness Check","slug":"Readiness-Check","count":1,"path":"api/tags/Readiness-Check.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"å¼€æ”¾ï¼Œå¼€æºï¼Œåˆ†äº«ï¼Œå…±äº«","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}},"next_post":{"title":"å…³äº rpc çš„æ•´ç†å’Œç†è§£","uid":"80757c505c28d656f4a66a57e05f0132","slug":"middleware/middleware-rpc-about","date":"2018-11-12T13:22:44.000Z","updated":"2024-07-05T04:09:05.790Z","comments":true,"path":"api/articles/middleware/middleware-rpc-about.json","keywords":null,"cover":[],"text":"RPC çš„ä¸»è¦ç›®æ ‡å°±æ˜¯ä¸ºäº†è®©æ„å»ºåˆ†å¸ƒå¼è®¡ç®—ï¼ˆåº”ç”¨ï¼‰å˜å¾—æ›´åŠ ç®€å•ï¼Œåœ¨æä¾›å¼ºå¤§çš„è¿œç¨‹è°ƒç”¨èƒ½åŠ›æ—¶ä¸æŸå¤±æœ¬åœ°è°ƒç”¨çš„è¯­ä¹‰ç®€æ´æ€§ã€‚ ä¸ºå®ç°è¯¥ç›®æ ‡ï¼ŒRPC æ¡†æ¶éœ€æä¾›ä¸€ç§é€æ˜...","permalink":"/post/middleware/middleware-rpc-about","photos":[],"count_time":{"symbolsCount":"4.3k","symbolsTime":"4 mins."},"categories":[{"name":"Middleware","slug":"Middleware","count":14,"path":"api/categories/Middleware.json"}],"tags":[{"name":"rpc","slug":"rpc","count":1,"path":"api/tags/rpc.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"å¼€æ”¾ï¼Œå¼€æºï¼Œåˆ†äº«ï¼Œå…±äº«","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}}}