{"title":"git 中 merge 和 rebase 小记","uid":"fcd3e7ce113bd1990030da77cb454e76","slug":"git/git-cmd-rebase-merge","date":"2021-11-09T03:32:40.000Z","updated":"2024-07-05T04:09:05.758Z","comments":true,"path":"api/articles/git/git-cmd-rebase-merge.json","keywords":null,"cover":[],"content":"<p>作为一线工程师的你，对于 git一定不会陌生，git 作为一个开源的分布式版本控制系统，有着广泛的用户基础。git 使用有很多可视化的工具，idea 自身也大多都集成了 git 套件，如下：</p>\n<span id=\"more\"></span>\n\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82fe2b984ac54ebd9faea3b77772dbcc~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>不过相比于这些可视化工具，我更喜欢使用命令行的方式。</p>\n<p>本篇背景也是源于实际工作，一个同学遇到的问题是：他从 master 分支自己拉了一个开发分支，但是由于时间很长，所以在提交之前他执行了:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull</span><br></pre></td></tr></table></figure>\n\n<p>然后 push ，当提交 mr 时发现，自己的提交里有很多别人的 commit 记录。ok，这里背景交代清楚，我们通过一个实际的 case 来看看。</p>\n<h2 id=\"git-pull-发生了什么？\"><a href=\"#git-pull-发生了什么？\" class=\"headerlink\" title=\"git pull 发生了什么？\"></a>git pull 发生了什么？</h2><ul>\n<li>从 master 分支切出一个 dev 分支</li>\n<li>切到 master 分支，代码修改，然后提交</li>\n<li>切回 dev ，执行 git pull</li>\n</ul>\n<p>在执行 <code>git pull</code> 之前，先看下 git log</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb433208c819455b8ba5ce12afcecb84~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>执行 <code>git pull</code> 之后</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52dac2e2d24344ff9092435f01717c11~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>所以可以非常明显的看到，git pull 操作中有把 master merge 到当前 dev，实际上 git pull 是下面两个指令的整合：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull = git fetch + git merge</span><br></pre></td></tr></table></figure>\n\n<p>那既然是 merge，所以 dev 中后续的提交，都会带上此次 merge 的 commit 记录；</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fa61852543c4509989cbf6dc032aed2~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>这就是那位同学遇到的问题。如果我们不想让自己的提交中含有其他无关的 commit 怎么办？此时就需要 rebase 出场了。</p>\n<h2 id=\"git-rebase\"><a href=\"#git-rebase\" class=\"headerlink\" title=\"git rebase\"></a>git rebase</h2><ul>\n<li>从 master 切 一个 rebase-dev 分支</li>\n<li>从 master 切 一个 rebase-dev2 分支</li>\n<li>修改 rebase-dev2，然后提交，merge 到 master</li>\n</ul>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e66cb88a5a71415099082ec6f6d1c8f0~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>两次提交记录；这里基于前面提到的 git pull 行为，如果我们期望 rebase-dev 的提交不包括 rebase-dev2 的提交，但是从 log 看， rebase-dev 已经在最新 commit 后面了</p>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f52ca4786fc64beabdff8f4755c2de84~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>git rebase 本质上是需要给 rebase-dev 变基，就是将基线拉到最新 commit 之前，在 rebase-dev 分支下，执行 <code>git rebase master</code>，此时再观察下 log</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d370e84f6274d9dbc84a1bf9eed9ab0~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>可以看到 rebase-dev 已经跑到上面了，下面在 rebase-dev 做修改提交</p>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05bf5ed23ff349c6bc63a9ed7093d7fd~tplv-k3u1fbpfcp-watermark.image\" alt=\"image.png\"></p>\n<p>可以看下，此时提交就没有 rebase-dev2 的 commit 记录了。</p>\n<h2 id=\"关于-git-merge-和-git-rebase-的小结\"><a href=\"#关于-git-merge-和-git-rebase-的小结\" class=\"headerlink\" title=\"关于 git merge 和 git rebase 的小结\"></a>关于 git merge 和 git rebase 的小结</h2><ul>\n<li>git merge：分支代码合并后不会破坏原分支的代码提交记录，但是会产生额外的提交记录并进行两条分支的合并</li>\n<li>git rebase：不会新增提交记录到目标分支，rebase 后可以将对象分支的提交历史续到目标分支上，形成线性提交历史记录</li>\n</ul>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>所以你学废了吗？</p></blockquote>\n","text":"作为一线工程师的你，对于 git一定不会陌生，git 作为一个开源的分布式版本控制系统，有着广泛的用户基础。git 使用有很多可视化的工具，idea 自身也大多...","permalink":"/post/git/git-cmd-rebase-merge","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"git","slug":"git","count":3,"path":"api/categories/git.json"}],"tags":[{"name":"git","slug":"git","count":3,"path":"api/tags/git.json"},{"name":"merge","slug":"merge","count":1,"path":"api/tags/merge.json"},{"name":"rebase","slug":"rebase","count":1,"path":"api/tags/rebase.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#git-pull-%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F\"><span class=\"toc-text\">git pull 发生了什么？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#git-rebase\"><span class=\"toc-text\">git rebase</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%85%B3%E4%BA%8E-git-merge-%E5%92%8C-git-rebase-%E7%9A%84%E5%B0%8F%E7%BB%93\"><span class=\"toc-text\">关于 git merge 和 git rebase 的小结</span></a></li></ol>","author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"为什么你的 SpringBoot 自动配置失效了","uid":"0733c66f6904b8d3bf1d0aaecefb6227","slug":"springboot/springboot-series-autoconfigure-invalid","date":"2021-11-15T03:35:18.000Z","updated":"2024-07-05T04:09:05.827Z","comments":true,"path":"api/articles/springboot/springboot-series-autoconfigure-invalid.json","keywords":null,"cover":[],"text":"本文源自近期项目中遇到的问题， bug 总是出现在你自以为是的地方… 问题描述下面是一个简单复现的代码片段，在你没有阅读完本文时，如果能做出正确的判断，那恭喜你...","permalink":"/post/springboot/springboot-series-autoconfigure-invalid","photos":[],"count_time":{"symbolsCount":"6.8k","symbolsTime":"6 mins."},"categories":[{"name":"SpringBoot","slug":"SpringBoot","count":17,"path":"api/categories/SpringBoot.json"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","count":17,"path":"api/tags/SpringBoot.json"},{"name":"自动配置","slug":"自动配置","count":2,"path":"api/tags/自动配置.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}},"next_post":{"title":"mysql 日志文件","uid":"b98b36bd5e2d6f53b8f282c8597b8e9d","slug":"middleware/middleware-mysql-log-file","date":"2021-11-08T03:30:18.000Z","updated":"2024-07-05T04:09:05.789Z","comments":true,"path":"api/articles/middleware/middleware-mysql-log-file.json","keywords":null,"cover":null,"text":"日志文件记录了影响 mysql 数据库的各种类型活动，mysql 中常见的日志文件主要包括以下 4 种： 错误日志 二进制日志 慢查询日志 查询日志 这些日志文...","permalink":"/post/middleware/middleware-mysql-log-file","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"Middleware","slug":"Middleware","count":13,"path":"api/categories/Middleware.json"}],"tags":[{"name":"mysql","slug":"mysql","count":4,"path":"api/tags/mysql.json"},{"name":"log","slug":"log","count":5,"path":"api/tags/log.json"}],"author":{"name":"glmapper","slug":"blog-author","avatar":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/favicon.ico","link":"/","description":"开放，开源，分享，共享","socials":{"github":"https://github.com/glmapper","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/2412872703","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/3227821827961806","customs":{"sofastack":{"icon":"https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/common/sofastack.svg","link":"https://www.sofastack.tech/"}}}}}}